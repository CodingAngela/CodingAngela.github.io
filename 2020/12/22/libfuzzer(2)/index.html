<!doctype html>
<html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>（转）LibFuzzer workshop学习之路（二） - An9Ela</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="An9Ela"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="An9Ela"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="文章首发于安全客，由安全客原创发布： https:&amp;#x2F;&amp;#x2F;www.anquanke.com&amp;#x2F;post&amp;#x2F;id&amp;#x2F;225957 LibFuzzer workshop学习之路（二） 上一篇对libfuzzer的原理和使用有了基本的了解，接下来就到进阶的内容了，会涉及到字典的使用，语料库精简，错误报告生成以及一些关键的编译选项的选择等内容，希望能对libfuzzer有更深入的学习。"><meta property="og:type" content="article"><meta property="og:title" content="（转）LibFuzzer workshop学习之路（二）"><meta property="og:url" content="https://github.com/CodingAngela/CodingAngela.github.io.git/2020/12/22/libfuzzer(2)/"><meta property="og:site_name" content="An9Ela"><meta property="og:description" content="文章首发于安全客，由安全客原创发布： https:&amp;#x2F;&amp;#x2F;www.anquanke.com&amp;#x2F;post&amp;#x2F;id&amp;#x2F;225957 LibFuzzer workshop学习之路（二） 上一篇对libfuzzer的原理和使用有了基本的了解，接下来就到进阶的内容了，会涉及到字典的使用，语料库精简，错误报告生成以及一些关键的编译选项的选择等内容，希望能对libfuzzer有更深入的学习。"><meta property="og:image" content="https://github.com/img/og_image.png"><meta property="article:published_time" content="2020-12-22T10:00:20.000Z"><meta property="article:modified_time" content="2021-06-09T08:08:12.545Z"><meta property="article:author" content="An9Ela"><meta property="article:tag" content="FUZZ"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/CodingAngela/CodingAngela.github.io.git/2020/12/22/libfuzzer(2)/"},"headline":"（转）LibFuzzer workshop学习之路（二）","image":["https://github.com/img/og_image.png"],"datePublished":"2020-12-22T10:00:20.000Z","dateModified":"2021-06-09T08:08:12.545Z","author":{"@type":"Person","name":"An9Ela"},"publisher":{"@type":"Organization","name":"An9Ela","logo":{"@type":"ImageObject"}},"description":"文章首发于安全客，由安全客原创发布： https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;225957 LibFuzzer workshop学习之路（二） 上一篇对libfuzzer的原理和使用有了基本的了解，接下来就到进阶的内容了，会涉及到字典的使用，语料库精简，错误报告生成以及一些关键的编译选项的选择等内容，希望能对libfuzzer有更深入的学习。"}</script><link rel="canonical" href="https://github.com/CodingAngela/CodingAngela.github.io.git/2020/12/22/libfuzzer(2)/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">An9Ela</a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-12-22T10:00:20.000Z" title="2020-12-22 6:00:20 ├F10: PM┤">2020-12-22</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-06-09T08:08:12.545Z" title="2021-6-9 4:08:12 ├F10: PM┤">2021-06-09</time></span></div></div><h1 class="title is-3 is-size-4-mobile">（转）LibFuzzer workshop学习之路（二）</h1><div class="content"><p>文章首发于安全客，由安全客原创发布： <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/225957">https://www.anquanke.com/post/id/225957</a></p>
<h3 id="LibFuzzer-workshop学习之路（二）"><a href="#LibFuzzer-workshop学习之路（二）" class="headerlink" title="LibFuzzer workshop学习之路（二）"></a>LibFuzzer workshop学习之路（二）</h3><blockquote>
<p>上一篇对libfuzzer的原理和使用有了基本的了解，接下来就到进阶的内容了，会涉及到字典的使用，语料库精简，错误报告生成以及一些关键的编译选项的选择等内容，希望能对libfuzzer有更深入的学习。</p>
</blockquote>
<span id="more"></span>
<h4 id="lesson-08-dictionaries-are-so-effective"><a href="#lesson-08-dictionaries-are-so-effective" class="headerlink" title="lesson 08(dictionaries are so effective)"></a>lesson 08(dictionaries are so effective)</h4><p>对libxml2进行fuzz。<br>首先对其解压并用clang编译之。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar xzf libxml2.tgz</span><br><span class="line">cd libxml2</span><br><span class="line"></span><br><span class="line">./autogen.sh</span><br><span class="line">export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link&quot;</span><br><span class="line">CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \</span><br><span class="line">    CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot;  ./configure</span><br><span class="line">make -j$(nproc)</span><br></pre></td></tr></table></figure>
<p>解释下新的编译选项<br><code>-gline-tables-only</code>:表示使用采样分析器<br>clang手册中对采样分析器的解释:<code>Sampling profilers are used to collect runtime information, such as hardware counters, while your application executes. They are typically very efficient and do not incur a large runtime overhead. The sample data collected by the profiler can be used during compilation to determine what the most executed areas of the code are.</code><br>用于收集程序执行期间的信息比如硬件计数器，在编译期间使用采样分析器所收集的数据来确定代码中最值得执行的区域。因此，使用样本分析器中的数据需要对程序的构建方式进行一些更改。在编译器可以使用分析信息之前，代码需要在分析器下执行。这也对提高我们fuzz效率很重要。<br>提供的harness：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2015 The Chromium Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></span><br><span class="line"><span class="comment">// found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libxml/parser.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ignore</span> <span class="params">(<span class="type">void</span>* ctx, <span class="type">const</span> <span class="type">char</span>* msg, ...)</span> &#123;</span><br><span class="line">  <span class="comment">// Error handler to avoid spam of error messages from libxml parser.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">int</span> <span class="title function_">LLVMFuzzerTestOneInput</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> size)</span> &#123;</span><br><span class="line">  xmlSetGenericErrorFunc(<span class="literal">NULL</span>, &amp;ignore);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">auto</span> doc = xmlReadMemory(reinterpret_cast&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(data),</span><br><span class="line">                               static_cast&lt;<span class="type">int</span>&gt;(size), <span class="string">&quot;noname.xml&quot;</span>, <span class="literal">NULL</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">    xmlFreeDoc(doc);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将输入的样本类型转换后交给<code>xmlReadMemory</code>处理。编译如下：<br><code>clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -std=c++11 xml_read_memory_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2.9.2-fsanitize_fuzzer1</code></p>
<p>由于编译时使用了样本分析器，fuzz的执行速率和覆盖率都很可观</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2481433</span>	NEW    cov: <span class="number">2018</span> ft: <span class="number">9895</span> corp: <span class="number">3523</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2038</span> rss: <span class="number">553</span>Mb L: <span class="number">484</span>/<span class="number">1470</span> MS: <span class="number">1</span> CopyPart-</span><br><span class="line">#<span class="number">2481939</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9895</span> corp: <span class="number">3523</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">390</span>/<span class="number">1470</span> MS: <span class="number">4</span> InsertByte-ChangeBit-ShuffleBytes-EraseBytes-</span><br><span class="line">#<span class="number">2482177</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9895</span> corp: <span class="number">3523</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">816</span>/<span class="number">1470</span> MS: <span class="number">3</span> ChangeBit-ShuffleBytes-EraseBytes-</span><br><span class="line">#<span class="number">2482341</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9895</span> corp: <span class="number">3523</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2038</span> rss: <span class="number">553</span>Mb L: <span class="number">41</span>/<span class="number">1470</span> MS: <span class="number">2</span> CopyPart-EraseBytes-</span><br><span class="line">#<span class="number">2482513</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2038</span> rss: <span class="number">553</span>Mb L: <span class="number">604</span>/<span class="number">1470</span> MS: <span class="number">3</span> ChangeASCIIInt-ChangeASCIIInt-CopyPart-</span><br><span class="line">#<span class="number">2482756</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2038</span> rss: <span class="number">553</span>Mb L: <span class="number">342</span>/<span class="number">1470</span> MS: <span class="number">2</span> InsertRepeatedBytes-EraseBytes-</span><br><span class="line">#<span class="number">2483073</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2038</span> rss: <span class="number">553</span>Mb L: <span class="number">1188</span>/<span class="number">1470</span> MS: <span class="number">3</span> InsertByte-ShuffleBytes-EraseBytes-</span><br><span class="line">#<span class="number">2483808</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">102</span>/<span class="number">1470</span> MS: <span class="number">2</span> InsertRepeatedBytes-EraseBytes-</span><br><span class="line">#<span class="number">2483824</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">477</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2483875</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">70</span>/<span class="number">1470</span> MS: <span class="number">3</span> CopyPart-ChangeByte-EraseBytes-</span><br><span class="line">#<span class="number">2483999</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1470</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">604</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2485065</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">32</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2485100</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">139</span>/<span class="number">1470</span> MS: <span class="number">2</span> ChangeByte-EraseBytes-</span><br><span class="line">#<span class="number">2485127</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">622</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2485277</span>	REDUCE cov: <span class="number">2018</span> ft: <span class="number">9896</span> corp: <span class="number">3524</span>/<span class="number">671</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">93</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2485465</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9897</span> corp: <span class="number">3525</span>/<span class="number">671</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">40</span>/<span class="number">1470</span> MS: <span class="number">1</span> PersAutoDict- DE: <span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x05&quot;</span>-</span><br><span class="line">#<span class="number">2485715</span>	NEW    cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">1092</span>/<span class="number">1470</span> MS: <span class="number">3</span> ChangeBit-CopyPart-CopyPart-</span><br><span class="line">#<span class="number">2485805</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">25</span>/<span class="number">1470</span> MS: <span class="number">2</span> ShuffleBytes-EraseBytes-</span><br><span class="line">#<span class="number">2486420</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">336</span>/<span class="number">1470</span> MS: <span class="number">2</span> InsertByte-EraseBytes-</span><br><span class="line">#<span class="number">2486677</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">33</span>/<span class="number">1470</span> MS: <span class="number">2</span> ChangeBit-EraseBytes-</span><br><span class="line">#<span class="number">2486836</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">142</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2487217</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9899</span> corp: <span class="number">3526</span>/<span class="number">672</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">555</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2487243</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9901</span> corp: <span class="number">3527</span>/<span class="number">673</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2037</span> rss: <span class="number">553</span>Mb L: <span class="number">1464</span>/<span class="number">1470</span> MS: <span class="number">1</span> CopyPart-</span><br><span class="line">#<span class="number">2487595</span>	NEW    cov: <span class="number">2019</span> ft: <span class="number">9902</span> corp: <span class="number">3528</span>/<span class="number">675</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2035</span> rss: <span class="number">553</span>Mb L: <span class="number">1430</span>/<span class="number">1470</span> MS: <span class="number">4</span> ShuffleBytes-ChangeByte-ChangeBinInt-CopyPart-</span><br><span class="line">#<span class="number">2487978</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9902</span> corp: <span class="number">3528</span>/<span class="number">675</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2035</span> rss: <span class="number">553</span>Mb L: <span class="number">34</span>/<span class="number">1470</span> MS: <span class="number">2</span> ChangeBit-EraseBytes-</span><br><span class="line">#<span class="number">2487997</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9902</span> corp: <span class="number">3528</span>/<span class="number">675</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">534</span>/<span class="number">1470</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">2488103</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9902</span> corp: <span class="number">3528</span>/<span class="number">675</span>Kb lim: <span class="number">1480</span> exec/s: <span class="number">2036</span> rss: <span class="number">553</span>Mb L: <span class="number">62</span>/<span class="number">1470</span> MS: <span class="number">4</span> ChangeBit-PersAutoDict-ShuffleBytes-EraseBytes- DE: <span class="string">&quot;UT&quot;</span>-</span><br></pre></td></tr></table></figure>
<p>但迟迟没有crash。这可能有很多原因：1.程序很健壮。2.我们选择的接口函数不合适 3.异常检测的设置不当。<br>这三个可能的原因中程序是否健壮我们不得而知，接口函数是否合适我们通过覆盖率了解到以<code>xmlReadMemory</code>作为入口函数执行到的代码块还是较高的，但也有可能因为漏洞不在接口函数的部分。第三个可能，由于异常检测的设置不当导致即使产生了异常但因为于设置的异常检测不匹配和没有捕获到。回头看下我们的santize设置为address开启内存错误检测器(AddressSanitizer)，该选项较为通用且宽泛(无非stack&#x2F;heap_overflow)，但其实还有一些更具针对行的选项：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-fsanitize-address-field-padding=&lt;value&gt;</span><br><span class="line">                         Level of field padding for AddressSanitizer</span><br><span class="line"> -fsanitize-address-globals-dead-stripping</span><br><span class="line">                         Enable linker dead stripping of globals in AddressSanitizer</span><br><span class="line"> -fsanitize-address-poison-custom-array-cookie</span><br><span class="line">                         Enable poisoning array cookies when using custom operator new[] in AddressSanitizer</span><br><span class="line"> -fsanitize-address-use-after-scope</span><br><span class="line">                         Enable use-after-scope detection in AddressSanitizer</span><br><span class="line"> -fsanitize-address-use-odr-indicator</span><br><span class="line">                         Enable ODR indicator globals to avoid false ODR violation reports in partially sanitized programs at the cost of an increase in binary size</span><br></pre></td></tr></table></figure>
<p>其中有一个<code>-fsanitize-address-use-after-scope</code>描述为开启use-after-scope检测，将其加入到编译选项中，再次编译。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope&quot;</span><br><span class="line"></span><br><span class="line">CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \</span><br><span class="line">    CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot;  ./configure</span><br><span class="line"></span><br><span class="line">make -j$(nproc)</span><br><span class="line">clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope -std=c++11 xml_read_memory_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2.9.2-fsanitize_fuzzer1</span><br></pre></td></tr></table></figure>
<p>跑了一会儿依然没有收获，看来这将会是一个较长时间的过程。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1823774</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9428</span> corp: <span class="number">3417</span>/<span class="number">499</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2867</span> rss: <span class="number">546</span>Mb L: <span class="number">229</span>/<span class="number">1150</span> MS: <span class="number">4</span> ChangeBinInt-InsertByte-InsertByte-EraseBytes-</span><br><span class="line">#<span class="number">1823804</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2867</span> rss: <span class="number">546</span>Mb L: <span class="number">508</span>/<span class="number">1150</span> MS: <span class="number">3</span> CopyPart-EraseBytes-CopyPart-</span><br><span class="line">#<span class="number">1824507</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2868</span> rss: <span class="number">546</span>Mb L: <span class="number">24</span>/<span class="number">1150</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1824608</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2864</span> rss: <span class="number">546</span>Mb L: <span class="number">474</span>/<span class="number">1150</span> MS: <span class="number">4</span> InsertRepeatedBytes-ChangeASCIIInt-PersAutoDict-CrossOver- DE: <span class="string">&quot;\xff\xff\xffN&quot;</span>-</span><br><span class="line">#<span class="number">1824748</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2864</span> rss: <span class="number">546</span>Mb L: <span class="number">1066</span>/<span class="number">1143</span> MS: <span class="number">5</span> ChangeASCIIInt-CMP-PersAutoDict-ChangeBit-EraseBytes- DE: <span class="string">&quot;ISO-8859-1&quot;</span>-<span class="string">&quot;\xfe\xff\xff&quot;</span>-</span><br><span class="line">#<span class="number">1825344</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2865</span> rss: <span class="number">546</span>Mb L: <span class="number">25</span>/<span class="number">1143</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1825716</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2866</span> rss: <span class="number">546</span>Mb L: <span class="number">437</span>/<span class="number">1143</span> MS: <span class="number">3</span> InsertRepeatedBytes-InsertRepeatedBytes-EraseBytes-</span><br><span class="line">#<span class="number">1825879</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1160</span> exec/s: <span class="number">2866</span> rss: <span class="number">546</span>Mb L: <span class="number">73</span>/<span class="number">1143</span> MS: <span class="number">4</span> CMP-ChangeASCIIInt-ChangeBit-EraseBytes- DE: <span class="string">&quot;\x01\x00\x00P&quot;</span>-</span><br><span class="line">#<span class="number">1826898</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2863</span> rss: <span class="number">546</span>Mb L: <span class="number">453</span>/<span class="number">1143</span> MS: <span class="number">3</span> ChangeByte-ChangeASCIIInt-EraseBytes-</span><br><span class="line">#<span class="number">1827221</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2863</span> rss: <span class="number">546</span>Mb L: <span class="number">404</span>/<span class="number">1143</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1827788</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2864</span> rss: <span class="number">546</span>Mb L: <span class="number">47</span>/<span class="number">1143</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1828282</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2861</span> rss: <span class="number">546</span>Mb L: <span class="number">112</span>/<span class="number">1143</span> MS: <span class="number">4</span> CMP-ChangeBit-ChangeByte-EraseBytes- DE: <span class="string">&quot;O&gt;/&lt;&quot;</span>-</span><br><span class="line">#<span class="number">1828714</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2861</span> rss: <span class="number">546</span>Mb L: <span class="number">7</span>/<span class="number">1143</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1828728</span>	REDUCE cov: <span class="number">2019</span> ft: <span class="number">9429</span> corp: <span class="number">3418</span>/<span class="number">500</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2861</span> rss: <span class="number">546</span>Mb L: <span class="number">163</span>/<span class="number">1143</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1828756</span>	NEW    cov: <span class="number">2020</span> ft: <span class="number">9430</span> corp: <span class="number">3419</span>/<span class="number">501</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2861</span> rss: <span class="number">546</span>Mb L: <span class="number">1155</span>/<span class="number">1155</span> MS: <span class="number">1</span> CopyPart-</span><br><span class="line">#<span class="number">1828812</span>	REDUCE cov: <span class="number">2020</span> ft: <span class="number">9430</span> corp: <span class="number">3419</span>/<span class="number">501</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2861</span> rss: <span class="number">546</span>Mb L: <span class="number">42</span>/<span class="number">1155</span> MS: <span class="number">2</span> ChangeBit-EraseBytes-</span><br><span class="line">#<span class="number">1828952</span>	REDUCE cov: <span class="number">2020</span> ft: <span class="number">9430</span> corp: <span class="number">3419</span>/<span class="number">501</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2862</span> rss: <span class="number">546</span>Mb L: <span class="number">380</span>/<span class="number">1155</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">1829111</span>	REDUCE cov: <span class="number">2020</span> ft: <span class="number">9430</span> corp: <span class="number">3419</span>/<span class="number">501</span>Kb lim: <span class="number">1170</span> exec/s: <span class="number">2862</span> rss: <span class="number">546</span>Mb L: <span class="number">542</span>/<span class="number">1155</span> MS: <span class="number">3</span> InsertByte-ChangeASCIIInt-EraseBytes-</span><br></pre></td></tr></table></figure>
<p>但我们不能放任其fuzz，要想一些办法去提高我们fuzz的效率，这其中一个办法就是使用字典。</p>
<p>我们知道基本上所有的程序都是处理的数据其格式是不同的，比如 xml文档， png图片等等。这些数据中会有一些特殊字符序列 （或者说关键字）， 比如在xml文档中就有CDATA，&lt;!ATTLIST等，png图片就有png 图片头。如果我们事先就把这些字符序列列举出来吗，fuzz直接使用这些关键字去组合，就会就可以减少很多没有意义的尝试，同时还有可能会走到更深的程序分支中去。<br>这里whorkshop就提供了AFL中所使用的dict:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">//xml.dict</span><br><span class="line">➜  08 git:(master) ✗ cat xml.dict </span><br><span class="line"># Copyright 2016 Google Inc.</span><br><span class="line">#</span><br><span class="line"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"># you may not use this file except in compliance with the License.</span><br><span class="line"># You may obtain a copy of the License at</span><br><span class="line">#</span><br><span class="line">#      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line">#</span><br><span class="line"># Unless required by applicable law or agreed to in writing, software</span><br><span class="line"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"># See the License for the specific language governing permissions and</span><br><span class="line"># limitations under the License.</span><br><span class="line">#</span><br><span class="line">################################################################################</span><br><span class="line">#</span><br><span class="line"># AFL dictionary for XML</span><br><span class="line"># ----------------------</span><br><span class="line">#</span><br><span class="line"># Several basic syntax elements and attributes, modeled on libxml2.</span><br><span class="line">#</span><br><span class="line"># Created by Michal Zalewski &lt;lcamtuf@google.com&gt;</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">attr_encoding=&quot; encoding=\&quot;1\&quot;&quot;</span><br><span class="line">attr_generic=&quot; a=\&quot;1\&quot;&quot;</span><br><span class="line">attr_href=&quot; href=\&quot;1\&quot;&quot;</span><br><span class="line">attr_standalone=&quot; standalone=\&quot;no\&quot;&quot;</span><br><span class="line">attr_version=&quot; version=\&quot;1\&quot;&quot;</span><br><span class="line">attr_xml_base=&quot; xml:base=\&quot;1\&quot;&quot;</span><br><span class="line">attr_xml_id=&quot; xml:id=\&quot;1\&quot;&quot;</span><br><span class="line">attr_xml_lang=&quot; xml:lang=\&quot;1\&quot;&quot;</span><br><span class="line">attr_xml_space=&quot; xml:space=\&quot;1\&quot;&quot;</span><br><span class="line">attr_xmlns=&quot; xmlns=\&quot;1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">entity_builtin=&quot;&amp;lt;&quot;</span><br><span class="line">entity_decimal=&quot;&amp;#1;&quot;</span><br><span class="line">entity_external=&quot;&amp;a;&quot;</span><br><span class="line">entity_hex=&quot;&amp;#x1;&quot;</span><br><span class="line"></span><br><span class="line">string_any=&quot;ANY&quot;</span><br><span class="line">string_brackets=&quot;[]&quot;</span><br><span class="line">string_cdata=&quot;CDATA&quot;</span><br><span class="line">string_col_fallback=&quot;:fallback&quot;</span><br><span class="line">string_col_generic=&quot;:a&quot;</span><br><span class="line">string_col_include=&quot;:include&quot;</span><br><span class="line">string_dashes=&quot;--&quot;</span><br><span class="line">string_empty=&quot;EMPTY&quot;</span><br><span class="line">string_empty_dblquotes=&quot;\&quot;\&quot;&quot;</span><br><span class="line">string_empty_quotes=&quot;&#x27;&#x27;&quot;</span><br><span class="line">string_entities=&quot;ENTITIES&quot;</span><br><span class="line">string_entity=&quot;ENTITY&quot;</span><br><span class="line">string_fixed=&quot;#FIXED&quot;</span><br><span class="line">string_id=&quot;ID&quot;</span><br><span class="line">string_idref=&quot;IDREF&quot;</span><br><span class="line">string_idrefs=&quot;IDREFS&quot;</span><br><span class="line">string_implied=&quot;#IMPLIED&quot;</span><br><span class="line">string_nmtoken=&quot;NMTOKEN&quot;</span><br><span class="line">string_nmtokens=&quot;NMTOKENS&quot;</span><br><span class="line">string_notation=&quot;NOTATION&quot;</span><br><span class="line">string_parentheses=&quot;()&quot;</span><br><span class="line">string_pcdata=&quot;#PCDATA&quot;</span><br><span class="line">string_percent=&quot;%a&quot;</span><br><span class="line">string_public=&quot;PUBLIC&quot;</span><br><span class="line">string_required=&quot;#REQUIRED&quot;</span><br><span class="line">string_schema=&quot;:schema&quot;</span><br><span class="line">string_system=&quot;SYSTEM&quot;</span><br><span class="line">string_ucs4=&quot;UCS-4&quot;</span><br><span class="line">string_utf16=&quot;UTF-16&quot;</span><br><span class="line">string_utf8=&quot;UTF-8&quot;</span><br><span class="line">string_xmlns=&quot;xmlns:&quot;</span><br><span class="line"></span><br><span class="line">tag_attlist=&quot;&lt;!ATTLIST&quot;</span><br><span class="line">tag_cdata=&quot;&lt;![CDATA[&quot;</span><br><span class="line">tag_close=&quot;&lt;/a&gt;&quot;</span><br><span class="line">tag_doctype=&quot;&lt;!DOCTYPE&quot;</span><br><span class="line">tag_element=&quot;&lt;!ELEMENT&quot;</span><br><span class="line">tag_entity=&quot;&lt;!ENTITY&quot;</span><br><span class="line">tag_ignore=&quot;&lt;![IGNORE[&quot;</span><br><span class="line">tag_include=&quot;&lt;![INCLUDE[&quot;</span><br><span class="line">tag_notation=&quot;&lt;!NOTATION&quot;</span><br><span class="line">tag_open=&quot;&lt;a&gt;&quot;</span><br><span class="line">tag_open_close=&quot;&lt;a /&gt;&quot;</span><br><span class="line">tag_open_exclamation=&quot;&lt;!&quot;</span><br><span class="line">tag_open_q=&quot;&lt;?&quot;</span><br><span class="line">tag_sq2_close=&quot;]]&gt;&quot;</span><br><span class="line">tag_xml_q=&quot;&lt;?xml?&gt;&quot;</span><br></pre></td></tr></table></figure>
<p>其中关键字就是””里的内容，libfuzzer会使用这些关键字进行组合来生成样本。字典使用方法<code>./libxml2-v2.9.2-fsanitize_fuzzer1 -max_total_time=60 -print_final_stats=1 -dict=./xml.dict corpus1</code><br>执行结果：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">468074</span>	REDUCE cov: <span class="number">2521</span> ft: <span class="number">8272</span> corp: <span class="number">2493</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7801</span> rss: <span class="number">452</span>Mb L: <span class="number">105</span>/<span class="number">135</span> MS: <span class="number">4</span> InsertRepeatedBytes-CMP-CopyPart-CrossOver- DE: <span class="string">&quot;\x01\x00\x00\x00&quot;</span>-</span><br><span class="line">#<span class="number">468322</span>	REDUCE cov: <span class="number">2521</span> ft: <span class="number">8272</span> corp: <span class="number">2493</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7805</span> rss: <span class="number">452</span>Mb L: <span class="number">85</span>/<span class="number">135</span> MS: <span class="number">3</span> CopyPart-CopyPart-EraseBytes-</span><br><span class="line">#<span class="number">468381</span>	REDUCE cov: <span class="number">2521</span> ft: <span class="number">8273</span> corp: <span class="number">2494</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7806</span> rss: <span class="number">452</span>Mb L: <span class="number">74</span>/<span class="number">135</span> MS: <span class="number">1</span> InsertByte-</span><br><span class="line">#<span class="number">468390</span>	REDUCE cov: <span class="number">2521</span> ft: <span class="number">8273</span> corp: <span class="number">2494</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7806</span> rss: <span class="number">452</span>Mb L: <span class="number">66</span>/<span class="number">135</span> MS: <span class="number">2</span> ChangeASCIIInt-EraseBytes-</span><br><span class="line">#<span class="number">468391</span>	REDUCE cov: <span class="number">2521</span> ft: <span class="number">8273</span> corp: <span class="number">2494</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7806</span> rss: <span class="number">452</span>Mb L: <span class="number">89</span>/<span class="number">135</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">468575</span>	DONE   cov: <span class="number">2521</span> ft: <span class="number">8273</span> corp: <span class="number">2494</span>/<span class="number">82</span>Kb lim: <span class="number">135</span> exec/s: <span class="number">7681</span> rss: <span class="number">452</span>Mb</span><br><span class="line">###### Recommended dictionary. ######</span><br><span class="line"><span class="string">&quot;\x08\x00&quot;</span> # Uses: <span class="number">366</span></span><br><span class="line"><span class="string">&quot;Q\x00&quot;</span> # Uses: <span class="number">370</span></span><br><span class="line"><span class="string">&quot;\x00:&quot;</span> # Uses: <span class="number">325</span></span><br><span class="line"><span class="string">&quot;\x97\x00&quot;</span> # Uses: <span class="number">301</span></span><br><span class="line"><span class="string">&quot;\x0d\x00&quot;</span> # Uses: <span class="number">335</span></span><br><span class="line"><span class="string">&quot;\xfe\xff\xff\xff&quot;</span> # Uses: <span class="number">273</span></span><br><span class="line"><span class="string">&quot;UCS-&quot;</span> # Uses: <span class="number">294</span></span><br><span class="line"><span class="string">&quot;\x15\x00&quot;</span> # Uses: <span class="number">277</span></span><br><span class="line"><span class="string">&quot;\x00\x00&quot;</span> # Uses: <span class="number">289</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x1c&quot;</span> # Uses: <span class="number">258</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff!&quot;</span> # Uses: <span class="number">257</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x01&quot;</span> # Uses: <span class="number">250</span></span><br><span class="line"><span class="string">&quot;UTF-1&quot;</span> # Uses: <span class="number">250</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xffN&quot;</span> # Uses: <span class="number">236</span></span><br><span class="line"><span class="string">&quot;UTF-16LE&quot;</span> # Uses: <span class="number">223</span></span><br><span class="line"><span class="string">&quot;ISO-10&quot;</span> # Uses: <span class="number">228</span></span><br><span class="line"><span class="string">&quot;ISO-1064&quot;</span> # Uses: <span class="number">256</span></span><br><span class="line"><span class="string">&quot;\x0a\x00\x00\x00&quot;</span> # Uses: <span class="number">246</span></span><br><span class="line"><span class="string">&quot;Q\x00\x00\x00&quot;</span> # Uses: <span class="number">247</span></span><br><span class="line"><span class="string">&quot;\xf1\x1f\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">212</span></span><br><span class="line"><span class="string">&quot;$\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">194</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x0e&quot;</span> # Uses: <span class="number">211</span></span><br><span class="line"><span class="string">&quot;\x09\x00&quot;</span> # Uses: <span class="number">226</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\xfa&quot;</span> # Uses: <span class="number">212</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x02&quot;</span> # Uses: <span class="number">239</span></span><br><span class="line"><span class="string">&quot;\xac\x0f\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">206</span></span><br><span class="line"><span class="string">&quot;\xffO&quot;</span> # Uses: <span class="number">263</span></span><br><span class="line"><span class="string">&quot;\xff\x03&quot;</span> # Uses: <span class="number">235</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\x10&quot;</span> # Uses: <span class="number">200</span></span><br><span class="line"><span class="string">&quot;\xf4\x01\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">203</span></span><br><span class="line"><span class="string">&quot;UTF-16BE&quot;</span> # Uses: <span class="number">188</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00P&quot;</span> # Uses: <span class="number">207</span></span><br><span class="line"><span class="string">&quot;\x0a\x00&quot;</span> # Uses: <span class="number">196</span></span><br><span class="line"><span class="string">&quot;\xff\xff&quot;</span> # Uses: <span class="number">203</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\x97\x96\x80&quot;</span> # Uses: <span class="number">186</span></span><br><span class="line"><span class="string">&quot;\x01 \x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">187</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00$&quot;</span> # Uses: <span class="number">156</span></span><br><span class="line"><span class="string">&quot;P\x00&quot;</span> # Uses: <span class="number">186</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff&quot;</span> # Uses: <span class="number">197</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x09&quot;</span> # Uses: <span class="number">202</span></span><br><span class="line"><span class="string">&quot;\x12\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">204</span></span><br><span class="line"><span class="string">&quot;\x01\x01&quot;</span> # Uses: <span class="number">170</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x00\x10&quot;</span> # Uses: <span class="number">197</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\x03&quot;</span> # Uses: <span class="number">183</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">174</span></span><br><span class="line"><span class="string">&quot;\xff\x05&quot;</span> # Uses: <span class="number">198</span></span><br><span class="line"><span class="string">&quot;US-ASCII&quot;</span> # Uses: <span class="number">214</span></span><br><span class="line"><span class="string">&quot;\x01\x00&quot;</span> # Uses: <span class="number">201</span></span><br><span class="line"><span class="string">&quot;xlmns&quot;</span> # Uses: <span class="number">189</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x14&quot;</span> # Uses: <span class="number">191</span></span><br><span class="line"><span class="string">&quot;xmlsn&quot;</span> # Uses: <span class="number">179</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x03&quot;</span> # Uses: <span class="number">201</span></span><br><span class="line"><span class="string">&quot;xmlns&quot;</span> # Uses: <span class="number">182</span></span><br><span class="line"><span class="string">&quot;\xaf\x0f\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">186</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\x0e\xb9&quot;</span> # Uses: <span class="number">176</span></span><br><span class="line"><span class="string">&quot;\xff\x09&quot;</span> # Uses: <span class="number">178</span></span><br><span class="line"><span class="string">&quot;ISO-1&quot;</span> # Uses: <span class="number">191</span></span><br><span class="line"><span class="string">&quot;la&quot;</span> # Uses: <span class="number">157</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00&quot;</span> # Uses: <span class="number">173</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x00\x14&quot;</span> # Uses: <span class="number">172</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x7f\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">164</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x04&quot;</span> # Uses: <span class="number">154</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">153</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x02&quot;</span> # Uses: <span class="number">136</span></span><br><span class="line"><span class="string">&quot;\x04\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">140</span></span><br><span class="line"><span class="string">&quot;ISO-10646-&quot;</span> # Uses: <span class="number">146</span></span><br><span class="line"><span class="string">&quot;id&quot;</span> # Uses: <span class="number">155</span></span><br><span class="line"><span class="string">&quot;\x00\x01&quot;</span> # Uses: <span class="number">145</span></span><br><span class="line"><span class="string">&quot;\x00\x02&quot;</span> # Uses: <span class="number">140</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x08&quot;</span> # Uses: <span class="number">165</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x1e&quot;</span> # Uses: <span class="number">136</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff~\xff\xff\xff&quot;</span> # Uses: <span class="number">130</span></span><br><span class="line"><span class="string">&quot;\x81\x96\x98\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">150</span></span><br><span class="line"><span class="string">&quot;\x03\x00\x00\x00&quot;</span> # Uses: <span class="number">116</span></span><br><span class="line"><span class="string">&quot;\x18\x00\x00\x00&quot;</span> # Uses: <span class="number">176</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\xf9&quot;</span> # Uses: <span class="number">124</span></span><br><span class="line"><span class="string">&quot;%\x17\x8f[&quot;</span> # Uses: <span class="number">130</span></span><br><span class="line"><span class="string">&quot;\x0e\x00\x00\x00&quot;</span> # Uses: <span class="number">142</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x00\xfa&quot;</span> # Uses: <span class="number">96</span></span><br><span class="line"><span class="string">&quot;\x06\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">116</span></span><br><span class="line"><span class="string">&quot;\x00\x04&quot;</span> # Uses: <span class="number">161</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x0b&quot;</span> # Uses: <span class="number">119</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x06&quot;</span> # Uses: <span class="number">141</span></span><br><span class="line"><span class="string">&quot;annnn\xd4nnnnnn&quot;</span> # Uses: <span class="number">100</span></span><br><span class="line"><span class="string">&quot;\x1f\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">106</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x17&quot;</span> # Uses: <span class="number">114</span></span><br><span class="line"><span class="string">&quot;\x16\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">122</span></span><br><span class="line"><span class="string">&quot;\x0f\x00&quot;</span> # Uses: <span class="number">121</span></span><br><span class="line"><span class="string">&quot;inlc0a&quot;</span> # Uses: <span class="number">128</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00O&quot;</span> # Uses: <span class="number">101</span></span><br><span class="line"><span class="string">&quot;\x01\x04&quot;</span> # Uses: <span class="number">117</span></span><br><span class="line"><span class="string">&quot;\x01P&quot;</span> # Uses: <span class="number">122</span></span><br><span class="line"><span class="string">&quot;\xfb\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">95</span></span><br><span class="line"><span class="string">&quot;\x03\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">107</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x00\x03&quot;</span> # Uses: <span class="number">98</span></span><br><span class="line"><span class="string">&quot;\x00#&quot;</span> # Uses: <span class="number">102</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x0d&quot;</span> # Uses: <span class="number">92</span></span><br><span class="line"><span class="string">&quot;ISO-8859-1&quot;</span> # Uses: <span class="number">100</span></span><br><span class="line"><span class="string">&quot;\xff\xf9&quot;</span> # Uses: <span class="number">77</span></span><br><span class="line"><span class="string">&quot;\xf7\x0f\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">79</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\xfb&quot;</span> # Uses: <span class="number">82</span></span><br><span class="line"><span class="string">&quot;\x01\x0b&quot;</span> # Uses: <span class="number">101</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\x0e\xff&quot;</span> # Uses: <span class="number">78</span></span><br><span class="line"><span class="string">&quot;&gt;&lt;&gt;\xb7&quot;</span> # Uses: <span class="number">81</span></span><br><span class="line"><span class="string">&quot;&lt;b&quot;</span> # Uses: <span class="number">81</span></span><br><span class="line"><span class="string">&quot;UTF-8\x00&quot;</span> # Uses: <span class="number">76</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\x09&quot;</span> # Uses: <span class="number">63</span></span><br><span class="line"><span class="string">&quot;#\x00\x00\x00&quot;</span> # Uses: <span class="number">75</span></span><br><span class="line"><span class="string">&quot;S\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">73</span></span><br><span class="line"><span class="string">&quot;a\xff&quot;</span> # Uses: <span class="number">70</span></span><br><span class="line"><span class="string">&quot;TIONb&quot;</span> # Uses: <span class="number">46</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00?&quot;</span> # Uses: <span class="number">69</span></span><br><span class="line"><span class="string">&quot;!\x00\x00\x00&quot;</span> # Uses: <span class="number">67</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x01&quot;</span> # Uses: <span class="number">74</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\x1f\x02&quot;</span> # Uses: <span class="number">57</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x00\x16&quot;</span> # Uses: <span class="number">57</span></span><br><span class="line"><span class="string">&quot;-\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">53</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x05&quot;</span> # Uses: <span class="number">65</span></span><br><span class="line"><span class="string">&quot;:b&quot;</span> # Uses: <span class="number">67</span></span><br><span class="line"><span class="string">&quot;\x17\x1c_&gt;&quot;</span> # Uses: <span class="number">63</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff\x18&quot;</span> # Uses: <span class="number">64</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00&#x27;&quot;</span> # Uses: <span class="number">45</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x05&quot;</span> # Uses: <span class="number">52</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x0d&quot;</span> # Uses: <span class="number">51</span></span><br><span class="line"><span class="string">&quot;US-AS&quot;</span> # Uses: <span class="number">48</span></span><br><span class="line"><span class="string">&quot;a&gt;&quot;</span> # Uses: <span class="number">53</span></span><br><span class="line"><span class="string">&quot;C\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">44</span></span><br><span class="line"><span class="string">&quot;\xff\xff\x00\x00&quot;</span> # Uses: <span class="number">36</span></span><br><span class="line"><span class="string">&quot;\x01\x07&quot;</span> # Uses: <span class="number">49</span></span><br><span class="line"><span class="string">&quot;@\x00\x00\x00&quot;</span> # Uses: <span class="number">46</span></span><br><span class="line"><span class="string">&quot;\x02\x00&quot;</span> # Uses: <span class="number">32</span></span><br><span class="line"><span class="string">&quot;+\x00&quot;</span> # Uses: <span class="number">37</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00 \x02&quot;</span> # Uses: <span class="number">42</span></span><br><span class="line"><span class="string">&quot;\x00\x0f&quot;</span> # Uses: <span class="number">37</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\xff\xff\xff\xff$&quot;</span> # Uses: <span class="number">49</span></span><br><span class="line"><span class="string">&quot;ASCII&quot;</span> # Uses: <span class="number">40</span></span><br><span class="line"><span class="string">&quot;\x00\x00\x00\x00\x00\x00\x01\x00&quot;</span> # Uses: <span class="number">30</span></span><br><span class="line"><span class="string">&quot;a\xff:-\xec&quot;</span> # Uses: <span class="number">27</span></span><br><span class="line"><span class="string">&quot;\xff\x1a&quot;</span> # Uses: <span class="number">30</span></span><br><span class="line"><span class="string">&quot;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&amp;&#x27;&#x27;&quot;</span> # Uses: <span class="number">23</span></span><br><span class="line"><span class="string">&quot;\x01\x00\x00\x00\x00\x00\x01\x1d&quot;</span> # Uses: <span class="number">34</span></span><br><span class="line"><span class="string">&quot;TIOIb&quot;</span> # Uses: <span class="number">19</span></span><br><span class="line"><span class="string">&quot;J\x00\x00\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">15</span></span><br><span class="line"><span class="string">&quot;N\x00\x00\x00&quot;</span> # Uses: <span class="number">10</span></span><br><span class="line"><span class="string">&quot;\x01O&quot;</span> # Uses: <span class="number">8</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x02&quot;</span> # Uses: <span class="number">6</span></span><br><span class="line"><span class="string">&quot;HTML&quot;</span> # Uses: <span class="number">8</span></span><br><span class="line"><span class="string">&quot;\x00P&quot;</span> # Uses: <span class="number">9</span></span><br><span class="line"><span class="string">&quot;\xff\xff\xff\x00&quot;</span> # Uses: <span class="number">9</span></span><br><span class="line"><span class="string">&quot;\xff\x06&quot;</span> # Uses: <span class="number">9</span></span><br><span class="line"><span class="string">&quot;\x7f\x96\x98\x00\x00\x00\x00\x00&quot;</span> # Uses: <span class="number">4</span></span><br><span class="line"><span class="string">&quot;^&gt;&lt;b&gt;&quot;</span> # Uses: <span class="number">5</span></span><br><span class="line"><span class="string">&quot;\x01\x0a&quot;</span> # Uses: <span class="number">5</span></span><br><span class="line"><span class="string">&quot;\x13\x00&quot;</span> # Uses: <span class="number">1</span></span><br><span class="line">###### End of recommended dictionary. ######</span><br><span class="line">Done <span class="number">479244</span> runs in <span class="number">61</span> second(s)</span><br><span class="line">stat::number_of_executed_units: <span class="number">479244</span></span><br><span class="line">stat::average_exec_per_sec:     <span class="number">7856</span></span><br><span class="line">stat::new_units_added:          <span class="number">5007</span></span><br><span class="line">stat::slowest_unit_time_sec:    <span class="number">0</span></span><br><span class="line">stat::peak_rss_mb:              <span class="number">467</span></span><br></pre></td></tr></table></figure>
<p>可以看到最后还给出了<code>Recommended dictionary</code>，可以更新到我们的.dict中。<br><code>stat::new_units_added:          4709</code>说明最终探测到了5007个代码单元。<br>不使用字典的话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Done 402774 runs in 61 second(s)</span><br><span class="line">stat::number_of_executed_units: 402774</span><br><span class="line">stat::average_exec_per_sec:     6602</span><br><span class="line">stat::new_units_added:          3761</span><br><span class="line">stat::slowest_unit_time_sec:    0</span><br><span class="line">stat::peak_rss_mb:              453</span><br></pre></td></tr></table></figure>
<p>可以看到使用字典效率确实提高不少。</p>
<p>此外，当我们长时间fuzz时，会产生和编译出很多样本，这些样本存放在语料库corpus中，例如上面就产生了<code>➜  08 git:(master) ✗ ls -lR| grep &quot;^-&quot; | wc -l 7217</code> 7217个样本，其中很多是重复的，我们可以通过以下方法进行精简(使用-merge&#x3D;1标志)：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mkdir corpus1_min</span><br><span class="line">corpus1_min: 精简后的样本集存放的位置</span><br><span class="line">corpus1: 原始样本集存放的位置</span><br><span class="line"></span><br><span class="line">➜  <span class="number">08</span> git:(master) ✗ ./libxml2-v2<span class="number">.9</span><span class="number">.2</span>-fsanitize_fuzzer1 -merge=<span class="number">1</span> corpus1_min corpus1</span><br><span class="line">INFO: Seed: <span class="number">1264856731</span></span><br><span class="line">INFO: Loaded <span class="number">1</span> modules   (<span class="number">53343</span> inline <span class="number">8</span>-bit counters): <span class="number">53343</span> [<span class="number">0xd27740</span>, <span class="number">0xd3479f</span>), </span><br><span class="line">INFO: Loaded <span class="number">1</span> PC tables (<span class="number">53343</span> PCs): <span class="number">53343</span> [<span class="number">0x9b3650</span>,<span class="number">0xa83c40</span>), </span><br><span class="line">MERGE-OUTER: <span class="number">2724</span> files, <span class="number">0</span> in the initial corpus</span><br><span class="line">MERGE-OUTER: attempt <span class="number">1</span></span><br><span class="line">INFO: Seed: <span class="number">1264900516</span></span><br><span class="line">INFO: Loaded <span class="number">1</span> modules   (<span class="number">53343</span> inline <span class="number">8</span>-bit counters): <span class="number">53343</span> [<span class="number">0xd27740</span>, <span class="number">0xd3479f</span>), </span><br><span class="line">INFO: Loaded <span class="number">1</span> PC tables (<span class="number">53343</span> PCs): <span class="number">53343</span> [<span class="number">0x9b3650</span>,<span class="number">0xa83c40</span>), </span><br><span class="line">INFO: -max_len is not provided; libFuzzer will not generate inputs larger than <span class="number">1048576</span> bytes</span><br><span class="line">MERGE-INNER: using the control file <span class="string">&#x27;/tmp/libFuzzerTemp.8187.txt&#x27;</span></span><br><span class="line">MERGE-INNER: <span class="number">2724</span> total files; <span class="number">0</span> processed earlier; will process <span class="number">2724</span> files now</span><br><span class="line">#<span class="number">1</span>	pulse  cov: <span class="number">464</span> exec/s: <span class="number">0</span> rss: <span class="number">32</span>Mb</span><br><span class="line">#<span class="number">2</span>	pulse  cov: <span class="number">470</span> exec/s: <span class="number">0</span> rss: <span class="number">33</span>Mb</span><br><span class="line">#<span class="number">4</span>	pulse  cov: <span class="number">502</span> exec/s: <span class="number">0</span> rss: <span class="number">33</span>Mb</span><br><span class="line">#<span class="number">8</span>	pulse  cov: <span class="number">522</span> exec/s: <span class="number">0</span> rss: <span class="number">34</span>Mb</span><br><span class="line">#<span class="number">16</span>	pulse  cov: <span class="number">533</span> exec/s: <span class="number">0</span> rss: <span class="number">34</span>Mb</span><br><span class="line">#<span class="number">32</span>	pulse  cov: <span class="number">681</span> exec/s: <span class="number">0</span> rss: <span class="number">35</span>Mb</span><br><span class="line">#<span class="number">64</span>	pulse  cov: <span class="number">756</span> exec/s: <span class="number">0</span> rss: <span class="number">36</span>Mb</span><br><span class="line">#<span class="number">128</span>	pulse  cov: <span class="number">1077</span> exec/s: <span class="number">0</span> rss: <span class="number">39</span>Mb</span><br><span class="line">#<span class="number">256</span>	pulse  cov: <span class="number">1247</span> exec/s: <span class="number">0</span> rss: <span class="number">45</span>Mb</span><br><span class="line">#<span class="number">512</span>	pulse  cov: <span class="number">1553</span> exec/s: <span class="number">0</span> rss: <span class="number">55</span>Mb</span><br><span class="line">#<span class="number">1024</span>	pulse  cov: <span class="number">2166</span> exec/s: <span class="number">0</span> rss: <span class="number">77</span>Mb</span><br><span class="line">#<span class="number">2048</span>	pulse  cov: <span class="number">2550</span> exec/s: <span class="number">2048</span> rss: <span class="number">120</span>Mb</span><br><span class="line">#<span class="number">2724</span>	DONE  cov: <span class="number">2666</span> exec/s: <span class="number">2724</span> rss: <span class="number">155</span>Mb</span><br><span class="line">MERGE-OUTER: succesfull in <span class="number">1</span> attempt(s)</span><br><span class="line">MERGE-OUTER: the control file has <span class="number">287194</span> bytes</span><br><span class="line">MERGE-OUTER: consumed <span class="number">0</span>Mb (<span class="number">38</span>Mb rss) to parse the control file</span><br><span class="line">MERGE-OUTER: <span class="number">2313</span> <span class="built_in">new</span> files with <span class="number">8750</span> <span class="built_in">new</span> features added; <span class="number">2666</span> <span class="built_in">new</span> coverage edges</span><br></pre></td></tr></table></figure>
<p>精简到了2313个样本。</p>
<p>workshop还提供了另一个fuzz target:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="number">08</span> git:(master) ✗ cat xml_compile_regexp_fuzzer.cc </span><br><span class="line"><span class="comment">// Copyright 2016 The Chromium Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></span><br><span class="line"><span class="comment">// found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libxml/parser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libxml/tree.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libxml/xmlversion.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ignore</span> <span class="params">(<span class="type">void</span> * ctx, <span class="type">const</span> <span class="type">char</span> * msg, ...)</span> &#123;</span><br><span class="line">  <span class="comment">// Error handler to avoid spam of error messages from libxml parser.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Entry point for LibFuzzer.</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">int</span> <span class="title function_">LLVMFuzzerTestOneInput</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *data, <span class="type">size_t</span> size)</span> &#123;</span><br><span class="line">  xmlSetGenericErrorFunc(<span class="literal">NULL</span>, &amp;ignore);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">uint8_t</span>&gt; <span class="title function_">buffer</span><span class="params">(size + <span class="number">1</span>, <span class="number">0</span>)</span>;</span><br><span class="line">  <span class="built_in">std</span>::copy(data, data + size, buffer.data());</span><br><span class="line"></span><br><span class="line">  xmlRegexpPtr x = xmlRegexpCompile(buffer.data());</span><br><span class="line">  <span class="keyword">if</span> (x)</span><br><span class="line">    xmlRegFreeRegexp(x);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与之前的不同，将输入的数据copy到buffer中，再交给<code>xmlRegexpCompile</code>处理。编译运行如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="number">08</span> git:(master) ✗ clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -fsanitize-address-use-after-scope -std=c++<span class="number">11</span> xml_compile_regexp_fuzzer.cc -I libxml2/include libxml2/.libs/libxml2.a -fsanitize=fuzzer -lz -o libxml2-v2<span class="number">.9</span><span class="number">.2</span>-fsanitize_fuzzer1 </span><br><span class="line">➜  <span class="number">08</span> git:(master) ✗ ./libxml2-v2<span class="number">.9</span><span class="number">.2</span>-fsanitize_fuzzer1 -dict=./xml.dict</span><br><span class="line">Dictionary: <span class="number">60</span> entries</span><br><span class="line">INFO: Seed: <span class="number">2400921417</span></span><br><span class="line">INFO: Loaded <span class="number">1</span> modules   (<span class="number">53352</span> inline <span class="number">8</span>-bit counters): <span class="number">53352</span> [<span class="number">0xd27700</span>, <span class="number">0xd34768</span>), </span><br><span class="line">INFO: Loaded <span class="number">1</span> PC tables (<span class="number">53352</span> PCs): <span class="number">53352</span> [<span class="number">0x9b36f0</span>,<span class="number">0xa83d70</span>), </span><br><span class="line">INFO: -max_len is not provided; libFuzzer will not generate inputs larger than <span class="number">4096</span> bytes</span><br><span class="line">INFO: A corpus is not provided, starting from an empty corpus</span><br><span class="line">#<span class="number">2</span>	INITED cov: <span class="number">114</span> ft: <span class="number">115</span> corp: <span class="number">1</span>/<span class="number">1</span>b exec/s: <span class="number">0</span> rss: <span class="number">30</span>Mb</span><br><span class="line">	NEW_FUNC[<span class="number">1</span>/<span class="number">5</span>]: <span class="number">0x551cf0</span> in ignore(void*, char <span class="keyword">const</span>*, ...) /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/xml_compile_regexp_fuzzer.cc:<span class="number">16</span></span><br><span class="line">	NEW_FUNC[<span class="number">2</span>/<span class="number">5</span>]: <span class="number">0x552d00</span> in __xmlRaiseError /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/libxml2/<span class="type">error</span>.c:<span class="number">461</span></span><br><span class="line">#<span class="number">6</span>	NEW    cov: <span class="number">150</span> ft: <span class="number">169</span> corp: <span class="number">2</span>/<span class="number">2</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">1</span>/<span class="number">1</span> MS: <span class="number">3</span> ShuffleBytes-ShuffleBytes-ChangeByte-</span><br><span class="line">#<span class="number">10</span>	NEW    cov: <span class="number">155</span> ft: <span class="number">223</span> corp: <span class="number">3</span>/<span class="number">4</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">2</span> MS: <span class="number">4</span> ChangeBit-ShuffleBytes-ShuffleBytes-InsertByte-</span><br><span class="line">#<span class="number">12</span>	NEW    cov: <span class="number">156</span> ft: <span class="number">277</span> corp: <span class="number">4</span>/<span class="number">8</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">2</span> ShuffleBytes-CopyPart-</span><br><span class="line">#<span class="number">13</span>	NEW    cov: <span class="number">161</span> ft: <span class="number">282</span> corp: <span class="number">5</span>/<span class="number">12</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">1</span> CrossOver-</span><br><span class="line">#<span class="number">20</span>	NEW    cov: <span class="number">175</span> ft: <span class="number">302</span> corp: <span class="number">6</span>/<span class="number">14</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">2</span> ChangeByte-ChangeBinInt-</span><br><span class="line">#<span class="number">24</span>	NEW    cov: <span class="number">177</span> ft: <span class="number">305</span> corp: <span class="number">7</span>/<span class="number">16</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">4</span> EraseBytes-ChangeBinInt-ChangeBit-InsertByte-</span><br><span class="line">	NEW_FUNC[<span class="number">1</span>/<span class="number">1</span>]: <span class="number">0x604f00</span> in xmlFAReduceEpsilonTransitions /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/libxml2/xmlregexp.c:<span class="number">1777</span></span><br><span class="line">#<span class="number">28</span>	NEW    cov: <span class="number">206</span> ft: <span class="number">336</span> corp: <span class="number">8</span>/<span class="number">19</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">3</span>/<span class="number">4</span> MS: <span class="number">4</span> ShuffleBytes-ChangeByte-ChangeBit-CMP- DE: <span class="string">&quot;\x01?&quot;</span>-</span><br><span class="line">#<span class="number">32</span>	NEW    cov: <span class="number">209</span> ft: <span class="number">343</span> corp: <span class="number">9</span>/<span class="number">21</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">4</span> ManualDict-ShuffleBytes-ShuffleBytes-ChangeBit- DE: <span class="string">&quot;&lt;!&quot;</span>-</span><br><span class="line">#<span class="number">38</span>	NEW    cov: <span class="number">210</span> ft: <span class="number">344</span> corp: <span class="number">10</span>/<span class="number">25</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">1</span> ChangeByte-</span><br><span class="line">#<span class="number">45</span>	NEW    cov: <span class="number">210</span> ft: <span class="number">347</span> corp: <span class="number">11</span>/<span class="number">29</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">2</span> CopyPart-ChangeByte-</span><br><span class="line">#<span class="number">47</span>	NEW    cov: <span class="number">211</span> ft: <span class="number">366</span> corp: <span class="number">12</span>/<span class="number">33</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">2</span> CopyPart-ChangeBinInt-</span><br><span class="line">#<span class="number">50</span>	NEW    cov: <span class="number">211</span> ft: <span class="number">367</span> corp: <span class="number">13</span>/<span class="number">37</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">3</span> ChangeBinInt-CopyPart-ChangeBinInt-</span><br><span class="line">#<span class="number">57</span>	NEW    cov: <span class="number">211</span> ft: <span class="number">388</span> corp: <span class="number">14</span>/<span class="number">40</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">3</span>/<span class="number">4</span> MS: <span class="number">2</span> ManualDict-CrossOver- DE: <span class="string">&quot;\&quot;\&quot;&quot;</span>-</span><br><span class="line">	NEW_FUNC[<span class="number">1</span>/<span class="number">1</span>]: <span class="number">0x606d20</span> in xmlFARecurseDeterminism /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/libxml2/xmlregexp.c:<span class="number">2589</span></span><br><span class="line">#<span class="number">64</span>	NEW    cov: <span class="number">233</span> ft: <span class="number">421</span> corp: <span class="number">15</span>/<span class="number">43</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">3</span>/<span class="number">4</span> MS: <span class="number">2</span> ChangeBit-PersAutoDict- DE: <span class="string">&quot;\x01?&quot;</span>-</span><br><span class="line">#<span class="number">66</span>	NEW    cov: <span class="number">235</span> ft: <span class="number">426</span> corp: <span class="number">16</span>/<span class="number">47</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">2</span> EraseBytes-PersAutoDict- DE: <span class="string">&quot;\x01?&quot;</span>-</span><br><span class="line">#<span class="number">68</span>	REDUCE cov: <span class="number">235</span> ft: <span class="number">426</span> corp: <span class="number">16</span>/<span class="number">46</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">3</span>/<span class="number">4</span> MS: <span class="number">2</span> ChangeBit-EraseBytes-</span><br><span class="line">#<span class="number">72</span>	NEW    cov: <span class="number">236</span> ft: <span class="number">427</span> corp: <span class="number">17</span>/<span class="number">50</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">4</span> ShuffleBytes-PersAutoDict-ShuffleBytes-ShuffleBytes- DE: <span class="string">&quot;\x01?&quot;</span>-</span><br><span class="line">#<span class="number">86</span>	REDUCE cov: <span class="number">236</span> ft: <span class="number">427</span> corp: <span class="number">17</span>/<span class="number">48</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">4</span> ChangeByte-ChangeBinInt-CopyPart-EraseBytes-</span><br><span class="line">#<span class="number">92</span>	NEW    cov: <span class="number">237</span> ft: <span class="number">431</span> corp: <span class="number">18</span>/<span class="number">49</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">1</span>/<span class="number">4</span> MS: <span class="number">1</span> EraseBytes-</span><br><span class="line">#<span class="number">103</span>	NEW    cov: <span class="number">237</span> ft: <span class="number">433</span> corp: <span class="number">19</span>/<span class="number">53</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">1</span> CopyPart-</span><br><span class="line">#<span class="number">104</span>	REDUCE cov: <span class="number">237</span> ft: <span class="number">433</span> corp: <span class="number">19</span>/<span class="number">50</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">1</span>/<span class="number">4</span> MS: <span class="number">1</span> CrossOver-</span><br><span class="line">	NEW_FUNC[<span class="number">1</span>/<span class="number">1</span>]: <span class="number">0x600e30</span> in xmlFAParseCharClassEsc /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/libxml2/xmlregexp.c:<span class="number">4843</span></span><br><span class="line">#<span class="number">115</span>	NEW    cov: <span class="number">243</span> ft: <span class="number">439</span> corp: <span class="number">20</span>/<span class="number">54</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">1</span> ChangeByte-</span><br><span class="line">#<span class="number">118</span>	NEW    cov: <span class="number">246</span> ft: <span class="number">447</span> corp: <span class="number">21</span>/<span class="number">58</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">3</span> CrossOver-PersAutoDict-ChangeBinInt- DE: <span class="string">&quot;\&quot;\&quot;&quot;</span>-</span><br><span class="line">#<span class="number">134</span>	REDUCE cov: <span class="number">249</span> ft: <span class="number">457</span> corp: <span class="number">22</span>/<span class="number">62</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">4</span>/<span class="number">4</span> MS: <span class="number">1</span> CrossOver-</span><br><span class="line">#<span class="number">137</span>	REDUCE cov: <span class="number">249</span> ft: <span class="number">460</span> corp: <span class="number">23</span>/<span class="number">64</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">3</span> InsertByte-EraseBytes-PersAutoDict- DE: <span class="string">&quot;\x01?&quot;</span>-</span><br><span class="line">#<span class="number">145</span>	NEW    cov: <span class="number">250</span> ft: <span class="number">461</span> corp: <span class="number">24</span>/<span class="number">66</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">3</span> CopyPart-EraseBytes-ChangeBit-</span><br><span class="line">#<span class="number">153</span>	NEW    cov: <span class="number">250</span> ft: <span class="number">507</span> corp: <span class="number">25</span>/<span class="number">69</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">31</span>Mb L: <span class="number">3</span>/<span class="number">4</span> MS: <span class="number">3</span> CrossOver-ShuffleBytes-CopyPart-</span><br><span class="line">	NEW_FUNC[<span class="number">1</span>/<span class="number">1</span>]: <span class="number">0x600890</span> in xmlFAParseCharGroup /home/admin/libfuzzer-workshop/lessons/<span class="number">08</span>/libxml2/xmlregexp.c:<span class="number">5100</span></span><br><span class="line">#<span class="number">165</span>	NEW    cov: <span class="number">254</span> ft: <span class="number">511</span> corp: <span class="number">26</span>/<span class="number">71</span>b lim: <span class="number">4</span> exec/s: <span class="number">0</span> rss: <span class="number">32</span>Mb L: <span class="number">2</span>/<span class="number">4</span> MS: <span class="number">2</span> InsertByte-ManualDict- DE: <span class="string">&quot;[]&quot;</span>-</span><br><span class="line">=================================================================</span><br><span class="line">==<span class="number">8434</span>==ERROR: AddressSanitizer: allocator is out of memory trying to allocate <span class="number">0x18</span> bytes</span><br><span class="line">==<span class="number">8434</span>==ERROR: AddressSanitizer failed to allocate <span class="number">0x2000</span> (<span class="number">8192</span>) bytes of InternalMmapVector (<span class="type">error</span> code: <span class="number">12</span>)</span><br><span class="line">ERROR: Failed to mmap</span><br><span class="line">MS: <span class="number">4</span> ChangeBit-EraseBytes-PersAutoDict-ChangeBit- DE: <span class="string">&quot;[]&quot;</span>-; base unit: <span class="number">85</span>f707600c5524d8497fd94066e422258633e02f</span><br><span class="line"><span class="number">0x7f</span>,<span class="number">0x5b</span>,<span class="number">0xdd</span>,</span><br><span class="line">\x7f[\xdd</span><br><span class="line">artifact_prefix=<span class="string">&#x27;./&#x27;</span>; Test unit written to ./crash-dffb37701985bd6539dcbcfe2a04661627b040ff</span><br><span class="line">Base64: f1vd</span><br></pre></td></tr></table></figure>
<p>好家伙，这个harness几秒抛出了crash，说明对于的入口函数的选择至关重要。但这次的异常有点奇怪<code>==8434==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x18 bytes</code>描述说申请超出了内存，也没有SUMMARY对漏洞进行定位。<br>因此我们应该意识到问题是出在了harness上，由于在<code>xml_compile_regexp_fuzzer.cc</code>中使用<code>std::vector&lt;uint8_t&gt; buffer(size + 1, 0);</code>对data进行转储，在样例不断增加的过程中vector超出了扩容的内存限制，从而抛出了crash，这并不是测试函数<code>xmlRegexpCompile</code>函数的问题。<br>在另一个对<code>xmlReadMemory</code>的fuzz还在进行，学长说它fuzz这个函数花了十几个小时才出crash。</p>
<h4 id="lesson-09-the-importance-of-seed-corpus"><a href="#lesson-09-the-importance-of-seed-corpus" class="headerlink" title="lesson 09(the importance of seed corpus)"></a>lesson 09(the importance of seed corpus)</h4><p>这次我们的目标为开源库libpng，首先对源码进行编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">tar xzf libpng.tgz</span><br><span class="line">cd libpng</span><br><span class="line"></span><br><span class="line"># Disable logging via library build configuration control.</span><br><span class="line">cat scripts/pnglibconf.dfa | sed -e &quot;s/option STDIO/option STDIO disabled/&quot; \</span><br><span class="line">&gt; scripts/pnglibconf.dfa.temp</span><br><span class="line">mv scripts/pnglibconf.dfa.temp scripts/pnglibconf.dfa   #这里把错误消息禁用</span><br><span class="line"></span><br><span class="line"># build the library.</span><br><span class="line">autoreconf -f -i</span><br><span class="line">#1</span><br><span class="line">export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -g -fsanitize=address \</span><br><span class="line">    -fsanitize-coverage=trace-pc-guard,trace-cmp,trace-gep,trace-div&quot;</span><br><span class="line"></span><br><span class="line">./configure CC=&quot;clang&quot; CFLAGS=&quot;$FUZZ_CXXFLAGS&quot;</span><br><span class="line">make -j2     </span><br><span class="line"></span><br><span class="line">#2</span><br><span class="line">export FUZZ_CXXFLAGS=&quot;-O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link&quot;</span><br><span class="line">CXX=&quot;clang++ $FUZZ_CXXFLAGS&quot; CC=&quot;clang $FUZZ_CXXFLAGS&quot; \</span><br><span class="line">    CCLD=&quot;clang++ $FUZZ_CXXFLAGS&quot;  ./configure</span><br><span class="line">make -j$(nproc)</span><br></pre></td></tr></table></figure>
<p>workshop给出的是#1的编译策略，没有启用采样分析器，而且 -fsanitize-coverage&#x3D;trace-pc-guard适用在older version的libfuzzer。因此我用的是#2的编译策略，上一个lesson证明这样的编译插桩能有效提高fuzz的效率。<br>提供的harness：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2015 The Chromium Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></span><br><span class="line"><span class="comment">// found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PNG_INTERNAL</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;png.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BufState</span> &#123;</span></span><br><span class="line">  <span class="type">const</span> <span class="type">uint8_t</span>* data;</span><br><span class="line">  <span class="type">size_t</span> bytes_left;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PngObjectHandler</span> &#123;</span></span><br><span class="line">  png_infop info_ptr = nullptr;</span><br><span class="line">  png_structp png_ptr = nullptr;</span><br><span class="line">  png_voidp row_ptr = nullptr;</span><br><span class="line">  BufState* buf_state = nullptr;</span><br><span class="line"></span><br><span class="line">  ~PngObjectHandler() &#123;</span><br><span class="line">    <span class="keyword">if</span> (row_ptr &amp;&amp; png_ptr) &#123;</span><br><span class="line">      png_free(png_ptr, row_ptr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (png_ptr &amp;&amp; info_ptr) &#123;</span><br><span class="line">      png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, nullptr);</span><br><span class="line">    &#125;</span><br><span class="line">    delete buf_state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">user_read_data</span><span class="params">(png_structp png_ptr, png_bytep data, <span class="type">png_size_t</span> length)</span> &#123;</span><br><span class="line">  BufState* buf_state = static_cast&lt;BufState*&gt;(png_get_io_ptr(png_ptr));</span><br><span class="line">  <span class="keyword">if</span> (length &gt; buf_state-&gt;bytes_left) &#123;</span><br><span class="line">    png_error(png_ptr, <span class="string">&quot;read error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memcpy</span>(data, buf_state-&gt;data, length);</span><br><span class="line">  buf_state-&gt;bytes_left -= length;</span><br><span class="line">  buf_state-&gt;data += length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kPngHeaderSize = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Entry point for LibFuzzer.</span></span><br><span class="line"><span class="comment">// Roughly follows the libpng book example:</span></span><br><span class="line"><span class="comment">// http://www.libpng.org/pub/png/book/chapter13.html</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">int</span> <span class="title function_">LLVMFuzzerTestOneInput</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> size)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (size &lt; kPngHeaderSize) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; <span class="title function_">v</span><span class="params">(data, data + size)</span>;</span><br><span class="line">  <span class="keyword">if</span> (png_sig_cmp(v.data(), <span class="number">0</span>, kPngHeaderSize)) &#123;</span><br><span class="line">    <span class="comment">// not a PNG.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  PngObjectHandler png_handler;</span><br><span class="line">  png_handler.png_ptr = png_create_read_struct</span><br><span class="line">    (PNG_LIBPNG_VER_STRING, nullptr, nullptr, nullptr);</span><br><span class="line">  <span class="keyword">if</span> (!png_handler.png_ptr) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  png_set_user_limits(png_handler.png_ptr, <span class="number">2048</span>, <span class="number">2048</span>);</span><br><span class="line"></span><br><span class="line">  png_set_crc_action(png_handler.png_ptr, PNG_CRC_QUIET_USE, PNG_CRC_QUIET_USE);</span><br><span class="line"></span><br><span class="line">  png_handler.info_ptr = png_create_info_struct(png_handler.png_ptr);</span><br><span class="line">  <span class="keyword">if</span> (!png_handler.info_ptr) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setting up reading from buffer.</span></span><br><span class="line">  png_handler.buf_state = new BufState();</span><br><span class="line">  png_handler.buf_state-&gt;data = data + kPngHeaderSize;</span><br><span class="line">  png_handler.buf_state-&gt;bytes_left = size - kPngHeaderSize;</span><br><span class="line">  png_set_read_fn(png_handler.png_ptr, png_handler.buf_state, user_read_data);</span><br><span class="line">  png_set_sig_bytes(png_handler.png_ptr, kPngHeaderSize);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// libpng error handling.</span></span><br><span class="line">  <span class="keyword">if</span> (setjmp(png_jmpbuf(png_handler.png_ptr))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Reading.</span></span><br><span class="line">  png_read_info(png_handler.png_ptr, png_handler.info_ptr);</span><br><span class="line">  png_handler.row_ptr = png_malloc(</span><br><span class="line">      png_handler.png_ptr, png_get_rowbytes(png_handler.png_ptr,</span><br><span class="line">                                               png_handler.info_ptr));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// reset error handler to put png_deleter into scope.</span></span><br><span class="line">  <span class="keyword">if</span> (setjmp(png_jmpbuf(png_handler.png_ptr))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  png_uint_32 width, height;</span><br><span class="line">  <span class="type">int</span> bit_depth, color_type, interlace_type, compression_type;</span><br><span class="line">  <span class="type">int</span> filter_type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!png_get_IHDR(png_handler.png_ptr, png_handler.info_ptr, &amp;width,</span><br><span class="line">                    &amp;height, &amp;bit_depth, &amp;color_type, &amp;interlace_type,</span><br><span class="line">                    &amp;compression_type, &amp;filter_type)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This is going to be too slow.</span></span><br><span class="line">  <span class="keyword">if</span> (width &amp;&amp; height &gt; <span class="number">100000000</span> / width)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (width &gt; <span class="number">2048</span> || height &gt; <span class="number">2048</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> passes = png_set_interlace_handling(png_handler.png_ptr);</span><br><span class="line">  png_start_read_image(png_handler.png_ptr);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> pass = <span class="number">0</span>; pass &lt; passes; ++pass) &#123;</span><br><span class="line">    <span class="keyword">for</span> (png_uint_32 y = <span class="number">0</span>; y &lt; height; ++y) &#123;</span><br><span class="line">      png_read_row(png_handler.png_ptr,</span><br><span class="line">                   static_cast&lt;png_bytep&gt;(png_handler.row_ptr), <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于模糊测试来说，能否写出合适的harness关乎着fuzz最后的结果，我们通常选择涉及内存管理，数据处理等方面的函数作为我们的接口函数去fuzz。<br>这里给出的harness中我们比较容易看到它会首先去通过<code>png_sig_cmp</code>函数去判断输入的data是否符合png的格式，符合才能进入到后面的逻辑中，这一方面是确保data的有效性，同时也提高了数据变异的速率。<br>由于要求输入数据为png的格式，那自然想到使用字典去拼接关键字。这样的想法是正确的，下面比较一下两者的差异：<br>先编译:<code>clang++ -O2 -fno-omit-frame-pointer -gline-tables-only -fsanitize=address,fuzzer-no-link -std=c++11 libpng_read_fuzzer.cc -I libpng libpng/.libs/libpng16.a -fsanitize=fuzzer -lz -o libpng_read_fuzzer</code><br>使用的也是AFL给出的png.dict:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># Copyright 2016 Google Inc.</span><br><span class="line">#</span><br><span class="line"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"># you may not use this file except in compliance with the License.</span><br><span class="line"># You may obtain a copy of the License at</span><br><span class="line">#</span><br><span class="line">#      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line">#</span><br><span class="line"># Unless required by applicable law or agreed to in writing, software</span><br><span class="line"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"># See the License for the specific language governing permissions and</span><br><span class="line"># limitations under the License.</span><br><span class="line">#</span><br><span class="line">################################################################################</span><br><span class="line">#</span><br><span class="line"># AFL dictionary for PNG images</span><br><span class="line"># -----------------------------</span><br><span class="line">#</span><br><span class="line"># Just the basic, standard-originating sections; does not include vendor</span><br><span class="line"># extensions.</span><br><span class="line">#</span><br><span class="line"># Created by Michal Zalewski &lt;lcamtuf@google.com&gt;</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">header_png=&quot;\x89PNG\x0d\x0a\x1a\x0a&quot;</span><br><span class="line"></span><br><span class="line">section_IDAT=&quot;IDAT&quot;</span><br><span class="line">section_IEND=&quot;IEND&quot;</span><br><span class="line">section_IHDR=&quot;IHDR&quot;</span><br><span class="line">section_PLTE=&quot;PLTE&quot;</span><br><span class="line">section_bKGD=&quot;bKGD&quot;</span><br><span class="line">section_cHRM=&quot;cHRM&quot;</span><br><span class="line">section_fRAc=&quot;fRAc&quot;</span><br><span class="line">section_gAMA=&quot;gAMA&quot;</span><br><span class="line">section_gIFg=&quot;gIFg&quot;</span><br><span class="line">section_gIFt=&quot;gIFt&quot;</span><br><span class="line">section_gIFx=&quot;gIFx&quot;</span><br><span class="line">section_hIST=&quot;hIST&quot;</span><br><span class="line">section_iCCP=&quot;iCCP&quot;</span><br><span class="line">section_iTXt=&quot;iTXt&quot;</span><br><span class="line">section_oFFs=&quot;oFFs&quot;</span><br><span class="line">section_pCAL=&quot;pCAL&quot;</span><br><span class="line">section_pHYs=&quot;pHYs&quot;</span><br><span class="line">section_sBIT=&quot;sBIT&quot;</span><br><span class="line">section_sCAL=&quot;sCAL&quot;</span><br><span class="line">section_sPLT=&quot;sPLT&quot;</span><br><span class="line">section_sRGB=&quot;sRGB&quot;</span><br><span class="line">section_sTER=&quot;sTER&quot;</span><br><span class="line">section_tEXt=&quot;tEXt&quot;</span><br><span class="line">section_tIME=&quot;tIME&quot;</span><br><span class="line">section_tRNS=&quot;tRNS&quot;</span><br><span class="line">section_zTXt=&quot;zTXt&quot;# </span><br></pre></td></tr></table></figure>
<p>先不使用字典：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./libpng_read_fuzzer -max_total_time=60 -print_final_stats=1</span><br><span class="line">Done 5454409 runs in 61 second(s)</span><br><span class="line">stat::number_of_executed_units: 5454409</span><br><span class="line">stat::average_exec_per_sec:     89416</span><br><span class="line">stat::new_units_added:          512</span><br><span class="line">stat::slowest_unit_time_sec:    0</span><br><span class="line">stat::peak_rss_mb:              822</span><br></pre></td></tr></table></figure>
<p>探测到了512个代码单元<br>之后使用字典：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">./libpng_read_fuzzer -max_total_time=60 -print_final_stats=1 -dict=./png.dict</span><br><span class="line">#2849333	REDUCE cov: 287 ft: 511 corp: 111/19Kb lim: 4096 exec/s: 105530 rss: 682Mb L: 43/3088 MS: 1 EraseBytes-</span><br><span class="line">#2871709	REDUCE cov: 291 ft: 515 corp: 112/19Kb lim: 4096 exec/s: 106359 rss: 682Mb L: 47/3088 MS: 1 ManualDict- DE: &quot;bKGD&quot;-</span><br><span class="line">#2883416	NEW    cov: 293 ft: 520 corp: 113/19Kb lim: 4096 exec/s: 106793 rss: 682Mb L: 48/3088 MS: 2 PersAutoDict-EraseBytes- DE: &quot;sPLT&quot;-</span><br><span class="line">=================================================================</span><br><span class="line">==26551==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x62474b42 bytes</span><br><span class="line">    #0 0x51f69d in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3</span><br><span class="line">    #1 0x5a98a3 in png_read_buffer /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16</span><br><span class="line">    #2 0x5a98a3 in png_handle_sPLT /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:1683:13</span><br><span class="line">    #3 0x571b3c in png_read_info /home/admin/libfuzzer-workshop/lessons/09/libpng/pngread.c:225:10</span><br><span class="line">    #4 0x551b3a in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/09/libpng_read_fuzzer.cc:91:3</span><br><span class="line">    #5 0x459a21 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15</span><br><span class="line">    #6 0x459265 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3</span><br><span class="line">    #7 0x45b507 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19</span><br><span class="line">    #8 0x45c225 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5</span><br><span class="line">    #9 0x449fe8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6</span><br><span class="line">    #10 0x473452 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10</span><br><span class="line">    #11 0x7f5d84c2fbf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)</span><br><span class="line"></span><br><span class="line">==26551==HINT: if you don&#x27;t care about these errors you may set allocator_may_return_null=1</span><br><span class="line">SUMMARY: AddressSanitizer: out-of-memory /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 in malloc</span><br><span class="line">==26551==ABORTING</span><br><span class="line">MS: 1 ShuffleBytes-; base unit: 1c223175724dec61e3adf94affb1cceec27d30ae</span><br><span class="line">0x89,0x50,0x4e,0x47,0xd,0xa,0x1a,0xa,0x0,0x0,0x0,0xd,0x49,0x48,0x44,0x52,0x0,0x0,0x0,0x10,0x0,0x0,0x0,0x63,0x1,0x0,0x0,0x0,0x0,0x4,0x0,0x41,0x41,0x62,0x47,0x4b,0x41,0x73,0x50,0x4c,0x54,0x44,0x41,0x41,0x41,0x41,0x41,0xb9,</span><br><span class="line">\x89PNG\x0d\x0a\x1a\x0a\x00\x00\x00\x0dIHDR\x00\x00\x00\x10\x00\x00\x00c\x01\x00\x00\x00\x00\x04\x00AAbGKAsPLTDAAAAA\xb9</span><br><span class="line">artifact_prefix=&#x27;./&#x27;; Test unit written to ./crash-ac5ad67d43ac829fd5148d6930a33c17c2ac7143</span><br><span class="line">Base64: iVBORw0KGgoAAAANSUhEUgAAABAAAABjAQAAAAAEAEFBYkdLQXNQTFREQUFBQUG5</span><br><span class="line">stat::number_of_executed_units: 2888597</span><br><span class="line">stat::average_exec_per_sec:     103164</span><br><span class="line">stat::new_units_added:          533</span><br><span class="line">stat::slowest_unit_time_sec:    0</span><br><span class="line">stat::peak_rss_mb:              682</span><br></pre></td></tr></table></figure>
<p>啊这，直接出crash,有点东西。这也再次说明了好的字典使得我们fuzz时的输入数据更具有针对性，当然也提高了触发更多代码单元和获得crash的可能。<br>我使用workshop的#1编译方法在使用dict的情况下cov只有40多，也未能得到crash，因此上面能得到crash也得益于我们的插桩策略。<br>在未使用语料库的情况下就得到了crash实属意料之外，如果我们在使用字典的下情况仍然暂时未得到crash，另一个方法可以去寻找一些有效的输入语料库。因为libfuzzer是进化型的fuzz，结合了产生和变异两个发面。如果我们可以提供一些好的seed，虽然它本身没法造成程序crash，但libfuzzer会在此基础上进行变异，就有可能变异出更好的语料，从而增大程序crash的概率。具体的变异策略需要我们去阅读libfuzzer的源码或者些相关的论文。<br>workshop给我们提供了一些seed：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  09 git:(master) ✗ ls seed_corpus </span><br><span class="line">anti_aliasing_perspective.png             blue_yellow_alpha.png                green.png                                  offset_background_filter_1x.png</span><br><span class="line">anti_aliasing.png                         blue_yellow_alpha_translate.png      green_small.png                            offset_background_filter_2x.png</span><br><span class="line">axis_aligned.png                          blue_yellow_anti_aliasing.png        green_small_with_blue_corner.png           rotated_drop_shadow_filter_gl.png</span><br><span class="line">background_filter_blur_off_axis.png       blue_yellow_filter_chain.png         green_with_blue_corner.png                 rotated_drop_shadow_filter_sw.png</span><br><span class="line">background_filter_blur_outsets.png        blue_yellow_flipped.png              image_mask_of_layer.png                    rotated_filter_gl.png</span><br><span class="line">background_filter_blur.png                blue_yellow_partial_flipped.png      intersecting_blue_green.png                rotated_filter_sw.png</span><br><span class="line">background_filter_on_scaled_layer_gl.png  blue_yellow.png                      intersecting_blue_green_squares.png        scaled_render_surface_layer_gl.png</span><br><span class="line">background_filter_on_scaled_layer_sw.png  blur_filter_with_clip_gl.png         intersecting_blue_green_squares_video.png  scaled_render_surface_layer_sw.png</span><br><span class="line">background_filter.png                     blur_filter_with_clip_sw.png         intersecting_light_dark_squares_video.png  spiral_64_scale.png</span><br><span class="line">background_filter_rotated_gl.png          checkers_big.png                     mask_bottom_right.png                      spiral_double_scale.png</span><br><span class="line">background_filter_rotated_sw.png          checkers.png                         mask_middle.png                            spiral.png</span><br><span class="line">black.png                                 dark_grey.png                        mask_of_background_filter.png              white.png</span><br><span class="line">blending_and_filter.png                   enlarged_texture_on_crop_offset.png  mask_of_clipped_layer.png                  wrap_mode_repeat.png</span><br><span class="line">blending_render_pass_cm.png               enlarged_texture_on_threshold.png    mask_of_layer.png                          yuv_stripes_alpha.png</span><br><span class="line">blending_render_pass_mask_cm.png          filter_with_giant_crop_rect.png      mask_of_layer_with_blend.png               yuv_stripes_clipped.png</span><br><span class="line">blending_render_pass_mask.png             force_anti_aliasing_off.png          mask_of_replica_of_clipped_layer.png       yuv_stripes_offset.png</span><br><span class="line">blending_render_pass.png                  four_blue_green_checkers_linear.png  mask_of_replica.png                        yuv_stripes.png</span><br><span class="line">blending_transparent.png                  four_blue_green_checkers.png         mask_with_replica_of_clipped_layer.png     zoom_filter_gl.png</span><br><span class="line">blending_with_root.png                    green_alpha.png                      mask_with_replica.png                      zoom_filter_sw.png</span><br></pre></td></tr></table></figure>
<p>使用seed_corpus去fuzz:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">➜  09 git:(master) ✗ ./libpng_read_fuzzer seed_corpus</span><br><span class="line">#502095	REDUCE cov: 626 ft: 2025 corp: 450/631Kb lim: 19944 exec/s: 4219 rss: 457Mb L: 821/19555 MS: 2 CMP-EraseBytes- DE: &quot;JDAT&quot;-</span><br><span class="line">#502951	REDUCE cov: 626 ft: 2025 corp: 450/630Kb lim: 19944 exec/s: 4226 rss: 457Mb L: 2710/19555 MS: 1 EraseBytes-</span><br><span class="line">#503447	REDUCE cov: 626 ft: 2025 corp: 450/630Kb lim: 19944 exec/s: 4230 rss: 457Mb L: 467/19555 MS: 1 EraseBytes-</span><br><span class="line">=================================================================</span><br><span class="line">==26681==ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x60000008 bytes</span><br><span class="line">    #0 0x51f69d in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3</span><br><span class="line">    #1 0x5ad493 in png_read_buffer /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16</span><br><span class="line">    #2 0x5ad493 in png_handle_sCAL /home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:2323:13</span><br><span class="line">    #3 0x571a4c in png_read_info /home/admin/libfuzzer-workshop/lessons/09/libpng/pngread.c:200:10</span><br><span class="line">    #4 0x551b3a in LLVMFuzzerTestOneInput /home/admin/libfuzzer-workshop/lessons/09/libpng_read_fuzzer.cc:91:3</span><br><span class="line">    #5 0x459a21 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:553:15</span><br><span class="line">    #6 0x459265 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:469:3</span><br><span class="line">    #7 0x45b507 in fuzzer::Fuzzer::MutateAndTestOne() /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:695:19</span><br><span class="line">    #8 0x45c225 in fuzzer::Fuzzer::Loop(std::Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:831:5</span><br><span class="line">    #9 0x449fe8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:825:6</span><br><span class="line">    #10 0x473452 in main /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10</span><br><span class="line">    #11 0x7fc8e2ee1bf6 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21bf6)</span><br><span class="line"></span><br><span class="line">==26681==HINT: if you don&#x27;t care about these errors you may set allocator_may_return_null=1</span><br><span class="line">SUMMARY: AddressSanitizer: out-of-memory /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3 in malloc</span><br><span class="line">==26681==ABORTING</span><br><span class="line">MS: 1 ChangeByte-; base unit: 7221de698a693628dcbac00aa34b38a2aca2a905</span><br><span class="line">0x89,0x50,0x4e,0x47,0xd,0xa,0x1a,0xa,0x0,0x0,0x0,0xd,0x49,0x48,0x44,0x52,0x0,0x0,0x0,0x27,0x0,0x0,0x0,0xc8,0x8,0x2,0x0,0x0,0x0,0x22,0x3a,0x39,0xc9,0x0,0x0,0x0,0x1,0x73,0x52,0x47,0x42,0x0,0xae,0xce,0x1c,0xe9,0x0,0x0,0x0,0x9,0x70,0x48,0x59,0x73,0x0,0x0,0xb,0x13,0x0,0x0,0xb,0x13,0x1,0x0,0x9a,0x9c,0x18,0x60,0x0,0x0,0x7,0x73,0x43,0x41,0x4c,0x7,0xdd,0xed,0x4,0x14,0x33,0x74,0x49,0x0,0x0,0x0,0x0,0xb7,0xba,0x47,0x42,0x60,0x82,</span><br><span class="line">\x89PNG\x0d\x0a\x1a\x0a\x00\x00\x00\x0dIHDR\x00\x00\x00&#x27;\x00\x00\x00\xc8\x08\x02\x00\x00\x00\&quot;:9\xc9\x00\x00\x00\x01sRGB\x00\xae\xce\x1c\xe9\x00\x00\x00\x09pHYs\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\x00\x9a\x9c\x18`\x00\x00\x07sCAL\x07\xdd\xed\x04\x143tI\x00\x00\x00\x00\xb7\xbaGB`\x82</span><br><span class="line">artifact_prefix=&#x27;./&#x27;; Test unit written to ./crash-110b2ad7102489b24efc4899bf7d9e55904eb83b</span><br><span class="line">Base64: iVBORw0KGgoAAAANSUhEUgAAACcAAADICAIAAAAiOjnJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGGAAAAdzQ0FMB93tBBQzdEkAAAAAt7pHQmCC</span><br></pre></td></tr></table></figure>
<p>也顺利得到了crash，这次的crash和上面的crash有所不同，上面造成crash时的cov只有293，而且造成crash的输入为<code>Base64: iVBORw0KGgoAAAANSUhEUgAAABAAAABjAQAAAAAEAEFBYkdLQXNQTFREQUFBQUG51</code>，而使用seed的话cov达到了626，而且造成crash的数据为<code>Base64: iVBORw0KGgoAAAANSUhEUgAAACcAAADICAIAAAAiOjnJAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGGAAAAdzQ0FMB93tBBQzdEkAAAAAt7pHQmCC</code>，要长很多。<br>多数情况下我们同时使用字典和语料库，从产生和变异两个方面去提高样例的威力，双管齐下。</p>
<p>接下来就要分析crash的原因了：<code>ERROR: AddressSanitizer: allocator is out of memory trying to allocate 0x60000008 bytes</code>，怎么有点眼熟，好像和lesson 09的报错一样。。但也有所不同，它对错误定位在了<code>in malloc /local/mnt/workspace/bcain_clang_bcain-ubuntu_23113/llvm/utils/release/final/llvm.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3</code>，这个是底层malloc的位置，同时有个hint：<code>if you don&#39;t care about these errors you may set allocator_may_return_null=1</code>，提示我们这个crash是由于malloc申请失败造成的，也就是<code>/home/admin/libfuzzer-workshop/lessons/09/libpng/pngrutil.c:310:16</code>处的malloc:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (buffer == <span class="literal">NULL</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      buffer = png_voidcast(png_bytep, png_malloc_base(png_ptr, new_size));  <span class="comment">//此处的png_malloc_base</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (buffer != <span class="literal">NULL</span>)</span><br><span class="line">      &#123;</span><br><span class="line">         png_ptr-&gt;read_buffer = buffer;</span><br><span class="line">         png_ptr-&gt;read_buffer_size = new_size;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (warn &lt; <span class="number">2</span>) <span class="comment">/* else silent */</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span> (warn != <span class="number">0</span>)</span><br><span class="line">             png_chunk_warning(png_ptr, <span class="string">&quot;insufficient memory to read chunk&quot;</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             png_chunk_error(png_ptr, <span class="string">&quot;insufficient memory to read chunk&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>定位到问题出在png_malloc_base(png_ptr, new_size)处，由于没有对new_size的大小进行严格限制岛主在malloc时<code>trying to allocate 0x60000008 bytes</code>导致异常崩溃。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这一篇操作下来我感觉到对于提高libfuzzer的效率包括在编译插桩、字典使用、语料库选择方面有了更清楚的认识。模糊测试fuzz在软件诞生时就应运而生了，经过了如此长时间的发展，对人们它的研究也在不断深入，并且根据不同的需求开发出了很多个性化的fuzz工具。正所谓理论结合实践，要想对libfuzzer有更深入的了解，我们还是要去分析它的源码，参考各种研究paper。</p>
<p>初学libfuzzer，有错误疏忽之处烦请各位师傅指正。</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/FUZZ/">FUZZ</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/01/06/libfuzzer3/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">（转）LibFuzzer workshop学习之路（三）</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/12/17/LibFuzzer(1)/"><span class="level-item">（转）LibFuzzer workshop学习之路（一）</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">An9Ela</a><p class="is-size-7"><span>&copy; 2022 An9Ela</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("default");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>